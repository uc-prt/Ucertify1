{"version":3,"file":"VideoPlus-b855a8fb.js","sources":["../../../src/components/VideoPlus.svelte"],"sourcesContent":["<script>\n    import { writable } from \"svelte/store\";\n    import { beforeUpdate, onMount } from \"svelte\";\n    import { AH } from \"../../helper/HelperAI.svelte\";\n    export let setAjaxContent;\n    export let editorState;\n    let lastAction =\"\"\n    let state = {};\n    let hdd = writable({\n\t\t\tsequence:'0',\n\t\t\tinfo:\"\",\n\t\t\tvtt:\"\"\n        });\n    const unsubscribe = hdd.subscribe((items)=> {\n        state = items;\n    })\n        \n    onMount(()=> {\n        if (setAjaxContent) {\n\t\t\tvar ajaxPageData = setAjaxContent['page_data'];\n\t\t\tstate.vtt = setAjaxContent['vtt'],\n\t\t\tstate.info = setAjaxContent['info']\n            if (ajaxPageData) {\n                ajaxPageData = setAjaxContent['page_data'].replace(/id=\"update-vtt\"/gmi,'id=\"update-vtt\" in_editor=\"1\" ');\n                AH.select('#previewSection').innerHTML = ajaxPageData;\n            }\n\t\t}\n\t\tAH.listen(document, 'click','#showPreview', updateVideoContent.bind(this));\n\t\tAH.listen(document, 'click','#update-vtt',function(_this) {\n\t\t\tAH.selectAll(\".text\").forEach((elm, index)=> {\n\t\t        captions[index].text = elm.textContent;\n\t\t    });\n\t\t    var vtt_data = JSON.stringify(captions);\n            editorState.activator = true;\n            \n\t\t\tAH.ajax({\n\t\t       url: baseUrl+\"editor/index.php\",\n\t\t       type: 'POST',\n\t\t       data: {\n\t\t\t\t   ajax:1,\n\t\t\t\t   content_guid:self.props.guid,\n\t\t\t\t   text:vtt_data,\n\t\t\t\t   tag:[],\n\t\t\t\t   action:'update_vtt',\n\t\t\t\t   in_editor:1\n                },\n            }).then((data)=> {\n                try {\n                    AH.select('#save_xml').classList.remove('disabled');\n                    AH.select('#save_xml').setAttribute('disabled', false);\n                    data = JSON.parse(data);\n                    state.vtt = data.vtt;\n                    state.info = data.info;\n                    AH.select('#vtt').innerHTML = data.vtt;\n                    AH.select('#info').innerHTML = data.info;\n                    AH.select('#showPreview').click();\n                }\n                catch(err) {\n                    console.log({err,func:'componentDidMount @ 70'});\n                }\n\t\t    });\n\t\t});\n\t\ttinyMCE.PluginManager.add('changeInModule', function(editorPlugin, url) {\n\t\t\teditorPlugin.on('change click', function(e) {\n\t\t\t\ttry {\n\t\t\t\t\tsetContent(tinyMCE.activeEditor.id);\n\t\t\t\t} catch(error) {\n\t\t\t\t\tconsole.log({error, func:'loadVideoListener @ 1173'});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n    })\n\n    beforeUpdate(async ()=> {\n\t\tlet videoHeight = AH.select(\".video-container\").clientHeight;\n\t\tif (videoHeight > 100 && videoHeight > AH.select(\"#sidebar\").clientHeight) {\n\t\t\tAH.select(\"#sidebar\").style.height = videoHeight - (isNaN(AH.select('.sidetab_ul').clientHeight) ? 0 : AH.select('.sidetab_ul').clientHeight);\n\t\t\tlet reduceHeight = videoHeight - (AH.select(\".trans_toolbar\").clientHeight + 10);\n\t\t\tAH.select(\"#transcript\").style.height = reduceHeight;\n\t\t\tAH.selectAll(\"#transcript,.transcript-ul\").forEach((elm)=> elm.style.height = (AH.select('#video-container').outerHeight - AH.select('.sidetab_ul').outerHeight - 4) +'px');\n\t\t\tAH.select('.video_comment_section').style.height = AH.select('#video-container').outerHeight - AH.select('.sidetab_ul').outerHeight - 4;\n\t\t}\n\t})\n\n\tfunction updateVideoContent(){\n\t\tvar content = {};\n\t\tcontent['title'] = editorState.title;\n\t\tcontent['content'] = (editorState.content) ? editorState.content.replace(/'/g,'\"') : '';\n\t\tcontent['info'] = state.info;\n\t\tvar vtt = (state.vtt) ? state.vtt.replace(/<br>|<br\\/>|<br \\/>/gim,\"\\n\").replace(/<span>|<\\/span>/gim,'') : \"\";\n\t\tcontent['vtt'] = vtt.replace(/ \\n|\\n |\\n/g,\"\\n\");\n\t\teditorState.activator = true;\n\t\tAH.ajax({\n            url: baseUrl+'editor/index.php', \n            cache: false,\n            data: {ajax:1, content_guid : editorState.guid,title:content['title'],content:content['content'],info:content['info'],vtt:content['vtt'],content_type : 'f',content_subtype : '45',content_text:content , func:'react_get_preview'},                         \n        }).then((response)=> {\n            response = JSON.parse(response);\n            response['page_data'] = response['page_data'].replace(/id=\"update-vtt\"/gmi,'id=\"update-vtt\" in_editor=\"1\" ');\n            AH.select('#previewSection').innerHTML = response['page_data'];\n            editorState.activator = false;\n\t\t});\n\t}\n\n\tfunction setContent(type) {\n\t\t(lastAction) ? clearTimeout(lastAction) : \"\";\n\t\tlastAction = setTimeout(function() {\n\t\t\tvar content = tinyMCE.activeEditor.getContent({format : 'raw'});\n\t\t\tcontent = content.replace(/<span class=\"nanospell-typo\" data-mce-bogus=\"1\">/g, '');\n\t\t\tcontent = content.replace(/<span class=\"\" data-mce-bogus=\"1\">/g, '');\n\t\t\t(content.match(/<uc:syntax/gm)) ? prettyPrint() : '';\n\t\t\tstate[type] = content.replace(/<br>|<br\\/>|<br \\/>/gim,\"\\n\").replace(/<span>|<\\/span>/gim,'');\n            updateVttAndInfo(state.vtt, state.info);\n\t\t\tclearTimeout(lastAction);\n\t\t},200);\n    }\n    function updateVttAndInfo(vtt, info) {\n\t\teditorState.vtt = vtt;\n\t\teditorState.info = info;\n\t}\n</script>\n\n<div id=\"authoringArea\">\n    <div \n        class=\"tinymce-editor auth-editor\"\n        contentEditable={true}\n        id=\"vtt\"\n        data-text=\"Vtt\"\n        on:keyup={setContent.bind(this, 'vtt')}\n        style=\"border-bottom: 1px solid #e7e7e7; margin: 5px 0 5px 0; whiteSpace: pre-line; clear: both; min-height: 125px\"  \n    ></div>\n    <div \n        class=\"tinymce-editor auth-editor\"\n        contentEditable={true}\n        id=\"info\"\n        data-text=\"Info\"\n        on:keyup={setContent.bind(this, 'info')}\n        style=\"border-bottom: 1px solid #e7e7e7; margin: 5px 0 5px 0; whiteSpace: pre-line; clear: both; min-height: 125px\"  \n    ></div>\n</div>"],"names":[],"mappings":"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"}