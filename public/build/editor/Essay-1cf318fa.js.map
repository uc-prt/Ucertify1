{"version":3,"file":"Essay-1cf318fa.js","sources":["../../../clsSMEssay/Essay.svelte"],"sourcesContent":["<script>\r\n    import { beforeUpdate,onMount } from \"svelte\";\r\n    import { AH, XMLToJSON } from \"../helper/HelperAI.svelte\";\r\n    import SUNEDITOR from 'suneditor';\r\n    import plugins from 'suneditor/src/plugins';\r\n    import { Checkbox } from 'svelte-mui/src';\r\n    export let xml;\r\n    export let getChildXml;\r\n    export let l;\r\n    let isUpload = false;\r\n    let author_xml;\r\n    const headingArray = [{\"font\": \"fontSize 6\",\"text\": \"Heading 1\"}, {\"font\": \"fontSize 5\",\"text\": \"Heading 2\"}, {\"font\": \"fontSize 4\",\"text\": \"Heading 3\"},{\"font\": \"fontSize 3\",\"text\": \"Heading 4\"},{\"font\": \"fontSize 2\",\"text\": \"Heading 5\"},{\"font\": \"fontSize 1\",\"text\": \"Heading 6\"}];\r\n    let essayAuthEditor;\r\n    let timer = null;\r\n    let state = {\r\n        files_number : 0,\r\n        cdata : true,\r\n        file_ext: \"\"\r\n    };\r\n    \r\n    onMount(()=> {\r\n        initEdit();\r\n        let listenrTarget = AH.find('#SM_essay', 'a,button,input,select');\r\n        AH.listenAll(listenrTarget, \"blur\", (e)=> { \r\n            updateXML(500); \r\n        });\r\n        // AH.listenAll(listenrTarget, \"keyup\", ()=> { updateXML(500); });\r\n        // AH.listenAll(listenrTarget, \"keydown\", ()=> { updateXML(500); });\r\n\r\n        AH.bind(\"#files_number\", 'keydown', (e)=> {\r\n            if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {\r\n                AH.select(\"#err_txt\").innerHTML = \"Digits Only\";\r\n                AH.selectAll(\"#err_txt\", 'show');\r\n                return false;\r\n            }\r\n        });\r\n\r\n        // if ((navigator.userAgent.indexOf(\"MSIE \") > -1 || navigator.userAgent.indexOf(\"Trident/\")) > -1) {\r\n        //     jQuery('#uploadChk').keyup(function(e) { if (e.keyCode == 32) this.click() });\r\n        // }\r\n\r\n        let parsedXmlNode = AH.parseHtml(xml);\r\n        if (AH.find(parsedXmlNode, 'default') && AH.find(parsedXmlNode, 'default').getAttribute('type') == 1) {\r\n            AH.selectAll('.upload-area', 'removeClass', 'h');\r\n            AH.select('#uploadChk').checked = true;\r\n            AH.select(`#choose_ext option[value=\"${AH.find(parsedXmlNode, 'default').getAttribute('fileTypeExts')}\"]`, 'attr',{selected: 'selected'});\r\n            AH.select('#files_number').value = AH.find(parsedXmlNode, 'default').getAttribute('limit');\r\n        }\r\n\r\n        updateXML();\r\n        parseXml(xml);\r\n    });\r\n\r\n    function initEdit() {\r\n        essayAuthEditor = SUNEDITOR.create('essay_editorAuth', { \r\n            width: 'auto',\r\n            toolbarContainer: \"#essayToolbar\",\r\n            placeholder: \"Write text here.\",\r\n            plugins: plugins, \r\n            resizingBar: false,\r\n            showPathLabel: false,\r\n            linkProtocol: \"https://\",\r\n            attributesWhitelist: {\r\n                \"all\": \"style\",\r\n                \"font\": \"size\"\r\n            },\r\n            \"addTagsWhitelist\": \"font\",\r\n            buttonList: [\r\n                ['formatBlock'],\r\n                ['bold', 'italic', 'underline'],\r\n                ['link'],\r\n                ['list', 'outdent', 'indent', 'align'],\r\n                ['removeFormat'],\r\n            ] \r\n        });\r\n\r\n        essayAuthEditor.onChange = (content, core)=> {\r\n            updateXML(1000, content);\r\n        }\r\n        essayAuthEditor.onKeyDown = (e, core)=> {\r\n            if (e.keyCode == 86 || e.keyCode == 67) {\r\n                updateXML(1000);\r\n            }\r\n        }\r\n    }\r\n    // // it detects any change in xml.\r\n    // beforeUpdate(()=> {\r\n    //     if (xml != author_xml) {\r\n    //         author_xml = xml;\r\n    //         parseXml(xml);\r\n    //     }\r\n    // });\r\n    \r\n\r\n    // if xml change the it updates cdata\r\n    function parseXml(xml) {\r\n        if (state.cdata) {\r\n            state.cdata = false;\r\n            let qxml = XMLToJSON(xml);\r\n            if ( AI.isValid(qxml) && AI.isValid(qxml.smxml.default) ) {\r\n                essayAuthEditor.setContents(qxml.smxml.default.__cdata);\r\n            }\r\n        }\r\n    }\r\n\r\n    // it checks the no .of files for upload. \r\n    function maxLengthCheck(e) {\r\n        if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {\r\n            AH.select(\"#err_txt\").innerHTML = \"Digits Only\";\r\n            AH.selectAll(\"#err_txt\", 'show');\r\n            return false;\r\n        }\r\n        updateXML(100);\r\n    }\r\n\r\n    // it updates the xml;\r\n    function updateXML(time, content) {\r\n        if (timer) {\r\n            clearTimeout(timer);\r\n        }\r\n        timer = setTimeout(function() {\r\n            let val = content || essayAuthEditor.getContents();\r\n            let xmlDom = AH.parseHtml(xml);\r\n            let defaultDom = xmlDom.querySelector('default');\r\n            if (AH.select(\"#uploadChk\").checked) {\r\n                isUpload = true;\r\n                if (defaultDom) {\r\n                    AH.setAttr(defaultDom, {\r\n                        'type': 1,\r\n                        'fileTypeExts': state.file_ext || defaultDom.getAttribute('filetypeexts') || \"*.txt,*.doc,*.docx,*.pdf,*.jpg,*.png,*.gif,*.bmp,*.jpeg\",\r\n                        'limit': state.files_number || defaultDom.getAttribute('limit') || 1\r\n                    });\r\n                    state.files_number = state.files_number || defaultDom.getAttribute('limit');\r\n                    state.file_ext = state.file_ext || defaultDom.getAttribute('filetypeexts');\r\n                } else {\r\n                    let defHtml = AH.parseHtml(`<default type=\"1\" fileTypeExts=\"${state.file_ext || \"*.txt,*.doc,*.docx,*.pdf,*.jpg,*.png,*.gif,*.bmp,*.jpeg\"}\" limit=\"${state.files_number || 1}\"></default>`);\r\n                    xmlDom.appendChild(defHtml);\r\n                }\r\n            } else if (defaultDom) {\r\n                defaultDom.setAttribute('type', 0)\r\n                defaultDom.removeAttribute(...['fileTypeExts', 'limit']);\r\n            }\r\n            if (defaultDom) {\r\n                defaultDom.innerHTML = `<!--[CDATA[${val}]]-->`;\r\n            } else {\r\n                let defHtml = AH.parseHtml(`<default type=\"0\"><!--[CDATA[${val}]]--></default>`);\r\n                xmlDom.appendChild(defHtml);\r\n            }\r\n            author_xml = formatXml(xmlDom.outerHTML);\r\n            getChildXml(author_xml);\r\n        }, time);\r\n    }\r\n</script>\r\n\r\n<main id=\"SM_essay\">\r\n    <div class=\"hero-unit\">\r\n        <div id=\"essayToolbar\" class=\"sun-editor\"></div>\r\n        <textarea id=\"essay_editorAuth\" class=\"text-left editor sun-editor-editable\"></textarea>\r\n        <Checkbox \t\r\n            bind:checked={isUpload}\r\n            on:click={updateXML}\r\n            id=\"uploadChk\"\r\n            name=\"uploadChk\"\r\n            color=\"primary\"\r\n        >\r\n            <span>Upload</span>\r\n        </Checkbox>\r\n        {#if isUpload}\r\n            <div class=\"upload-area mt-3 text-left\">\r\n                <div class=\"row\">\r\n                    <div class=\"col-sm-3\">\r\n                        <label for=\"choose_ext\" class=\"mb-0 pt-sm1 font14\">{l.file_extension_text} </label>\r\n                    </div>\r\n                    <div class=\"col-sm-8\">\r\n                        <select name=\"choose_ext\" id=\"choose_ext\" class=\"form-control form-control-md\" bind:value={state.file_ext} on:blur=\"{()=> updateXML(100)}\">\r\n                            <option value=\"*.txt,*.doc,*.docx,*.pdf,*.jpg,*.png,*.gif,*.bmp,*.jpeg\" selected=\"selected\">All(*.*)</option>\r\n                            <option value=\"*.txt\">*.txt</option>\r\n                            <option value=\"*.pdf\">*.pdf</option>\r\n                            <option value=\"*.doc,*.docx\">*.doc,*.docx</option>\r\n                            <option value=\"*.doc,*.docx,*.pdf\">*.doc,*.docx,*.pdf</option>\r\n                            <option value=\"*.jpg,*.png,*.gif,*.bmp,*.jpeg\">*.jpg,*.png,*.gif,*.bmp,*.jpeg</option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                <div class=\"row mt-2\">\r\n                    <div class=\"col-sm-3\">\r\n                        <label for=\"files_number\" class=\"mb-0 font14 pt-1\">{l.number_of_files} </label>\r\n                    </div>\r\n                    <div class=\"col-sm-8\">\r\n                        <input \r\n                            type=\"number\" \r\n                            class=\"form-control form-control-md float-left filenumber\" \r\n                            name=\"files_number\" \r\n                            id=\"files_number\" \r\n                            bind:value={state.files_number} \r\n                            step=\"1\" \r\n                            min=\"1\" \r\n                            max=\"10\" \r\n                            on:change={maxLengthCheck} \r\n                            required=\"required\"\r\n                        />\r\n                        <small class=\"font11\">{l.you_can_upload}</small>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        {/if}\r\n    </div>\r\n</main>\r\n<style>\r\n\r\n    :global(a:hover) {\r\n        text-decoration: none;\r\n    }\r\n    .hero-unit {\r\n        border: 1px solid #ccc;\r\n        width: 84%;\r\n        padding: 18px!important;\r\n        font-size: 15px!important;\r\n        margin-bottom: 30px;\r\n        font-weight: 200;\r\n        line-height: 30px;\r\n        color: inherit;\r\n        background-color: #eeeeee;\r\n        -webkit-border-radius: 6px;\r\n        -moz-border-radius: 6px;\r\n        border-radius: 6px;\r\n    }\r\n    #essay_editorAuth {\r\n        max-height: 250px;\r\n        height: 250px;\r\n        background-color: white;\r\n        border-collapse: separate;\r\n        border: 1px solid rgb(204, 204, 204);\r\n        padding: 4px;\r\n        box-sizing: content-box;\r\n        -webkit-box-shadow: rgba(0, 0, 0, 0.0745098) 0px 1px 1px 0px inset;\r\n        box-shadow: rgba(0, 0, 0, 0.0745098) 0px 1px 1px 0px inset;\r\n        border-top-right-radius: 3px;\r\n        border-bottom-right-radius: 3px;\r\n        border-bottom-left-radius: 3px;\r\n        border-top-left-radius: 3px;\r\n        overflow: scroll;\r\n        outline: none;\r\n    }\r\n    .essay-btn, .essay-btn-add {\r\n        display: inline-block;\r\n        padding: 4px 8px;\r\n        font-size: 12px;\r\n        line-height: 20px;\r\n        text-align: center;\r\n        vertical-align: middle;\r\n        cursor: pointer;\r\n        color: #333333;\r\n        text-shadow: 0 1px 1px rgba(255, 255, 255, 0.75);\r\n        background-color: #f5f5f5;\r\n        background-image: -moz-linear-gradient(top, #ffffff, #e6e6e6);\r\n        background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#ffffff), to(#e6e6e6));\r\n        background-image: -webkit-linear-gradient(top, #ffffff, #e6e6e6);\r\n        background-image: -o-linear-gradient(top, #ffffff, #e6e6e6);\r\n        background-image: linear-gradient(to bottom, #ffffff, #e6e6e6);\r\n        background-repeat: repeat-x;\r\n        /* filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffffff', endColorstr='#ffe6e6e6', GradientType=0); */\r\n        border-color: #e6e6e6 #e6e6e6 #bfbfbf;\r\n        border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);\r\n        /* filter: progid:DXImageTransform.Microsoft.gradient(enabled = false); */\r\n        border: 1px solid #cccccc;\r\n        border-bottom-color: #b3b3b3;\r\n        -webkit-border-radius: 4px;\r\n        -moz-border-radius: 4px;\r\n        border-radius: 4px;\r\n        -webkit-box-shadow: inset 0 1px 0 rgba(255,255,255,.2), 0 1px 2px rgba(0,0,0,.05);\r\n        -moz-box-shadow: inset 0 1px 0 rgba(255,255,255,.2), 0 1px 2px rgba(0,0,0,.05);\r\n        box-shadow: inset 0 1px 0 rgba(255,255,255,.2), 0 1px 2px rgba(0,0,0,.05);\r\n    }\r\n    .dropdown-item {\r\n        display: block;\r\n        width: 100%;\r\n        padding: 4px 12px;\r\n        clear: both;\r\n        font-weight: 400;\r\n        color: #212529;\r\n        text-align: inherit;\r\n        white-space: nowrap;\r\n        background-color: transparent;\r\n        border: 0;\r\n    }\r\n    .essay-btn {\r\n        margin-bottom: 15px;\r\n    }\r\n    .essay-container .upload-area #files_number {\r\n        width: 115px;\r\n    }\r\n    .essay-container {\r\n        width: 89%;\r\n    }\r\n</style>"],"names":["insert","ctx","file_extension_text","number_of_files","you_can_upload","file_ext","append","files_number","author_xml","essayAuthEditor","xml","getChildXml","l","isUpload","timer","state","cdata","updateXML","time","content","clearTimeout","setTimeout","val","getContents","xmlDom","AH","parseHtml","defaultDom","querySelector","select","checked","setAttr","type","fileTypeExts","getAttribute","limit","defHtml","appendChild","setAttribute","removeAttribute","innerHTML","formatXml","outerHTML","onMount","SUNEDITOR","create","width","toolbarContainer","placeholder","plugins","resizingBar","showPathLabel","linkProtocol","attributesWhitelist","all","font","addTagsWhitelist","buttonList","onChange","core","onKeyDown","e","keyCode","listenrTarget","find","listenAll","bind","which","selectAll","parsedXmlNode","selected","value","qxml","XMLToJSON","AI","isValid","smxml","default","setContents","__cdata","parseXml"],"mappings":"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"}