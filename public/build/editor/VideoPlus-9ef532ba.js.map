{"version":3,"file":"VideoPlus-9ef532ba.js","sources":["../../../src/components/VideoPlus.svelte"],"sourcesContent":["<script>\r\n    import { writable } from \"svelte/store\";\r\n    import { beforeUpdate, onMount } from \"svelte\";\r\n    import { AH } from \"../../helper/HelperAI.svelte\";\r\n    export let setAjaxContent;\r\n    export let editorState;\r\n    let lastAction =\"\"\r\n    let state = {};\r\n    let hdd = writable({\r\n\t\t\tsequence:'0',\r\n\t\t\tinfo:\"\",\r\n\t\t\tvtt:\"\"\r\n        });\r\n    const unsubscribe = hdd.subscribe((items)=> {\r\n        state = items;\r\n    })\r\n        \r\n    onMount(()=> {\r\n        if (setAjaxContent) {\r\n\t\t\tvar ajaxPageData = setAjaxContent['page_data'];\r\n\t\t\tstate.vtt = setAjaxContent['vtt'],\r\n\t\t\tstate.info = setAjaxContent['info']\r\n            if (ajaxPageData) {\r\n                ajaxPageData = setAjaxContent['page_data'].replace(/id=\"update-vtt\"/gmi,'id=\"update-vtt\" in_editor=\"1\" ');\r\n                AH.select('#previewSection').innerHTML = ajaxPageData;\r\n            }\r\n\t\t}\r\n\t\tAH.listen(document, 'click','#showPreview', updateVideoContent.bind(this));\r\n\t\tAH.listen(document, 'click','#update-vtt',function(_this) {\r\n\t\t\tAH.selectAll(\".text\").forEach((elm, index)=> {\r\n\t\t        captions[index].text = elm.textContent;\r\n\t\t    });\r\n\t\t    var vtt_data = JSON.stringify(captions);\r\n            editorState.activator = true;\r\n            \r\n\t\t\tAH.ajax({\r\n\t\t       url: baseUrl+\"editor/index.php\",\r\n\t\t       type: 'POST',\r\n\t\t       data: {\r\n\t\t\t\t   ajax:1,\r\n\t\t\t\t   content_guid:self.props.guid,\r\n\t\t\t\t   text:vtt_data,\r\n\t\t\t\t   tag:[],\r\n\t\t\t\t   action:'update_vtt',\r\n\t\t\t\t   in_editor:1\r\n                },\r\n            }).then((data)=> {\r\n                try {\r\n                    AH.select('#save_xml').classList.remove('disabled');\r\n                    AH.select('#save_xml').setAttribute('disabled', false);\r\n                    data = JSON.parse(data);\r\n                    state.vtt = data.vtt;\r\n                    state.info = data.info;\r\n                    AH.select('#vtt').innerHTML = data.vtt;\r\n                    AH.select('#info').innerHTML = data.info;\r\n                    AH.select('#showPreview').click();\r\n                }\r\n                catch(err) {\r\n                    console.log({err,func:'componentDidMount @ 70'});\r\n                }\r\n\t\t    });\r\n\t\t});\r\n\t\ttinyMCE.PluginManager.add('changeInModule', function(editorPlugin, url) {\r\n\t\t\teditorPlugin.on('change click', function(e) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tsetContent(tinyMCE.activeEditor.id);\r\n\t\t\t\t} catch(error) {\r\n\t\t\t\t\tconsole.log({error, func:'loadVideoListener @ 1173'});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n    })\r\n\r\n    beforeUpdate(async ()=> {\r\n\t\tlet videoHeight = AH.select(\".video-container\").clientHeight;\r\n\t\tif (videoHeight > 100 && videoHeight > AH.select(\"#sidebar\").clientHeight) {\r\n\t\t\tAH.select(\"#sidebar\").style.height = videoHeight - (isNaN(AH.select('.sidetab_ul').clientHeight) ? 0 : AH.select('.sidetab_ul').clientHeight);\r\n\t\t\tlet reduceHeight = videoHeight - (AH.select(\".trans_toolbar\").clientHeight + 10);\r\n\t\t\tAH.select(\"#transcript\").style.height = reduceHeight;\r\n\t\t\tAH.selectAll(\"#transcript,.transcript-ul\").forEach((elm)=> elm.style.height = (AH.select('#video-container').outerHeight - AH.select('.sidetab_ul').outerHeight - 4) +'px');\r\n\t\t\tAH.select('.video_comment_section').style.height = AH.select('#video-container').outerHeight - AH.select('.sidetab_ul').outerHeight - 4;\r\n\t\t}\r\n\t})\r\n\r\n\tfunction updateVideoContent(){\r\n\t\tvar content = {};\r\n\t\tcontent['title'] = editorState.title;\r\n\t\tcontent['content'] = (editorState.content) ? editorState.content.replace(/'/g,'\"') : '';\r\n\t\tcontent['info'] = state.info;\r\n\t\tvar vtt = (state.vtt) ? state.vtt.replace(/<br>|<br\\/>|<br \\/>/gim,\"\\n\").replace(/<span>|<\\/span>/gim,'') : \"\";\r\n\t\tcontent['vtt'] = vtt.replace(/ \\n|\\n |\\n/g,\"\\n\");\r\n\t\teditorState.activator = true;\r\n\t\tAH.ajax({\r\n            url: baseUrl+'editor/index.php', \r\n            cache: false,\r\n            data: {ajax:1, content_guid : editorState.guid,title:content['title'],content:content['content'],info:content['info'],vtt:content['vtt'],content_type : 'f',content_subtype : '45',content_text:content , func:'react_get_preview'},                         \r\n        }).then((response)=> {\r\n            response = JSON.parse(response);\r\n            response['page_data'] = response['page_data'].replace(/id=\"update-vtt\"/gmi,'id=\"update-vtt\" in_editor=\"1\" ');\r\n            AH.select('#previewSection').innerHTML = response['page_data'];\r\n            editorState.activator = false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction setContent(type) {\r\n\t\t(lastAction) ? clearTimeout(lastAction) : \"\";\r\n\t\tlastAction = setTimeout(function() {\r\n\t\t\tvar content = tinyMCE.activeEditor.getContent({format : 'raw'});\r\n\t\t\tcontent = content.replace(/<span class=\"nanospell-typo\" data-mce-bogus=\"1\">/g, '');\r\n\t\t\tcontent = content.replace(/<span class=\"\" data-mce-bogus=\"1\">/g, '');\r\n\t\t\t(content.match(/<uc:syntax/gm)) ? prettyPrint() : '';\r\n\t\t\tstate[type] = content.replace(/<br>|<br\\/>|<br \\/>/gim,\"\\n\").replace(/<span>|<\\/span>/gim,'');\r\n            updateVttAndInfo(state.vtt, state.info);\r\n\t\t\tclearTimeout(lastAction);\r\n\t\t},200);\r\n    }\r\n    function updateVttAndInfo(vtt, info) {\r\n\t\teditorState.vtt = vtt;\r\n\t\teditorState.info = info;\r\n\t}\r\n</script>\r\n\r\n<div id=\"authoringArea\">\r\n    <div \r\n        class=\"tinymce-editor auth-editor\"\r\n        contentEditable={true}\r\n        id=\"vtt\"\r\n        data-text=\"Vtt\"\r\n        on:keyup={setContent.bind(this, 'vtt')}\r\n        style=\"border-bottom: 1px solid #e7e7e7; margin: 5px 0 5px 0; whiteSpace: pre-line; clear: both; min-height: 125px\"  \r\n    ></div>\r\n    <div \r\n        class=\"tinymce-editor auth-editor\"\r\n        contentEditable={true}\r\n        id=\"info\"\r\n        data-text=\"Info\"\r\n        on:keyup={setContent.bind(this, 'info')}\r\n        style=\"border-bottom: 1px solid #e7e7e7; margin: 5px 0 5px 0; whiteSpace: pre-line; clear: both; min-height: 125px\"  \r\n    ></div>\r\n</div>"],"names":[],"mappings":"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"}