{"version":3,"file":"VideoPlus-4a1e6e76.js","sources":["../../../src/components/VideoPlus.svelte"],"sourcesContent":["<script>\r\n    import { writable } from \"svelte/store\";\r\n    import { beforeUpdate, onMount } from \"svelte\";\r\n    import { AH } from \"../../helper/HelperAI.svelte\";\r\n    export let setAjaxContent;\r\n    export let editorState;\r\n    let lastAction =\"\"\r\n    let state = {};\r\n    let hdd = writable({\r\n\t\t\tsequence:'0',\r\n\t\t\tinfo:\"\",\r\n\t\t\tvtt:\"\"\r\n        });\r\n    const unsubscribe = hdd.subscribe((items)=> {\r\n        state = items;\r\n    })\r\n        \r\n    onMount(()=> {\r\n        if (setAjaxContent) {\r\n\t\t\tvar ajaxPageData = setAjaxContent['page_data'];\r\n\t\t\tstate.vtt = setAjaxContent['vtt'],\r\n\t\t\tstate.info = setAjaxContent['info']\r\n            if (ajaxPageData) {\r\n                ajaxPageData = setAjaxContent['page_data'].replace(/id=\"update-vtt\"/gmi,'id=\"update-vtt\" in_editor=\"1\" ');\r\n                AH.select('#previewSection').innerHTML = ajaxPageData;\r\n            }\r\n\t\t}\r\n\t\tAH.listen(document, 'click','#showPreview', updateVideoContent.bind(this));\r\n\t\tAH.listen(document, 'click','#update-vtt',function(_this) {\r\n\t\t\tAH.selectAll(\".text\").forEach((elm, index)=> {\r\n\t\t        captions[index].text = elm.textContent;\r\n\t\t    });\r\n\t\t    var vtt_data = JSON.stringify(captions);\r\n            editorState.activator = true;\r\n            \r\n\t\t\tAH.ajax({\r\n\t\t       url: baseUrl+\"editor/index.php\",\r\n\t\t       type: 'POST',\r\n\t\t       data: {\r\n\t\t\t\t   ajax:1,\r\n\t\t\t\t   content_guid:self.props.guid,\r\n\t\t\t\t   text:vtt_data,\r\n\t\t\t\t   tag:[],\r\n\t\t\t\t   action:'update_vtt',\r\n\t\t\t\t   in_editor:1\r\n                },\r\n            }).then((data)=> {\r\n                try {\r\n                    AH.select('#save_xml').classList.remove('disabled');\r\n                    AH.select('#save_xml').setAttribute('disabled', false);\r\n                    data = JSON.parse(data);\r\n                    state.vtt = data.vtt;\r\n                    state.info = data.info;\r\n                    AH.select('#vtt').innerHTML = data.vtt;\r\n                    AH.select('#info').innerHTML = data.info;\r\n                    AH.select('#showPreview').click();\r\n                }\r\n                catch(err) {\r\n                    console.log({err,func:'componentDidMount @ 70'});\r\n                }\r\n\t\t    });\r\n\t\t});\r\n\t\ttinyMCE.PluginManager.add('changeInModule', function(editorPlugin, url) {\r\n\t\t\teditorPlugin.on('change click', function(e) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tsetContent(tinyMCE.activeEditor.id);\r\n\t\t\t\t} catch(error) {\r\n\t\t\t\t\tconsole.log({error, func:'loadVideoListener @ 1173'});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n    })\r\n\r\n    beforeUpdate(async ()=> {\r\n\t\tlet videoHeight = AH.select(\".video-container\").clientHeight;\r\n\t\tif (videoHeight > 100 && videoHeight > AH.select(\"#sidebar\").clientHeight) {\r\n\t\t\tAH.select(\"#sidebar\").style.height = videoHeight - (isNaN(AH.select('.sidetab_ul').clientHeight) ? 0 : AH.select('.sidetab_ul').clientHeight);\r\n\t\t\tlet reduceHeight = videoHeight - (AH.select(\".trans_toolbar\").clientHeight + 10);\r\n\t\t\tAH.select(\"#transcript\").style.height = reduceHeight;\r\n\t\t\tAH.selectAll(\"#transcript,.transcript-ul\").forEach((elm)=> elm.style.height = (AH.select('#video-container').outerHeight - AH.select('.sidetab_ul').outerHeight - 4) +'px');\r\n\t\t\tAH.select('.video_comment_section').style.height = AH.select('#video-container').outerHeight - AH.select('.sidetab_ul').outerHeight - 4;\r\n\t\t}\r\n\t})\r\n\r\n\tfunction updateVideoContent(){\r\n\t\tvar content = {};\r\n\t\tcontent['title'] = editorState.title;\r\n\t\tcontent['content'] = (editorState.content) ? editorState.content.replace(/'/g,'\"') : '';\r\n\t\tcontent['info'] = state.info;\r\n\t\tvar vtt = (state.vtt) ? state.vtt.replace(/<br>|<br\\/>|<br \\/>/gim,\"\\n\").replace(/<span>|<\\/span>/gim,'') : \"\";\r\n\t\tcontent['vtt'] = vtt.replace(/ \\n|\\n |\\n/g,\"\\n\");\r\n\t\teditorState.activator = true;\r\n\t\tAH.ajax({\r\n            url: baseUrl+'editor/index.php', \r\n            cache: false,\r\n            data: {ajax:1, content_guid : editorState.guid,title:content['title'],content:content['content'],info:content['info'],vtt:content['vtt'],content_type : 'f',content_subtype : '45',content_text:content , func:'react_get_preview'},                         \r\n        }).then((response)=> {\r\n            response = JSON.parse(response);\r\n            response['page_data'] = response['page_data'].replace(/id=\"update-vtt\"/gmi,'id=\"update-vtt\" in_editor=\"1\" ');\r\n            AH.select('#previewSection').innerHTML = response['page_data'];\r\n            editorState.activator = false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction setContent(type) {\r\n\t\t(lastAction) ? clearTimeout(lastAction) : \"\";\r\n\t\tlastAction = setTimeout(function() {\r\n\t\t\tvar content = tinyMCE.activeEditor.getContent({format : 'raw'});\r\n\t\t\tcontent = content.replace(/<span class=\"nanospell-typo\" data-mce-bogus=\"1\">/g, '');\r\n\t\t\tcontent = content.replace(/<span class=\"\" data-mce-bogus=\"1\">/g, '');\r\n\t\t\t(content.match(/<uc:syntax/gm)) ? prettyPrint() : '';\r\n\t\t\tstate[type] = content.replace(/<br>|<br\\/>|<br \\/>/gim,\"\\n\").replace(/<span>|<\\/span>/gim,'');\r\n            updateVttAndInfo(state.vtt, state.info);\r\n\t\t\tclearTimeout(lastAction);\r\n\t\t},200);\r\n    }\r\n    function updateVttAndInfo(vtt, info) {\r\n\t\teditorState.vtt = vtt;\r\n\t\teditorState.info = info;\r\n\t}\r\n</script>\r\n\r\n<div id=\"authoringArea\">\r\n    <div \r\n        class=\"tinymce-editor auth-editor\"\r\n        contentEditable={true}\r\n        id=\"vtt\"\r\n        data-text=\"Vtt\"\r\n        on:keyup={setContent.bind(this, 'vtt')}\r\n        style=\"border-bottom: 1px solid #e7e7e7; margin: 5px 0 5px 0; whiteSpace: pre-line; clear: both; min-height: 125px\"  \r\n    ></div>\r\n    <div \r\n        class=\"tinymce-editor auth-editor\"\r\n        contentEditable={true}\r\n        id=\"info\"\r\n        data-text=\"Info\"\r\n        on:keyup={setContent.bind(this, 'info')}\r\n        style=\"border-bottom: 1px solid #e7e7e7; margin: 5px 0 5px 0; whiteSpace: pre-line; clear: both; min-height: 125px\"  \r\n    ></div>\r\n</div>"],"names":["insert","append","ctx","bind","this","setAjaxContent","editorState","lastAction","state","writable","sequence","info","vtt","subscribe","items","updateVideoContent","content","title","replace","activator","AH","ajax","url","baseUrl","cache","data","content_guid","guid","content_type","content_subtype","content_text","func","then","response","JSON","parse","select","innerHTML","setContent","type","clearTimeout","setTimeout","tinyMCE","activeEditor","getContent","format","match","prettyPrint","onMount","ajaxPageData","listen","document","_this","selectAll","forEach","elm","index","captions","text","textContent","vtt_data","stringify","self","props","tag","action","in_editor","classList","remove","setAttribute","click","err","console","log","PluginManager","add","editorPlugin","on","e","id","error","beforeUpdate","videoHeight","clientHeight","style","height","isNaN","reduceHeight","outerHeight"],"mappings":"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"}