import{G as t,O as e,S as i,i as n,s,F as r,c as a,m as o,t as l,a as c,d as u,e as h,b as d,f as p,g as f,h as m,j as g,k as b,n as v,o as x,p as w,A as y,E as A,X as q,T as k,w as _,I as O,u as T}from"./main-91b4ef6d.js";import{I as j}from"./ItemHelper-8de8b060.js";import{F as E}from"./mathquill-f6e8162d.js";import"./style-inject.es-1f59c1d0.js";import"https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js";const C=new t;const S=new class{constructor(t){this.userAnsXML="",this.sInfo=!0,this.labBinded=!0,this.delPreSpaces={},this.init(),this.iscorrect="-2",this.previous_droped_item={}}init(){this.delPreSpaces={loopGaurd:0,withLines:t=>{this.delPreSpaces.loopGaurd>0&&("function"==typeof activate&&activate(1),C.selectAll(t,"hide"));var e=C.selectAll(".linenums li").length,i=[];if(0==e&&this.delPreSpaces.loopGaurd<=4)return this.delPreSpaces.loopGaurd++,setTimeout((()=>{this.delPreSpaces.withLines(t)}),1e3),!1;this.showFillModule(t),C.selectAll(".linenums li").forEach(((t,e)=>{"&nbsp;"==C.find(t,"span").innerHTML||""==C.find(t,"span").innerHTML?t.remove():i.push(t)})),i.forEach(((t,e)=>{if(t.children.classList.contains("fillelement")||t.children.classList.contains("dropable")){let e;t.children.forEach((t=>{""==t.innerHTML?t.remove():e=t})),C.prevElm(t).append(e),C.insert(C.prevElm(t),C.nextElm(t).innerHTML,"beforeend"),C.nextElm(t).remove(),t.remove()}}))},withoutLines:t=>{C.find(t,".fillelement,.dropable","all").forEach((e=>{var i=C.prevElm(e).innerHTML.trim(),n=C.nextElm(e).innerHTML.trim();if(delPreSpaces.loopGaurd>0&&("function"==typeof activate&&activate(1),C.selectAll(t,"hide")),0==C.find(t,".kwd","all").length&&delPreSpaces.loopGaurd<=4)return delPreSpaces.loopGaurd++,setTimeout((()=>{delPreSpaces.withoutLines(t)}),1e3),!1;this.showFillModule(t),""==i?C.prevElm(e).remove():C.prevElm(e).innerHTML=i,""==n?C.nextElm(e).remove():C.nextElm(e).innerHTML=n}))},showFillModule:t=>{"function"==typeof activate&&activate(0),"undefined"!=typeof quizPlayerStatic&&"undefined"!=typeof QuizPlayer&&QuizPlayer.setNewHeight(quizPlayerStatic),C.selectAll(t,"show")}}}setUpdate(t){this.updateModule=t}readyFill(t){let i="",n="";C.bind(t+" select","change",(()=>{C.trigger(t,"click")})),this.dragOptionFill={appendTo:"body",zIndex:100,revert:t=>{if(!t)return this.sInfo&&(this.sInfo=!1,setTimeout((function(){this.sInfo=!0}),6e4),C.showmsg("While dropping a component, keep your mouse pointer on the drop area. Drop area must be compatible with the component you are dropping.",100)),!0},helper:e=>{var i=e.target;try{return i.classList.contains("dropable")&&(i=C.find(t,"#"+e.target.getAttribute("droped"))),this.img={width:C.select(i).clientWidth,height:"auto"},e.target.draggable("option","cursorAt",{left:Math.floor(this.img.width/2),top:-10}),e.target.cloneNode(!0).css({width:this.img.width+"px",height:this.img.height+"px",position:"absolute","text-align":"center"})}catch(t){console.warn("Helper:",t)}},onDragStart:t=>{t.target.dataset.drag_enable=!0},onDragEnter:t=>{t.target.classList.add("drop-hover")},onDragLeave:t=>{t.target.classList.remove("drop-hover")},onDrop:(e,i)=>{const s=e.target,r=i.getAttribute("droped")?i.getAttribute("droped"):i.getAttribute("id");s.getAttribute("droped").trim(),s.innerHTML=i.innerHTML,C.select(s,"attr",{userans:r,droped:r,path:i.getAttribute("path")}),C.select(s,"css",{backgroundColor:i.style.backgroundColor}),n=s.id,this.checkAns(t),s.classList.remove("drop-hover")},onDragEnd:(e,s)=>{let r=e.target;if(r.classList.contains("dropable")&&(r.dataset.drag_enable,C.select(r,"css",{backgroundColor:r.getAttribute("bgcolor")}),r.textContent=r.getAttribute("caption"),C.selectAll(r,"attr",{droped:"",userans:""})),i=r.id,r.classList.contains("dropable")){const t=C.select("#"+n).getAttribute("droped");t&&1==C.select("#"+t).getAttribute("drag-single")&&this.dnd.disableDrag("#"+t)}else if(i&&1==C.select("#"+i).getAttribute("drag-single")&&""!=n){this.dnd.disableDrag("#"+i),Object.entries(this.previous_droped_item)&&this.previous_droped_item[n]&&(this.previous_droped_item[n].setAttribute("draggable","true"),this.previous_droped_item[n].setAttribute("aria-disabled","false"),this.previous_droped_item[n].classList.remove("ui-draggable-disabled","ui-state-disabled"));let t=document.querySelector("#"+i);t.setAttribute("draggable","false"),t.setAttribute("aria-disabled","true"),t.classList.add("ui-draggable-disabled","ui-state-disabled"),this.previous_droped_item[n]=t}this.checkAns(t),n=""},scroll:"true",refreshPositions:!0,cursor:"default"},window.fillid=t,this.dnd||(this.dnd=new e(this.dragOptionFill)),C.find(t,".dragable","all").forEach((t=>this.dnd.setDrag(t))),C.find(t,".dropable","all").forEach((t=>{const e=t.getAttribute("droped");e&&1==C.select("#"+e).getAttribute("drag-single")&&this.dnd.disableDrag(C.select("#"+e))})),C.find(t,"[droped*=ID]","all").forEach(((e,i)=>{"0"==C.find(t,"#"+e.getAttribute("droped")).getAttribute("multi_drag")&&this.dnd.disableDrag(C.find(t,"#"+e.getAttribute("droped")))})),C.find(t,".dropable","all").forEach((t=>this.dnd.setDrop(t)))}bindKeyup(t){C.find(t,".fillelement","all").forEach((t=>{C.selectAll(Array.from(t.children),"addClass","ks")})),C.find(t,".dragable","all").forEach((t=>{t.classList.add("ks")})),C.find(t,".dropable","all").forEach((t=>{t.classList.add("ks")})),C.listen(document,"click",t,((e,i)=>{this.checkFocus("ks")||C.selectAll(C.find(t,".copiedclr","all"),"removeClass","copiedclr")}))}checkFocus(t){this.checkAns&&this.checkAns(ajax_eId);var e=!1;return C.find(ajax_eId,"."+t,"all").forEach((t=>{if(C.isFocus(t))return e=!0,!1})),e}showdragans(t,e,i){void 0===i&&(i=0),C.find(t,"select,input,textarea,.dropable,span.edit_step","all").forEach((n=>{this.showchilddragans(t,n,e,i)}))}showchilddragans(t,e,i,n){let s=-2;if(e.classList.contains("dropable"))if(e.innerHTML=e.getAttribute("caption").replace(/\#doublequote#/gim,'"'),C.setCss(e,{"background-color":e.getAttribute("bgcolor")}),"c"==i)e.getAttribute("anskey").split(",").forEach(((i,n)=>{if(""!=i.trim()){const n=C.find(t,"#"+i);return n&&(e.innerHTML=n.getAttribute("caption").replace(/\#doublequote#/gim,'"'),C.setCss(e,{backgroundColor:n.getAttribute("bgcolor")})),!1}}));else if("u"==i){s=-1,""!=e.getAttribute("userans").trim()&&(this.userans=C.find(t,"#"+e.getAttribute("userans")),this.userans&&(e.innerHTML=this.userans.getAttribute("caption").replace(/\#doublequote#/gim,'"'),C.setCss(e,{backgroundColor:this.userans.getAttribute("bgcolor")})));const i=e.getAttribute("anskey"),n=e.getAttribute("userans");""!=n&&i.indexOf(n)>-1&&(s=1)}if(e.classList.contains("edit_step")&&1==n&&("c"==i?C.selectAll(".edit_step","css",{border:"none",display:"none"}):"u"==i&&(C.selectAll(".edit_step","css",{cursor:"none",display:"block"}),s=this.fillTestText(t,e))),e.parentElement.classList.contains("fillelement"))if("SELECT"==e.nodeName)s=-1,this.totalcorrect=C.find(e,"[correctans='1']","all").length,this.a=0,C.find(e,"option","all").forEach(((t,e)=>{t.removeAttribute("selected"),"c"==i?t.getAttribute("correctans")>0&&t.setAttribute("selected",!0):"u"==i&&(t.getAttribute("userans")>0&&t.setAttribute("selected",!0),t.selected&&1==t.getAttribute("correctans")&&this.a++)})),this.totalcorrect==this.a&&(s=1);else if("INPUT"==e.nodeName||"TEXTAREA"==e.nodeName)if(void 0===e.type&&(this.type="text"),"c"==i){var r=e.getAttribute("anskey").split(",");if(r.length>1){var a="<p style='text-align:left;'>All of the answers are correct!<br>";r.forEach(((t,e)=>{a+="("+(e+1)+") "+t.replace(/#cm/g,",")+"<br>"})),C.setAttr(e,{rel:"multiple_answers",title:a+"</p>","data-html":"true"})}e.value=e.getAttribute("anskey").replace(/#cm/g,",")}else if("u"==i){if(e.removeAttribute(["rel","title","data-html"]),""==e.getAttribute("userans")&&""!==e.getAttribute("defaultAns"))e.value=e.getAttribute("defaultAns");else{var o=e.getAttribute("userans");"TEXTAREA"==e.nodeName&&(o=(o=o.replace(/#singlequote#/g,"'")).replace(/#dblquote#/g,'"')),e.value=o}s=this.fillTestText(t,e)}if("u"==i&&1==n){if(-2!=s&&1!=parseInt(C.select(t).getAttribute("manual_grade"))){const t=this.markUserAnswer(s);e.classList.contains("dropable")?(C.insert(e,t,"beforeend"),e.setAttribute("as",s)):e.classList.contains("edit_step")?(1==s?C.selectAll("#"+e.getAttribute("id"),"css",{border:"2px solid green"}):C.selectAll("#"+e.getAttribute("id"),"css",{border:"2px solid red"}),e.setAttribute("as",s)):(C.insert(e.parentElement,t,"beforeend"),e.parentElement.setAttribute("as",s))}e.setAttribute("title",1==s?"is marked as Correct":"is marked as incorrect")}else C.find(t,".correct_incorrect_icon_fill",{action:"remove"}),e.setAttribute("title","");this.iscorrect=s}fillTestText(t,e){var i=-1,n=e.getAttribute("anskey").trim(),s=e.value?e.value.trim():"",r=e.getAttribute("haskeywords"),a=e.getAttribute("hasnotkeywords"),o=e.getAttribute("codetype"),l=e.getAttribute("mathtype");if("TEXTAREA"!=e.nodeName){/\d,\d/.test(s)&&(s=e.value.trim().replace(/,/g,"#cm"));let t=s.match(/[a-zA-Z]{1,1},[a-zA-Z]{1,1}/g);s.match(/[a-zA-Z]{1,1},[a-zA-Z]{1,1}/g)&&(t=t.toString().replace(/,/g,"#cm")),s=s.replace(/[a-zA-Z]{1,1},[a-zA-Z]{1,1}/g,t)}if(1==o){var c=[/\s+/g,/\;$/,/"/g],u=["","","'"];for(let t=0;t<c.length;t++)s=s.replace(c[t],u[t]),n=n.replace(c[t],u[t])}if(1==l&&(s=e.getAttribute("userans").trim()),1==C.select(t).getAttribute("matchtype")&&(n=n.toLowerCase(),s=s.toLowerCase()),1==C.select(t).getAttribute("ignoretype")){if(0!=C.select(t).getAttribute("multi")){var h=[];n.split(",").forEach(((t,e)=>{h.push(t.replace(/[^a-zA-Z0-9]/gi,""))})),n=h.join(",")}else n=n.replace(/[^a-zA-Z0-9]/gi,"");s=s.replace(/[^a-zA-Z0-9]/gi,"")}if(1==e.getAttribute("keywordtype")&&r.length>0&&a.length>0){var d=0,p=0;r.split(",").forEach(((t,e)=>{-1!=s.indexOf(t)&&d++})),a.split(",").forEach(((t,e)=>{-1!=s.indexOf(t)&&p++})),r.split(",").length==d&&0==p&&(s=n)}return 0!=C.select(t).getAttribute("multi")?""!=(s=s.replace(/,/gm,"#cm"))&&this.checkInArray(n.split(","),s.split(","))&&(i=1,s=s.replace(/#cm/gm,",")):s==n&&(i=1),i}markUserAnswer(t){const e='<span class="'+(1==t?"icomoon-new-24px-checkmark-circle-1 font-weight-bold":"icomoon-new-24px-cancel-circle-1 font-weight-bold")+'" style="color:'+(1==t?"green":"red")+';">';let i='<span class="correct_incorrect_icon_fill" style="background:white;border-radius:15px 12px 12px;"> '+e+"</span></span>";return C.find(ajax_eId,".prettyprint","all").length>0&&(i='<span class="correct_incorrect_icon_fill" style="bottom:22px;background:none;border-radius:12px;"> '+e+"</span></span>"),i}checkAns(t){if(this.userAnsXML="<smans type='9'>\n",this.result=!0,this.temp=0,C.find(t,"select,input,textarea,.dropable,span.edit_step.mathquill","all").forEach((e=>{this.userAnsXML=this.checkChildAnswer(t,e,this.userAnsXML)})),this.userAnsXML+="</smans>",window.ISSPECIALMODULEUSERXMLCHANGE=1,C.select("#special_module_user_xml").value=this.userAnsXML,this.updateModule("uxml",this.userAnsXML),1!=parseInt(C.select(t).getAttribute("manual_grade")))return C.select("#answer").checked=!!this.result,this.result?(C.select("#answer").checked=!0,"undefined"!=typeof is_sm&&C.showmsg("Correct",3),"Correct"):(C.select("#answer").checked=!1,"undefined"!=typeof is_sm&&C.showmsg("Incorrect",3),"Incorrect")}checkInArray(t,e){let i=[];for(let n=0;n<t.length;n++)for(let s=0;s<e.length;s++)i.includes(e[s])||e[s].trim()!=t[n].trim()||i.push(e[s]);return 0==e.length-i.length}checkChildAnswer(t,e,i){if(e.classList.contains("dropable")){var n=e.getAttribute("anskey").split(",");0==C.findInArray(e.getAttribute("userans"),n)?this.result=!1:this.temp++,"undefined"!=typeof calculatePoint&&calculatePoint(C.select(t).getAttribute("totalcorrectans"),this.temp),i+=`<div id='${e.getAttribute("id")}' userAns='${e.getAttribute("userans")}'></div>\n`}else if(e.classList.contains("mathquill")){for(var s=[],r=e.getAttribute("id"),a=e.getAttribute("anskey").trim(),o=e.getAttribute("userans").trim(),l=MathQuill.getInterface(2).StaticMath(document.getElementById(r)),c=0;c<=l.innerFields.length-1;c++)s[c]=l.innerFields[c].latex();let t=o,n=o.match(/\\MathQuillMathField(.*?)}*}{4,6}|\\MathQuillMathField(.*?)}*}{3,6}|\\MathQuillMathField(.*?)}*}{2,6}|\\MathQuillMathField(.*?)}*}{1,6}/g);if(s.indexOf("")<0)for(c in n){const e="\\MathQuillMathField{"+s[c]+"}",i=n[c].replace(/\\MathQuillMathField(.*?)}*}{4,6}|\\MathQuillMathField(.*?)}*}{3,6}|\\MathQuillMathField(.*?)}*}{2,6}|\\MathQuillMathField(.*?)}*}{1,6}/g,e),r=n[c];t=t.replace(r,i)}let u=o=t;a!=u?this.result=!1:this.temp++,e.getAttribute("userans",u),i+=`<div id='${e.getAttribute("id")}' userAns='${u}' anskey='${a}' userAnsSeq='${e.getAttribute("userAnsSeq")}'></div>\n`}else if(e.parentElement.classList.contains("fillelement"))if("SELECT"==e.nodeName)this.uAnsSel="",this.a=0,this.totalcorrect=C.find(e,"[correctans='1']","all").length,C.find(e,"option","all").forEach(((t,e)=>{t.selected&&(this.a++,1!=t.getAttribute("correctans")?this.result=!1:this.temp++,this.uAnsSel=this.uAnsSel+e+",")})),this.a!=this.totalcorrect&&(this.result=!1),"undefined"!=typeof calculatePoint&&calculatePoint(C.select(t).getAttribute("totalcorrectans"),this.temp),i+=`<div id='${e.parentElement.getAttribute("id")}' userAns='${this.uAnsSel}'></div>\n`;else if("INPUT"==e.nodeName||"TEXTAREA"==e.nodeName){a=e.getAttribute("anskey").trim();var u=e.value.trim();if(1==e.getAttribute("codetype")){var h=[/\s+/g,/\;$/,/"/g],d=["","","'"];for(let t=0;t<h.length;t++)u=u.replace(h[t],d[t]),a=a.replace(h[t],d[t])}if(1==C.select(t).getAttribute("matchtype")&&(a=a.toLowerCase(),u=u.toLowerCase()),1==C.select(t).getAttribute("ignoretype")){if(0!=C.select(t).getAttribute("multi")){let t=[];a.split(",").forEach(((e,i)=>{t.push(e.replace(/[^a-zA-Z0-9]/gi,""))})),a=t.join(",")}else a=a.replace(/[^a-zA-Z0-9]/gi,"");u=u.replace(/[^a-zA-Z0-9]/gi,"")}if(0!=C.select(t).getAttribute("multi"))""!=(u=u.replace(/,/g,"#cm"))&&this.checkInArray(a.split(","),u.split(","))?this.temp++:this.result=!1;else{var p=e.getAttribute("haskeywords"),f=e.getAttribute("hasnotkeywords");if(1==e.getAttribute("keywordtype")&&p.length>0&&f.length>0){var m=0,g=0;p.split(",").forEach(((t,e)=>{-1!=u.indexOf(t)&&m++})),f.split(",").forEach(((t,e)=>{-1!=u.indexOf(t)&&g++})),p.split(",").length!=m||0!=g?this.result=!1:this.temp++}else a!=u?this.result=!1:this.temp++}"undefined"!=typeof calculatePoint&&calculatePoint(C.select(t).getAttribute("totalcorrectans"),this.temp);var b=e.value;"TEXTAREA"==e.nodeName&&(b=(b=b.replace(/'/g,"#singlequote#")).replace(/"/g,"#dblquote#")),e.nodeName,i+=`<div id='${e.parentElement.getAttribute("id")}' userAns='${b}'></div>\n`}return i}modeOn(t,e){C.selectAll(".test, .review","addClass","h"),t?("function"==typeof hotkeys&&(hotkeys.unbind("alt+down,enter,delete","fillintheblank"),hotkeys.deleteScope("fillintheblank")),C.selectAll(".review","removeClass","h"),this.unBindLab(),this.showdragans(ajax_eId,"u",1)):(this.bindKeyup(ajax_eId),C.selectAll(".test","removeClass","h"),this.bindLab(),this.showdragans(ajax_eId,"u"))}bindLab(){this.labBinded=!0,C.find(ajax_eId,"select,input,textarea",{action:"removeAttr",actionData:"disabled"});try{this.readyFill(ajax_eId)}catch(t){console.log("catch")}}unBindLab(){this.labBinded=!1,C.find(ajax_eId,"input,select,textarea","all").forEach((t=>{"INPUT"==this.nodeName||"TEXTAREA"==this.nodeName?t.getAttribute("userans",t.value):"SELECT"==this.nodeName&&t.querySelectorAll("option").forEach(((t,e)=>{t.selected?t.setAttribute("userans",1):t.setAttribute("userans","")}))}))}pre_fill(t){C.find(t,".fillelement,.dropable","all");C.find(t,".prettyprint","all").length>0&&("function"==typeof activate&&activate(1),C.selectAll(t,"hide"),C.find(t,"pre").classList.contains("lg")&&C.selectAll(t,"css",{width:"930px"}),setTimeout((()=>{C.find(t,"pre").classList.contains("linenums")?this.delPreSpaces.withLines(t):this.delPreSpaces.withoutLines(t),this.delPreSpaces.showFillModule(t)}),1e3))}};function L(t){r(t,"svelte-1fzfbpq","xmp{display:inline}#fillmain{overflow:hidden;max-width:1024px;text-align:left}#fillmain pre{background:none;border:none;font-size:14px!important}#fillmain .string{min-height:50px;margin-top:10px;margin-right:10px}#fillmain .footerStr{position:relative;margin-top:10px;background-color:#ccc;padding:15px;min-height:60px}#fillmain .footerStr .arrow-up{position:absolute;top:-10px;right:50%;width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:10px solid #ccc}#fillmain .fill-row{padding:6px}#fillmain .fillelement{height:30px;display:inline-block;position:relative;min-height:30px;margin:1px 0 1px 0;top:-3px}#fillmain .drag-resize{height:30px;display:inline-block;position:relative;min-height:30px;margin:1px 0 1px 0;top:-3px}td .drag-resize{top:0 !important}td .fillelement{top:0px !important}#fillmain input[type=\"text\"]{height:99%!important;resize:none;font-size:12px;color:#000;max-width:800px}#fillmain .drag-resize{vertical-align:middle;border:1px solid #31B731;text-align:center;padding:3px;font-size:14px}#fillmain .drag-resize.ui-draggable{cursor:move}#fillmain .drop-hover{border:1px dashed red!important;box-shadow:0 0 0 2px yellow inset;outline:1px solid blue}#fillmain .fillcheck ul{width:220px}#fillmain .fillcheck li.selected{background-color:#E5E5E5}.fillcheck .selected .icomoon-checkmark-3:before{float:left;color:blue;padding:3px;position:relative;right:14px}.fillcheck .icomoon-close-2:before{float:left;color:blue;position:relative;right:14px;font-size:20px}.MathJax_Display{display:inline!important}#fillmain .select{font-size:15px}#fillmain .textarea{vertical-align:middle;border-radius:3px;background:#ffe;border:1px solid #ccc;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,0.075);box-shadow:inset 0 1px 1px rgba(0,0,0,0.075)}.ui-draggable-disabled{cursor:no-drop!important;opacity:0.5!important}.sel{border:2px solid #FF0000!important}#fillmain .dragable:focus{box-shadow:inset 0 0 0 1px transparent, inset 0 0 0 1px #ffffff, inset 0 0 0 2px #fff;outline:none}#fillmain .dropable:focus{box-shadow:inset 0 0 0 1px transparent, inset 0 0 0 1px #ffffff, inset 0 0 0 2px #fff;outline:none}.highlight_main{border:1px dashed #000}.copiedclr{background-color:#CCC!important}#fillmain select::-ms-expand{margin-left:2px}.fillintheblank{height:30px;padding:5px 10px;font-size:14px;margin-bottom:3px;line-height:20px;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;color:#555;background-color:#FFE;vertical-align:middle;background-image:none;border:1px solid #ccc;font-family:Helvetica,Arial,'Times New Roman',Verdana,sans-serif;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,0.075);box-shadow:inset 0 1px 1px rgba(0,0,0,0.075);-webkit-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.fillintheblank:focus{border-color:rgba(82,168,236,0.8);outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,0.075),0 0 8px rgba(82,168,236,0.6);-moz-box-shadow:inset 0 1px 1px rgba(0,0,0,0.075),0 0 8px rgba(82,168,236,0.6);box-shadow:inset 0 1px 1px rgba(0,0,0,0.075),0 0 8px rgba(82,168,236,0.6)}.correct_incorrect_icon_fill{position:absolute;width:17px;height:18px;right:-4px;top:-7px;font-size:17px;white-space:normal !important;z-index:9 !important}.corr_div{display:none;position:absolute;width:100%;height:100%;background-color:#21a81d;color:#ffffff;top:0%;padding-top:4px;border-radius:3px;cursor:none !important}.auto_height{height:auto!important}.prettyprint{display:-ms-grid!important}")}function Q(t){let e,i;return e=new E({props:{spanId:t[5].spanId,divId:t[5].divId,action:t[3].fillMath[t[6]],show:t[9]}}),{c(){a(e.$$.fragment)},m(t,n){o(e,t,n),i=!0},p(t,i){const n={};32&i[0]&&(n.spanId=t[5].spanId),32&i[0]&&(n.divId=t[5].divId),8&i[0]&&(n.action=t[3].fillMath[t[6]]),e.$set(n)},i(t){i||(l(e.$$.fragment,t),i=!0)},o(t){c(e.$$.fragment,t),i=!1},d(t){u(e,t)}}}function D(t){let e;return{c(){e=T("*Matching is not case sensitive.")},m(t,i){m(t,e,i)},d(t){t&&x(e)}}}function I(t){let e;return{c(){e=T("*Exact matching is required.")},m(t,i){m(t,e,i)},d(t){t&&x(e)}}}function M(t){let e,i,n,s,r,w,y,A,q,k,_,O,T,E,C,S,L,M,z,R,F,B,N,P,H={handleReviewClick:t[10],reviewMode:t[0]};n=new j({props:H}),t[15](n),n.$on("setReview",t[7]),n.$on("unsetReview",t[8]);let U=t[5].showToolbar&&Q(t);function X(t,e){return"0"==t[5].matchtype?I:D}let W=X(t),G=W(t);return{c(){e=h("div"),i=h("center"),a(n.$$.fragment),s=d(),r=h("div"),w=h("div"),y=d(),U&&U.c(),A=d(),q=h("div"),G.c(),k=d(),_=h("div"),O=h("div"),T=d(),E=h("center"),B=d(),N=h("textarea"),p(w,"class","string"),p(w,"id","previewArea"),f(w,"font-family","'Roboto, sans-serif; font-size: 1em"),f(q,"color","#b94a48"),f(q,"margin-top","5px"),p(q,"class","smnotes"),p(O,"class","arrow-up"),p(E,"class","dragArea"),p(_,"class","footerStr"),f(_,"display",t[5].footerStr?"block":"none"),p(r,"id",$),p(r,"class",C="fillmain "+(t[0]?"pe-none":null)),p(r,"matchtype",S=t[5].matchtype),p(r,"multi",L=t[5].multi),p(r,"ignoretype",M=t[5].ignoretype),p(r,"manual_grade",z=t[1]||0),p(r,"totalcorrectans",R=t[5].totalcorrectans),p(e,"class",F=t[2]?"mx-4 pl-2 pl-md-0":""),p(N,"class","h"),p(N,"id","special_module_user_xml")},m(t,a){m(t,e,a),g(e,i),o(n,i,null),g(i,s),g(i,r),g(r,w),g(r,y),U&&U.m(r,null),g(r,A),g(r,q),G.m(q,null),g(r,k),g(r,_),g(_,O),g(_,T),g(_,E),m(t,B,a),m(t,N,a),P=!0},p(t,i){const s={};1&i[0]&&(s.reviewMode=t[0]),n.$set(s),t[5].showToolbar?U?(U.p(t,i),32&i[0]&&l(U,1)):(U=Q(t),U.c(),l(U,1),U.m(r,A)):U&&(b(),c(U,1,1,(()=>{U=null})),v()),W!==(W=X(t))&&(G.d(1),G=W(t),G&&(G.c(),G.m(q,null))),(!P||32&i[0])&&f(_,"display",t[5].footerStr?"block":"none"),(!P||1&i[0]&&C!==(C="fillmain "+(t[0]?"pe-none":null)))&&p(r,"class",C),(!P||32&i[0]&&S!==(S=t[5].matchtype))&&p(r,"matchtype",S),(!P||32&i[0]&&L!==(L=t[5].multi))&&p(r,"multi",L),(!P||32&i[0]&&M!==(M=t[5].ignoretype))&&p(r,"ignoretype",M),(!P||2&i[0]&&z!==(z=t[1]||0))&&p(r,"manual_grade",z),(!P||32&i[0]&&R!==(R=t[5].totalcorrectans))&&p(r,"totalcorrectans",R),(!P||4&i[0]&&F!==(F=t[2]?"mx-4 pl-2 pl-md-0":""))&&p(e,"class",F)},i(t){P||(l(n.$$.fragment,t),l(U),P=!0)},o(t){c(n.$$.fragment,t),c(U),P=!1},d(i){i&&x(e),t[15](null),u(n),U&&U.d(),G.d(),i&&x(B),i&&x(N)}}}!function(){var t,e=window.jQuery,i="mathquill-command-id",n="mathquill-block-id",s=Math.min,r=Math.max;function a(){}var o=[].slice;function l(t){var e=t.length-1;return function(){var i=o.call(arguments,0,e),n=o.call(arguments,e);return t.apply(this,i.concat([n]))}}var c=l((function(t,e){return l((function(i,n){if(t in i)return i[t].apply(i,e.concat(n))}))}));function u(t){return l((function(e,i){"function"!=typeof e&&(e=c(e));return t.call(this,(function(t){return e.apply(t,[t].concat(i))}))}))}function h(t){var e=o.call(arguments,1);return function(){return t.apply(this,e)}}function d(t,e){if(!e)throw new Error("prayer failed: "+t)}var p=function(t,e,i){function n(t){return"object"==typeof t}function s(t){return"function"==typeof t}function r(){}return function t(i,a){function o(){var t=new l;return s(t.init)&&t.init.apply(t,arguments),t}function l(){}undefined===a&&(a=i,i=Object),o.Bare=l;var c,u=r.prototype=i.prototype,h=l.prototype=o.prototype=o.p=new r;return h.constructor=o,o.mixin=function(e){return l.prototype=o.prototype=t(o,e).prototype,o},(o.open=function(t){if(c={},s(t)?c=t.call(o,h,u,o,i):n(t)&&(c=t),n(c))for(var r in c)e.call(c,r)&&(h[r]=c[r]);return s(h.init)||(h.init=i),o})(a)}}(0,{}.hasOwnProperty),f=-1;function m(t){d("a direction was passed",t===f||1===t)}var g=p(e,(function(t){t.insDirOf=function(t,e){return t===f?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===f?this.prependTo(e):this.appendTo(e)}})),b=p((function(t){t.parent=0,t[f]=0,t[1]=0,t.init=function(t,e,i){this.parent=t,this[f]=e,this[1]=i},this.copy=function(t){return b(t.parent,t[f],t[1])}})),v=p((function(t){t[f]=0,t[1]=0,t.parent=0;var e=0;this.byId={},t.init=function(){this.id=e+=1,v.byId[this.id]=this,this.ends={},this.ends[f]=0,this.ends[1]=0},t.dispose=function(){delete v.byId[this.id]},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=g(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){t=g(t||this.html());function e(t){if(t.getAttribute){var i=t.getAttribute("mathquill-command-id"),n=t.getAttribute("mathquill-block-id");i&&v.byId[i].jQadd(t),n&&v.byId[n].jQadd(t)}for(t=t.firstChild;t;t=t.nextSibling)e(t)}for(var i=0;i<t.length;i+=1)e(t[i]);return t},t.createDir=function(t,e){m(t);var i=this;return i.jQize(),i.jQ.insDirOf(t,e.jQ),e[t]=i.adopt(e.parent,e[f],e[1]),i},t.createLeftOf=function(t){return this.createDir(f,t)},t.selectChildren=function(t,e){return k(t,e)},t.bubble=u((function(t){for(var e=this;e;e=e.parent){if(!1===t(e))break}return this})),t.postOrder=u((function(t){return function e(i){i.eachChild(e),t(i)}(this),this})),t.isEmpty=function(){return 0===this.ends[f]&&0===this.ends[1]},t.children=function(){return w(this.ends[f],this.ends[1])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,i,n){return w(this,this).withDirAdopt(t,e,i,n),this},t.adopt=function(t,e,i){return w(this,this).adopt(t,e,i),this},t.disown=function(){return w(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}));function x(t,e,i){d("a parent is always present",t),d("leftward is properly set up",e?e[1]===i&&e.parent===t:t.ends[f]===i),d("rightward is properly set up",i?i[f]===e&&i.parent===t:t.ends[1]===e)}var w=p((function(e){e.init=function(e,i,n){if(n===t&&(n=f),m(n),d("no half-empty fragments",!e==!i),this.ends={},e){d("withDir is passed to Fragment",e instanceof v),d("oppDir is passed to Fragment",i instanceof v),d("withDir and oppDir have the same parent",e.parent===i.parent),this.ends[n]=e,this.ends[-n]=i;var s=this.fold([],(function(t,e){return t.push.apply(t,e.jQ.get()),t}));this.jQ=this.jQ.add(s)}},e.jQ=g(),e.withDirAdopt=function(t,e,i,n){return t===f?this.adopt(e,i,n):this.adopt(e,n,i)},e.adopt=function(t,e,i){x(t,e,i);var n=this;n.disowned=!1;var s=n.ends[f];if(!s)return this;var r=n.ends[1];return e||(t.ends[f]=s),i?i[f]=r:t.ends[1]=r,n.ends[1][1]=i,n.each((function(i){i[f]=e,i.parent=t,e&&(e[1]=i),e=i})),n},e.disown=function(){var t=this,e=t.ends[f];if(!e||t.disowned)return t;t.disowned=!0;var i=t.ends[1],n=e.parent;return x(n,e[f],e),x(n,i,i[1]),e[f]?e[f][1]=i[1]:n.ends[f]=i[1],i[1]?i[1][f]=e[f]:n.ends[1]=e[f],t},e.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},e.each=u((function(t){var e=this,i=e.ends[f];if(!i)return e;for(;i!==e.ends[1][1];i=i[1]){if(!1===t(i))break}return e})),e.fold=function(t,e){return this.each((function(i){t=e.call(this,t,i)})),t}})),y={},A={},q=p(b,(function(t){t.init=function(t,e){this.parent=t,this.options=e;var i=this.jQ=this._jQ=g('<span class="mq-cursor">&#8203;</span>');this.blink=function(){i.toggleClass("mq-blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[1]?this.selection&&this.selection.ends[f][f]===this[f]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[1].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=g(),this},t.withDirInsertAt=function(t,e,i,n){var s=this.parent;this.parent=e,this[t]=i,this[-t]=n,s!==e&&s.blur&&s.blur()},t.insDirOf=function(t,e){return m(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},t.insLeftOf=function(t){return this.insDirOf(f,t)},t.insRightOf=function(t){return this.insDirOf(1,t)},t.insAtDirEnd=function(t,e){return m(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(f,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(1,t)},t.jumpUpDown=function(t,e){var i=this;i.upDownCache[t.id]=b.copy(i);var n=i.upDownCache[e.id];if(n)n[1]?i.insLeftOf(n[1]):i.insAtRightEnd(n.parent);else{var s=i.offset().left;e.seek(s,i)}},t.offset=function(){var t=this.jQ.removeClass("mq-cursor").offset();return this.jQ.addClass("mq-cursor"),t},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,i=t[1],n=t[f];if(t.disown().eachChild((function(s){s.isEmpty()||(s.children().adopt(e,n,i).each((function(e){e.jQ.insertBefore(t.jQ.first())})),n=s.ends[1])})),!this[1])if(this[f])this[1]=this[f][1];else for(;!this[1];){if(this.parent=this.parent[1],!this.parent){this[1]=t[1],this.parent=e;break}this[1]=this.parent.ends[f]}this[1]?this.insLeftOf(this[1]):this.insAtRightEnd(e),t.jQ.remove(),t[f].siblingDeleted&&t[f].siblingDeleted(this.options,1),t[1].siblingDeleted&&t[1].siblingDeleted(this.options,f)},t.startSelection=function(){for(var t=this.anticursor=b.copy(this),e=t.ancestors={},i=t;i.parent;i=i.parent)e[i.parent.id]=i},t.endSelection=function(){delete this.anticursor},t.select=function(){var t=this.anticursor;if(this[f]===t[f]&&this.parent===t.parent)return!1;for(var e=this;e.parent;e=e.parent)if(e.parent.id in t.ancestors){var i=e.parent;break}d("cursor and anticursor in the same tree",i);var n,s,r=t.ancestors[i.id],a=1;if(e[f]!==r)for(var o=e;o;o=o[1])if(o[1]===r[1]){a=f,n=e,s=r;break}return 1===a&&(n=r,s=e),n instanceof b&&(n=n[1]),s instanceof b&&(s=s[f]),this.hide().selection=i.selectChildren(n,s),this.insDirOf(a,this.selection.ends[a]),this.selectionChanged(),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this[f]=this.selection.ends[f][f],this[1]=this.selection.ends[1][1],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[f]=t.ends[f][f],this[1]=t.ends[1][1],delete this.selection),t}})),k=p(w,(function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(t){return this.fold("",(function(e,i){return e+i[t]()}))}})),_=p((function(t){t.init=function(t,e,i){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=i,t.controller=this,this.cursor=t.cursor=q(t,i)},t.handle=function(t,e){var i=this.options.handlers;if(i&&i.fns[t]){var n=i.APIClasses[this.KIND_OF_MQ](this);e===f||1===e?i.fns[t](e,n):i.fns[t](n)}};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t+=1)e[t].apply(this.cursor,arguments);return this}})),O={},T=p(),j={},E=p(),C={};function S(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function L(t){return S(),Dt(t)}L.prototype=E.p,L.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return(S=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')})(),L},L.getInterface=I;var Q=I.MIN=1,D=I.MAX=2;function I(t){if(!(Q<=t&&t<=D))throw"Only interface versions between "+Q+" and "+D+" supported. You specified: "+t;function e(t){if(!t||!t.nodeType)return null;var e=g(t).children(".mq-root-block").attr(n),s=e&&v.byId[e].controller;return s?i[s.KIND_OF_MQ](s):null}var i={};function s(t,e){for(var n in e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:i}),e)if(e.hasOwnProperty(n)){var s=e[n],r=j[n];t[n]=r?r(s):s}}e.L=f,e.R=1,e.config=function(t){return s(T.p,t),this},e.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";C[t]=e};var r=i.AbstractMathQuill=p(E,(function(t){t.init=function(t){this.__controller=t,this.__options=t.options,this.id=t.id,this.data=t.data},t.__mathquillify=function(t){var e=this.__controller,i=e.root,s=e.container;e.createTextarea();var r=s.addClass(t).contents().detach();i.jQ=g('<span class="mq-root-block"/>').attr(n,i.id).appendTo(s),this.latex(r.text()),this.revert=function(){return s.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(r)}},t.config=function(t){return s(this.__options,t),this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}));for(var o in e.prototype=r.prototype,i.EditableField=p(r,(function(t,e){t.__mathquillify=function(){return e.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},t.focus=function(){return this.__controller.textarea.focus(),this},t.blur=function(){return this.__controller.textarea.blur(),this},t.write=function(t){return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},t.cmd=function(t){var e=this.__controller.notify(),i=e.cursor;if(/^\\[a-z]+$/i.test(t)){t=t.slice(1);var n=y[t];n&&(t=n(t),i.selection&&t.replaces(i.replaceSelection()),t.createLeftOf(i.show()),this.__controller.scrollHoriz())}else i.parent.write(i,t);return e.blurred&&i.hide().parent.blur(),this},t.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[f];)t.selectLeft();return this},t.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},t.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},t.moveToLeftEnd=function(){return this.moveToDirEnd(f)},t.moveToRightEnd=function(){return this.moveToDirEnd(1)},t.keystroke=function(t){t=t.replace(/^\s+|\s+$/g,"").split(/\s+/);for(var e=0;e<t.length;e+=1)this.__controller.keystroke(t[e],{preventDefault:a});return this},t.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},t.dropEmbedded=function(t,e,i){var n=t-g(window).scrollLeft(),s=e-g(window).scrollTop(),r=document.elementFromPoint(n,s);this.__controller.seek(g(r),t,e),Qt().setOptions(i).createLeftOf(this.__controller.cursor)}})),e.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},e.EditableField.prototype=i.EditableField.prototype,O)!function(n,s){var r=i[n]=s(i);e[n]=function(i,s){var a=e(i);if(a instanceof r||!i||!i.nodeType)return a;var o=_(r.RootBlock(),g(i),T());return o.KIND_OF_MQ=n,r(o).__mathquillify(s,t)},e[n].prototype=r.prototype}(o,O[o]);return e}L.noConflict=function(){return window.MathQuill=M,L};var M=window.MathQuill;function $(t){for(var e="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" "),i=0;i<e.length;i+=1)!function(e){t[e]=function(t){this.controller.handle(e,t)}}(e[i]);t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}window.MathQuill=L;var z,R=p((function(t,e,i){function n(t,e){throw"Parse Error: "+e+" at "+(t=t?"'"+t+"'":"EOF")}t.init=function(t){this._=t},t.parse=function(t){return this.skip(a)._(""+t,(function(t,e){return e}),n)},t.or=function(t){d("or is passed a parser",t instanceof i);var e=this;return i((function(i,n,s){return e._(i,n,(function(e){return t._(i,n,s)}))}))},t.then=function(t){var e=this;return i((function(n,s,r){return e._(n,(function(e,n){var a=t instanceof i?t:t(n);return d("a parser is returned",a instanceof i),a._(e,s,r)}),r)}))},t.many=function(){var t=this;return i((function(e,i,n){for(var s=[];t._(e,r,a););return i(e,s);function r(t,i){return e=t,s.push(i),!0}function a(){return!1}}))},t.times=function(t,e){arguments.length<2&&(e=t);var n=this;return i((function(i,s,r){for(var a,o=[],l=!0,c=0;c<t;c+=1)if(!(l=n._(i,u,h)))return r(i,a);for(;c<e&&l;c+=1)l=n._(i,u,d);return s(i,o);function u(t,e){return o.push(e),i=t,!0}function h(t,e){return a=e,i=t,!1}function d(t,e){return!1}}))},t.result=function(t){return this.then(r(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then((function(t){return e.many().map((function(e){return t.concat(e)}))}))},t.map=function(t){return this.then((function(e){return r(t(e))}))},t.skip=function(t){return this.then((function(e){return t.result(e)}))};this.string=function(t){var e=t.length,n="expected '"+t+"'";return i((function(i,s,r){var a=i.slice(0,e);return a===t?s(i.slice(e),a):r(i,n)}))};var s=this.regex=function(t){d("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return i((function(i,n,s){var r=t.exec(i);if(r){var a=r[0];return n(i.slice(a.length),a)}return s(i,e)}))},r=i.succeed=function(t){return i((function(e,i){return i(e,t)}))},a=(i.fail=function(t){return i((function(e,i,n){return n(e,t)}))},i.letter=s(/^[a-z]/i),i.letters=s(/^[a-z]*/i),i.digit=s(/^[0-9]/),i.digits=s(/^[0-9]*/),i.whitespace=s(/^\s+/),i.optWhitespace=s(/^\s*/),i.any=i((function(t,e,i){return t?e(t.slice(1),t.charAt(0)):i(t,"expected any character")})),i.all=i((function(t,e,i){return e("",t)})),i.eof=i((function(t,e,i){return t?i(t,"expected EOF"):e(t,t)})))})),F=(z={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"},function(t,i){var n,s=null,r=null,o=e(t),l=e(i.container||o),c=a;function u(t){c=t,clearTimeout(n),n=setTimeout(t)}l.bind("keydown keypress input keyup focusout paste",(function(t){c(t)}));var h=!1;function d(){i.keystroke(function(t){var e,i=t.which||t.keyCode,n=z[i],s=[];return t.ctrlKey&&s.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&s.push("Meta"),t.altKey&&s.push("Alt"),t.shiftKey&&s.push("Shift"),e=n||String.fromCharCode(i),s.length||n?(s.push(e),s.join("-")):e}(s),s)}function p(){if(!("selectionStart"in(t=o[0]))||t.selectionStart===t.selectionEnd){var t,e=o.val();1===e.length?(o.val(""),i.typedText(e)):e&&o[0].select&&o[0].select()}}function f(){var t=o.val();o.val(""),t&&i.paste(t)}return l.bind({keydown:function(t){s=t,r=null,h&&u((function(t){t&&"focusout"===t.type||!o[0].select||o[0].select(),c=a,clearTimeout(n)})),d()},keypress:function(t){s&&r&&d(),r=t,u(p)},focusout:function(){s=r=null},paste:function(t){o.focus(),u(f)}}),{select:function(t){c(),c=a,clearTimeout(n),o.val(t),t&&o[0].select&&o[0].select(),h=!!t}}});_.open((function(t,e){t.exportText=function(){return this.root.foldChildren("",(function(t,e){return t+e.text()}))}})),_.open((function(t){t.focusBlurEvents=function(){var t,e=this,i=e.root,n=e.cursor;function s(){clearTimeout(t),n.selection&&n.selection.jQ.addClass("mq-blur"),r()}function r(){n.hide().parent.blur(),e.container.removeClass("mq-focused"),g(window).off("blur",s)}e.textarea.focus((function(){e.blurred=!1,clearTimeout(t),e.container.addClass("mq-focused"),n.parent||n.insAtRightEnd(i),n.selection?(n.selection.jQ.removeClass("mq-blur"),e.selectionChanged()):n.show()})).blur((function(){e.blurred=!0,t=setTimeout((function(){i.postOrder("intentionalBlur"),n.clearSelection().endSelection(),r()})),g(window).on("blur",s)})),e.blurred=!0,n.hide().parent.blur()}})),_.open((function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}})),v.open((function(t){t.keystroke=function(t,e,i){var n=i.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":i.ctrlDeleteDir(f);break;case"Shift-Backspace":case"Backspace":i.backspace();break;case"Esc":case"Tab":return void i.escapeDir(1,t,e);case"Shift-Tab":case"Shift-Esc":return void i.escapeDir(f,t,e);case"End":i.notify("move").cursor.insAtRightEnd(n.parent);break;case"Ctrl-End":i.notify("move").cursor.insAtRightEnd(i.root);break;case"Shift-End":for(;n[1];)i.selectRight();break;case"Ctrl-Shift-End":for(;n[1]||n.parent!==i.root;)i.selectRight();break;case"Home":i.notify("move").cursor.insAtLeftEnd(n.parent);break;case"Ctrl-Home":i.notify("move").cursor.insAtLeftEnd(i.root);break;case"Shift-Home":for(;n[f];)i.selectLeft();break;case"Ctrl-Shift-Home":for(;n[f]||n.parent!==i.root;)i.selectLeft();break;case"Left":i.moveLeft();break;case"Shift-Left":i.selectLeft();break;case"Ctrl-Left":break;case"Right":i.moveRight();break;case"Shift-Right":i.selectRight();break;case"Ctrl-Right":break;case"Up":i.moveUp();break;case"Down":i.moveDown();break;case"Shift-Up":if(n[f])for(;n[f];)i.selectLeft();else i.selectLeft();case"Shift-Down":if(n[1])for(;n[1];)i.selectRight();else i.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":i.ctrlDeleteDir(1);break;case"Shift-Del":case"Del":i.deleteForward();break;case"Meta-A":case"Ctrl-A":for(i.notify("move").cursor.insAtRightEnd(i.root);n[f];)i.selectLeft();break;default:return}e.preventDefault(),i.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){d("overridden or never called on this node")}})),_.open((function(t){function e(t,e){var i=t.notify("upDown").cursor,n=e+"Into",s=e+"OutOf";return i[1][n]?i.insAtLeftEnd(i[1][n]):i[f][n]?i.insAtRightEnd(i[f][n]):i.parent.bubble((function(t){var e=t[s];if(e&&("function"==typeof e&&(e=t[s](i)),e instanceof v&&i.jumpUpDown(t,e),!0!==e))return!1})),t}this.onNotify((function(t){"move"!==t&&"upDown"!==t||this.show().clearSelection()})),t.escapeDir=function(t,e,i){m(t);var n=this.cursor;if(n.parent!==this.root&&i.preventDefault(),n.parent!==this.root)return n.parent.moveOutOf(t,n),this.notify("move")},j.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){m(t);var e=this.cursor,i=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,i):e.parent.moveOutOf(t,e,i),this.notify("move")},t.moveLeft=function(){return this.moveDir(f)},t.moveRight=function(){return this.moveDir(1)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify((function(t){"upDown"!==t&&(this.upDownCache={})})),this.onNotify((function(t){"edit"===t&&this.show().deleteSelection()})),t.deleteDir=function(t){m(t);var e=this.cursor,i=e.selection;return this.notify("edit"),i||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[f].siblingDeleted&&e[f].siblingDeleted(e.options,1),e[1].siblingDeleted&&e[1].siblingDeleted(e.options,f),e.parent.bubble("reflow"),this},t.ctrlDeleteDir=function(t){m(t);var e=this.cursor;return!e[f]||e.selection?ctrlr.deleteDir():(this.notify("edit"),w(e.parent.ends[f],e[f]).remove(),e.insAtDirEnd(f,e.parent),e[f].siblingDeleted&&e[f].siblingDeleted(e.options,1),e[1].siblingDeleted&&e[1].siblingDeleted(e.options,f),e.parent.bubble("reflow"),this)},t.backspace=function(){return this.deleteDir(f)},t.deleteForward=function(){return this.deleteDir(1)},this.onNotify((function(t){"select"!==t&&this.endSelection()})),t.selectDir=function(t){var e=this.notify("select").cursor,i=e.selection;m(t),e.anticursor||e.startSelection();var n=e[t];n?i&&i.ends[t]===n&&e.anticursor[-t]!==n?n.unselectInto(t,e):n.selectTowards(t,e):e.parent.selectOutOf(t,e),e.clearSelection(),e.select()||e.show()},t.selectLeft=function(){return this.selectDir(f)},t.selectRight=function(){return this.selectDir(1)}}));var B=function(){function t(t){for(var e=t[0]||W(),i=1;i<t.length;i+=1)t[i].children().adopt(e,e.ends[1],0);return e}var e=R.string,i=R.regex,n=R.letter,s=R.any,r=R.optWhitespace,a=R.succeed,o=R.fail,l=n.map((function(t){return it(t)})),c=i(/^[^${}\\_^]/).map((function(t){return U(t)})),u=i(/^[^\\a-eg-zA-Z]/).or(e("\\").then(i(/^[a-z]+/i).or(i(/^\s+/).result(" ")).or(s))).then((function(t){var e=y[t];return e?e(t).parser():o("unknown command: \\"+t)})).or(l).or(c),h=e("{").then((function(){return p})).skip(e("}")),d=r.then(h.or(u.map((function(t){var e=W();return t.adopt(e,0,0),e})))),p=d.many().map(t).skip(r),f=e("[").then(d.then((function(t){return"]"!==t.join("latex")?a(t):o()})).many().map(t).skip(r)).skip(e("]")),m=p;return m.block=d,m.optBlock=f,m}();_.open((function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},t.writeLatex=function(t){var e=this.notify("edit").cursor,i=R.all,n=R.eof,s=B.skip(n).or(i.result(!1)).parse(t);s&&!s.isEmpty()&&(s.children().adopt(e.parent,e[f],e[1]),s.jQize().insertBefore(e.jQ),e[f]=s.ends[1],s.finalizeInsert(e.options,e),s.ends[1][1].siblingCreated&&s.ends[1][1].siblingCreated(e.options,f),s.ends[f][f].siblingCreated&&s.ends[f][f].siblingCreated(e.options,1),e.parent.bubble("reflow"));return this},t.renderLatexMath=function(t){var e=this.root,i=this.cursor,n=R.all,s=R.eof,r=B.skip(s).or(n.result(!1)).parse(t);e.eachChild("postOrder","dispose"),e.ends[f]=e.ends[1]=0,r&&r.children().adopt(e,0,0);var a=e.jQ;if(r){var o=r.join("html");a.html(o),e.jQize(a.children()),e.finalizeInsert(i.options)}else a.empty();delete i.selection,i.insAtRightEnd(e)},t.renderLatexText=function(t){var e=this.root,i=this.cursor;e.jQ.children().slice(1).remove(),e.eachChild("postOrder","dispose"),e.ends[f]=e.ends[1]=0,delete i.selection,i.show().insAtRightEnd(e);var n=R.regex,s=R.string,r=R.eof,a=R.all,o=s("$").then(B).skip(s("$").or(r)).map((function(t){var e=Y(i);e.createBlocks();var n=e.ends[f];return t.children().adopt(n,0,0),e})),l=s("\\$").result("$").or(n(/^[^$]/)).map(U),c=o.or(l).many().skip(r).or(a.result(!1)).parse(t);if(c){for(var u=0;u<c.length;u+=1)c[u].adopt(e,e.ends[1],0);e.jQize().appendTo(e.jQ),e.finalizeInsert(i.options)}}})),_.open((function(e){e.delegateMouseEvents=function(){var e=this.root.jQ;this.container.bind("mousedown.mathquill",(function(i){var s,r=g(i.target).closest(".mq-root-block"),o=v.byId[r.attr(n)||e.attr(n)].controller,l=o.cursor,c=l.blink,u=o.textareaSpan,h=o.textarea;function d(t){s=g(t.target)}function p(e){l.anticursor||l.startSelection(),o.seek(s,e.pageX,e.pageY).cursor.select(),s=t}o.blurred&&(o.editable||r.prepend(u),h.focus()),i.preventDefault(),i.target.unselectable=!0,l.blink=a,o.seek(g(i.target),i.pageX,i.pageY).cursor.startSelection(),r.mousemove(d),g(i.target.ownerDocument).mousemove(p).mouseup((function t(e){l.blink=c,l.selection||(o.editable?l.show():u.detach()),r.unbind("mousemove",d),g(e.target.ownerDocument).unbind("mousemove",p).unbind("mouseup",t)}))}))}})),_.open((function(t){t.seek=function(t,e,s){var r=this.notify("select").cursor;if(t){var a=t.attr(n)||t.attr(i);if(!a){var o=t.parent();a=o.attr(n)||o.attr(i)}}var l=a?v.byId[a]:this.root;return d("nodeId is the id of some Node that exists",l),r.clearSelection().show(),l.seek(e,r),this.scrollHoriz(),this}})),_.open((function(t){t.scrollHoriz=function(){var t=this.cursor,e=t.selection,i=this.root.jQ[0].getBoundingClientRect();if(e){var n=e.jQ[0].getBoundingClientRect(),s=n.left-(i.left+20),r=n.right-(i.right-20);if(e.ends[f]===t[1])if(s<0)o=s;else{if(!(r>0))return;if(n.left-r<i.left+20)o=s;else o=r}else if(r>0)o=r;else{if(!(s<0))return;if(n.right-s>i.right-20)o=r;else o=s}}else{var a=t.jQ[0].getBoundingClientRect().left;if(a>i.right-20)var o=a-(i.right-20);else{if(!(a<i.left+20))return;var o=a-(i.left+20)}}this.root.jQ.stop().animate({scrollLeft:"+="+o},100)}})),_.open((function(e){T.p.substituteTextarea=function(){return g("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},e.createTextarea=function(){var t=this.textareaSpan=g('<span class="mq-textarea"></span>'),e=this.options.substituteTextarea();if(!e.nodeType)throw"substituteTextarea() must return a DOM element, got "+e;e=this.textarea=g(e).appendTo(t);var i=this;i.cursor.selectionChanged=function(){i.selectionChanged()},i.container.bind("copy",(function(){i.setTextareaSelection()}))},e.selectionChanged=function(){var e=this;bt(e.container[0]),e.textareaSelectionTimeout===t&&(e.textareaSelectionTimeout=setTimeout((function(){e.setTextareaSelection()})))},e.setTextareaSelection=function(){this.textareaSelectionTimeout=t;var e="";this.cursor.selection&&(e=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(e="$"+e+"$")),this.selectFn(e)},e.staticMathTextareaEvents=function(){var t=this,e=(t.root,t.cursor),i=t.textarea,n=t.textareaSpan;function s(){n.detach(),t.blurred=!0}this.container.prepend('<span class="mq-selectable">$'+t.exportLatex()+"$</span>"),t.blurred=!0,i.bind("cut paste",!1).focus((function(){t.blurred=!1})).blur((function(){e.selection&&e.selection.clear(),setTimeout(s)})),t.selectFn=function(t){i.val(t),t&&i.select()}},e.editablesTextareaEvents=function(){var t=this,e=(t.root,t.cursor),i=t.textarea,n=t.textareaSpan,s=F(i,this);this.selectFn=function(t){s.select(t)},this.container.prepend(n).on("cut",(function(i){e.selection&&setTimeout((function(){t.notify("edit"),e.parent.bubble("reflow")}))})),this.focusBlurEvents()},e.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t),this.scrollHoriz()},e.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}}));var N=p(v,(function(t,e){t.finalizeInsert=function(t,e){var i=this;i.postOrder("finalizeTree",t),i.postOrder("contactWeld",e),i.postOrder("blur"),i.postOrder("reflow"),i[1].siblingCreated&&i[1].siblingCreated(t,f),i[f].siblingCreated&&i[f].siblingCreated(t,1),i.bubble("reflow")}})),P=p(N,(function(t,e){t.init=function(t,i,n){var s=this;e.init.call(s),s.ctrlSeq||(s.ctrlSeq=t),i&&(s.htmlTemplate=i),n&&(s.textTemplate=n)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,(function(t,e){return t&&e.isEmpty()}))},t.parser=function(){var t=B.block,e=this;return t.times(e.numBlocks()).map((function(t){e.blocks=t;for(var i=0;i<t.length;i+=1)t[i].adopt(e,e.ends[1],0);return e}))},t.createLeftOf=function(t){var i=this,n=i.replacedFragment;i.createBlocks(),e.createLeftOf.call(i,t),n&&(n.adopt(i.ends[f],0,0),n.jQ.appendTo(i.ends[f].jQ)),i.finalizeInsert(t.options),i.placeCursor(t)},t.createBlocks=function(){for(var t=this,e=t.numBlocks(),i=t.blocks=Array(e),n=0;n<e;n+=1){(i[n]=W()).adopt(t,t.ends[1],0)}},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[f],(function(t,e){return t.isEmpty()?t:e})))},t.moveTowards=function(t,e,i){var n=i&&this[i+"Into"];e.insAtDirEnd(-t,n||this.ends[-t])},t.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e,null)},t.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.selectChildren=function(){return k(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(t,e){function i(t){var e={};return e[f]=t.jQ.offset().left,e[1]=e[f]+t.jQ.outerWidth(),e}var n=this,s=i(n);if(t<s[f])return e.insLeftOf(n);if(t>s[1])return e.insRightOf(n);var r=s[f];n.eachChild((function(a){var o=i(a);return t<o[f]?(t-r<o[f]-t?a[f]?e.insAtRightEnd(a[f]):e.insLeftOf(n):e.insAtLeftEnd(a),!1):t>o[1]?void(a[1]?r=o[1]:s[1]-t<t-o[1]?e.insRightOf(n):e.insAtRightEnd(a)):(a.seek(t,e),!1)}))},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){var t=this,e=t.blocks,i=" mathquill-command-id="+t.id,n=t.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);d("no unmatched angle brackets",n.join("")===this.htmlTemplate);for(var s=0,r=n[0];r;r=n[s+=1])if("/>"===r.slice(-2))n[s]=r.slice(0,-2)+i+"/>";else if("<"===r.charAt(0)){d("not an unmatched top-level close tag","/"!==r.charAt(1)),n[s]=r.slice(0,-1)+i+">";var a=1;do{d("no missing close tags",r=n[s+=1]),"</"===r.slice(0,2)?a-=1:"<"===r.charAt(0)&&"/>"!==r.slice(-2)&&(a+=1)}while(a>0)}return n.join("").replace(/>&(\d+)/g,(function(t,i){return" mathquill-block-id="+e[i].id+">"+e[i].join("html")}))},t.latex=function(){return this.foldChildren(this.ctrlSeq,(function(t,e){return t+"{"+(e.latex()||" ")+"}"}))},t.textTemplate=[""],t.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],(function(i,n){e+=1;var s=n.text();return i&&"("===t.textTemplate[e]&&"("===s[0]&&")"===s.slice(-1)?i+s.slice(1,-1)+t.textTemplate[e]:i+n.text()+(t.textTemplate[e]||"")}))}})),H=p(P,(function(t,e){t.init=function(t,i,n){n||(n=t&&t.length>1?t.slice(1):t),e.init.call(this,t,i,[n])},t.parser=function(){return R.succeed(this)},t.numBlocks=function(){return 0},t.replaces=function(t){t.remove()},t.createBlocks=a,t.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t]},t.deleteTowards=function(t,e){e[t]=this.remove()[t]},t.seek=function(t,e){t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this)},t.latex=function(){return this.ctrlSeq},t.text=function(){return this.textTemplate},t.placeCursor=a,t.isEmpty=function(){return!0}})),U=p(H,(function(t,e){t.init=function(t,i){e.init.call(this,t,"<span>"+(i||t)+"</span>")}})),X=p(H,(function(t,e){t.init=function(t,i,n){e.init.call(this,t,'<span class="mq-binary-operator">'+i+"</span>",n)}})),W=p(N,(function(t,e){t.join=function(t){return this.foldChildren("",(function(e,i){return e+i[t]()}))},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[f]===this.ends[1]&&0!==this.ends[f]?this.ends[f].text():this.join("text")},t.keystroke=function(t,i,n){return!n.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):(i.preventDefault(),void n.escapeDir("Shift-Spacebar"===t?f:1,t,i))},t.moveOutOf=function(t,e,i){!(i&&this.parent[i+"Into"])&&this[t]?e.insAtDirEnd(-t,this[t]):e.insDirOf(t,this.parent)},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e){var i=this.ends[1];if(!i||i.jQ.offset().left+i.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[f].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<i.jQ.offset().left;)i=i[f];return i.seek(t,e)},t.chToCmd=function(t){var e;return t.match(/^[a-eg-zA-Z]$/)?it(t):/^\d$/.test(t)?tt(t):(e=A[t]||y[t])?e(t):U(t)},t.write=function(t,e){var i=this.chToCmd(e);t.selection&&i.replaces(t.replaceSelection()),i.createLeftOf(t.show())},t.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}));O.StaticMath=function(t){return p(t.AbstractMathQuill,(function(e,i){this.RootBlock=W,e.__mathquillify=function(){return i.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},e.init=function(){i.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField)},e.latex=function(){var e=i.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField),e}}))};var G=p(W,$);O.MathField=function(t){return p(t.EditableField,(function(t,e){this.RootBlock=G,t.__mathquillify=function(t,i){return this.config(t),i>1&&(this.__controller.root.reflow=a),e.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}}))};var Z=p(v,(function(t,e){function i(t){t.jQ[0].normalize();var e=t.jQ[0].firstChild;d("only node in TextBlock span is Text node",3===e.nodeType);var i=K(e.data);return i.jQadd(e),t.children().disown(),i.adopt(t,0,0)}t.ctrlSeq="\\text",t.replaces=function(t){t instanceof w?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.jQadd=function(t){e.jQadd.call(this,t),this.ends[f]&&this.ends[f].jQadd(this.jQ[0].firstChild)},t.createLeftOf=function(t){var i=this;if(e.createLeftOf.call(this,t),i[1].siblingCreated&&i[1].siblingCreated(t.options,f),i[f].siblingCreated&&i[f].siblingCreated(t.options,1),i.bubble("reflow"),t.insAtRightEnd(i),i.replacedText)for(var n=0;n<i.replacedText.length;n+=1)i.write(t,i.replacedText.charAt(n))},t.parser=function(){var t=this,e=R.string,i=R.regex;return R.optWhitespace.then(e("{")).then(i(/^[^}]*/)).skip(e("}")).map((function(e){return K(e).adopt(t,0,0),t}))},t.textContents=function(){return this.foldChildren("",(function(t,e){return t+e.text}))},t.text=function(){return'"'+this.textContents()+'"'},t.latex=function(){return"\\text{"+this.textContents()+"}"},t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)},t.moveOutOf=function(t,e){e.insDirOf(t,this)},t.unselectInto=t.moveTowards,t.selectTowards=P.prototype.selectTowards,t.deleteTowards=P.prototype.deleteTowards,t.selectOutOf=function(t,e){e.insDirOf(t,this)},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},t.write=function(t,i){if(t.show().deleteSelection(),"$"!==i)t[f]?t[f].appendText(i):K(i).createLeftOf(t);else if(this.isEmpty())t.insRightOf(this),U("\\$","$").createLeftOf(t);else if(t[1])if(t[f]){var n=Z(),s=this.ends[f];s.disown(),s.adopt(n,0,0),t.insLeftOf(this),e.createLeftOf.call(n,t)}else t.insLeftOf(this);else t.insRightOf(this)},t.seek=function(t,e){e.hide();var n=i(this),s=this.jQ.width()/this.text.length,r=Math.round((t-this.jQ.offset().left)/s);r<=0?e.insAtLeftEnd(this):r>=n.text.length?e.insAtRightEnd(this):e.insLeftOf(n.splitRight(r));for(var a=t-e.show().offset().left,o=a&&a<0?f:1,l=o;e[o]&&a*l>0;)e[o].moveTowards(o,e),l=a,a=t-e.offset().left;if(o*a<-o*l&&e[-o].moveTowards(-o,e),e.anticursor){if(e.anticursor.parent===this){var c=e[f]&&e[f].text.length;if(this.anticursorPosition===c)e.anticursor=b.copy(e);else{if(this.anticursorPosition<c){var u=e[f].splitRight(this.anticursorPosition);e[f]=u}else u=e[1].splitRight(this.anticursorPosition-c);e.anticursor=b(this,u[f],u)}}}else this.anticursorPosition=e[f]&&e[f].text.length},t.blur=function(){W.prototype.blur.call(this),i(this)},t.focus=W.prototype.focus})),K=p(v,(function(t,e){function i(t,e){return e.charAt(t===f?0:-1+e.length)}t.init=function(t){e.init.call(this),this.text=t},t.jQadd=function(t){this.dom=t,this.jQ=g(t)},t.jQize=function(){return this.jQadd(document.createTextNode(this.text))},t.appendText=function(t){this.text+=t,this.dom.appendData(t)},t.prependText=function(t){this.text=t+this.text,this.dom.insertData(0,t)},t.insTextAtDirEnd=function(t,e){m(e),1===e?this.appendText(t):this.prependText(t)},t.splitRight=function(t){var e=K(this.text.slice(t)).adopt(this.parent,this,this[1]);return e.jQadd(this.dom.splitText(t)),this.text=this.text.slice(0,t),e},t.moveTowards=function(t,e){m(t);var n=i(-t,this.text),s=this[-t];return s?s.insTextAtDirEnd(n,t):K(n).createDir(-t,e),this.deleteTowards(t,e)},t.latex=function(){return this.text},t.deleteTowards=function(t,e){this.text.length>1?1===t?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),e[t]=this[t])},t.selectTowards=function(t,e){m(t);var n=e.anticursor,s=i(-t,this.text);if(n[t]===this){var r=K(s).createDir(t,e);n[t]=r,e.insDirOf(t,r)}else{var a=this[-t];if(a)a.insTextAtDirEnd(s,t);else(r=K(s).createDir(-t,e)).jQ.insDirOf(-t,e.selection.jQ);1===this.text.length&&n[-t]===this&&(n[-t]=this[-t])}return this.deleteTowards(t,e)}}));function V(t,e,i){return p(Z,{ctrlSeq:t,htmlTemplate:"<"+e+" "+i+">&0</"+e+">"})}A.$=y.text=y.textnormal=y.textrm=y.textup=y.textmd=Z,y.em=y.italic=y.italics=y.emph=y.textit=y.textsl=V("\\textit","i",'class="mq-text-mode"'),y.strong=y.bold=y.textbf=V("\\textbf","b",'class="mq-text-mode"'),y.sf=y.textsf=V("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),y.tt=y.texttt=V("\\texttt","span",'class="mq-monospace mq-text-mode"'),y.textsc=V("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),y.uppercase=V("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),y.lowercase=V("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"');var Y=p(P,(function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mq-math-mode">&0</span>',t.createBlocks=function(){e.createBlocks.call(this),this.ends[f].cursor=this.cursor,this.ends[f].write=function(t,e){"$"!==e?W.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),U("\\$","$").createLeftOf(t.show())):t[1]?t[f]?W.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[f].latex()+"$"}})),J=p(G,(function(t,e){t.keystroke=function(t){if("Spacebar"!==t&&"Shift-Spacebar"!==t)return e.keystroke.apply(this,arguments)},t.write=function(t,e){var i;(t.show().deleteSelection(),"$"===e)?Y(t).createLeftOf(t):("<"===e?i="&lt;":">"===e&&(i="&gt;"),U(e,i).createLeftOf(t))}}));O.TextField=function(t){return p(t.EditableField,(function(t,e){this.RootBlock=J,t.__mathquillify=function(){return e.__mathquillify.call(this,"mq-editable-field mq-text-mode")},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}}))};A["\\"]=p(P,(function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[f].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[f].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[f].write=function(t,e){t.show().deleteSelection(),e.match(/[a-z]/i)?U(e).createLeftOf(t):(this.parent.renderCommand(t),"\\"===e&&this.isEmpty()||this.parent.parent.write(t,e))},this.ends[f].keystroke=function(t,i,n){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.parent.renderCommand(n.cursor),void i.preventDefault()):e.keystroke.apply(this,arguments)}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this._replacedFragment){var i=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",(function(t){return g(t.target=i).trigger(t),!1})).insertBefore(this.jQ).add(this.jQ)}},t.latex=function(){return"\\"+this.ends[f].latex()+" "},t.renderCommand=function(t){this.jQ=this.jQ.last(),this.remove(),this[1]?t.insLeftOf(this[1]):t.insAtRightEnd(this.parent);var e=this.ends[f].latex();e||(e=" ");var i=y[e];i?(i=i(e),this._replacedFragment&&i.replaces(this._replacedFragment),i.createLeftOf(t)):((i=Z()).replaces(e),i.createLeftOf(t),t.insRightOf(i),this._replacedFragment&&this._replacedFragment.remove())}}));y.notin=y.cong=y.equiv=y.oplus=y.otimes=p(X,(function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}})),y["≠"]=y.ne=y.neq=h(X,"\\ne ","&ne;"),y.ast=y.star=y.loast=y.lowast=h(X,"\\ast ","&lowast;"),y.therefor=y.therefore=h(X,"\\therefore ","&there4;"),y.cuz=y.because=h(X,"\\because ","&#8757;"),y.prop=y.propto=h(X,"\\propto ","&prop;"),y["≈"]=y.asymp=y.approx=h(X,"\\approx ","&asymp;"),y.isin=y.in=h(X,"\\in ","&isin;"),y.ni=y.contains=h(X,"\\ni ","&ni;"),y.notni=y.niton=y.notcontains=y.doesnotcontain=h(X,"\\not\\ni ","&#8716;"),y.sub=y.subset=h(X,"\\subset ","&sub;"),y.sup=y.supset=y.superset=h(X,"\\supset ","&sup;"),y.nsub=y.notsub=y.nsubset=y.notsubset=h(X,"\\not\\subset ","&#8836;"),y.nsup=y.notsup=y.nsupset=y.notsupset=y.nsuperset=y.notsuperset=h(X,"\\not\\supset ","&#8837;"),y.sube=y.subeq=y.subsete=y.subseteq=h(X,"\\subseteq ","&sube;"),y.supe=y.supeq=y.supsete=y.supseteq=y.supersete=y.superseteq=h(X,"\\supseteq ","&supe;"),y.nsube=y.nsubeq=y.notsube=y.notsubeq=y.nsubsete=y.nsubseteq=y.notsubsete=y.notsubseteq=h(X,"\\not\\subseteq ","&#8840;"),y.nsupe=y.nsupeq=y.notsupe=y.notsupeq=y.nsupsete=y.nsupseteq=y.notsupsete=y.notsupseteq=y.nsupersete=y.nsuperseteq=y.notsupersete=y.notsuperseteq=h(X,"\\not\\supseteq ","&#8841;"),y.N=y.naturals=y.Naturals=h(U,"\\mathbb{N}","&#8469;"),y.P=y.primes=y.Primes=y.projective=y.Projective=y.probability=y.Probability=h(U,"\\mathbb{P}","&#8473;"),y.Z=y.integers=y.Integers=h(U,"\\mathbb{Z}","&#8484;"),y.Q=y.rationals=y.Rationals=h(U,"\\mathbb{Q}","&#8474;"),y.R=y.reals=y.Reals=h(U,"\\mathbb{R}","&#8477;"),y.C=y.complex=y.Complex=y.complexes=y.Complexes=y.complexplane=y.Complexplane=y.ComplexPlane=h(U,"\\mathbb{C}","&#8450;"),y.H=y.Hamiltonian=y.quaternions=y.Quaternions=h(U,"\\mathbb{H}","&#8461;"),y.quad=y.emsp=h(U,"\\quad ","    "),y.qquad=h(U,"\\qquad ","        "),y.diamond=h(U,"\\diamond ","&#9671;"),y.bigtriangleup=h(U,"\\bigtriangleup ","&#9651;"),y.ominus=h(U,"\\ominus ","&#8854;"),y.uplus=h(U,"\\uplus ","&#8846;"),y.bigtriangledown=h(U,"\\bigtriangledown ","&#9661;"),y.sqcap=h(U,"\\sqcap ","&#8851;"),y.triangleleft=h(U,"\\triangleleft ","&#8882;"),y.sqcup=h(U,"\\sqcup ","&#8852;"),y.triangleright=h(U,"\\triangleright ","&#8883;"),y.odot=y.circledot=h(U,"\\odot ","&#8857;"),y.bigcirc=h(U,"\\bigcirc ","&#9711;"),y.dagger=h(U,"\\dagger ","&#0134;"),y.ddagger=h(U,"\\ddagger ","&#135;"),y.wr=h(U,"\\wr ","&#8768;"),y.amalg=h(U,"\\amalg ","&#8720;"),y.models=h(U,"\\models ","&#8872;"),y.prec=h(U,"\\prec ","&#8826;"),y.succ=h(U,"\\succ ","&#8827;"),y.preceq=h(U,"\\preceq ","&#8828;"),y.succeq=h(U,"\\succeq ","&#8829;"),y.simeq=h(U,"\\simeq ","&#8771;"),y.mid=h(U,"\\mid ","&#8739;"),y.ll=h(U,"\\ll ","&#8810;"),y.gg=h(U,"\\gg ","&#8811;"),y.parallel=h(U,"\\parallel ","&#8741;"),y.nparallel=h(U,"\\nparallel ","&#8742;"),y.bowtie=h(U,"\\bowtie ","&#8904;"),y.sqsubset=h(U,"\\sqsubset ","&#8847;"),y.sqsupset=h(U,"\\sqsupset ","&#8848;"),y.smile=h(U,"\\smile ","&#8995;"),y.sqsubseteq=h(U,"\\sqsubseteq ","&#8849;"),y.sqsupseteq=h(U,"\\sqsupseteq ","&#8850;"),y.doteq=h(U,"\\doteq ","&#8784;"),y.frown=h(U,"\\frown ","&#8994;"),y.vdash=h(U,"\\vdash ","&#8870;"),y.dashv=h(U,"\\dashv ","&#8867;"),y.nless=h(U,"\\nless ","&#8814;"),y.ngtr=h(U,"\\ngtr ","&#8815;"),y.longleftarrow=h(U,"\\longleftarrow ","&#8592;"),y.longrightarrow=h(U,"\\longrightarrow ","&#8594;"),y.Longleftarrow=h(U,"\\Longleftarrow ","&#8656;"),y.Longrightarrow=h(U,"\\Longrightarrow ","&#8658;"),y.longleftrightarrow=h(U,"\\longleftrightarrow ","&#8596;"),y.updownarrow=h(U,"\\updownarrow ","&#8597;"),y.Longleftrightarrow=h(U,"\\Longleftrightarrow ","&#8660;"),y.Updownarrow=h(U,"\\Updownarrow ","&#8661;"),y.mapsto=h(U,"\\mapsto ","&#8614;"),y.nearrow=h(U,"\\nearrow ","&#8599;"),y.hookleftarrow=h(U,"\\hookleftarrow ","&#8617;"),y.hookrightarrow=h(U,"\\hookrightarrow ","&#8618;"),y.searrow=h(U,"\\searrow ","&#8600;"),y.leftharpoonup=h(U,"\\leftharpoonup ","&#8636;"),y.rightharpoonup=h(U,"\\rightharpoonup ","&#8640;"),y.swarrow=h(U,"\\swarrow ","&#8601;"),y.leftharpoondown=h(U,"\\leftharpoondown ","&#8637;"),y.rightharpoondown=h(U,"\\rightharpoondown ","&#8641;"),y.nwarrow=h(U,"\\nwarrow ","&#8598;"),y.ldots=h(U,"\\ldots ","&#8230;"),y.cdots=h(U,"\\cdots ","&#8943;"),y.vdots=h(U,"\\vdots ","&#8942;"),y.ddots=h(U,"\\ddots ","&#8945;"),y.surd=h(U,"\\surd ","&#8730;"),y.triangle=h(U,"\\triangle ","&#9651;"),y.ell=h(U,"\\ell ","&#8467;"),y.top=h(U,"\\top ","&#8868;"),y.flat=h(U,"\\flat ","&#9837;"),y.natural=h(U,"\\natural ","&#9838;"),y.sharp=h(U,"\\sharp ","&#9839;"),y.wp=h(U,"\\wp ","&#8472;"),y.bot=h(U,"\\bot ","&#8869;"),y.clubsuit=h(U,"\\clubsuit ","&#9827;"),y.diamondsuit=h(U,"\\diamondsuit ","&#9826;"),y.heartsuit=h(U,"\\heartsuit ","&#9825;"),y.spadesuit=h(U,"\\spadesuit ","&#9824;"),y.parallelogram=h(U,"\\parallelogram ","&#9649;"),y.square=h(U,"\\square ","&#11036;"),y.oint=h(U,"\\oint ","&#8750;"),y.bigcap=h(U,"\\bigcap ","&#8745;"),y.bigcup=h(U,"\\bigcup ","&#8746;"),y.bigsqcup=h(U,"\\bigsqcup ","&#8852;"),y.bigvee=h(U,"\\bigvee ","&#8744;"),y.bigwedge=h(U,"\\bigwedge ","&#8743;"),y.bigodot=h(U,"\\bigodot ","&#8857;"),y.bigotimes=h(U,"\\bigotimes ","&#8855;"),y.bigoplus=h(U,"\\bigoplus ","&#8853;"),y.biguplus=h(U,"\\biguplus ","&#8846;"),y.lfloor=h(U,"\\lfloor ","&#8970;"),y.rfloor=h(U,"\\rfloor ","&#8971;"),y.lceil=h(U,"\\lceil ","&#8968;"),y.rceil=h(U,"\\rceil ","&#8969;"),y.opencurlybrace=y.lbrace=h(U,"\\lbrace ","{"),y.closecurlybrace=y.rbrace=h(U,"\\rbrace ","}"),y.lbrack=h(U,"["),y.rbrack=h(U,"]"),y["∫"]=y.int=y.integral=h(H,"\\int ","<big>&int;</big>"),y.slash=h(U,"/"),y.vert=h(U,"|"),y.perp=y.perpendicular=h(U,"\\perp ","&perp;"),y.nabla=y.del=h(U,"\\nabla ","&nabla;"),y.hbar=h(U,"\\hbar ","&#8463;"),y.AA=y.Angstrom=y.angstrom=h(U,"\\text\\AA ","&#8491;"),y.ring=y.circ=y.circle=h(U,"\\circ ","&#8728;"),y.bull=y.bullet=h(U,"\\bullet ","&bull;"),y.setminus=y.smallsetminus=h(U,"\\setminus ","&#8726;"),y.not=y["¬"]=y.neg=h(U,"\\neg ","&not;"),y["…"]=y.dots=y.ellip=y.hellip=y.ellipsis=y.hellipsis=h(U,"\\dots ","&hellip;"),y.converges=y.darr=y.dnarr=y.dnarrow=y.downarrow=h(U,"\\downarrow ","&darr;"),y.dArr=y.dnArr=y.dnArrow=y.Downarrow=h(U,"\\Downarrow ","&dArr;"),y.diverges=y.uarr=y.uparrow=h(U,"\\uparrow ","&uarr;"),y.uArr=y.Uparrow=h(U,"\\Uparrow ","&uArr;"),y.to=h(X,"\\to ","&rarr;"),y.rarr=y.rightarrow=h(U,"\\rightarrow ","&rarr;"),y.implies=h(X,"\\Rightarrow ","&rArr;"),y.rArr=y.Rightarrow=h(U,"\\Rightarrow ","&rArr;"),y.gets=h(X,"\\gets ","&larr;"),y.larr=y.leftarrow=h(U,"\\leftarrow ","&larr;"),y.impliedby=h(X,"\\Leftarrow ","&lArr;"),y.lArr=y.Leftarrow=h(U,"\\Leftarrow ","&lArr;"),y.harr=y.lrarr=y.leftrightarrow=h(U,"\\leftrightarrow ","&harr;"),y.iff=h(X,"\\Leftrightarrow ","&hArr;"),y.hArr=y.lrArr=y.Leftrightarrow=h(U,"\\Leftrightarrow ","&hArr;"),y.Re=y.Real=y.real=h(U,"\\Re ","&real;"),y.Im=y.imag=y.image=y.imagin=y.imaginary=y.Imaginary=h(U,"\\Im ","&image;"),y.part=y.partial=h(U,"\\partial ","&part;"),y.infty=y.infin=y.infinity=h(U,"\\infty ","&infin;"),y.alef=y.alefsym=y.aleph=y.alephsym=h(U,"\\aleph ","&alefsym;"),y.xist=y.xists=y.exist=y.exists=h(U,"\\exists ","&exist;"),y.and=y.land=y.wedge=h(U,"\\wedge ","&and;"),y.or=y.lor=y.vee=h(U,"\\vee ","&or;"),y.o=y.O=y.empty=y.emptyset=y.oslash=y.Oslash=y.nothing=y.varnothing=h(X,"\\varnothing ","&empty;"),y.cup=y.union=h(X,"\\cup ","&cup;"),y.cap=y.intersect=y.intersection=h(X,"\\cap ","&cap;"),y.deg=y.degree=h(U,"\\degree ","&deg;"),y.ang=y.angle=h(U,"\\angle ","&ang;"),y.measuredangle=h(U,"\\measuredangle ","&#8737;");var tt=p(U,(function(t,e){t.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[f]instanceof et&&!1!==t[f].isItalic||t[f]instanceof yt&&t[f][f]instanceof et&&!1!==t[f][f].isItalic)?(y._().createLeftOf(t),e.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):e.createLeftOf.call(this,t)}})),et=p(H,(function(t,e){t.init=function(t,i){e.init.call(this,t,"<var>"+(i||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return!this[f]||this[f]instanceof et||this[f]instanceof X||"\\ "===this[f].ctrlSeq||(t="*"+t),!this[1]||this[1]instanceof X||this[1]instanceof yt||(t+="*"),t}}));T.p.autoCommands={_maxLength:0},j.autoCommands=function(t){if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(var e=t.split(" "),i={},n=0,s=0;s<e.length;s+=1){var a=e[s];if(a.length<2)throw'autocommand "'+a+'" not minimum length of 2';if(y[a]===at)throw'"'+a+'" is a built-in operator name';i[a]=1,n=r(n,a.length)}return i._maxLength=n,i};var it=p(et,(function(t,e){function i(t){return t instanceof H&&!(t instanceof X)}t.init=function(t){return e.init.call(this,this.letter=t)},t.createLeftOf=function(t){var i=t.options.autoCommands,n=i._maxLength;if(n>0){for(var s=this.letter,r=t[f],a=1;r instanceof it&&a<n;)s=r.letter+s,r=r[f],a+=1;for(;s.length;){if(i.hasOwnProperty(s)){for(a=2,r=t[f];a<s.length;a+=1,r=r[f]);return w(r,t[f]).remove(),t[f]=r[f],y[s](s).createLeftOf(t)}s=s.slice(1)}}e.createLeftOf.apply(this,arguments)},t.italicize=function(t){return this.isItalic=t,this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==f&&this[1]instanceof it||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e=t.autoOperatorNames;if(0!==e._maxLength){for(var n=this.letter,r=this[f];r instanceof it;r=r[f])n=r.letter+n;for(var a=this[1];a instanceof it;a=a[1])n+=a.letter;w(r[1]||this.parent.ends[f],a[f]||this.parent.ends[1]).each((function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last"),t.ctrlSeq=t.letter}));t:for(var o=0,l=r[1]||this.parent.ends[f];o<n.length;o+=1,l=l[1])for(var c=s(e._maxLength,n.length-o);c>0;c-=1){var u=n.slice(o,o+c);if(e.hasOwnProperty(u)){for(var h=0,d=l;h<c;h+=1,d=d[1]){d.italicize(!1);var p=d}var m=nt.hasOwnProperty(u);l.ctrlSeq=(m?"\\":"\\operatorname{")+l.ctrlSeq,p.ctrlSeq+=m?" ":"}",rt.hasOwnProperty(u)&&p[f][f][f].jQ.addClass("mq-last"),i(l[f])&&l.jQ.addClass("mq-first"),i(p[1])&&p.jQ.addClass("mq-last"),o+=c-1,l=p;continue t}}}}})),nt={},st=T.p.autoOperatorNames={_maxLength:9},rt={limsup:1,liminf:1,projlim:1,injlim:1};!function(){for(var t="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" "),e=0;e<t.length;e+=1)nt[t[e]]=st[t[e]]=1;var i="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" ");for(e=0;e<i.length;e+=1)nt[i[e]]=1;var n="sin cos tan sec cosec csc cotan cot ctg".split(" ");for(e=0;e<n.length;e+=1)st[n[e]]=st["arc"+n[e]]=st[n[e]+"h"]=st["ar"+n[e]+"h"]=st["arc"+n[e]+"h"]=1;var s="gcf hcf lcm proj span".split(" ");for(e=0;e<s.length;e+=1)st[s[e]]=1}(),j.autoOperatorNames=function(t){if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(var e=t.split(" "),i={},n=0,s=0;s<e.length;s+=1){var a=e[s];if(a.length<2)throw'"'+a+'" not minimum length of 2';i[a]=1,n=r(n,a.length)}return i._maxLength=n,i};var at=p(H,(function(t,e){t.init=function(t){this.ctrlSeq=t},t.createLeftOf=function(t){for(var e=this.ctrlSeq,i=0;i<e.length;i+=1)it(e.charAt(i)).createLeftOf(t)},t.parser=function(){for(var t=this.ctrlSeq,e=W(),i=0;i<t.length;i+=1)it(t.charAt(i)).adopt(e,e.ends[1],0);return R.succeed(e.children())}}));for(var ot in st)st.hasOwnProperty(ot)&&(y[ot]=at);y.operatorname=p(P,(function(t){t.createLeftOf=a,t.numBlocks=function(){return 1},t.parser=function(){return B.block.map((function(t){return t.children()}))}})),y.f=p(it,(function(t,e){t.init=function(){H.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},t.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),e.italicize.apply(this,arguments)}})),y[" "]=y.space=h(U,"\\ ","&nbsp;"),y["'"]=y.prime=h(U,"'","&prime;"),y.backslash=h(U,"\\backslash ","\\"),A["\\"]||(A["\\"]=y.backslash),y.$=h(U,"\\$","$");var lt=p(H,(function(t,e){t.init=function(t,i){e.init.call(this,t,'<span class="mq-nonSymbola">'+(i||t)+"</span>")}}));y["@"]=lt,y["&"]=h(lt,"\\&","&amp;"),y["%"]=h(lt,"\\%","%"),y.alpha=y.beta=y.gamma=y.delta=y.zeta=y.eta=y.theta=y.iota=y.kappa=y.mu=y.nu=y.xi=y.rho=y.sigma=y.tau=y.chi=y.psi=y.omega=p(et,(function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}})),y.phi=h(et,"\\phi ","&#981;"),y.phiv=y.varphi=h(et,"\\varphi ","&phi;"),y.epsilon=h(et,"\\epsilon ","&#1013;"),y.epsiv=y.varepsilon=h(et,"\\varepsilon ","&epsilon;"),y.piv=y.varpi=h(et,"\\varpi ","&piv;"),y.sigmaf=y.sigmav=y.varsigma=h(et,"\\varsigma ","&sigmaf;"),y.thetav=y.vartheta=y.thetasym=h(et,"\\vartheta ","&thetasym;"),y.upsilon=y.upsi=h(et,"\\upsilon ","&upsilon;"),y.gammad=y.Gammad=y.digamma=h(et,"\\digamma ","&#989;"),y.kappav=y.varkappa=h(et,"\\varkappa ","&#1008;"),y.rhov=y.varrho=h(et,"\\varrho ","&#1009;"),y.pi=y["π"]=h(lt,"\\pi ","&pi;"),y.lambda=h(lt,"\\lambda ","&lambda;"),y.Upsilon=y.Upsi=y.upsih=y.Upsih=h(H,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),y.Gamma=y.Delta=y.Theta=y.Lambda=y.Xi=y.Pi=y.Sigma=y.Phi=y.Psi=y.Omega=y.forall=p(U,(function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}));var ct=p(P,(function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=B.parse(this.latex);e.children().adopt(t.parent,t[f],t[1]),t[f]=e.ends[1],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[1][1].siblingCreated&&e.ends[1][1].siblingCreated(t.options,f),e.ends[f][f].siblingCreated&&e.ends[f][f].siblingCreated(t.options,1),t.parent.bubble("reflow")},t.parser=function(){var t=B.parse(this.latex).children();return R.succeed(t)}}));y["¹"]=h(ct,"^1"),y["²"]=h(ct,"^2"),y["³"]=h(ct,"^3"),y["¼"]=h(ct,"\\frac14"),y["½"]=h(ct,"\\frac12"),y["¾"]=h(ct,"\\frac34");var ut=p(X,(function(t){t.init=U.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){if(1!==e)return this.jQ[0].className=!this[f]||this[f]instanceof X?"":"mq-binary-operator",this}}));y["+"]=h(ut,"+","+"),y["–"]=y["-"]=h(ut,"-","&minus;"),y["±"]=y.pm=y.plusmn=y.plusminus=h(ut,"\\pm ","&plusmn;"),y.mp=y.mnplus=y.minusplus=h(ut,"\\mp ","&#8723;"),A["*"]=y.sdot=y.cdot=h(X,"\\cdot ","&middot;","*");var ht=p(X,(function(t,e){t.init=function(t,i){this.data=t,this.strict=i;var n=i?"Strict":"";e.init.call(this,t["ctrlSeq"+n],t["html"+n],t["text"+n])},t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t,i){if(t===f&&!this.strict)return this.swap(!0),void this.bubble("reflow");e.deleteTowards.apply(this,arguments)}})),dt={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},pt={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};y["<"]=y.lt=h(ht,dt,!0),y[">"]=y.gt=h(ht,pt,!0),y["≤"]=y.le=y.leq=h(ht,dt,!1),y["≥"]=y.ge=y.geq=h(ht,pt,!1);var ft=p(X,(function(t,e){t.init=function(){e.init.call(this,"=","=")},t.createLeftOf=function(t){if(t[f]instanceof ht&&t[f].strict)return t[f].swap(!1),void t[f].bubble("reflow");e.createLeftOf.apply(this,arguments)}}));y["="]=ft,y["×"]=y.times=h(X,"\\times ","&times;","[x]"),y["÷"]=y.div=y.divide=y.divides=h(X,"\\div ","&divide;","[/]"),A["~"]=y.sim=h(X,"\\sim ","~","~");var mt,gt,bt=a,vt=document.createElement("div").style;for(var xt in{transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1})if(xt in vt){gt=xt;break}gt?mt=function(t,e,i){t.css(gt,"scale("+e+","+i+")")}:"filter"in vt?(bt=function(t){t.className=t.className},mt=function(t,e,i){e/=1+(i-1)/2,t.css("fontSize",i+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>');var n=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')");function s(){t.css("marginRight",(n.width()-1)*(e-1)/e+"px")}s();var r=setInterval(s);g(window).load((function(){clearTimeout(r),s()}))}):mt=function(t,e,i){t.css("fontSize",i+"em")};var wt=p(P,(function(t,e){t.init=function(t,i,n){e.init.call(this,t,"<"+i+" "+n+">&0</"+i+">")}}));y.mathrm=h(wt,"\\mathrm","span",'class="mq-roman mq-font"'),y.mathit=h(wt,"\\mathit","i",'class="mq-font"'),y.mathbf=h(wt,"\\mathbf","b",'class="mq-font"'),y.mathsf=h(wt,"\\mathsf","span",'class="mq-sans-serif mq-font"'),y.mathtt=h(wt,"\\mathtt","span",'class="mq-monospace mq-font"'),y.underline=h(wt,"\\underline","span",'class="mq-non-leaf mq-underline"'),y.overline=y.bar=h(wt,"\\overline","span",'class="mq-non-leaf mq-overline"'),y.overrightarrow=h(wt,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),y.overleftarrow=h(wt,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"');y.textcolor=p(P,(function(t,e){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var t=this,i=R.optWhitespace,n=R.string,s=R.regex;return i.then(n("{")).then(s(/^[#\w\s.,()%-]*/)).skip(n("}")).then((function(i){return t.setColor(i),e.parser.call(t)}))}})),y.class=p(P,(function(t,e){t.parser=function(){var t=this,i=R.string,n=R.regex;return R.optWhitespace.then(i("{")).then(n(/^[-\w\s\\\xA0-\xFF]*/)).skip(i("}")).then((function(i){return t.htmlTemplate='<span class="mq-class '+i+'">&0</span>',e.parser.call(t)}))}}));var yt=p(P,(function(t,e){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){if(t[f]||!t.options.supSubsRequireOperand)return e.createLeftOf.apply(this,arguments)},t.contactWeld=function(t){for(var e=f;e;e=e===f&&1)if(this[e]instanceof yt){for(var i="sub";i;i="sub"===i&&"sup"){var n=this[i],s=this[e][i];if(n){if(s)if(n.isEmpty())a=b(s,0,s.ends[f]);else{n.jQ.children().insAtDirEnd(-e,s.jQ);var r=n.children().disown(),a=b(s,r.ends[1],s.ends[f]);e===f?r.adopt(s,s.ends[1],0):r.adopt(s,0,s.ends[f])}else this[e].addBlock(n.disown());this.placeCursor=function(t,i){return function(n){n.insAtDirEnd(-e,t||i)}}(s,n)}}this.remove(),t&&t[f]===this&&(1===e&&a?a[f]?t.insRightOf(a[f]):t.insAtLeftEnd(a.parent):t.insRightOf(this[e]));break}this.respace()},T.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[f].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var i=this.chToCmd(e);return i instanceof H?t.deleteSelection():t.clearSelection().insRightOf(this.parent),i.createLeftOf(t.show())}t[f]&&!t[1]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&t.insRightOf(this.parent),W.p.write.apply(this,arguments)}},t.moveTowards=function(t,i,n){i.options.autoSubscriptNumerals&&!this.sup?i.insDirOf(t,this):e.moveTowards.apply(this,arguments)},t.deleteTowards=function(t,i){if(i.options.autoSubscriptNumerals&&this.sub){var n=this.sub.ends[-t];n instanceof H?n.remove():n&&n.deleteTowards(t,i.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(f,i.insAtLeftEnd(this.sub)),this.sup&&i.insDirOf(-t,this))}else e.deleteTowards.apply(this,arguments)},t.latex=function(){function t(t,e){var i=e&&e.latex();return e?t+(1===i.length?i:"{"+(i||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.respace=t.siblingCreated=t.siblingDeleted=function(t,e){1!==e&&this.jQ.toggleClass("mq-limit","\\int "===this[f].ctrlSeq)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=g('<span class="mq-sup"/>').append(t.jQ.children()).attr(n,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=g('<span class="mq-sub"></span>').append(t.jQ.children()).attr(n,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;e<2;e+=1)!function(t,e,i,n){t[e].deleteOutOf=function(s,r){if(r.insDirOf(this[s]?-s:s,this.parent),!this.isEmpty()){var a=this.ends[s];this.children().disown().withDirAdopt(s,r.parent,r[s],r[-s]).jQ.insDirOf(-s,r.jQ),r[-s]=a}t.supsub=i,delete t[e],delete t[n+"Into"],t[i][n+"OutOf"]=At,delete t[i].deleteOutOf,"sub"===e&&g(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])}}));function At(t){var e=this.parent,i=t;do{if(i[1])return t.insLeftOf(e);i=i.parent.parent}while(i!==e);t.insRightOf(e)}y.subscript=y._=p(yt,(function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.finalizeTree=function(){this.downInto=this.sub=this.ends[f],this.sub.upOutOf=At,e.finalizeTree.call(this)}})),y.superscript=y.supscript=y["^"]=p(yt,(function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^"],t.finalizeTree=function(){this.upInto=this.sup=this.ends[1],this.sup.downOutOf=At,e.finalizeTree.call(this)}}));var qt=p(P,(function(t,e){t.init=function(t,e){var i='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>';H.prototype.init.call(this,t,i)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(it("n").createLeftOf(t),ft().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[f].latex())+"^"+t(this.ends[1].latex())},t.parser=function(){for(var t=R.string,e=R.optWhitespace,i=R.succeed,n=B.block,s=this,r=s.blocks=[W(),W()],a=0;a<r.length;a+=1)r[a].adopt(s,s.ends[1],0);return e.then(t("_").or(t("^"))).then((function(t){var e=r["_"===t?0:1];return n.then((function(t){return t.children().adopt(e,e.ends[1],0),i(s)}))})).many().result(s)},t.finalizeTree=function(){this.downInto=this.ends[f],this.upInto=this.ends[1],this.ends[f].upOutOf=this.ends[1],this.ends[1].downOutOf=this.ends[f]}}));y["∑"]=y.sum=y.summation=h(qt,"\\sum ","&sum;"),y["∏"]=y.prod=y.product=h(qt,"\\prod ","&prod;"),y.coprod=y.coproduct=h(qt,"\\coprod ","&#8720;");var kt=y.frac=y.dfrac=y.cfrac=y.fraction=p(P,(function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t.finalizeTree=function(){this.upInto=this.ends[1].upOutOf=this.ends[f],this.downInto=this.ends[f].downOutOf=this.ends[1]}})),_t=y.over=A["/"]=p(kt,(function(t,e){t.createLeftOf=function(t){if(!this.replacedFragment){for(var i=t[f];i&&!(i instanceof X||i instanceof(y.text||a)||i instanceof qt||"\\ "===i.ctrlSeq||/^[,;:]$/.test(i.ctrlSeq));)i=i[f];i instanceof qt&&i[1]instanceof yt&&(i=i[1])[1]instanceof yt&&i[1].ctrlSeq!=i.ctrlSeq&&(i=i[1]),i!==t[f]&&(this.replaces(w(i[1]||t.parent.ends[f],t[f])),t[f]=i)}e.createLeftOf.call(this,t)}})),Ot=y.sqrt=y["√"]=p(P,(function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return B.optBlock.then((function(t){return B.block.map((function(e){var i=Tt();return i.blocks=[t,e],t.adopt(i,0,0),e.adopt(i,t,0),i}))})).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[1].jQ;mt(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}})),Tt=(y.vec=p(P,(function(t,e){t.ctrlSeq="\\vec",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-vector-prefix">&rarr;</span><span class="mq-vector-stem">&0</span></span>',t.textTemplate=["vec(",")"]})),y.nthroot=p(Ot,(function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[f].latex()+"]{"+this.ends[1].latex()+"}"}})));function jt(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));mt(this.delimjQs,s(1+.2*(t-1),1.2),1.2*t)}}var Et=p(p(P,jt),(function(e,i){e.init=function(e,n,s,r,a){i.init.call(this,"\\left"+r,t,[n,s]),this.side=e,this.sides={},this.sides[f]={ch:n,ctrlSeq:r},this.sides[1]={ch:s,ctrlSeq:a}},e.numBlocks=function(){return 1},e.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(1===this.side?" mq-ghost":"")+'">'+this.sides[f].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===f?" mq-ghost":"")+'">'+this.sides[1].ch+"</span></span>",i.html.call(this)},e.latex=function(){return"\\left"+this.sides[f].ctrlSeq+this.ends[f].latex()+"\\right"+this.sides[1].ctrlSeq},e.oppBrack=function(t,e,i){return e instanceof Et&&e.side&&e.side!==-i&&("|"===this.sides[this.side].ch||e.side===-this.side)&&(!t.restrictMismatchedBrackets||Ct[this.sides[this.side].ch]===e.sides[e.side].ch||{"(":"]","[":")"}[this.sides[f].ch]===e.sides[1].ch)&&e},e.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===f?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},e.createLeftOf=function(t){if(!this.replacedFragment)var e=t.options,n=this.oppBrack(e,t[f],f)||this.oppBrack(e,t[1],1)||this.oppBrack(e,t.parent.parent);if(n){var s=this.side=-n.side;this.closeOpposing(n),n===t.parent.parent&&t[s]&&(w(t[s],t.parent.ends[s],-s).disown().withDirAdopt(-s,n.parent,n,n[s]).jQ.insDirOf(s,n.jQ),n.bubble("reflow"))}else s=(n=this).side,n.replacedFragment?n.side=0:t[-s]&&(n.replaces(w(t[-s],t.parent.ends[-s],s)),t[-s]=0),i.createLeftOf.call(n,t);s===f?t.insAtLeftEnd(n.ends[f]):t.insRightOf(n)},e.placeCursor=a,e.unwrap=function(){this.ends[f].children().disown().adopt(this.parent,this,this[1]).jQ.insertAfter(this.jQ),this.remove()},e.deleteSide=function(t,e,i){var n=this.parent,s=this[t],r=n.ends[t];if(t===this.side)return this.unwrap(),void(s?i.insDirOf(-t,s):i.insAtDirEnd(t,n));var a=i.options,o=!this.side;if(this.side=-t,this.oppBrack(a,this.ends[f].ends[this.side],t)){this.closeOpposing(this.ends[f].ends[this.side]);var l=this.ends[f].ends[t];this.unwrap(),l.siblingCreated&&l.siblingCreated(i.options,t),s?i.insDirOf(-t,s):i.insAtDirEnd(t,n)}else{if(this.oppBrack(a,this.parent.parent,t))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&o)return this.unwrap(),void(s?i.insDirOf(-t,s):i.insAtDirEnd(t,n));this.sides[t]={ch:Ct[this.sides[this.side].ch],ctrlSeq:Ct[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===f?0:1).addClass("mq-ghost").html(this.sides[t].ch)}if(s){l=this.ends[f].ends[t];w(s,r,-t).disown().withDirAdopt(-t,this.ends[f],l,0).jQ.insAtDirEnd(t,this.ends[f].jQ.removeClass("mq-empty")),l.siblingCreated&&l.siblingCreated(i.options,t),i.insDirOf(-t,s)}else e?i.insDirOf(t,this):i.insAtDirEnd(t,this.ends[f])}},e.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},e.finalizeTree=function(){this.ends[f].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===f?1:0).removeClass("mq-ghost"),this.side=0}},e.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}})),Ct={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|"};function St(t,e){e=e||t;var i=Ct[t],n=Ct[e];A[t]=h(Et,f,t,i,e,n),A[i]=h(Et,1,t,i,e,n)}St("("),St("["),St("{","\\{"),y.langle=h(Et,f,"&lang;","&rang;","\\langle ","\\rangle "),y.rangle=h(Et,1,"&lang;","&rang;","\\langle ","\\rangle "),A["|"]=h(Et,f,"|","|","|","|"),y.left=p(P,(function(t){t.parser=function(){var t=R.regex,e=R.string,i=(R.succeed,R.optWhitespace);return i.then(t(/^(?:[([|]|\\\{)/)).then((function(n){var s="\\"===n.charAt(0)?n.slice(1):n;return B.then((function(r){return e("\\right").skip(i).then(t(/^(?:[\])|]|\\\})/)).map((function(t){var e="\\"===t.charAt(0)?t.slice(1):t,i=Et(0,s,e,n,t);return i.blocks=[r],r.adopt(i,0,0),i}))}))}))}})),y.right=p(P,(function(t){t.parser=function(){return R.fail("unmatched \\right")}}));var Lt=y.binom=y.binomial=p(p(P,jt),(function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"]}));y.choose=p(Lt,(function(t){t.createLeftOf=_t.prototype.createLeftOf}));y.editable=y.MathQuillMathField=p(P,(function(t,e){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t.parser=function(){var t=this,i=R.string,n=R.regex,s=R.succeed;return i("[").then(n(/^[a-z][a-z0-9]*/i)).skip(i("]")).map((function(e){t.name=e})).or(s()).then(e.parser.call(t))},t.finalizeTree=function(){var t=_(this.ends[f],this.jQ,T());t.KIND_OF_MQ="MathField",t.editable=!0,t.createTextarea(),t.editablesTextareaEvents(),t.cursor.insAtRightEnd(t.root),$(t.root)},t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[f].controller))},t.latex=function(){return this.ends[f].latex()},t.text=function(){return this.ends[f].text()}}));var Qt=y.embed=p(H,(function(t,e){t.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},t.parser=function(){var t=this;return string=R.string,regex=R.regex,succeed=R.succeed,string("{").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("}")).then((function(e){return string("[").then(regex(/^[-\w\s]*/)).skip(string("]")).or(succeed()).map((function(i){return t.setOptions(C[e](i))}))}))}})),Dt=I(1);for(var It in Dt)!function(t,e){"function"==typeof e?(L[t]=function(){return S(),e.apply(this,arguments)},L[t].prototype=e.prototype):L[t]=e}(It,Dt[It])}();let $="fillmain";function z(t){let e=document.querySelectorAll(".textarea.ks");for(let n=0;n<e.length;n++){let s=e[n];var i=setTimeout((function(){s.style.cssText="height:auto;overflow: auto;",t&&(window.isIE?s.style.cssText="height:"+(s.scrollHeight+10)+"px;overflow: hidden":s.style.cssText="height:"+s.scrollHeight+"px;overflow: hidden"),clearTimeout(i)}),100)}}function R(t,e,i){let n,{manual_grade:s}=e,{xml:r}=e,{uxml:a}=e,{isReview:o}=e,{editorState:l}=e,{smValidate:c}=e,{showAns:u}=e,h="",d="",p=[],f=0,m=1,g=[],b={},v={};globalThis.ajax_eId="#fillmain";let x={};_({matchtype:"0",ignoretype:"",multi:"",totalcorrectans:0,showToolbar:!1,isMathquill:!1,fillMath:[],footerStr:!1}).subscribe((t=>{i(5,x=t)}));function T(){if(i(5,x.xml=r,x),b=q(r),a&&(window.isResetMath?(console.warn("Uxml not loaded",window.isResetMath),window.isResetMath=!1):(console.warn("uxml loaded",window.isResetMath),v=q(a),i(5,x.uxml=a,x))),function(t,e=!1){h=t.smxml.text.__cdata,d="",p=[],f=0,i(5,x.footerStr=!1,x),y.selectAll(".smnotes","hide"),t.smxml.text._matchType&&(t.smxml.text._matchtype=t.smxml.text._matchType,delete t.smxml.text._matchType);t.smxml.text._ignoreType&&(t.smxml.text._ignoretype=t.smxml.text._ignoreType,delete t.smxml.text._ignoreType);i(5,x.matchtype=t.smxml.text._matchtype,x),i(5,x.ignoretype=t.smxml.text._ignoretype,x),i(5,x.multi="multiple"==t.smxml.text._multiple?"1":"",x);let n=h.match(/%{[\s\S]*?}%/gm),s="",r="",a=0;n&&n.forEach(((t,o)=>{if(a++,e&&e.smans){let t=e.smans.div;0==Array.isArray(t)&&(t=[],t[0]=e.smans.div),t&&(r=t[o])}let l=n[o];s=n[o].match(/\|(.*?)}%$/gm),s=s?s[0].replace(/\||}%/gm,""):"",s=s.trim(),""==s||"c"==s?(y.selectAll(".smnotes","show"),r?M(l,o,r):M(l,o)):"n"==s?r?R(l,o,r):R(l,o):"d"==s||"ds"==s?r?N(l,o,r):N(l,o):"s"==s?r?F(l,o,r):F(l,o):"e"==s?(i(5,x.isMathquill=!0,x),r?I(l,o,r):I(l,o)):(s.indexOf(!1)||s.indexOf(!1))&&(y.selectAll(".smnotes","show"),r?B(l,o,r):B(l,o));l.replace("%{","").replace("}%","")}));y.selectAll("#"+$,"attr",{totalcorrectans:a}),h=y.ignoreEnity(h),y.find("#"+$,"#previewArea",{action:"html",actionData:h}),y.find("#"+$,".dragArea",{action:"html",actionData:d});let o=y.find("#"+$,".dragArea"),l=o?.children?Array.from(o.children):[];for(;l.length;)o.append(l.splice(Math.floor(Math.random()*l.length),1)[0]);(function(){let t=[];y.selectAll(".dragArea div").forEach(((e,i)=>{t.push(10*e.innerHTML.length+30)})),y.selectAll("#previewArea [id^=elem]").forEach((e=>{e.classList.contains("drag-resize")&&y.setCss(e,{"max-width":Math.max(...t)})}))})(),function(){if(y.find(ajax_eId,"table.uc-table","all").length>0){let t=y.find(ajax_eId,"table.uc-table").clientWidth+9;y.setCss(y.find(ajax_eId,".smnotes"),{width:t+"px",margin:"auto","padding-top":"5px"})}}(),D();var c=setTimeout((function(){y.find(ajax_eId,".prettyprint","all").length>=1&&0==y.find(ajax_eId,".prettyprint .L0","all").length&&"function"==typeof prettyPrint&&(y.selectAll(".prettyprint").forEach((t=>{t.classList.add("prettyprintReplica"),t.classList.remove("prettyprint")})),y.selectAll(".linenums").forEach((t=>{t.classList.add("linenumsReplica"),t.classList.remove("linenums")})),y.find(ajax_eId,".prettyprintReplica").forEach((t=>{t.classList.add("prettyprint")})),y.find(ajax_eId,".linenumsReplica").forEach((t=>{t.classList.add("linenums")})),prettyPrint(),y.selectAll(".prettyprintReplica").forEach((t=>{t.classList.add("prettyprint"),t.classList.remove("prettyprintReplica")})),y.selectAll(".linenumsReplica").forEach((t=>{t.classList.add("linenums"),t.classList.remove("linenumsReplica")}))),clearTimeout(c)}),2e3);if(y.find(ajax_eId,"table.uc-table","all").length>0){y.find(ajax_eId,"table.uc-table",{action:"addClass",actionData:"font14"});try{"BR"==y.find(ajax_eId,"table.uc-table").previousElementSibling?.nodeName&&y.find(ajax_eId,"table.uc-table").previousElementSibling.remove()}catch(t){console.warn(t)}}}(b,v),S.showdragans(ajax_eId,"u"),!r){let t=smVal.validate(l.content_type,l.subtype,l.content_icon);c(t)}}function j(){i(0,o=!0),r.includes("user Response{")&&(window.isResetMath=!0),i(5,x.showToolbar=!1,x),S.modeOn("on"),S.showdragans(ajax_eId,"u",1),y.selectAll(".remed_disable","show"),z(1);let t=document.getElementById($);t=t?t.getElementsByClassName("mathquill"):t,t&&(y.setCss(ajax_eId,{position:"relative"}),y.insert(ajax_eId,"<div class='spinner-wrapper' style='position:absolute!important;opacity:0!important;'></div>","afterbegin")),C()}function E(){i(0,o=!1),y.selectAll(".mathquill","css",{border:"none"}),S.modeOn(),y.selectAll(".remed_disable, .corr_div","hide"),S.showdragans(ajax_eId,"u",0);let t=document.getElementById($);t=t?t.getElementsByClassName("mathquill"):t,z(),t&&(y.selectAll(ajax_eId,"css",{position:"unset"}),y.selectAll(".spinner-wrapper","remove"))}function C(){let t=S.checkAns(ajax_eId),e={ans:S.result,uXml:S.userAnsXML};k(e),l&&u(t)}function L(t,e){let n,s=!0;for(;s;)(t=t.parentElement).getAttribute("id")&&(s=!1,n=t.getAttribute("id"));let r=[];y.selectAll("#"+n+" span.mq-editable-field").forEach((e=>{let i=t.getAttribute("mathquill-command-id");r.push(i)}));let a=t.getAttribute("mathquill-command-id"),o=r.indexOf(a);i(5,x.spanId=o,x),i(5,x.divId=n,x),i(5,x.showToolbar=!0,x)}function Q(t,e){i(5,x[t]=e,x),"uxml"==t&&(v=q(x.uxml),function(t){let e="",i=b.smxml.text.__cdata.match(/%{[\s\S]*?}%/gm),n="";i&&i.forEach(((i,s)=>{if(t&&t.smans){let i=t.smans.div;0==Array.isArray(i)&&(i=[],i[0]=t.smans.div),i&&(e=i[s])}if(n=i.match(/\|(.*?)}%$/gm),n=n?n[0].replace(/\||}%/gm,""):"",n=n.trim(),e&&e._userAns){let t="";""==n||"c"==n||"n"==n?t=`#elem${s} .fillintheblank`:"d"==n||"ds"==n?t="#elem"+s:"s"==n||("e"==n?t="#elem"+s:(n.indexOf(!1)||n.indexOf(!1))&&(t=`#elem${s} .textarea`)),y.isValid(t)&&document.querySelector(t)&&document.querySelector(t).setAttribute("userans",e._userAns)}}))}(v))}function D(){try{console.log("runmodule"),S.readyFill(ajax_eId)}catch(e){if(m<=100)var t=setTimeout((()=>{D(),clearTimeout(t)}),50);else console.warn("Error at runModule function");m++}}function I(t,e,n=!1){let s=t,r=(t=(t=t.replace(/%{|}%/g,"")).split("|"))[0].replace(/user Response/g,"\\MathQuillMathField").split("##"),a=Math.floor(Math.random()*r.length),o=r[a],l=o.replace(/MathQuillMathField{(.*?)}/g,"MathQuillMathField{}"),c=0,u=o;n?n._userAns&&(l=n._userAns,n._userAnsSeq&&(u=n._anskey,a=n._userAnsSeq)):o.indexOf("MathQuillMathField")>-1&&(u=o,c=1),y.selectAll("#elem"+e,"hide");let d=`<div id="main_div" class="text-center filter auto_height fillelement mathitem inline-block"><div class="disable_div fh fwidth absolute h"></div><div class="remed_disable fh fwidth absolute h"></div><span  id="m${e}" style="display:none;" class="auto_height h corr_div fillmathelement mathquill" userAnsSeq="${a}" anskey="${u}" defaultans="${c}" mathtype="1">${u}</span>${`<span id="elem${e}" class="auto_height edit_step fillmathelement mathquill" userAnsSeq="${a}" userans="${l}" anskey="${u}" defaultans="${c}" mathtype="1"></span>`}</div>`;h=h.replace(s,d);let p=setInterval((()=>{if("function"==typeof MathQuill){clearInterval(p),y.selectAll("#elem"+e,"show");let t=MathQuill.getInterface(2);y.selectAll(".mathquill").forEach((e=>{let i=e.getAttribute("id");if(1==e.getAttribute("defaultans")){var n=e.getAttribute("userans");y.selectAll("#"+i,"text",n)}else y.selectAll("#"+i,"text",e.getAttribute("userans"));g[i]=t.StaticMath(document.getElementById(i))})),i(3,S.fillMath=g,S)}}),100)}function M(t,e,i=!1){var n="";i&&i._userAns&&(n=i._userAns);let s=t,r="",a=(t=(t=t.replace(/%{|}%/g,"")).split("|"))[1]&&"c"==t[1].trim()?"1":"",o=t[0].trim();if(-1!=o.indexOf("#style#")){let t=o.split("#style#");o=t[0],r=t[1]}let l=[],c=o.split(",");y.selectAll(c).forEach(((t,e)=>{l[e]=10*c[e].length+30}));let u=`<div id="elem${e}" class="fillelement">${`<input type="text" class="fillintheblank ks" anskey="${o.trim()}" value="${n}" userans="${n}" defaultans="" haskeywords="" codetype="${a}" hasnotkeywords="" keywordtype="" autocomplete="off" data-role="none" style="width:${Math.max(...l)}px;${r}" />`}</div>`;h=h.replace(s,u)}function R(t,e,i=!1){var n="";i&&i._userAns&&(n=i._userAns);let s=t,r="",a=(t=(t=t.replace(/%{|}%/g,"")).split("|"))[1]&&"c"==t[1].trim()?"1":"",o=t[0].trim();if(-1!=o.indexOf("#style#")){let t=o.split("#style#");o=t[0],r=t[1]}let l=[],c=o.split(",");y.selectAll(c).forEach(((t,e)=>{l[e]=10*c[e].length+30}));let u=`<div id="elem${e}" class="fillelement">${`<input type="number" onKeyDown="if(isNaN(event.key)){var key_arr = [13, 37, 38, 39, 40, 8, 69, 101, 46, 16, 9];if(!key_arr.includes(event.keyCode)) event.preventDefault()} "class="fillintheblank ks" anskey="${o.trim()}" value="${n}" userans="${n}" defaultans="" haskeywords="" codetype="${a}" hasnotkeywords="" keywordtype="" autocomplete="off" data-role="none" style="width: ${Math.max(...l)+20}px;${r}" />`}</div>`;h=h.replace(s,u)}function F(t,e,i=!1){let n=t,s=(t=(t=t.replace(/%{|}%/g,"")).split("|"))[0].trim();s=s.split(",").map((t=>t.trim()));let r='<option value="">&nbsp;Please Select</option>';y.selectAll(s).forEach(((t,e)=>{let n=0==s[e].indexOf("*")?"1":"0",a=0==s[e].indexOf("+")?'selected="selected"':"",o=0==s[e].indexOf("*")||0==s[e].indexOf("+")?s[e].slice(1):s[e],l="";if(i&&i._userAns){a="",e==i._userAns.split(",")[0].trim()-1&&(a='selected="selected"',l="1")}o=o.replace(/\#cm/gim,",").replace(/\#pl/gim,"+"),r+=`<option value="${e}" correctans="${n}" userans="${l}" ${a}>&nbsp;${o}</option>`}));let a=`<div id="elem${e}" class="fillelement">${`<select class="fillintheblank ks" data-role="none">${r}</select>`}</div>`;h=h.replace(n,a)}function B(t,e,i=!1){let n="";i&&i._userAns&&(n=i._userAns);let s=t,r=(t=(t=t.replace(/%{|}%/g,"")).split("|"))[0].trim(),a=JSON.parse(t[1]),o=`<div id="elem${e}" class="fillelement" style="height:auto">${`<textarea class="textarea ks" rows="${a.rows}" cols="${a.cols}" anskey="${r}" value="${n}" defaultans="${a.defaultAns?a.defaultAns:""}" userans="${n}" haskeywords="" hasnotkeywords="" keywordtype="1" autocomplete="off" data-role="none">${n}</textarea>`}</div>`;h=h.replace(s,o)}function N(t,e,n=!1){let s=t,r=(t=(t=t.replace(/%{|}%/g,"")).split("|"))[0].trim(),a="ds"==t[1].trim()?"1":"0",o=r.split(","),l="";y.selectAll(o).forEach(((t,e)=>{let i=!1,n=10*o[e].length+30,s=o[e],r=o[e].match(/i~|~i/g),c="";r?s=o[e].replace(/i~|~i/g,""):(l+="ID"+f+",",c="ID"+f+","),y.selectAll(p).forEach(((t,e)=>{p[e].ans==s&&(i=!0,r||(l=l.replace(c,""),l+=p[e].id+","))})),0==i&&p.push({ans:s,id:"ID"+f}),0==i&&(d+=`<div id="ID${f}" dragable="true" tabindex="0" class="drag-resize dragable ks" caption="${s.replace(/\#cm/gim,",").replace(/\"/gim,"#doublequote#")}" path="//s3.amazonaws.com/jigyaasa_content_static/" drag-single="${a}" bgcolor="#CCFFCC" style="background-color:#CCFFCC;height:auto;max-width:${n}px;padding:3px 10px 3px 10px; margin: 2px 2px;" aria-disabled="false">${s.replace(/\#cm/gim,",")}</div>`),0==i&&f++}));let c="";n&&n._userAns&&(c=n._userAns);let u='<div id="elem'+e+'" tabindex="0" dropzone="1" class="drag-resize dropable ks" path="//s3.amazonaws.com/jigyaasa_content_static/" anskey="'+l.slice(0,-1)+'" caption="" userans="'+c+'" droped="'+c+'" bgcolor="#FFFFCC" style="background-color: rgb(255, 255, 204); min-width: 50px; height: auto; padding: 5px 10px 5px;">'+c+"</div>";h=h.replace(s,u),i(5,x.footerStr=!0,x)}return w((async()=>{S.setUpdate(Q.bind(this));let t=document.getElementById($);t=t?t.getElementsByClassName("mathquill"):t,x.isMathquill&&y.selectAll("div"+ajax_eId,"css",{overflow:"auto"}),y.bind(ajax_eId,"click",C),y.bind(ajax_eId,"keyup",C),y.bind(ajax_eId,"change",C),y.listen(document,"click","span.mq-editable-field.mq-focused",L),y.listen(document,"change","span.mq-editable-field.mq-focused",L),T()})),A((t=>{if(r!=x.xml){if(l&&1==l.stopPreviewUpdate)return!1;T(),setTimeout((function(){let t=document.getElementById("previewArea");if(t.childNodes[0]&&"TABLE"==t.childNodes[0].nodeName){t=document.querySelectorAll("#previewArea td");for(let e in t)t[e].firstElementChild||"TD"!=t[e].nodeName||t[e].setAttribute("tabindex","0")}else for(let e in t.childNodes)if(3==t.childNodes[e].nodeType){let i=document.createElement("span");i.setAttribute("tabindex","0"),i.innerHTML=t.childNodes[e].textContent,t.childNodes[e].replaceWith(i)}}),1e3)}})),t.$$set=t=>{"manual_grade"in t&&i(1,s=t.manual_grade),"xml"in t&&i(2,r=t.xml),"uxml"in t&&i(11,a=t.uxml),"isReview"in t&&i(0,o=t.isReview),"editorState"in t&&i(12,l=t.editorState),"smValidate"in t&&i(13,c=t.smValidate),"showAns"in t&&i(14,u=t.showAns)},t.$$.update=()=>{1&t.$$.dirty[0]&&(o?j():E())},[o,s,r,S,n,x,undefined,j,E,function(t){i(5,x.showToolbar=t,x)},function(t,e){"c"==t?(S.showdragans(ajax_eId,"c",1),y.selectAll(".corr_div","show"),y.selectAll(".remed_disable","show"),z(1)):(S.showdragans(ajax_eId,"u",1),y.selectAll(".corr_div","hide"),z(1))},a,l,c,u,function(t){O[t?"unshift":"push"]((()=>{n=t,i(4,n)}))}]}export default class extends i{constructor(t){super(),n(this,t,R,M,s,{manual_grade:1,xml:2,uxml:11,isReview:0,editorState:12,smValidate:13,showAns:14},L,[-1,-1])}}
//# sourceMappingURL=FillInTheBlanksPreview-2b4a7265.js.map
