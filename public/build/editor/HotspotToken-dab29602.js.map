{"version":3,"file":"HotspotToken-dab29602.js","sources":["../../../clsSMHotspot/HotspotToken.svelte"],"sourcesContent":["<script>\n    import { beforeUpdate, onMount } from \"svelte\";\n    import { writable } from \"svelte/store\";\n    import { AH, JSONToXML, XMLToJSON } from \"../helper/HelperAI.svelte\";\n    import l from '../src/libs/editorLib/language';\n    export let xml;\n    export let isReview;\n    export let editorState;\n    export let getChildXml;\n\n    let state = {};\n    let hdd = writable({\n        xml: \"\",\n        cdata: \"\",\n        viewToken: \"\",\n        viewTemplate: \"\",\n        correctAns: [],\n        itemLayout: [],\n        activeToken: \"\",\n        confirmDialog: false\n    });\n    const unsub = hdd.subscribe((items)=> {\n        state = items;\n    })\n    // calls whenever there is change in state or props \n    beforeUpdate(()=> {\n        // check if there is change in xml\n        if (xml != state.xml) {\n            state.xml = xml;\n            // for refreshing the module with new xml\n            loadModule(xml);\n        }\n    })\n\n    // called just after rendering\n    onMount(()=> {\n        // check the conditions if it is IE\n        // if (isIE) {\n        //     AH.listen(document, \"keyup\", \".hotspot-token .token\", (_this, event)=> {\n        //         // binding the enter key in case of ada\n        //         if (event.which == 13) {\n        //             AH.trigger(_this, 'click');\n        //         }\n        //     });\n        // }\n        \n        // storing and updating the xml\n        getChildXml(xml+\" \");\n        // for showing the Enter text tab by default \n        toggleTemplateToken(\"none\", \"block\");\n\n        // for showing the text into the editable area of the Enter text\n        AH.selectAll('.text_area', 'value', state.cdata.trim().replace(/[ ]+/gm, ' '));\n\n        // function for showing warning for the unneccessary space\n        AH.bind(\".text_area\", \"keydown\", (event)=> {\n            let key_pressed = event;\n            var element_name = document.querySelector('.text_area');\n            // getting start pos\n            var startPos = element_name.selectionStart;\n            // getting end pos\n            var endPos = element_name.selectionEnd;\n            if (endPos == startPos) {\n                // if space key is pressed\n                if (key_pressed.which == 32) {\n                    if ((AH.select('.text_area').value.charAt(startPos - 1) == \" \") || (AH.select('.text_area').value.charAt(startPos) == \" \")) {\n                        AH.alert(l.space_warning);\n                        key_pressed.preventDefault();\n                    }\n                }\n            }\n        });\n    });\n\n    // parse the xml and load the module accordingly\n    function loadModule(loadXml) {\n        // Here xml is converted into the json and pass into the parseXMLAuthoring for xml parsing\n        loadXml = XMLToJSON(loadXml);\n        parseXMLAuthoring(loadXml);\n    }\n\n    // parsing the xml for authoring\n    async function parseXMLAuthoring(MYXML) {\n        // getting the correct ans sepereted by , in array format\n        state.correctAns = (MYXML.smxml.div._correctAns.trim()) ? MYXML.smxml.div._correctAns.split(\",\") : [];\n        state.cdata = MYXML.smxml.div.__cdata;\n        state.activeToken = MYXML.smxml.div._type;\n        // switching the module on the basis of the type used\n        switch(MYXML.smxml.div._type) {\n            case \"w\" :\n                // in case of word\n                parseWord(state.cdata);\n                break;\n            case \"s\" :\n                // in case of sentence\n                parseSentance(state.cdata);\n                break;\n            case \"p\" :\n                // in case of paragraph\n                parseParagraph(state.cdata);\n                break;\n            default :\n                console.warn(\"No type found to parse\");\n            break;\n        }\n    }\n\n    // parsing the word\n    function parseWord(str) {\n        // replace the newline with \" #newline# \"\n        str = str.replace(/\\n/g, \" #newline# \");\n        //Split the string with space and remove array which contain null value\n        let word = str.split(\" \").map( (item)=> { return item.trim() } ).filter( (arr)=> { return arr != \"\" });\n        let tempWord = [];\n\n        /* split punctuation mark in word and store in the tempWord array */\n        word.map((data, i)=> {\n            let special_symbol = data.match(/[.,]/g);\n            if (special_symbol) {\n                let splitText = data.split(special_symbol[0]);\n                tempWord.push(splitText[0]);\n                tempWord.push(special_symbol[0]);\n                if (splitText[1].trim()) {\n                    tempWord.push(splitText[1]);\n                }\n            } else {\n                tempWord.push(data)\n            }\n        });\n        /*end*/\n        let wordArray = [];\n        // store id, value and selected in wordArray\n        // Here id is unique id of that element , value stores the element value and selected stores wether it is selected or not\n        tempWord.map((data, i)=> {\n            wordArray.push({\n                id: \"ID\"+i,\n                value: data,\n                selected: getSelected(i)\n            });\n        });\n        \n        state.itemLayout = wordArray;\n    }\n\n    // parsing the sentence\n    function parseSentance(str) {\n        //Split the string with fullstop and remove array which contain null value\n        let sentance = str.split(\".\").map( (item)=> { return item.trim() } ).filter( (arr)=> { return arr != \"\" });\n        let sentanceArray = [];\n\n        // store id, value and selected in sentanceArray\n        // Here id is unique id of that element , value stores the element value and selected stores wether it is selected or not\n        sentance.map((data, i)=> {\n            sentanceArray.push({\n                id: \"ID\"+i,\n                value: data+\".\",\n                selected: getSelected(i)\n            });\n        });\n        state.itemLayout = sentanceArray;\n    }\n\n    // parsing the paragraph\n    function parseParagraph(str) {\n        //Split the string with paragraph and remove array which contain null value\n        let paragraph = str.split(\"\\n\").map( (item)=> { return item.trim() } ).filter( (arr)=> { return arr != \"\" });\n        let paragraphArray = [];\n\n        // store id, value and selected in paragraphArray\n        // Here id is unique id of that element , value stores the element value and selected stores wether it is selected or not\n        paragraph.map((data, i)=> {\n            paragraphArray.push({\n                id: \"ID\"+i,\n                value: data,\n                selected: getSelected(i)\n            });\n        });\n        state.itemLayout = paragraphArray;\n    }\n\n    // update the cdata whenever there is chamge in textarea\n    function updateCdata(e) {\n        // convert the XML into JSON using XMLToJSON func and stored in xml\n        let xml = XMLToJSON(state.xml);\n        // clear the correctAns \n        xml.smxml.div._correctAns = \"\";\n        // updtae the cdata\n        xml.smxml.div.__cdata = e.target.value;\n        // stores and update the xml \n        getChildXml(JSONToXML(xml));\n    }\n\n    // calls whenever tab is changed\n    function toggleTemplateToken(viewToken, viewTemplate) {\n        state.viewToken = viewToken;\n        state.viewTemplate = viewTemplate;\n    }\n\n    // return true if that particular position was selected\n    function getSelected(pos) {\n        return (AH.findInArray(\"ID\" + pos, state.correctAns) ? true: false);\n    }\n\n    // for changing the mode word, sentence, paragraph\n    function setTemplateType(type) {\n        // convert the XML into JSON using XMLToJSON func and stored in xml\n        let xml = XMLToJSON(state.xml);\n        // update the type w,p,s \n        xml.smxml.div._type = type;\n        // clear the correctAns \n        xml.smxml.div._correctAns = \"\";\n        // stores and update the xml \n        getChildXml(JSONToXML(xml));\n    }\n\n    // for setting the correct answer which is selected\n    function setSelected(pos) {\n        state.itemLayout[pos].selected = !state.itemLayout[pos].selected;\n        setCorrectAnswer(pos,state.itemLayout[pos].selected);\n    }\n\n    // set the correct answer\n    function setCorrectAnswer(id, selected) {\n        if (selected == true) {\n            // if token is selected then push it in correctAns\n            state.correctAns.push(\"ID\"+id);\n        } else if (selected == false) {\n            let deleteValue = state.correctAns.indexOf(\"ID\"+id);\n            if (deleteValue > -1) {\n                // if token is deselected then delete that element from the correctAns\n                state.correctAns.splice(deleteValue,1);\n            } \n        }\n        // join the correctAns with , sepereted and stored in crt\n        let crt = state.correctAns.filter( function(arr) { return arr != \"\" }).join();\n        // update the correctAns attribute in the xml\n        updateCorrect(crt);\n    }\n\n    // update correct answer\n    function updateCorrect(correct) {\n        // convert the XML into JSON using XMLToJSON func and stored in xml\n        let xml = XMLToJSON(state.xml);\n        // updating the correctAns\n        xml.smxml.div._correctAns = correct;\n        // stores and update the xml \n        getChildXml(JSONToXML(xml));\n    }\n\n    // whenever clear button is clicked\n    function clearToken() {\n        // convert the XML into JSON using XMLToJSON func and stored in xml\n        let xml = XMLToJSON(state.xml);\n        // updating the correctAns\n        xml.smxml.div._correctAns = \"\";\n        // stores and update the xml \n        getChildXml(JSONToXML(xml));\n    }\n</script>\n\n<div class=\"hotspot-token p-2 border\">\n    <div class=\"row ml-sm2\">\n        <div class=\"btn-group amazonpaybutton mb-2 mr-4\" role=\"group\">\n            <button \n                type=\"button\"\n                class={(state.viewTemplate == \"block\")? \"btn btn-light active\" : \"btn btn-light \"} \n                on:click={toggleTemplateToken.bind(this, \"none\", \"block\")}\n            >\n                {l.edit_template}\n            </button>\n            <button \n                type=\"button\"\n                class={(state.viewToken == \"block\")?\"btn btn-light active\":\"btn btn-light\"}  \n                on:click={toggleTemplateToken.bind(this, \"block\", \"none\")}\n            >\n                {l.edit_token}\n            </button>\n        </div>\n        <div style=\"display: {state.viewToken}\">\n            <div class=\"btn-group border-0 bg-none\">\n                <button \n                    type=\"button\" \n                    class={(state.activeToken == \"w\") ? \"btn btn-light active\" : \"btn btn-light\"} \n                    on:click={setTemplateType.bind(this, \"w\")}\n                >\n                    {l.word}\n                </button>\n                <button \n                    type=\"button\" \n                    class={(state.activeToken == \"s\") ? \"btn btn-light active\" : \"btn btn-light\"} \n                    on:click={setTemplateType.bind(this, \"s\")}\n                >\n                    {l.sentance}\n                </button>\n                <button \n                    type=\"button\"\n                    class={(state.activeToken == \"p\") ? \"btn btn-light active\" : \"btn btn-light\"} \n                    on:click={setTemplateType.bind(this, \"p\")}\n                >\n                    {l.paragraph}\n                </button>\n            </div>\n            <button type=\"button\" class=\"btn btn-outline-primary ml-2\" on:click={clearToken.bind(this)}>{l.clear}</button>\n        </div>\n    </div>\n    <textarea \n        style=\"display: {state.viewTemplate}\" \n        on:change={updateCdata.bind(this)} \n        rows=\"10\" \n        cols=\"65\"\n        class=\"text_area p-2 mt-3 fwidth\"\n    ></textarea>\n    <div style=\"display: {state.viewToken}\" class=\"mt-3 light-cyan-bg border\">\n        <div class=\"d-inline-block px-1 py-2 word_break\">\n        {#if state.itemLayout}\n            {#each state.itemLayout as data, i }\n                {#if data.value == \",\" || data.value == \".\"}\n                    <div class=\"float-start position-relative done_percent_bar\" style=\"width: 2px\">\n                        <span \n                            class=\"position-absolute float-start top5\"\n                            style=\"left: -3px\"\n                        >\n                            {data.value}\n                        </span>\n                    </div>\n                {:else if data.value == \"#newline#\" }\n                    <br/>\n                {:else}\n                    <div\n                        data-id={\"ID\"+i}\n                        on:click={setSelected.bind(this, i)}\n                        data-selected={data.selected}\n                        tabIndex=\"0\"\n                        class=\"token float-start mx-1 mb-1 p-1 border border-secondary pointer text-left {data.selected ? 'token_selected' : 'token bg-white'}\"\n                        style=\"user-select: none;border-radius: 3px; font: 14px;\"\n                    >\n                        {data.value}\n                    </div>\n                {/if}\n            {/each}\n        {/if}\n        </div>\n    </div>\n    <div style=\"display: {state.viewToken}\">\n        <div class=\"pl-2 pt-2 font-weight-bold\">{state.correctAns.length} {l.no_of_token}</div>\n    </div>\n    <div class=\"text-danger pl-2 pt-2\" style=\"font: 13px;\">\n        <span class=\"font-weight-bolder\">* {l.note_label}</span>\n        <span>{l.token_message}</span>\n    </div>\n</div>\n<style>\n    .token_selected {\n        background-color: #64bb63;\n        color: #fff;\n    }\n</style>"],"names":["ctx","itemLayout","length","value","selected","bind","this","l","edit_template","edit_token","word","sentance","paragraph","correctAns","no_of_token","clear","note_label","token_message","viewTemplate","viewToken","activeToken","xml","isReview","editorState","getChildXml","state","writable","cdata","confirmDialog","subscribe","items","toggleTemplateToken","getSelected","pos","AH","findInArray","beforeUpdate","MYXML","smxml","div","_correctAns","trim","split","__cdata","_type","str","replace","map","item","filter","arr","tempWord","data","i","special_symbol","match","splitText","push","wordArray","id","parseWord","sentanceArray","parseSentance","paragraphArray","parseParagraph","console","warn","parseXMLAuthoring","XMLToJSON","onMount","selectAll","event","key_pressed","element_name","document","querySelector","startPos","selectionStart","selectionEnd","which","select","charAt","alert","space_warning","preventDefault","e","target","JSONToXML","type","deleteValue","indexOf","splice","correct","updateCorrect","join","setCorrectAnswer"],"mappings":"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"}