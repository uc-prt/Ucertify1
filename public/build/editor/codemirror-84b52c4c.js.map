{"version":3,"file":"codemirror-84b52c4c.js","sources":["../../../src/libs/codemirror.js"],"sourcesContent":["// CodeMirror version 3.20\r\n//\r\n// CodeMirror is the only global var we claim\r\nwindow.CodeMirror = (function() {\r\n    \"use strict\";\r\n  \r\n    // BROWSER SNIFFING\r\n  \r\n    // Crude, but necessary to handle a number of hard-to-feature-detect\r\n    // bugs and behavior differences.\r\n    var gecko = /gecko\\/\\d/i.test(navigator.userAgent);\r\n    // IE11 currently doesn't count as 'ie', since it has almost none of\r\n    // the same bugs as earlier versions. Use ie_gt10 to handle\r\n    // incompatibilities in that version.\r\n    var ie = /MSIE \\d/.test(navigator.userAgent);\r\n    var ie_lt8 = ie && (document.documentMode == null || document.documentMode < 8);\r\n    var ie_lt9 = ie && (document.documentMode == null || document.documentMode < 9);\r\n    var ie_gt10 = /Trident\\/([7-9]|\\d{2,})\\./.test(navigator.userAgent);\r\n    var webkit = /WebKit\\//.test(navigator.userAgent);\r\n    var qtwebkit = webkit && /Qt\\/\\d+\\.\\d+/.test(navigator.userAgent);\r\n    var chrome = /Chrome\\//.test(navigator.userAgent);\r\n    var opera = /Opera\\//.test(navigator.userAgent);\r\n    var safari = /Apple Computer/.test(navigator.vendor);\r\n    var khtml = /KHTML\\//.test(navigator.userAgent);\r\n    var mac_geLion = /Mac OS X 1\\d\\D([7-9]|\\d\\d)\\D/.test(navigator.userAgent);\r\n    var mac_geMountainLion = /Mac OS X 1\\d\\D([8-9]|\\d\\d)\\D/.test(navigator.userAgent);\r\n    var phantom = /PhantomJS/.test(navigator.userAgent);\r\n  \r\n    var ios = /AppleWebKit/.test(navigator.userAgent) && /Mobile\\/\\w+/.test(navigator.userAgent);\r\n    // This is woefully incomplete. Suggestions for alternative methods welcome.\r\n    var mobile = ios || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent);\r\n    var mac = ios || /Mac/.test(navigator.platform);\r\n    var windows = /win/i.test(navigator.platform);\r\n  \r\n    var opera_version = opera && navigator.userAgent.match(/Version\\/(\\d*\\.\\d*)/);\r\n    if (opera_version) opera_version = Number(opera_version[1]);\r\n    if (opera_version && opera_version >= 15) { opera = false; webkit = true; }\r\n    // Some browsers use the wrong event properties to signal cmd/ctrl on OS X\r\n    var flipCtrlCmd = mac && (qtwebkit || opera && (opera_version == null || opera_version < 12.11));\r\n    var captureMiddleClick = gecko || (ie && !ie_lt9);\r\n  \r\n    // Optimize some code when these features are not used\r\n    var sawReadOnlySpans = false, sawCollapsedSpans = false;\r\n  \r\n    // CONSTRUCTOR\r\n  \r\n    function CodeMirror(place, options) {\r\n      if (!(this instanceof CodeMirror)) return new CodeMirror(place, options);\r\n  \r\n      this.options = options = options || {};\r\n      // Determine effective options based on given values and defaults.\r\n      for (var opt in defaults) if (!options.hasOwnProperty(opt) && defaults.hasOwnProperty(opt))\r\n        options[opt] = defaults[opt];\r\n      setGuttersForLineNumbers(options);\r\n  \r\n      var docStart = typeof options.value == \"string\" ? 0 : options.value.first;\r\n      var display = this.display = makeDisplay(place, docStart);\r\n      display.wrapper.CodeMirror = this;\r\n      updateGutters(this);\r\n      if (options.autofocus && !mobile) focusInput(this);\r\n  \r\n      this.state = {keyMaps: [],\r\n                    overlays: [],\r\n                    modeGen: 0,\r\n                    overwrite: false, focused: false,\r\n                    suppressEdits: false, pasteIncoming: false,\r\n                    draggingText: false,\r\n                    highlight: new Delayed()};\r\n  \r\n      themeChanged(this);\r\n      if (options.lineWrapping)\r\n        this.display.wrapper.className += \" CodeMirror-wrap\";\r\n  \r\n      var doc = options.value;\r\n      if (typeof doc == \"string\") doc = new Doc(options.value, options.mode);\r\n      operation(this, attachDoc)(this, doc);\r\n  \r\n      // Override magic textarea content restore that IE sometimes does\r\n      // on our hidden textarea on reload\r\n      if (ie) setTimeout(bind(resetInput, this, true), 20);\r\n  \r\n      registerEventHandlers(this);\r\n      // IE throws unspecified error in certain cases, when\r\n      // trying to access activeElement before onload\r\n      var hasFocus; try { hasFocus = (document.activeElement == display.input); } catch(e) { }\r\n      if (hasFocus || (options.autofocus && !mobile)) setTimeout(bind(onFocus, this), 20);\r\n      else onBlur(this);\r\n  \r\n      operation(this, function() {\r\n        for (var opt in optionHandlers)\r\n          if (optionHandlers.propertyIsEnumerable(opt))\r\n            optionHandlers[opt](this, options[opt], Init);\r\n        for (var i = 0; i < initHooks.length; ++i) initHooks[i](this);\r\n      })();\r\n    }\r\n  \r\n    // DISPLAY CONSTRUCTOR\r\n  \r\n    function makeDisplay(place, docStart) {\r\n      var d = {};\r\n  \r\n      var input = d.input = elt(\"textarea\", null, null, \"position: absolute; padding: 0; width: 1px; height: 1em; outline: none; font-size: 4px;\");\r\n      if (webkit) input.style.width = \"1000px\";\r\n      else input.setAttribute(\"wrap\", \"off\");\r\n      // if border: 0; -- iOS fails to open keyboard (issue #1287)\r\n      if (ios) input.style.border = \"1px solid black\";\r\n      input.setAttribute(\"autocorrect\", \"off\"); input.setAttribute(\"autocapitalize\", \"off\"); input.setAttribute(\"spellcheck\", \"false\");\r\n  \r\n      // Wraps and hides input textarea\r\n      d.inputDiv = elt(\"div\", [input], null, \"overflow: hidden; position: relative; width: 3px; height: 0px;\");\r\n      // The actual fake scrollbars.\r\n      d.scrollbarH = elt(\"div\", [elt(\"div\", null, null, \"height: 1px\")], \"CodeMirror-hscrollbar\");\r\n      d.scrollbarV = elt(\"div\", [elt(\"div\", null, null, \"width: 1px\")], \"CodeMirror-vscrollbar\");\r\n      d.scrollbarFiller = elt(\"div\", null, \"CodeMirror-scrollbar-filler\");\r\n      d.gutterFiller = elt(\"div\", null, \"CodeMirror-gutter-filler\");\r\n      // DIVs containing the selection and the actual code\r\n      d.lineDiv = elt(\"div\", null, \"CodeMirror-code\");\r\n      d.selectionDiv = elt(\"div\", null, null, \"position: relative; z-index: 1\");\r\n      // Blinky cursor, and element used to ensure cursor fits at the end of a line\r\n      d.cursor = elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor\");\r\n      // Secondary cursor, shown when on a 'jump' in bi-directional text\r\n      d.otherCursor = elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor CodeMirror-secondarycursor\");\r\n      // Used to measure text size\r\n      d.measure = elt(\"div\", null, \"CodeMirror-measure\");\r\n      // Wraps everything that needs to exist inside the vertically-padded coordinate system\r\n      d.lineSpace = elt(\"div\", [d.measure, d.selectionDiv, d.lineDiv, d.cursor, d.otherCursor],\r\n                           null, \"position: relative; outline: none\");\r\n      // Moved around its parent to cover visible view\r\n      d.mover = elt(\"div\", [elt(\"div\", [d.lineSpace], \"CodeMirror-lines\")], null, \"position: relative\");\r\n      // Set to the height of the text, causes scrolling\r\n      d.sizer = elt(\"div\", [d.mover], \"CodeMirror-sizer\");\r\n      // D is needed because behavior of elts with overflow: auto and padding is inconsistent across browsers\r\n      d.heightForcer = elt(\"div\", null, null, \"position: absolute; height: \" + scrollerCutOff + \"px; width: 1px;\");\r\n      // Will contain the gutters, if any\r\n      d.gutters = elt(\"div\", null, \"CodeMirror-gutters\");\r\n      d.lineGutter = null;\r\n      // Provides scrolling\r\n      d.scroller = elt(\"div\", [d.sizer, d.heightForcer, d.gutters], \"CodeMirror-scroll\");\r\n      d.scroller.setAttribute(\"tabIndex\", \"-1\");\r\n      // The element in which the editor lives.\r\n      d.wrapper = elt(\"div\", [d.inputDiv, d.scrollbarH, d.scrollbarV,\r\n                              d.scrollbarFiller, d.gutterFiller, d.scroller], \"CodeMirror\");\r\n      // Work around IE7 z-index bug\r\n      if (ie_lt8) { d.gutters.style.zIndex = -1; d.scroller.style.paddingRight = 0; }\r\n      if (place.appendChild) place.appendChild(d.wrapper); else place(d.wrapper);\r\n  \r\n      // Needed to hide big blue blinking cursor on Mobile Safari\r\n      if (ios) input.style.width = \"0px\";\r\n      if (!webkit) d.scroller.draggable = true;\r\n      // Needed to handle Tab key in KHTML\r\n      if (khtml) { d.inputDiv.style.height = \"1px\"; d.inputDiv.style.position = \"absolute\"; }\r\n      // Need to set a minimum width to see the scrollbar on IE7 (but must not set it on IE8).\r\n      else if (ie_lt8) d.scrollbarH.style.minWidth = d.scrollbarV.style.minWidth = \"18px\";\r\n  \r\n      // Current visible range (may be bigger than the view window).\r\n      d.viewOffset = d.lastSizeC = 0;\r\n      d.showingFrom = d.showingTo = docStart;\r\n  \r\n      // Used to only resize the line number gutter when necessary (when\r\n      // the amount of lines crosses a boundary that makes its width change)\r\n      d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null;\r\n      // See readInput and resetInput\r\n      d.prevInput = \"\";\r\n      // Set to true when a non-horizontal-scrolling widget is added. As\r\n      // an optimization, widget aligning is skipped when d is false.\r\n      d.alignWidgets = false;\r\n      // Flag that indicates whether we currently expect input to appear\r\n      // (after some event like 'keypress' or 'input') and are polling\r\n      // intensively.\r\n      d.pollingFast = false;\r\n      // Self-resetting timeout for the poller\r\n      d.poll = new Delayed();\r\n  \r\n      d.cachedCharWidth = d.cachedTextHeight = null;\r\n      d.measureLineCache = [];\r\n      d.measureLineCachePos = 0;\r\n  \r\n      // Tracks when resetInput has punted to just putting a short\r\n      // string instead of the (large) selection.\r\n      d.inaccurateSelection = false;\r\n  \r\n      // Tracks the maximum line length so that the horizontal scrollbar\r\n      // can be kept static when scrolling.\r\n      d.maxLine = null;\r\n      d.maxLineLength = 0;\r\n      d.maxLineChanged = false;\r\n  \r\n      // Used for measuring wheel scrolling granularity\r\n      d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null;\r\n  \r\n      return d;\r\n    }\r\n  \r\n    // STATE UPDATES\r\n  \r\n    // Used to get the editor into a consistent state again when options change.\r\n  \r\n    function loadMode(cm) {\r\n      cm.doc.mode = CodeMirror.getMode(cm.options, cm.doc.modeOption);\r\n      cm.doc.iter(function(line) {\r\n        if (line.stateAfter) line.stateAfter = null;\r\n        if (line.styles) line.styles = null;\r\n      });\r\n      cm.doc.frontier = cm.doc.first;\r\n      startWorker(cm, 100);\r\n      cm.state.modeGen++;\r\n      if (cm.curOp) regChange(cm);\r\n    }\r\n  \r\n    function wrappingChanged(cm) {\r\n      if (cm.options.lineWrapping) {\r\n        cm.display.wrapper.className += \" CodeMirror-wrap\";\r\n        cm.display.sizer.style.minWidth = \"\";\r\n      } else {\r\n        cm.display.wrapper.className = cm.display.wrapper.className.replace(\" CodeMirror-wrap\", \"\");\r\n        computeMaxLength(cm);\r\n      }\r\n      estimateLineHeights(cm);\r\n      regChange(cm);\r\n      clearCaches(cm);\r\n      setTimeout(function(){updateScrollbars(cm);}, 100);\r\n    }\r\n  \r\n    function estimateHeight(cm) {\r\n      var th = textHeight(cm.display), wrapping = cm.options.lineWrapping;\r\n      var perLine = wrapping && Math.max(5, cm.display.scroller.clientWidth / charWidth(cm.display) - 3);\r\n      return function(line) {\r\n        if (lineIsHidden(cm.doc, line))\r\n          return 0;\r\n        else if (wrapping)\r\n          return (Math.ceil(line.text.length / perLine) || 1) * th;\r\n        else\r\n          return th;\r\n      };\r\n    }\r\n  \r\n    function estimateLineHeights(cm) {\r\n      var doc = cm.doc, est = estimateHeight(cm);\r\n      doc.iter(function(line) {\r\n        var estHeight = est(line);\r\n        if (estHeight != line.height) updateLineHeight(line, estHeight);\r\n      });\r\n    }\r\n  \r\n    function keyMapChanged(cm) {\r\n      var map = keyMap[cm.options.keyMap], style = map.style;\r\n      cm.display.wrapper.className = cm.display.wrapper.className.replace(/\\s*cm-keymap-\\S+/g, \"\") +\r\n        (style ? \" cm-keymap-\" + style : \"\");\r\n      cm.state.disableInput = map.disableInput;\r\n    }\r\n  \r\n    function themeChanged(cm) {\r\n      cm.display.wrapper.className = cm.display.wrapper.className.replace(/\\s*cm-s-\\S+/g, \"\") +\r\n        cm.options.theme.replace(/(^|\\s)\\s*/g, \" cm-s-\");\r\n      clearCaches(cm);\r\n    }\r\n  \r\n    function guttersChanged(cm) {\r\n      updateGutters(cm);\r\n      regChange(cm);\r\n      setTimeout(function(){alignHorizontally(cm);}, 20);\r\n    }\r\n  \r\n    function updateGutters(cm) {\r\n      var gutters = cm.display.gutters, specs = cm.options.gutters;\r\n      removeChildren(gutters);\r\n      for (var i = 0; i < specs.length; ++i) {\r\n        var gutterClass = specs[i];\r\n        var gElt = gutters.appendChild(elt(\"div\", null, \"CodeMirror-gutter \" + gutterClass));\r\n        if (gutterClass == \"CodeMirror-linenumbers\") {\r\n          cm.display.lineGutter = gElt;\r\n          gElt.style.width = (cm.display.lineNumWidth || 1) + \"px\";\r\n        }\r\n      }\r\n      gutters.style.display = i ? \"\" : \"none\";\r\n    }\r\n  \r\n    function lineLength(doc, line) {\r\n      if (line.height == 0) return 0;\r\n      var len = line.text.length, merged, cur = line;\r\n      while (merged = collapsedSpanAtStart(cur)) {\r\n        var found = merged.find();\r\n        cur = getLine(doc, found.from.line);\r\n        len += found.from.ch - found.to.ch;\r\n      }\r\n      cur = line;\r\n      while (merged = collapsedSpanAtEnd(cur)) {\r\n        var found = merged.find();\r\n        len -= cur.text.length - found.from.ch;\r\n        cur = getLine(doc, found.to.line);\r\n        len += cur.text.length - found.to.ch;\r\n      }\r\n      return len;\r\n    }\r\n  \r\n    function computeMaxLength(cm) {\r\n      var d = cm.display, doc = cm.doc;\r\n      d.maxLine = getLine(doc, doc.first);\r\n      d.maxLineLength = lineLength(doc, d.maxLine);\r\n      d.maxLineChanged = true;\r\n      doc.iter(function(line) {\r\n        var len = lineLength(doc, line);\r\n        if (len > d.maxLineLength) {\r\n          d.maxLineLength = len;\r\n          d.maxLine = line;\r\n        }\r\n      });\r\n    }\r\n  \r\n    // Make sure the gutters options contains the element\r\n    // \"CodeMirror-linenumbers\" when the lineNumbers option is true.\r\n    function setGuttersForLineNumbers(options) {\r\n      var found = indexOf(options.gutters, \"CodeMirror-linenumbers\");\r\n      if (found == -1 && options.lineNumbers) {\r\n        options.gutters = options.gutters.concat([\"CodeMirror-linenumbers\"]);\r\n      } else if (found > -1 && !options.lineNumbers) {\r\n        options.gutters = options.gutters.slice(0);\r\n        options.gutters.splice(found, 1);\r\n      }\r\n    }\r\n  \r\n    // SCROLLBARS\r\n  \r\n    // Re-synchronize the fake scrollbars with the actual size of the\r\n    // content. Optionally force a scrollTop.\r\n    function updateScrollbars(cm) {\r\n      var d = cm.display, docHeight = cm.doc.height;\r\n      var totalHeight = docHeight + paddingVert(d);\r\n      d.sizer.style.minHeight = d.heightForcer.style.top = totalHeight + \"px\";\r\n      d.gutters.style.height = Math.max(totalHeight, d.scroller.clientHeight - scrollerCutOff) + \"px\";\r\n      var scrollHeight = Math.max(totalHeight, d.scroller.scrollHeight);\r\n      var needsH = d.scroller.scrollWidth > (d.scroller.clientWidth + 1);\r\n      var needsV = scrollHeight > (d.scroller.clientHeight + 1);\r\n      if (needsV) {\r\n        d.scrollbarV.style.display = \"block\";\r\n        d.scrollbarV.style.bottom = needsH ? scrollbarWidth(d.measure) + \"px\" : \"0\";\r\n        d.scrollbarV.firstChild.style.height =\r\n          (scrollHeight - d.scroller.clientHeight + d.scrollbarV.clientHeight) + \"px\";\r\n      } else {\r\n        d.scrollbarV.style.display = \"\";\r\n        d.scrollbarV.firstChild.style.height = \"0\";\r\n      }\r\n      if (needsH) {\r\n        d.scrollbarH.style.display = \"block\";\r\n        d.scrollbarH.style.right = needsV ? scrollbarWidth(d.measure) + \"px\" : \"0\";\r\n        d.scrollbarH.firstChild.style.width =\r\n          (d.scroller.scrollWidth - d.scroller.clientWidth + d.scrollbarH.clientWidth) + \"px\";\r\n      } else {\r\n        d.scrollbarH.style.display = \"\";\r\n        d.scrollbarH.firstChild.style.width = \"0\";\r\n      }\r\n      if (needsH && needsV) {\r\n        d.scrollbarFiller.style.display = \"block\";\r\n        d.scrollbarFiller.style.height = d.scrollbarFiller.style.width = scrollbarWidth(d.measure) + \"px\";\r\n      } else d.scrollbarFiller.style.display = \"\";\r\n      if (needsH && cm.options.coverGutterNextToScrollbar && cm.options.fixedGutter) {\r\n        d.gutterFiller.style.display = \"block\";\r\n        d.gutterFiller.style.height = scrollbarWidth(d.measure) + \"px\";\r\n        d.gutterFiller.style.width = d.gutters.offsetWidth + \"px\";\r\n      } else d.gutterFiller.style.display = \"\";\r\n  \r\n      if (mac_geLion && scrollbarWidth(d.measure) === 0) {\r\n        d.scrollbarV.style.minWidth = d.scrollbarH.style.minHeight = mac_geMountainLion ? \"18px\" : \"12px\";\r\n        d.scrollbarV.style.pointerEvents = d.scrollbarH.style.pointerEvents = \"none\";\r\n      }\r\n    }\r\n  \r\n    function visibleLines(display, doc, viewPort) {\r\n      var top = display.scroller.scrollTop, height = display.wrapper.clientHeight;\r\n      if (typeof viewPort == \"number\") top = viewPort;\r\n      else if (viewPort) {top = viewPort.top; height = viewPort.bottom - viewPort.top;}\r\n      top = Math.floor(top - paddingTop(display));\r\n      var bottom = Math.ceil(top + height);\r\n      return {from: lineAtHeight(doc, top), to: lineAtHeight(doc, bottom)};\r\n    }\r\n  \r\n    // LINE NUMBERS\r\n  \r\n    function alignHorizontally(cm) {\r\n      var display = cm.display;\r\n      if (!display.alignWidgets && (!display.gutters.firstChild || !cm.options.fixedGutter)) return;\r\n      var comp = compensateForHScroll(display) - display.scroller.scrollLeft + cm.doc.scrollLeft;\r\n      var gutterW = display.gutters.offsetWidth, l = comp + \"px\";\r\n      for (var n = display.lineDiv.firstChild; n; n = n.nextSibling) if (n.alignable) {\r\n        for (var i = 0, a = n.alignable; i < a.length; ++i) a[i].style.left = l;\r\n      }\r\n      if (cm.options.fixedGutter)\r\n        display.gutters.style.left = (comp + gutterW) + \"px\";\r\n    }\r\n  \r\n    function maybeUpdateLineNumberWidth(cm) {\r\n      if (!cm.options.lineNumbers) return false;\r\n      var doc = cm.doc, last = lineNumberFor(cm.options, doc.first + doc.size - 1), display = cm.display;\r\n      if (last.length != display.lineNumChars) {\r\n        var test = display.measure.appendChild(elt(\"div\", [elt(\"div\", last)],\r\n                                                   \"CodeMirror-linenumber CodeMirror-gutter-elt\"));\r\n        var innerW = test.firstChild.offsetWidth, padding = test.offsetWidth - innerW;\r\n        display.lineGutter.style.width = \"\";\r\n        display.lineNumInnerWidth = Math.max(innerW, display.lineGutter.offsetWidth - padding);\r\n        display.lineNumWidth = display.lineNumInnerWidth + padding;\r\n        display.lineNumChars = display.lineNumInnerWidth ? last.length : -1;\r\n        display.lineGutter.style.width = display.lineNumWidth + \"px\";\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n  \r\n    function lineNumberFor(options, i) {\r\n      return String(options.lineNumberFormatter(i + options.firstLineNumber));\r\n    }\r\n    function compensateForHScroll(display) {\r\n      return getRect(display.scroller).left - getRect(display.sizer).left;\r\n    }\r\n  \r\n    // DISPLAY DRAWING\r\n  \r\n    function updateDisplay(cm, changes, viewPort, forced) {\r\n      var oldFrom = cm.display.showingFrom, oldTo = cm.display.showingTo, updated;\r\n      var visible = visibleLines(cm.display, cm.doc, viewPort);\r\n      for (var first = true;; first = false) {\r\n        var oldWidth = cm.display.scroller.clientWidth;\r\n        if (!updateDisplayInner(cm, changes, visible, forced)) break;\r\n        updated = true;\r\n        changes = [];\r\n        updateSelection(cm);\r\n        updateScrollbars(cm);\r\n        if (first && cm.options.lineWrapping && oldWidth != cm.display.scroller.clientWidth) {\r\n          forced = true;\r\n          continue;\r\n        }\r\n        forced = false;\r\n  \r\n        // Clip forced viewport to actual scrollable area\r\n        if (viewPort)\r\n          viewPort = Math.min(cm.display.scroller.scrollHeight - cm.display.scroller.clientHeight,\r\n                              typeof viewPort == \"number\" ? viewPort : viewPort.top);\r\n        visible = visibleLines(cm.display, cm.doc, viewPort);\r\n        if (visible.from >= cm.display.showingFrom && visible.to <= cm.display.showingTo)\r\n          break;\r\n      }\r\n  \r\n      if (updated) {\r\n        signalLater(cm, \"update\", cm);\r\n        if (cm.display.showingFrom != oldFrom || cm.display.showingTo != oldTo)\r\n          signalLater(cm, \"viewportChange\", cm, cm.display.showingFrom, cm.display.showingTo);\r\n      }\r\n      return updated;\r\n    }\r\n  \r\n    // Uses a set of changes plus the current scroll position to\r\n    // determine which DOM updates have to be made, and makes the\r\n    // updates.\r\n    function updateDisplayInner(cm, changes, visible, forced) {\r\n      var display = cm.display, doc = cm.doc;\r\n      if (!display.wrapper.clientWidth) {\r\n        display.showingFrom = display.showingTo = doc.first;\r\n        display.viewOffset = 0;\r\n        return;\r\n      }\r\n  \r\n      // Bail out if the visible area is already rendered and nothing changed.\r\n      if (!forced && changes.length == 0 &&\r\n          visible.from > display.showingFrom && visible.to < display.showingTo)\r\n        return;\r\n  \r\n      if (maybeUpdateLineNumberWidth(cm))\r\n        changes = [{from: doc.first, to: doc.first + doc.size}];\r\n      var gutterW = display.sizer.style.marginLeft = display.gutters.offsetWidth + \"px\";\r\n      display.scrollbarH.style.left = cm.options.fixedGutter ? gutterW : \"0\";\r\n  \r\n      // Used to determine which lines need their line numbers updated\r\n      var positionsChangedFrom = Infinity;\r\n      if (cm.options.lineNumbers)\r\n        for (var i = 0; i < changes.length; ++i)\r\n          if (changes[i].diff && changes[i].from < positionsChangedFrom) { positionsChangedFrom = changes[i].from; }\r\n  \r\n      var end = doc.first + doc.size;\r\n      var from = Math.max(visible.from - cm.options.viewportMargin, doc.first);\r\n      var to = Math.min(end, visible.to + cm.options.viewportMargin);\r\n      if (display.showingFrom < from && from - display.showingFrom < 20) from = Math.max(doc.first, display.showingFrom);\r\n      if (display.showingTo > to && display.showingTo - to < 20) to = Math.min(end, display.showingTo);\r\n      if (sawCollapsedSpans) {\r\n        from = lineNo(visualLine(doc, getLine(doc, from)));\r\n        while (to < end && lineIsHidden(doc, getLine(doc, to))) ++to;\r\n      }\r\n  \r\n      // Create a range of theoretically intact lines, and punch holes\r\n      // in that using the change info.\r\n      var intact = [{from: Math.max(display.showingFrom, doc.first),\r\n                     to: Math.min(display.showingTo, end)}];\r\n      if (intact[0].from >= intact[0].to) intact = [];\r\n      else intact = computeIntact(intact, changes);\r\n      // When merged lines are present, we might have to reduce the\r\n      // intact ranges because changes in continued fragments of the\r\n      // intact lines do require the lines to be redrawn.\r\n      if (sawCollapsedSpans)\r\n        for (var i = 0; i < intact.length; ++i) {\r\n          var range = intact[i], merged;\r\n          while (merged = collapsedSpanAtEnd(getLine(doc, range.to - 1))) {\r\n            var newTo = merged.find().from.line;\r\n            if (newTo > range.from) range.to = newTo;\r\n            else { intact.splice(i--, 1); break; }\r\n          }\r\n        }\r\n  \r\n      // Clip off the parts that won't be visible\r\n      var intactLines = 0;\r\n      for (var i = 0; i < intact.length; ++i) {\r\n        var range = intact[i];\r\n        if (range.from < from) range.from = from;\r\n        if (range.to > to) range.to = to;\r\n        if (range.from >= range.to) intact.splice(i--, 1);\r\n        else intactLines += range.to - range.from;\r\n      }\r\n      if (!forced && intactLines == to - from && from == display.showingFrom && to == display.showingTo) {\r\n        updateViewOffset(cm);\r\n        return;\r\n      }\r\n      intact.sort(function(a, b) {return a.from - b.from;});\r\n  \r\n      // Avoid crashing on IE's \"unspecified error\" when in iframes\r\n      try {\r\n        var focused = document.activeElement;\r\n      } catch(e) {}\r\n      if (intactLines < (to - from) * .7) display.lineDiv.style.display = \"none\";\r\n      patchDisplay(cm, from, to, intact, positionsChangedFrom);\r\n      display.lineDiv.style.display = \"\";\r\n      if (focused && document.activeElement != focused && focused.offsetHeight) focused.focus();\r\n  \r\n      var different = from != display.showingFrom || to != display.showingTo ||\r\n        display.lastSizeC != display.wrapper.clientHeight;\r\n      // This is just a bogus formula that detects when the editor is\r\n      // resized or the font size changes.\r\n      if (different) {\r\n        display.lastSizeC = display.wrapper.clientHeight;\r\n        startWorker(cm, 400);\r\n      }\r\n      display.showingFrom = from; display.showingTo = to;\r\n  \r\n      updateHeightsInViewport(cm);\r\n      updateViewOffset(cm);\r\n  \r\n      return true;\r\n    }\r\n  \r\n    function updateHeightsInViewport(cm) {\r\n      var display = cm.display;\r\n      var prevBottom = display.lineDiv.offsetTop;\r\n      for (var node = display.lineDiv.firstChild, height; node; node = node.nextSibling) if (node.lineObj) {\r\n        if (ie_lt8) {\r\n          var bot = node.offsetTop + node.offsetHeight;\r\n          height = bot - prevBottom;\r\n          prevBottom = bot;\r\n        } else {\r\n          var box = getRect(node);\r\n          height = box.bottom - box.top;\r\n        }\r\n        var diff = node.lineObj.height - height;\r\n        if (height < 2) height = textHeight(display);\r\n        if (diff > .001 || diff < -.001) {\r\n          updateLineHeight(node.lineObj, height);\r\n          var widgets = node.lineObj.widgets;\r\n          if (widgets) for (var i = 0; i < widgets.length; ++i)\r\n            widgets[i].height = widgets[i].node.offsetHeight;\r\n        }\r\n      }\r\n    }\r\n  \r\n    function updateViewOffset(cm) {\r\n      var off = cm.display.viewOffset = heightAtLine(cm, getLine(cm.doc, cm.display.showingFrom));\r\n      // Position the mover div to align with the current virtual scroll position\r\n      cm.display.mover.style.top = off + \"px\";\r\n    }\r\n  \r\n    function computeIntact(intact, changes) {\r\n      for (var i = 0, l = changes.length || 0; i < l; ++i) {\r\n        var change = changes[i], intact2 = [], diff = change.diff || 0;\r\n        for (var j = 0, l2 = intact.length; j < l2; ++j) {\r\n          var range = intact[j];\r\n          if (change.to <= range.from && change.diff) {\r\n            intact2.push({from: range.from + diff, to: range.to + diff});\r\n          } else if (change.to <= range.from || change.from >= range.to) {\r\n            intact2.push(range);\r\n          } else {\r\n            if (change.from > range.from)\r\n              intact2.push({from: range.from, to: change.from});\r\n            if (change.to < range.to)\r\n              intact2.push({from: change.to + diff, to: range.to + diff});\r\n          }\r\n        }\r\n        intact = intact2;\r\n      }\r\n      return intact;\r\n    }\r\n  \r\n    function getDimensions(cm) {\r\n      var d = cm.display, left = {}, width = {};\r\n      for (var n = d.gutters.firstChild, i = 0; n; n = n.nextSibling, ++i) {\r\n        left[cm.options.gutters[i]] = n.offsetLeft;\r\n        width[cm.options.gutters[i]] = n.offsetWidth;\r\n      }\r\n      return {fixedPos: compensateForHScroll(d),\r\n              gutterTotalWidth: d.gutters.offsetWidth,\r\n              gutterLeft: left,\r\n              gutterWidth: width,\r\n              wrapperWidth: d.wrapper.clientWidth};\r\n    }\r\n  \r\n    function patchDisplay(cm, from, to, intact, updateNumbersFrom) {\r\n      var dims = getDimensions(cm);\r\n      var display = cm.display, lineNumbers = cm.options.lineNumbers;\r\n      if (!intact.length && (!webkit || !cm.display.currentWheelTarget))\r\n        removeChildren(display.lineDiv);\r\n      var container = display.lineDiv, cur = container.firstChild;\r\n  \r\n      function rm(node) {\r\n        var next = node.nextSibling;\r\n        if (webkit && mac && cm.display.currentWheelTarget == node) {\r\n          node.style.display = \"none\";\r\n          node.lineObj = null;\r\n        } else {\r\n          node.parentNode.removeChild(node);\r\n        }\r\n        return next;\r\n      }\r\n  \r\n      var nextIntact = intact.shift(), lineN = from;\r\n      cm.doc.iter(from, to, function(line) {\r\n        if (nextIntact && nextIntact.to == lineN) nextIntact = intact.shift();\r\n        if (lineIsHidden(cm.doc, line)) {\r\n          if (line.height != 0) updateLineHeight(line, 0);\r\n          if (line.widgets && cur && cur.previousSibling) for (var i = 0; i < line.widgets.length; ++i) {\r\n            var w = line.widgets[i];\r\n            if (w.showIfHidden) {\r\n              var prev = cur.previousSibling;\r\n              if (/pre/i.test(prev.nodeName)) {\r\n                var wrap = elt(\"div\", null, null, \"position: relative\");\r\n                prev.parentNode.replaceChild(wrap, prev);\r\n                wrap.appendChild(prev);\r\n                prev = wrap;\r\n              }\r\n              var wnode = prev.appendChild(elt(\"div\", [w.node], \"CodeMirror-linewidget\"));\r\n              if (!w.handleMouseEvents) wnode.ignoreEvents = true;\r\n              positionLineWidget(w, wnode, prev, dims);\r\n            }\r\n          }\r\n        } else if (nextIntact && nextIntact.from <= lineN && nextIntact.to > lineN) {\r\n          // This line is intact. Skip to the actual node. Update its\r\n          // line number if needed.\r\n          while (cur.lineObj != line) cur = rm(cur);\r\n          if (lineNumbers && updateNumbersFrom <= lineN && cur.lineNumber)\r\n            setTextContent(cur.lineNumber, lineNumberFor(cm.options, lineN));\r\n          cur = cur.nextSibling;\r\n        } else {\r\n          // For lines with widgets, make an attempt to find and reuse\r\n          // the existing element, so that widgets aren't needlessly\r\n          // removed and re-inserted into the dom\r\n          if (line.widgets) for (var j = 0, search = cur, reuse; search && j < 20; ++j, search = search.nextSibling)\r\n            if (search.lineObj == line && /div/i.test(search.nodeName)) { reuse = search; break; }\r\n          // This line needs to be generated.\r\n          var lineNode = buildLineElement(cm, line, lineN, dims, reuse);\r\n          if (lineNode != reuse) {\r\n            container.insertBefore(lineNode, cur);\r\n          } else {\r\n            while (cur != reuse) cur = rm(cur);\r\n            cur = cur.nextSibling;\r\n          }\r\n  \r\n          lineNode.lineObj = line;\r\n        }\r\n        ++lineN;\r\n      });\r\n      while (cur) cur = rm(cur);\r\n    }\r\n  \r\n    function buildLineElement(cm, line, lineNo, dims, reuse) {\r\n      var built = buildLineContent(cm, line), lineElement = built.pre;\r\n      var markers = line.gutterMarkers, display = cm.display, wrap;\r\n  \r\n      var bgClass = built.bgClass ? built.bgClass + \" \" + (line.bgClass || \"\") : line.bgClass;\r\n      if (!cm.options.lineNumbers && !markers && !bgClass && !line.wrapClass && !line.widgets)\r\n        return lineElement;\r\n  \r\n      // Lines with gutter elements, widgets or a background class need\r\n      // to be wrapped again, and have the extra elements added to the\r\n      // wrapper div\r\n  \r\n      if (reuse) {\r\n        reuse.alignable = null;\r\n        var isOk = true, widgetsSeen = 0, insertBefore = null;\r\n        for (var n = reuse.firstChild, next; n; n = next) {\r\n          next = n.nextSibling;\r\n          if (!/\\bCodeMirror-linewidget\\b/.test(n.className)) {\r\n            reuse.removeChild(n);\r\n          } else {\r\n            for (var i = 0; i < line.widgets.length; ++i) {\r\n              var widget = line.widgets[i];\r\n              if (widget.node == n.firstChild) {\r\n                if (!widget.above && !insertBefore) insertBefore = n;\r\n                positionLineWidget(widget, n, reuse, dims);\r\n                ++widgetsSeen;\r\n                break;\r\n              }\r\n            }\r\n            if (i == line.widgets.length) { isOk = false; break; }\r\n          }\r\n        }\r\n        reuse.insertBefore(lineElement, insertBefore);\r\n        if (isOk && widgetsSeen == line.widgets.length) {\r\n          wrap = reuse;\r\n          reuse.className = line.wrapClass || \"\";\r\n        }\r\n      }\r\n      if (!wrap) {\r\n        wrap = elt(\"div\", null, line.wrapClass, \"position: relative\");\r\n        wrap.appendChild(lineElement);\r\n      }\r\n      // Kludge to make sure the styled element lies behind the selection (by z-index)\r\n      if (bgClass)\r\n        wrap.insertBefore(elt(\"div\", null, bgClass + \" CodeMirror-linebackground\"), wrap.firstChild);\r\n      if (cm.options.lineNumbers || markers) {\r\n        var gutterWrap = wrap.insertBefore(elt(\"div\", null, null, \"position: absolute; left: \" +\r\n                                               (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + \"px\"),\r\n                                           wrap.firstChild);\r\n        if (cm.options.fixedGutter) (wrap.alignable || (wrap.alignable = [])).push(gutterWrap);\r\n        if (cm.options.lineNumbers && (!markers || !markers[\"CodeMirror-linenumbers\"]))\r\n          wrap.lineNumber = gutterWrap.appendChild(\r\n            elt(\"div\", lineNumberFor(cm.options, lineNo),\r\n                \"CodeMirror-linenumber CodeMirror-gutter-elt\",\r\n                \"left: \" + dims.gutterLeft[\"CodeMirror-linenumbers\"] + \"px; width: \"\r\n                + display.lineNumInnerWidth + \"px\"));\r\n        if (markers)\r\n          for (var k = 0; k < cm.options.gutters.length; ++k) {\r\n            var id = cm.options.gutters[k], found = markers.hasOwnProperty(id) && markers[id];\r\n            if (found)\r\n              gutterWrap.appendChild(elt(\"div\", [found], \"CodeMirror-gutter-elt\", \"left: \" +\r\n                                         dims.gutterLeft[id] + \"px; width: \" + dims.gutterWidth[id] + \"px\"));\r\n          }\r\n      }\r\n      if (ie_lt8) wrap.style.zIndex = 2;\r\n      if (line.widgets && wrap != reuse) for (var i = 0, ws = line.widgets; i < ws.length; ++i) {\r\n        var widget = ws[i], node = elt(\"div\", [widget.node], \"CodeMirror-linewidget\");\r\n        if (!widget.handleMouseEvents) node.ignoreEvents = true;\r\n        positionLineWidget(widget, node, wrap, dims);\r\n        if (widget.above)\r\n          wrap.insertBefore(node, cm.options.lineNumbers && line.height != 0 ? gutterWrap : lineElement);\r\n        else\r\n          wrap.appendChild(node);\r\n        signalLater(widget, \"redraw\");\r\n      }\r\n      return wrap;\r\n    }\r\n  \r\n    function positionLineWidget(widget, node, wrap, dims) {\r\n      if (widget.noHScroll) {\r\n        (wrap.alignable || (wrap.alignable = [])).push(node);\r\n        var width = dims.wrapperWidth;\r\n        node.style.left = dims.fixedPos + \"px\";\r\n        if (!widget.coverGutter) {\r\n          width -= dims.gutterTotalWidth;\r\n          node.style.paddingLeft = dims.gutterTotalWidth + \"px\";\r\n        }\r\n        node.style.width = width + \"px\";\r\n      }\r\n      if (widget.coverGutter) {\r\n        node.style.zIndex = 5;\r\n        node.style.position = \"relative\";\r\n        if (!widget.noHScroll) node.style.marginLeft = -dims.gutterTotalWidth + \"px\";\r\n      }\r\n    }\r\n  \r\n    // SELECTION / CURSOR\r\n  \r\n    function updateSelection(cm) {\r\n      var display = cm.display;\r\n      var collapsed = posEq(cm.doc.sel.from, cm.doc.sel.to);\r\n      if (collapsed || cm.options.showCursorWhenSelecting)\r\n        updateSelectionCursor(cm);\r\n      else\r\n        display.cursor.style.display = display.otherCursor.style.display = \"none\";\r\n      if (!collapsed)\r\n        updateSelectionRange(cm);\r\n      else\r\n        display.selectionDiv.style.display = \"none\";\r\n  \r\n      // Move the hidden textarea near the cursor to prevent scrolling artifacts\r\n      if (cm.options.moveInputWithCursor) {\r\n        var headPos = cursorCoords(cm, cm.doc.sel.head, \"div\");\r\n        var wrapOff = getRect(display.wrapper), lineOff = getRect(display.lineDiv);\r\n        display.inputDiv.style.top = Math.max(0, Math.min(display.wrapper.clientHeight - 10,\r\n                                                          headPos.top + lineOff.top - wrapOff.top)) + \"px\";\r\n        display.inputDiv.style.left = Math.max(0, Math.min(display.wrapper.clientWidth - 10,\r\n                                                           headPos.left + lineOff.left - wrapOff.left)) + \"px\";\r\n      }\r\n    }\r\n  \r\n    // No selection, plain cursor\r\n    function updateSelectionCursor(cm) {\r\n      var display = cm.display, pos = cursorCoords(cm, cm.doc.sel.head, \"div\");\r\n      display.cursor.style.left = pos.left + \"px\";\r\n      display.cursor.style.top = pos.top + \"px\";\r\n      display.cursor.style.height = Math.max(0, pos.bottom - pos.top) * cm.options.cursorHeight + \"px\";\r\n      display.cursor.style.display = \"\";\r\n  \r\n      if (pos.other) {\r\n        display.otherCursor.style.display = \"\";\r\n        display.otherCursor.style.left = pos.other.left + \"px\";\r\n        display.otherCursor.style.top = pos.other.top + \"px\";\r\n        display.otherCursor.style.height = (pos.other.bottom - pos.other.top) * .85 + \"px\";\r\n      } else { display.otherCursor.style.display = \"none\"; }\r\n    }\r\n  \r\n    // Highlight selection\r\n    function updateSelectionRange(cm) {\r\n      var display = cm.display, doc = cm.doc, sel = cm.doc.sel;\r\n      var fragment = document.createDocumentFragment();\r\n      var clientWidth = display.lineSpace.offsetWidth, pl = paddingLeft(cm.display);\r\n  \r\n      function add(left, top, width, bottom) {\r\n        if (top < 0) top = 0;\r\n        fragment.appendChild(elt(\"div\", null, \"CodeMirror-selected\", \"position: absolute; left: \" + left +\r\n                                 \"px; top: \" + top + \"px; width: \" + (width == null ? clientWidth - left : width) +\r\n                                 \"px; height: \" + (bottom - top) + \"px\"));\r\n      }\r\n  \r\n      function drawForLine(line, fromArg, toArg) {\r\n        var lineObj = getLine(doc, line);\r\n        var lineLen = lineObj.text.length;\r\n        var start, end;\r\n        function coords(ch, bias) {\r\n          return charCoords(cm, Pos(line, ch), \"div\", lineObj, bias);\r\n        }\r\n  \r\n        iterateBidiSections(getOrder(lineObj), fromArg || 0, toArg == null ? lineLen : toArg, function(from, to, dir) {\r\n          var leftPos = coords(from, \"left\"), rightPos, left, right;\r\n          if (from == to) {\r\n            rightPos = leftPos;\r\n            left = right = leftPos.left;\r\n          } else {\r\n            rightPos = coords(to - 1, \"right\");\r\n            if (dir == \"rtl\") { var tmp = leftPos; leftPos = rightPos; rightPos = tmp; }\r\n            left = leftPos.left;\r\n            right = rightPos.right;\r\n          }\r\n          if (fromArg == null && from == 0) left = pl;\r\n          if (rightPos.top - leftPos.top > 3) { // Different lines, draw top part\r\n            add(left, leftPos.top, null, leftPos.bottom);\r\n            left = pl;\r\n            if (leftPos.bottom < rightPos.top) add(left, leftPos.bottom, null, rightPos.top);\r\n          }\r\n          if (toArg == null && to == lineLen) right = clientWidth;\r\n          if (!start || leftPos.top < start.top || leftPos.top == start.top && leftPos.left < start.left)\r\n            start = leftPos;\r\n          if (!end || rightPos.bottom > end.bottom || rightPos.bottom == end.bottom && rightPos.right > end.right)\r\n            end = rightPos;\r\n          if (left < pl + 1) left = pl;\r\n          add(left, rightPos.top, right - left, rightPos.bottom);\r\n        });\r\n        return {start: start, end: end};\r\n      }\r\n  \r\n      if (sel.from.line == sel.to.line) {\r\n        drawForLine(sel.from.line, sel.from.ch, sel.to.ch);\r\n      } else {\r\n        var fromLine = getLine(doc, sel.from.line), toLine = getLine(doc, sel.to.line);\r\n        var singleVLine = visualLine(doc, fromLine) == visualLine(doc, toLine);\r\n        var leftEnd = drawForLine(sel.from.line, sel.from.ch, singleVLine ? fromLine.text.length : null).end;\r\n        var rightStart = drawForLine(sel.to.line, singleVLine ? 0 : null, sel.to.ch).start;\r\n        if (singleVLine) {\r\n          if (leftEnd.top < rightStart.top - 2) {\r\n            add(leftEnd.right, leftEnd.top, null, leftEnd.bottom);\r\n            add(pl, rightStart.top, rightStart.left, rightStart.bottom);\r\n          } else {\r\n            add(leftEnd.right, leftEnd.top, rightStart.left - leftEnd.right, leftEnd.bottom);\r\n          }\r\n        }\r\n        if (leftEnd.bottom < rightStart.top)\r\n          add(pl, leftEnd.bottom, null, rightStart.top);\r\n      }\r\n  \r\n      removeChildrenAndAdd(display.selectionDiv, fragment);\r\n      display.selectionDiv.style.display = \"\";\r\n    }\r\n  \r\n    // Cursor-blinking\r\n    function restartBlink(cm) {\r\n      if (!cm.state.focused) return;\r\n      var display = cm.display;\r\n      clearInterval(display.blinker);\r\n      var on = true;\r\n      display.cursor.style.visibility = display.otherCursor.style.visibility = \"\";\r\n      if (cm.options.cursorBlinkRate > 0)\r\n        display.blinker = setInterval(function() {\r\n          display.cursor.style.visibility = display.otherCursor.style.visibility = (on = !on) ? \"\" : \"hidden\";\r\n        }, cm.options.cursorBlinkRate);\r\n    }\r\n  \r\n    // HIGHLIGHT WORKER\r\n  \r\n    function startWorker(cm, time) {\r\n      if (cm.doc.mode.startState && cm.doc.frontier < cm.display.showingTo)\r\n        cm.state.highlight.set(time, bind(highlightWorker, cm));\r\n    }\r\n  \r\n    function highlightWorker(cm) {\r\n      var doc = cm.doc;\r\n      if (doc.frontier < doc.first) doc.frontier = doc.first;\r\n      if (doc.frontier >= cm.display.showingTo) return;\r\n      var end = +new Date + cm.options.workTime;\r\n      var state = copyState(doc.mode, getStateBefore(cm, doc.frontier));\r\n      var changed = [], prevChange;\r\n      doc.iter(doc.frontier, Math.min(doc.first + doc.size, cm.display.showingTo + 500), function(line) {\r\n        if (doc.frontier >= cm.display.showingFrom) { // Visible\r\n          var oldStyles = line.styles;\r\n          line.styles = highlightLine(cm, line, state, true);\r\n          var ischange = !oldStyles || oldStyles.length != line.styles.length;\r\n          for (var i = 0; !ischange && i < oldStyles.length; ++i) ischange = oldStyles[i] != line.styles[i];\r\n          if (ischange) {\r\n            if (prevChange && prevChange.end == doc.frontier) prevChange.end++;\r\n            else changed.push(prevChange = {start: doc.frontier, end: doc.frontier + 1});\r\n          }\r\n          line.stateAfter = copyState(doc.mode, state);\r\n        } else {\r\n          processLine(cm, line.text, state);\r\n          line.stateAfter = doc.frontier % 5 == 0 ? copyState(doc.mode, state) : null;\r\n        }\r\n        ++doc.frontier;\r\n        if (+new Date > end) {\r\n          startWorker(cm, cm.options.workDelay);\r\n          return true;\r\n        }\r\n      });\r\n      if (changed.length)\r\n        operation(cm, function() {\r\n          for (var i = 0; i < changed.length; ++i)\r\n            regChange(this, changed[i].start, changed[i].end);\r\n        })();\r\n    }\r\n  \r\n    // Finds the line to start with when starting a parse. Tries to\r\n    // find a line with a stateAfter, so that it can start with a\r\n    // valid state. If that fails, it returns the line with the\r\n    // smallest indentation, which tends to need the least context to\r\n    // parse correctly.\r\n    function findStartLine(cm, n, precise) {\r\n      var minindent, minline, doc = cm.doc;\r\n      var lim = precise ? -1 : n - (cm.doc.mode.innerMode ? 1000 : 100);\r\n      for (var search = n; search > lim; --search) {\r\n        if (search <= doc.first) return doc.first;\r\n        var line = getLine(doc, search - 1);\r\n        if (line.stateAfter && (!precise || search <= doc.frontier)) return search;\r\n        var indented = countColumn(line.text, null, cm.options.tabSize);\r\n        if (minline == null || minindent > indented) {\r\n          minline = search - 1;\r\n          minindent = indented;\r\n        }\r\n      }\r\n      return minline;\r\n    }\r\n  \r\n    function getStateBefore(cm, n, precise) {\r\n      var doc = cm.doc, display = cm.display;\r\n      if (!doc.mode.startState) return true;\r\n      var pos = findStartLine(cm, n, precise), state = pos > doc.first && getLine(doc, pos-1).stateAfter;\r\n      if (!state) state = startState(doc.mode);\r\n      else state = copyState(doc.mode, state);\r\n      doc.iter(pos, n, function(line) {\r\n        processLine(cm, line.text, state);\r\n        var save = pos == n - 1 || pos % 5 == 0 || pos >= display.showingFrom && pos < display.showingTo;\r\n        line.stateAfter = save ? copyState(doc.mode, state) : null;\r\n        ++pos;\r\n      });\r\n      if (precise) doc.frontier = pos;\r\n      return state;\r\n    }\r\n  \r\n    // POSITION MEASUREMENT\r\n  \r\n    function paddingTop(display) {return display.lineSpace.offsetTop;}\r\n    function paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight;}\r\n    function paddingLeft(display) {\r\n      var e = removeChildrenAndAdd(display.measure, elt(\"pre\", null, null, \"text-align: left\")).appendChild(elt(\"span\", \"x\"));\r\n      return e.offsetLeft;\r\n    }\r\n  \r\n    function measureChar(cm, line, ch, data, bias) {\r\n      var dir = -1;\r\n      data = data || measureLine(cm, line);\r\n      if (data.crude) {\r\n        var left = data.left + ch * data.width;\r\n        return {left: left, right: left + data.width, top: data.top, bottom: data.bottom};\r\n      }\r\n  \r\n      for (var pos = ch;; pos += dir) {\r\n        var r = data[pos];\r\n        if (r) break;\r\n        if (dir < 0 && pos == 0) dir = 1;\r\n      }\r\n      bias = pos > ch ? \"left\" : pos < ch ? \"right\" : bias;\r\n      if (bias == \"left\" && r.leftSide) r = r.leftSide;\r\n      else if (bias == \"right\" && r.rightSide) r = r.rightSide;\r\n      return {left: pos < ch ? r.right : r.left,\r\n              right: pos > ch ? r.left : r.right,\r\n              top: r.top,\r\n              bottom: r.bottom};\r\n    }\r\n  \r\n    function findCachedMeasurement(cm, line) {\r\n      var cache = cm.display.measureLineCache;\r\n      for (var i = 0; i < cache.length; ++i) {\r\n        var memo = cache[i];\r\n        if (memo.text == line.text && memo.markedSpans == line.markedSpans &&\r\n            cm.display.scroller.clientWidth == memo.width &&\r\n            memo.classes == line.textClass + \"|\" + line.wrapClass)\r\n          return memo;\r\n      }\r\n    }\r\n  \r\n    function clearCachedMeasurement(cm, line) {\r\n      var exists = findCachedMeasurement(cm, line);\r\n      if (exists) exists.text = exists.measure = exists.markedSpans = null;\r\n    }\r\n  \r\n    function measureLine(cm, line) {\r\n      // First look in the cache\r\n      var cached = findCachedMeasurement(cm, line);\r\n      if (cached) return cached.measure;\r\n  \r\n      // Failing that, recompute and store result in cache\r\n      var measure = measureLineInner(cm, line);\r\n      var cache = cm.display.measureLineCache;\r\n      var memo = {text: line.text, width: cm.display.scroller.clientWidth,\r\n                  markedSpans: line.markedSpans, measure: measure,\r\n                  classes: line.textClass + \"|\" + line.wrapClass};\r\n      if (cache.length == 16) cache[++cm.display.measureLineCachePos % 16] = memo;\r\n      else cache.push(memo);\r\n      return measure;\r\n    }\r\n  \r\n    function measureLineInner(cm, line) {\r\n      if (!cm.options.lineWrapping && line.text.length >= cm.options.crudeMeasuringFrom)\r\n        return crudelyMeasureLine(cm, line);\r\n  \r\n      var display = cm.display, measure = emptyArray(line.text.length);\r\n      var pre = buildLineContent(cm, line, measure, true).pre;\r\n  \r\n      // IE does not cache element positions of inline elements between\r\n      // calls to getBoundingClientRect. This makes the loop below,\r\n      // which gathers the positions of all the characters on the line,\r\n      // do an amount of layout work quadratic to the number of\r\n      // characters. When line wrapping is off, we try to improve things\r\n      // by first subdividing the line into a bunch of inline blocks, so\r\n      // that IE can reuse most of the layout information from caches\r\n      // for those blocks. This does interfere with line wrapping, so it\r\n      // doesn't work when wrapping is on, but in that case the\r\n      // situation is slightly better, since IE does cache line-wrapping\r\n      // information and only recomputes per-line.\r\n      if (ie && !ie_lt8 && !cm.options.lineWrapping && pre.childNodes.length > 100) {\r\n        var fragment = document.createDocumentFragment();\r\n        var chunk = 10, n = pre.childNodes.length;\r\n        for (var i = 0, chunks = Math.ceil(n / chunk); i < chunks; ++i) {\r\n          var wrap = elt(\"div\", null, null, \"display: inline-block\");\r\n          for (var j = 0; j < chunk && n; ++j) {\r\n            wrap.appendChild(pre.firstChild);\r\n            --n;\r\n          }\r\n          fragment.appendChild(wrap);\r\n        }\r\n        pre.appendChild(fragment);\r\n      }\r\n  \r\n      removeChildrenAndAdd(display.measure, pre);\r\n  \r\n      var outer = getRect(display.lineDiv);\r\n      var vranges = [], data = emptyArray(line.text.length), maxBot = pre.offsetHeight;\r\n      // Work around an IE7/8 bug where it will sometimes have randomly\r\n      // replaced our pre with a clone at this point.\r\n      if (ie_lt9 && display.measure.first != pre)\r\n        removeChildrenAndAdd(display.measure, pre);\r\n  \r\n      function measureRect(rect) {\r\n        var top = rect.top - outer.top, bot = rect.bottom - outer.top;\r\n        if (bot > maxBot) bot = maxBot;\r\n        if (top < 0) top = 0;\r\n        for (var i = vranges.length - 2; i >= 0; i -= 2) {\r\n          var rtop = vranges[i], rbot = vranges[i+1];\r\n          if (rtop > bot || rbot < top) continue;\r\n          if (rtop <= top && rbot >= bot ||\r\n              top <= rtop && bot >= rbot ||\r\n              Math.min(bot, rbot) - Math.max(top, rtop) >= (bot - top) >> 1) {\r\n            vranges[i] = Math.min(top, rtop);\r\n            vranges[i+1] = Math.max(bot, rbot);\r\n            break;\r\n          }\r\n        }\r\n        if (i < 0) { i = vranges.length; vranges.push(top, bot); }\r\n        return {left: rect.left - outer.left,\r\n                right: rect.right - outer.left,\r\n                top: i, bottom: null};\r\n      }\r\n      function finishRect(rect) {\r\n        rect.bottom = vranges[rect.top+1];\r\n        rect.top = vranges[rect.top];\r\n      }\r\n  \r\n      for (var i = 0, cur; i < measure.length; ++i) if (cur = measure[i]) {\r\n        var node = cur, rect = null;\r\n        // A widget might wrap, needs special care\r\n        if (/\\bCodeMirror-widget\\b/.test(cur.className) && cur.getClientRects) {\r\n          if (cur.firstChild.nodeType == 1) node = cur.firstChild;\r\n          var rects = node.getClientRects();\r\n          if (rects.length > 1) {\r\n            rect = data[i] = measureRect(rects[0]);\r\n            rect.rightSide = measureRect(rects[rects.length - 1]);\r\n          }\r\n        }\r\n        if (!rect) rect = data[i] = measureRect(getRect(node));\r\n        if (cur.measureRight) rect.right = getRect(cur.measureRight).left;\r\n        if (cur.leftSide) rect.leftSide = measureRect(getRect(cur.leftSide));\r\n      }\r\n      removeChildren(cm.display.measure);\r\n      for (var i = 0, cur; i < data.length; ++i) if (cur = data[i]) {\r\n        finishRect(cur);\r\n        if (cur.leftSide) finishRect(cur.leftSide);\r\n        if (cur.rightSide) finishRect(cur.rightSide);\r\n      }\r\n      return data;\r\n    }\r\n  \r\n    function crudelyMeasureLine(cm, line) {\r\n      var copy = new Line(line.text.slice(0, 100), null);\r\n      if (line.textClass) copy.textClass = line.textClass;\r\n      var measure = measureLineInner(cm, copy);\r\n      var left = measureChar(cm, copy, 0, measure, \"left\");\r\n      var right = measureChar(cm, copy, 99, measure, \"right\");\r\n      return {crude: true, top: left.top, left: left.left, bottom: left.bottom, width: (right.right - left.left) / 100};\r\n    }\r\n  \r\n    function measureLineWidth(cm, line) {\r\n      var hasBadSpan = false;\r\n      if (line.markedSpans) for (var i = 0; i < line.markedSpans; ++i) {\r\n        var sp = line.markedSpans[i];\r\n        if (sp.collapsed && (sp.to == null || sp.to == line.text.length)) hasBadSpan = true;\r\n      }\r\n      var cached = !hasBadSpan && findCachedMeasurement(cm, line);\r\n      if (cached || line.text.length >= cm.options.crudeMeasuringFrom)\r\n        return measureChar(cm, line, line.text.length, cached && cached.measure, \"right\").right;\r\n  \r\n      var pre = buildLineContent(cm, line, null, true).pre;\r\n      var end = pre.appendChild(zeroWidthElement(cm.display.measure));\r\n      removeChildrenAndAdd(cm.display.measure, pre);\r\n      return getRect(end).right - getRect(cm.display.lineDiv).left;\r\n    }\r\n  \r\n    function clearCaches(cm) {\r\n      cm.display.measureLineCache.length = cm.display.measureLineCachePos = 0;\r\n      cm.display.cachedCharWidth = cm.display.cachedTextHeight = null;\r\n      if (!cm.options.lineWrapping) cm.display.maxLineChanged = true;\r\n      cm.display.lineNumChars = null;\r\n    }\r\n  \r\n    function pageScrollX() { return window.pageXOffset || (document.documentElement || document.body).scrollLeft; }\r\n    function pageScrollY() { return window.pageYOffset || (document.documentElement || document.body).scrollTop; }\r\n  \r\n    // Context is one of \"line\", \"div\" (display.lineDiv), \"local\"/null (editor), or \"page\"\r\n    function intoCoordSystem(cm, lineObj, rect, context) {\r\n      if (lineObj.widgets) for (var i = 0; i < lineObj.widgets.length; ++i) if (lineObj.widgets[i].above) {\r\n        var size = widgetHeight(lineObj.widgets[i]);\r\n        rect.top += size; rect.bottom += size;\r\n      }\r\n      if (context == \"line\") return rect;\r\n      if (!context) context = \"local\";\r\n      var yOff = heightAtLine(cm, lineObj);\r\n      if (context == \"local\") yOff += paddingTop(cm.display);\r\n      else yOff -= cm.display.viewOffset;\r\n      if (context == \"page\" || context == \"window\") {\r\n        var lOff = getRect(cm.display.lineSpace);\r\n        yOff += lOff.top + (context == \"window\" ? 0 : pageScrollY());\r\n        var xOff = lOff.left + (context == \"window\" ? 0 : pageScrollX());\r\n        rect.left += xOff; rect.right += xOff;\r\n      }\r\n      rect.top += yOff; rect.bottom += yOff;\r\n      return rect;\r\n    }\r\n  \r\n    // Context may be \"window\", \"page\", \"div\", or \"local\"/null\r\n    // Result is in \"div\" coords\r\n    function fromCoordSystem(cm, coords, context) {\r\n      if (context == \"div\") return coords;\r\n      var left = coords.left, top = coords.top;\r\n      // First move into \"page\" coordinate system\r\n      if (context == \"page\") {\r\n        left -= pageScrollX();\r\n        top -= pageScrollY();\r\n      } else if (context == \"local\" || !context) {\r\n        var localBox = getRect(cm.display.sizer);\r\n        left += localBox.left;\r\n        top += localBox.top;\r\n      }\r\n  \r\n      var lineSpaceBox = getRect(cm.display.lineSpace);\r\n      return {left: left - lineSpaceBox.left, top: top - lineSpaceBox.top};\r\n    }\r\n  \r\n    function charCoords(cm, pos, context, lineObj, bias) {\r\n      if (!lineObj) lineObj = getLine(cm.doc, pos.line);\r\n      return intoCoordSystem(cm, lineObj, measureChar(cm, lineObj, pos.ch, null, bias), context);\r\n    }\r\n  \r\n    function cursorCoords(cm, pos, context, lineObj, measurement) {\r\n      lineObj = lineObj || getLine(cm.doc, pos.line);\r\n      if (!measurement) measurement = measureLine(cm, lineObj);\r\n      function get(ch, right) {\r\n        var m = measureChar(cm, lineObj, ch, measurement, right ? \"right\" : \"left\");\r\n        if (right) m.left = m.right; else m.right = m.left;\r\n        return intoCoordSystem(cm, lineObj, m, context);\r\n      }\r\n      function getBidi(ch, partPos) {\r\n        var part = order[partPos], right = part.level % 2;\r\n        if (ch == bidiLeft(part) && partPos && part.level < order[partPos - 1].level) {\r\n          part = order[--partPos];\r\n          ch = bidiRight(part) - (part.level % 2 ? 0 : 1);\r\n          right = true;\r\n        } else if (ch == bidiRight(part) && partPos < order.length - 1 && part.level < order[partPos + 1].level) {\r\n          part = order[++partPos];\r\n          ch = bidiLeft(part) - part.level % 2;\r\n          right = false;\r\n        }\r\n        if (right && ch == part.to && ch > part.from) return get(ch - 1);\r\n        return get(ch, right);\r\n      }\r\n      var order = getOrder(lineObj), ch = pos.ch;\r\n      if (!order) return get(ch);\r\n      var partPos = getBidiPartAt(order, ch);\r\n      var val = getBidi(ch, partPos);\r\n      if (bidiOther != null) val.other = getBidi(ch, bidiOther);\r\n      return val;\r\n    }\r\n  \r\n    function PosWithInfo(line, ch, outside, xRel) {\r\n      var pos = new Pos(line, ch);\r\n      pos.xRel = xRel;\r\n      if (outside) pos.outside = true;\r\n      return pos;\r\n    }\r\n  \r\n    // Coords must be lineSpace-local\r\n    function coordsChar(cm, x, y) {\r\n      var doc = cm.doc;\r\n      y += cm.display.viewOffset;\r\n      if (y < 0) return PosWithInfo(doc.first, 0, true, -1);\r\n      var lineNo = lineAtHeight(doc, y), last = doc.first + doc.size - 1;\r\n      if (lineNo > last)\r\n        return PosWithInfo(doc.first + doc.size - 1, getLine(doc, last).text.length, true, 1);\r\n      if (x < 0) x = 0;\r\n  \r\n      for (;;) {\r\n        var lineObj = getLine(doc, lineNo);\r\n        var found = coordsCharInner(cm, lineObj, lineNo, x, y);\r\n        var merged = collapsedSpanAtEnd(lineObj);\r\n        var mergedPos = merged && merged.find();\r\n        if (merged && (found.ch > mergedPos.from.ch || found.ch == mergedPos.from.ch && found.xRel > 0))\r\n          lineNo = mergedPos.to.line;\r\n        else\r\n          return found;\r\n      }\r\n    }\r\n  \r\n    function coordsCharInner(cm, lineObj, lineNo, x, y) {\r\n      var innerOff = y - heightAtLine(cm, lineObj);\r\n      var wrongLine = false, adjust = 2 * cm.display.wrapper.clientWidth;\r\n      var measurement = measureLine(cm, lineObj);\r\n  \r\n      function getX(ch) {\r\n        var sp = cursorCoords(cm, Pos(lineNo, ch), \"line\",\r\n                              lineObj, measurement);\r\n        wrongLine = true;\r\n        if (innerOff > sp.bottom) return sp.left - adjust;\r\n        else if (innerOff < sp.top) return sp.left + adjust;\r\n        else wrongLine = false;\r\n        return sp.left;\r\n      }\r\n  \r\n      var bidi = getOrder(lineObj), dist = lineObj.text.length;\r\n      var from = lineLeft(lineObj), to = lineRight(lineObj);\r\n      var fromX = getX(from), fromOutside = wrongLine, toX = getX(to), toOutside = wrongLine;\r\n  \r\n      if (x > toX) return PosWithInfo(lineNo, to, toOutside, 1);\r\n      // Do a binary search between these bounds.\r\n      for (;;) {\r\n        if (bidi ? to == from || to == moveVisually(lineObj, from, 1) : to - from <= 1) {\r\n          var ch = x < fromX || x - fromX <= toX - x ? from : to;\r\n          var xDiff = x - (ch == from ? fromX : toX);\r\n          while (isExtendingChar.test(lineObj.text.charAt(ch))) ++ch;\r\n          var pos = PosWithInfo(lineNo, ch, ch == from ? fromOutside : toOutside,\r\n                                xDiff < 0 ? -1 : xDiff ? 1 : 0);\r\n          return pos;\r\n        }\r\n        var step = Math.ceil(dist / 2), middle = from + step;\r\n        if (bidi) {\r\n          middle = from;\r\n          for (var i = 0; i < step; ++i) middle = moveVisually(lineObj, middle, 1);\r\n        }\r\n        var middleX = getX(middle);\r\n        if (middleX > x) {to = middle; toX = middleX; if (toOutside = wrongLine) toX += 1000; dist = step;}\r\n        else {from = middle; fromX = middleX; fromOutside = wrongLine; dist -= step;}\r\n      }\r\n    }\r\n  \r\n    var measureText;\r\n    function textHeight(display) {\r\n      if (display.cachedTextHeight != null) return display.cachedTextHeight;\r\n      if (measureText == null) {\r\n        measureText = elt(\"pre\");\r\n        // Measure a bunch of lines, for browsers that compute\r\n        // fractional heights.\r\n        for (var i = 0; i < 49; ++i) {\r\n          measureText.appendChild(document.createTextNode(\"x\"));\r\n          measureText.appendChild(elt(\"br\"));\r\n        }\r\n        measureText.appendChild(document.createTextNode(\"x\"));\r\n      }\r\n      removeChildrenAndAdd(display.measure, measureText);\r\n      var height = measureText.offsetHeight / 50;\r\n      if (height > 3) display.cachedTextHeight = height;\r\n      removeChildren(display.measure);\r\n      return height || 1;\r\n    }\r\n  \r\n    function charWidth(display) {\r\n      if (display.cachedCharWidth != null) return display.cachedCharWidth;\r\n      var anchor = elt(\"span\", \"x\");\r\n      var pre = elt(\"pre\", [anchor]);\r\n      removeChildrenAndAdd(display.measure, pre);\r\n      var width = anchor.offsetWidth;\r\n      if (width > 2) display.cachedCharWidth = width;\r\n      return width || 10;\r\n    }\r\n  \r\n    // OPERATIONS\r\n  \r\n    // Operations are used to wrap changes in such a way that each\r\n    // change won't have to update the cursor and display (which would\r\n    // be awkward, slow, and error-prone), but instead updates are\r\n    // batched and then all combined and executed at once.\r\n  \r\n    var nextOpId = 0;\r\n    function startOperation(cm) {\r\n      cm.curOp = {\r\n        // An array of ranges of lines that have to be updated. See\r\n        // updateDisplay.\r\n        changes: [],\r\n        forceUpdate: false,\r\n        updateInput: null,\r\n        userSelChange: null,\r\n        textChanged: null,\r\n        selectionChanged: false,\r\n        cursorActivity: false,\r\n        updateMaxLine: false,\r\n        updateScrollPos: false,\r\n        id: ++nextOpId\r\n      };\r\n      if (!delayedCallbackDepth++) delayedCallbacks = [];\r\n    }\r\n  \r\n    function endOperation(cm) {\r\n      var op = cm.curOp, doc = cm.doc, display = cm.display;\r\n      cm.curOp = null;\r\n  \r\n      if (op.updateMaxLine) computeMaxLength(cm);\r\n      if (display.maxLineChanged && !cm.options.lineWrapping && display.maxLine) {\r\n        var width = measureLineWidth(cm, display.maxLine);\r\n        display.sizer.style.minWidth = Math.max(0, width + 3 + scrollerCutOff) + \"px\";\r\n        display.maxLineChanged = false;\r\n        var maxScrollLeft = Math.max(0, display.sizer.offsetLeft + display.sizer.offsetWidth - display.scroller.clientWidth);\r\n        if (maxScrollLeft < doc.scrollLeft && !op.updateScrollPos)\r\n          setScrollLeft(cm, Math.min(display.scroller.scrollLeft, maxScrollLeft), true);\r\n      }\r\n      var newScrollPos, updated;\r\n      if (op.updateScrollPos) {\r\n        newScrollPos = op.updateScrollPos;\r\n      } else if (op.selectionChanged && display.scroller.clientHeight) { // don't rescroll if not visible\r\n        var coords = cursorCoords(cm, doc.sel.head);\r\n        newScrollPos = calculateScrollPos(cm, coords.left, coords.top, coords.left, coords.bottom);\r\n      }\r\n      if (op.changes.length || op.forceUpdate || newScrollPos && newScrollPos.scrollTop != null) {\r\n        updated = updateDisplay(cm, op.changes, newScrollPos && newScrollPos.scrollTop, op.forceUpdate);\r\n        if (cm.display.scroller.offsetHeight) cm.doc.scrollTop = cm.display.scroller.scrollTop;\r\n      }\r\n      if (!updated && op.selectionChanged) updateSelection(cm);\r\n      if (op.updateScrollPos) {\r\n        var top = Math.max(0, Math.min(display.scroller.scrollHeight - display.scroller.clientHeight, newScrollPos.scrollTop));\r\n        var left = Math.max(0, Math.min(display.scroller.scrollWidth - display.scroller.clientWidth, newScrollPos.scrollLeft));\r\n        display.scroller.scrollTop = display.scrollbarV.scrollTop = doc.scrollTop = top;\r\n        display.scroller.scrollLeft = display.scrollbarH.scrollLeft = doc.scrollLeft = left;\r\n        alignHorizontally(cm);\r\n        if (op.scrollToPos)\r\n          scrollPosIntoView(cm, clipPos(cm.doc, op.scrollToPos.from),\r\n                            clipPos(cm.doc, op.scrollToPos.to), op.scrollToPos.margin);\r\n      } else if (newScrollPos) {\r\n        scrollCursorIntoView(cm);\r\n      }\r\n      if (op.selectionChanged) restartBlink(cm);\r\n  \r\n      if (cm.state.focused && op.updateInput)\r\n        resetInput(cm, op.userSelChange);\r\n  \r\n      var hidden = op.maybeHiddenMarkers, unhidden = op.maybeUnhiddenMarkers;\r\n      if (hidden) for (var i = 0; i < hidden.length; ++i)\r\n        if (!hidden[i].lines.length) signal(hidden[i], \"hide\");\r\n      if (unhidden) for (var i = 0; i < unhidden.length; ++i)\r\n        if (unhidden[i].lines.length) signal(unhidden[i], \"unhide\");\r\n  \r\n      var delayed;\r\n      if (!--delayedCallbackDepth) {\r\n        delayed = delayedCallbacks;\r\n        delayedCallbacks = null;\r\n      }\r\n      if (op.textChanged)\r\n        signal(cm, \"change\", cm, op.textChanged);\r\n      if (op.cursorActivity) signal(cm, \"cursorActivity\", cm);\r\n      if (delayed) for (var i = 0; i < delayed.length; ++i) delayed[i]();\r\n    }\r\n  \r\n    // Wraps a function in an operation. Returns the wrapped function.\r\n    function operation(cm1, f) {\r\n      return function() {\r\n        var cm = cm1 || this, withOp = !cm.curOp;\r\n        if (withOp) startOperation(cm);\r\n        try { var result = f.apply(cm, arguments); }\r\n        finally { if (withOp) endOperation(cm); }\r\n        return result;\r\n      };\r\n    }\r\n    function docOperation(f) {\r\n      return function() {\r\n        var withOp = this.cm && !this.cm.curOp, result;\r\n        if (withOp) startOperation(this.cm);\r\n        try { result = f.apply(this, arguments); }\r\n        finally { if (withOp) endOperation(this.cm); }\r\n        return result;\r\n      };\r\n    }\r\n    function runInOp(cm, f) {\r\n      var withOp = !cm.curOp, result;\r\n      if (withOp) startOperation(cm);\r\n      try { result = f(); }\r\n      finally { if (withOp) endOperation(cm); }\r\n      return result;\r\n    }\r\n  \r\n    function regChange(cm, from, to, lendiff) {\r\n      if (from == null) from = cm.doc.first;\r\n      if (to == null) to = cm.doc.first + cm.doc.size;\r\n      cm.curOp.changes.push({from: from, to: to, diff: lendiff});\r\n    }\r\n  \r\n    // INPUT HANDLING\r\n  \r\n    function slowPoll(cm) {\r\n      if (cm.display.pollingFast) return;\r\n      cm.display.poll.set(cm.options.pollInterval, function() {\r\n        readInput(cm);\r\n        if (cm.state.focused) slowPoll(cm);\r\n      });\r\n    }\r\n  \r\n    function fastPoll(cm) {\r\n      var missed = false;\r\n      cm.display.pollingFast = true;\r\n      function p() {\r\n        var changed = readInput(cm);\r\n        if (!changed && !missed) {missed = true; cm.display.poll.set(60, p);}\r\n        else {cm.display.pollingFast = false; slowPoll(cm);}\r\n      }\r\n      cm.display.poll.set(20, p);\r\n    }\r\n  \r\n    // prevInput is a hack to work with IME. If we reset the textarea\r\n    // on every change, that breaks IME. So we look for changes\r\n    // compared to the previous content instead. (Modern browsers have\r\n    // events that indicate IME taking place, but these are not widely\r\n    // supported or compatible enough yet to rely on.)\r\n    function readInput(cm) {\r\n      var input = cm.display.input, prevInput = cm.display.prevInput, doc = cm.doc, sel = doc.sel;\r\n      if (!cm.state.focused || hasSelection(input) || isReadOnly(cm) || cm.state.disableInput) return false;\r\n      if (cm.state.pasteIncoming && cm.state.fakedLastChar) {\r\n        input.value = input.value.substring(0, input.value.length - 1);\r\n        cm.state.fakedLastChar = false;\r\n      }\r\n      var text = input.value;\r\n      if (text == prevInput && posEq(sel.from, sel.to)) return false;\r\n      if (ie && !ie_lt9 && cm.display.inputHasSelection === text) {\r\n        resetInput(cm, true);\r\n        return false;\r\n      }\r\n  \r\n      var withOp = !cm.curOp;\r\n      if (withOp) startOperation(cm);\r\n      sel.shift = false;\r\n      var same = 0, l = Math.min(prevInput.length, text.length);\r\n      while (same < l && prevInput.charCodeAt(same) == text.charCodeAt(same)) ++same;\r\n      var from = sel.from, to = sel.to;\r\n      if (same < prevInput.length)\r\n        from = Pos(from.line, from.ch - (prevInput.length - same));\r\n      else if (cm.state.overwrite && posEq(from, to) && !cm.state.pasteIncoming)\r\n        to = Pos(to.line, Math.min(getLine(doc, to.line).text.length, to.ch + (text.length - same)));\r\n  \r\n      var updateInput = cm.curOp.updateInput;\r\n      var changeEvent = {from: from, to: to, text: splitLines(text.slice(same)),\r\n                         origin: cm.state.pasteIncoming ? \"paste\" : \"+input\"};\r\n      makeChange(cm.doc, changeEvent, \"end\");\r\n      cm.curOp.updateInput = updateInput;\r\n      signalLater(cm, \"inputRead\", cm, changeEvent);\r\n  \r\n      if (text.length > 1000 || text.indexOf(\"\\n\") > -1) input.value = cm.display.prevInput = \"\";\r\n      else cm.display.prevInput = text;\r\n      if (withOp) endOperation(cm);\r\n      cm.state.pasteIncoming = false;\r\n      return true;\r\n    }\r\n  \r\n    function resetInput(cm, user) {\r\n      var minimal, selected, doc = cm.doc;\r\n      if (!posEq(doc.sel.from, doc.sel.to)) {\r\n        cm.display.prevInput = \"\";\r\n        minimal = hasCopyEvent &&\r\n          (doc.sel.to.line - doc.sel.from.line > 100 || (selected = cm.getSelection()).length > 1000);\r\n        var content = minimal ? \"-\" : selected || cm.getSelection();\r\n        cm.display.input.value = content;\r\n        if (cm.state.focused) selectInput(cm.display.input);\r\n        if (ie && !ie_lt9) cm.display.inputHasSelection = content;\r\n      } else if (user) {\r\n        cm.display.prevInput = cm.display.input.value = \"\";\r\n        if (ie && !ie_lt9) cm.display.inputHasSelection = null;\r\n      }\r\n      cm.display.inaccurateSelection = minimal;\r\n    }\r\n  \r\n    function focusInput(cm) {\r\n      if (cm.options.readOnly != \"nocursor\" && (!mobile || document.activeElement != cm.display.input))\r\n        cm.display.input.focus();\r\n    }\r\n  \r\n    function isReadOnly(cm) {\r\n      return cm.options.readOnly || cm.doc.cantEdit;\r\n    }\r\n  \r\n    // EVENT HANDLERS\r\n  \r\n    function registerEventHandlers(cm) {\r\n      var d = cm.display;\r\n      on(d.scroller, \"mousedown\", operation(cm, onMouseDown));\r\n      if (ie)\r\n        on(d.scroller, \"dblclick\", operation(cm, function(e) {\r\n          if (signalDOMEvent(cm, e)) return;\r\n          var pos = posFromMouse(cm, e);\r\n          if (!pos || clickInGutter(cm, e) || eventInWidget(cm.display, e)) return;\r\n          e_preventDefault(e);\r\n          var word = findWordAt(getLine(cm.doc, pos.line).text, pos);\r\n          extendSelection(cm.doc, word.from, word.to);\r\n        }));\r\n      else\r\n        on(d.scroller, \"dblclick\", function(e) { signalDOMEvent(cm, e) || e_preventDefault(e); });\r\n      on(d.lineSpace, \"selectstart\", function(e) {\r\n        if (!eventInWidget(d, e)) e_preventDefault(e);\r\n      });\r\n      // Gecko browsers fire contextmenu *after* opening the menu, at\r\n      // which point we can't mess with it anymore. Context menu is\r\n      // handled in onMouseDown for Gecko.\r\n      if (!captureMiddleClick) on(d.scroller, \"contextmenu\", function(e) {onContextMenu(cm, e);});\r\n  \r\n      on(d.scroller, \"scroll\", function() {\r\n        if (d.scroller.clientHeight) {\r\n          setScrollTop(cm, d.scroller.scrollTop);\r\n          setScrollLeft(cm, d.scroller.scrollLeft, true);\r\n          signal(cm, \"scroll\", cm);\r\n        }\r\n      });\r\n      on(d.scrollbarV, \"scroll\", function() {\r\n        if (d.scroller.clientHeight) setScrollTop(cm, d.scrollbarV.scrollTop);\r\n      });\r\n      on(d.scrollbarH, \"scroll\", function() {\r\n        if (d.scroller.clientHeight) setScrollLeft(cm, d.scrollbarH.scrollLeft);\r\n      });\r\n  \r\n      on(d.scroller, \"mousewheel\", function(e){onScrollWheel(cm, e);});\r\n      on(d.scroller, \"DOMMouseScroll\", function(e){onScrollWheel(cm, e);});\r\n  \r\n      function reFocus() { if (cm.state.focused) setTimeout(bind(focusInput, cm), 0); }\r\n      on(d.scrollbarH, \"mousedown\", reFocus);\r\n      on(d.scrollbarV, \"mousedown\", reFocus);\r\n      // Prevent wrapper from ever scrolling\r\n      on(d.wrapper, \"scroll\", function() { d.wrapper.scrollTop = d.wrapper.scrollLeft = 0; });\r\n  \r\n      var resizeTimer;\r\n      function onResize() {\r\n        if (resizeTimer == null) resizeTimer = setTimeout(function() {\r\n          resizeTimer = null;\r\n          // Might be a text scaling operation, clear size caches.\r\n          d.cachedCharWidth = d.cachedTextHeight = knownScrollbarWidth = null;\r\n          clearCaches(cm);\r\n          runInOp(cm, bind(regChange, cm));\r\n        }, 100);\r\n      }\r\n      on(window, \"resize\", onResize);\r\n      // Above handler holds on to the editor and its data structures.\r\n      // Here we poll to unregister it when the editor is no longer in\r\n      // the document, so that it can be garbage-collected.\r\n      function unregister() {\r\n        for (var p = d.wrapper.parentNode; p && p != document.body; p = p.parentNode) {}\r\n        if (p) setTimeout(unregister, 5000);\r\n        else off(window, \"resize\", onResize);\r\n      }\r\n      setTimeout(unregister, 5000);\r\n  \r\n      on(d.input, \"keyup\", operation(cm, function(e) {\r\n        if (signalDOMEvent(cm, e) || cm.options.onKeyEvent && cm.options.onKeyEvent(cm, addStop(e))) return;\r\n        if (e.keyCode == 16) cm.doc.sel.shift = false;\r\n      }));\r\n      on(d.input, \"input\", function() {\r\n        if (ie && !ie_lt9 && cm.display.inputHasSelection) cm.display.inputHasSelection = null;\r\n        fastPoll(cm);\r\n      });\r\n      on(d.input, \"keydown\", operation(cm, onKeyDown));\r\n      on(d.input, \"keypress\", operation(cm, onKeyPress));\r\n      on(d.input, \"focus\", bind(onFocus, cm));\r\n      on(d.input, \"blur\", bind(onBlur, cm));\r\n  \r\n      function drag_(e) {\r\n        if (signalDOMEvent(cm, e) || cm.options.onDragEvent && cm.options.onDragEvent(cm, addStop(e))) return;\r\n        e_stop(e);\r\n      }\r\n      if (cm.options.dragDrop) {\r\n        on(d.scroller, \"dragstart\", function(e){onDragStart(cm, e);});\r\n        on(d.scroller, \"dragenter\", drag_);\r\n        on(d.scroller, \"dragover\", drag_);\r\n        on(d.scroller, \"drop\", operation(cm, onDrop));\r\n      }\r\n      on(d.scroller, \"paste\", function(e) {\r\n        if (eventInWidget(d, e)) return;\r\n        focusInput(cm);\r\n        fastPoll(cm);\r\n      });\r\n      on(d.input, \"paste\", function() {\r\n        // Workaround for webkit bug https://bugs.webkit.org/show_bug.cgi?id=90206\r\n        // Add a char to the end of textarea before paste occur so that\r\n        // selection doesn't span to the end of textarea.\r\n        if (webkit && !cm.state.fakedLastChar && !(new Date - cm.state.lastMiddleDown < 200)) {\r\n          var start = d.input.selectionStart, end = d.input.selectionEnd;\r\n          d.input.value += \"$\";\r\n          d.input.selectionStart = start;\r\n          d.input.selectionEnd = end;\r\n          cm.state.fakedLastChar = true;\r\n        }\r\n        cm.state.pasteIncoming = true;\r\n        fastPoll(cm);\r\n      });\r\n  \r\n      function prepareCopy() {\r\n        if (d.inaccurateSelection) {\r\n          d.prevInput = \"\";\r\n          d.inaccurateSelection = false;\r\n          d.input.value = cm.getSelection();\r\n          selectInput(d.input);\r\n        }\r\n      }\r\n      on(d.input, \"cut\", prepareCopy);\r\n      on(d.input, \"copy\", prepareCopy);\r\n  \r\n      // Needed to handle Tab key in KHTML\r\n      if (khtml) on(d.sizer, \"mouseup\", function() {\r\n          if (document.activeElement == d.input) d.input.blur();\r\n          focusInput(cm);\r\n      });\r\n    }\r\n  \r\n    function eventInWidget(display, e) {\r\n      for (var n = e_target(e); n != display.wrapper; n = n.parentNode) {\r\n        if (!n || n.ignoreEvents || n.parentNode == display.sizer && n != display.mover) return true;\r\n      }\r\n    }\r\n  \r\n    function posFromMouse(cm, e, liberal) {\r\n      var display = cm.display;\r\n      if (!liberal) {\r\n        var target = e_target(e);\r\n        if (target == display.scrollbarH || target == display.scrollbarH.firstChild ||\r\n            target == display.scrollbarV || target == display.scrollbarV.firstChild ||\r\n            target == display.scrollbarFiller || target == display.gutterFiller) return null;\r\n      }\r\n      var x, y, space = getRect(display.lineSpace);\r\n      // Fails unpredictably on IE[67] when mouse is dragged around quickly.\r\n      try { x = e.clientX; y = e.clientY; } catch (e) { return null; }\r\n      return coordsChar(cm, x - space.left, y - space.top);\r\n    }\r\n  \r\n    var lastClick, lastDoubleClick;\r\n    function onMouseDown(e) {\r\n      if (signalDOMEvent(this, e)) return;\r\n      var cm = this, display = cm.display, doc = cm.doc, sel = doc.sel;\r\n      sel.shift = e.shiftKey;\r\n  \r\n      if (eventInWidget(display, e)) {\r\n        if (!webkit) {\r\n          display.scroller.draggable = false;\r\n          setTimeout(function(){display.scroller.draggable = true;}, 100);\r\n        }\r\n        return;\r\n      }\r\n      if (clickInGutter(cm, e)) return;\r\n      var start = posFromMouse(cm, e);\r\n  \r\n      switch (e_button(e)) {\r\n      case 3:\r\n        if (captureMiddleClick) onContextMenu.call(cm, cm, e);\r\n        return;\r\n      case 2:\r\n        if (webkit) cm.state.lastMiddleDown = +new Date;\r\n        if (start) extendSelection(cm.doc, start);\r\n        setTimeout(bind(focusInput, cm), 20);\r\n        e_preventDefault(e);\r\n        return;\r\n      }\r\n      // For button 1, if it was clicked inside the editor\r\n      // (posFromMouse returning non-null), we have to adjust the\r\n      // selection.\r\n      if (!start) {if (e_target(e) == display.scroller) e_preventDefault(e); return;}\r\n  \r\n      if (!cm.state.focused) onFocus(cm);\r\n  \r\n      var now = +new Date, type = \"single\";\r\n      if (lastDoubleClick && lastDoubleClick.time > now - 400 && posEq(lastDoubleClick.pos, start)) {\r\n        type = \"triple\";\r\n        e_preventDefault(e);\r\n        setTimeout(bind(focusInput, cm), 20);\r\n        selectLine(cm, start.line);\r\n      } else if (lastClick && lastClick.time > now - 400 && posEq(lastClick.pos, start)) {\r\n        type = \"double\";\r\n        lastDoubleClick = {time: now, pos: start};\r\n        e_preventDefault(e);\r\n        var word = findWordAt(getLine(doc, start.line).text, start);\r\n        extendSelection(cm.doc, word.from, word.to);\r\n      } else { lastClick = {time: now, pos: start}; }\r\n  \r\n      var last = start;\r\n      if (cm.options.dragDrop && dragAndDrop && !isReadOnly(cm) && !posEq(sel.from, sel.to) &&\r\n          !posLess(start, sel.from) && !posLess(sel.to, start) && type == \"single\") {\r\n        var dragEnd = operation(cm, function(e2) {\r\n          if (webkit) display.scroller.draggable = false;\r\n          cm.state.draggingText = false;\r\n          off(document, \"mouseup\", dragEnd);\r\n          off(display.scroller, \"drop\", dragEnd);\r\n          if (Math.abs(e.clientX - e2.clientX) + Math.abs(e.clientY - e2.clientY) < 10) {\r\n            e_preventDefault(e2);\r\n            extendSelection(cm.doc, start);\r\n            focusInput(cm);\r\n          }\r\n        });\r\n        // Let the drag handler handle this.\r\n        if (webkit) display.scroller.draggable = true;\r\n        cm.state.draggingText = dragEnd;\r\n        // IE's approach to draggable\r\n        if (display.scroller.dragDrop) display.scroller.dragDrop();\r\n        on(document, \"mouseup\", dragEnd);\r\n        on(display.scroller, \"drop\", dragEnd);\r\n        return;\r\n      }\r\n      e_preventDefault(e);\r\n      if (type == \"single\") extendSelection(cm.doc, clipPos(doc, start));\r\n  \r\n      var startstart = sel.from, startend = sel.to, lastPos = start;\r\n  \r\n      function doSelect(cur) {\r\n        if (posEq(lastPos, cur)) return;\r\n        lastPos = cur;\r\n  \r\n        if (type == \"single\") {\r\n          extendSelection(cm.doc, clipPos(doc, start), cur);\r\n          return;\r\n        }\r\n  \r\n        startstart = clipPos(doc, startstart);\r\n        startend = clipPos(doc, startend);\r\n        if (type == \"double\") {\r\n          var word = findWordAt(getLine(doc, cur.line).text, cur);\r\n          if (posLess(cur, startstart)) extendSelection(cm.doc, word.from, startend);\r\n          else extendSelection(cm.doc, startstart, word.to);\r\n        } else if (type == \"triple\") {\r\n          if (posLess(cur, startstart)) extendSelection(cm.doc, startend, clipPos(doc, Pos(cur.line, 0)));\r\n          else extendSelection(cm.doc, startstart, clipPos(doc, Pos(cur.line + 1, 0)));\r\n        }\r\n      }\r\n  \r\n      var editorSize = getRect(display.wrapper);\r\n      // Used to ensure timeout re-tries don't fire when another extend\r\n      // happened in the meantime (clearTimeout isn't reliable -- at\r\n      // least on Chrome, the timeouts still happen even when cleared,\r\n      // if the clear happens after their scheduled firing time).\r\n      var counter = 0;\r\n  \r\n      function extend(e) {\r\n        var curCount = ++counter;\r\n        var cur = posFromMouse(cm, e, true);\r\n        if (!cur) return;\r\n        if (!posEq(cur, last)) {\r\n          if (!cm.state.focused) onFocus(cm);\r\n          last = cur;\r\n          doSelect(cur);\r\n          var visible = visibleLines(display, doc);\r\n          if (cur.line >= visible.to || cur.line < visible.from)\r\n            setTimeout(operation(cm, function(){if (counter == curCount) extend(e);}), 150);\r\n        } else {\r\n          var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;\r\n          if (outside) setTimeout(operation(cm, function() {\r\n            if (counter != curCount) return;\r\n            display.scroller.scrollTop += outside;\r\n            extend(e);\r\n          }), 50);\r\n        }\r\n      }\r\n  \r\n      function done(e) {\r\n        counter = Infinity;\r\n        e_preventDefault(e);\r\n        focusInput(cm);\r\n        off(document, \"mousemove\", move);\r\n        off(document, \"mouseup\", up);\r\n      }\r\n  \r\n      var move = operation(cm, function(e) {\r\n        if (!ie && !e_button(e)) done(e);\r\n        else extend(e);\r\n      });\r\n      var up = operation(cm, done);\r\n      on(document, \"mousemove\", move);\r\n      on(document, \"mouseup\", up);\r\n    }\r\n  \r\n    function gutterEvent(cm, e, type, prevent, signalfn) {\r\n      try { var mX = e.clientX, mY = e.clientY; }\r\n      catch(e) { return false; }\r\n      if (mX >= Math.floor(getRect(cm.display.gutters).right)) return false;\r\n      if (prevent) e_preventDefault(e);\r\n  \r\n      var display = cm.display;\r\n      var lineBox = getRect(display.lineDiv);\r\n  \r\n      if (mY > lineBox.bottom || !hasHandler(cm, type)) return e_defaultPrevented(e);\r\n      mY -= lineBox.top - display.viewOffset;\r\n  \r\n      for (var i = 0; i < cm.options.gutters.length; ++i) {\r\n        var g = display.gutters.childNodes[i];\r\n        if (g && getRect(g).right >= mX) {\r\n          var line = lineAtHeight(cm.doc, mY);\r\n          var gutter = cm.options.gutters[i];\r\n          signalfn(cm, type, cm, line, gutter, e);\r\n          return e_defaultPrevented(e);\r\n        }\r\n      }\r\n    }\r\n  \r\n    function contextMenuInGutter(cm, e) {\r\n      if (!hasHandler(cm, \"gutterContextMenu\")) return false;\r\n      return gutterEvent(cm, e, \"gutterContextMenu\", false, signal);\r\n    }\r\n  \r\n    function clickInGutter(cm, e) {\r\n      return gutterEvent(cm, e, \"gutterClick\", true, signalLater);\r\n    }\r\n  \r\n    // Kludge to work around strange IE behavior where it'll sometimes\r\n    // re-fire a series of drag-related events right after the drop (#1551)\r\n    var lastDrop = 0;\r\n  \r\n    function onDrop(e) {\r\n      var cm = this;\r\n      if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e) || (cm.options.onDragEvent && cm.options.onDragEvent(cm, addStop(e))))\r\n        return;\r\n      e_preventDefault(e);\r\n      if (ie) lastDrop = +new Date;\r\n      var pos = posFromMouse(cm, e, true), files = e.dataTransfer.files;\r\n      if (!pos || isReadOnly(cm)) return;\r\n      if (files && files.length && window.FileReader && window.File) {\r\n        var n = files.length, text = Array(n), read = 0;\r\n        var loadFile = function(file, i) {\r\n          var reader = new FileReader;\r\n          reader.onload = function() {\r\n            text[i] = reader.result;\r\n            if (++read == n) {\r\n              pos = clipPos(cm.doc, pos);\r\n              makeChange(cm.doc, {from: pos, to: pos, text: splitLines(text.join(\"\\n\")), origin: \"paste\"}, \"around\");\r\n            }\r\n          };\r\n          reader.readAsText(file);\r\n        };\r\n        for (var i = 0; i < n; ++i) loadFile(files[i], i);\r\n      } else {\r\n        // Don't do a replace if the drop happened inside of the selected text.\r\n        if (cm.state.draggingText && !(posLess(pos, cm.doc.sel.from) || posLess(cm.doc.sel.to, pos))) {\r\n          cm.state.draggingText(e);\r\n          // Ensure the editor is re-focused\r\n          setTimeout(bind(focusInput, cm), 20);\r\n          return;\r\n        }\r\n        try {\r\n          var text = e.dataTransfer.getData(\"Text\");\r\n          if (text) {\r\n            var curFrom = cm.doc.sel.from, curTo = cm.doc.sel.to;\r\n            setSelection(cm.doc, pos, pos);\r\n            if (cm.state.draggingText) replaceRange(cm.doc, \"\", curFrom, curTo, \"paste\");\r\n            cm.replaceSelection(text, null, \"paste\");\r\n            focusInput(cm);\r\n          }\r\n        }\r\n        catch(e){}\r\n      }\r\n    }\r\n  \r\n    function onDragStart(cm, e) {\r\n      if (ie && (!cm.state.draggingText || +new Date - lastDrop < 100)) { e_stop(e); return; }\r\n      if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e)) return;\r\n  \r\n      var txt = cm.getSelection();\r\n      e.dataTransfer.setData(\"Text\", txt);\r\n  \r\n      // Use dummy image instead of default browsers image.\r\n      // Recent Safari (~6.0.2) have a tendency to segfault when this happens, so we don't do it there.\r\n      if (e.dataTransfer.setDragImage && !safari) {\r\n        var img = elt(\"img\", null, null, \"position: fixed; left: 0; top: 0;\");\r\n        img.src = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";\r\n        if (opera) {\r\n          img.width = img.height = 1;\r\n          cm.display.wrapper.appendChild(img);\r\n          // Force a relayout, or Opera won't use our image for some obscure reason\r\n          img._top = img.offsetTop;\r\n        }\r\n        e.dataTransfer.setDragImage(img, 0, 0);\r\n        if (opera) img.parentNode.removeChild(img);\r\n      }\r\n    }\r\n  \r\n    function setScrollTop(cm, val) {\r\n      if (Math.abs(cm.doc.scrollTop - val) < 2) return;\r\n      cm.doc.scrollTop = val;\r\n      if (!gecko) updateDisplay(cm, [], val);\r\n      if (cm.display.scroller.scrollTop != val) cm.display.scroller.scrollTop = val;\r\n      if (cm.display.scrollbarV.scrollTop != val) cm.display.scrollbarV.scrollTop = val;\r\n      if (gecko) updateDisplay(cm, []);\r\n      startWorker(cm, 100);\r\n    }\r\n    function setScrollLeft(cm, val, isScroller) {\r\n      if (isScroller ? val == cm.doc.scrollLeft : Math.abs(cm.doc.scrollLeft - val) < 2) return;\r\n      val = Math.min(val, cm.display.scroller.scrollWidth - cm.display.scroller.clientWidth);\r\n      cm.doc.scrollLeft = val;\r\n      alignHorizontally(cm);\r\n      if (cm.display.scroller.scrollLeft != val) cm.display.scroller.scrollLeft = val;\r\n      if (cm.display.scrollbarH.scrollLeft != val) cm.display.scrollbarH.scrollLeft = val;\r\n    }\r\n  \r\n    // Since the delta values reported on mouse wheel events are\r\n    // unstandardized between browsers and even browser versions, and\r\n    // generally horribly unpredictable, this code starts by measuring\r\n    // the scroll effect that the first few mouse wheel events have,\r\n    // and, from that, detects the way it can convert deltas to pixel\r\n    // offsets afterwards.\r\n    //\r\n    // The reason we want to know the amount a wheel event will scroll\r\n    // is that it gives us a chance to update the display before the\r\n    // actual scrolling happens, reducing flickering.\r\n  \r\n    var wheelSamples = 0, wheelPixelsPerUnit = null;\r\n    // Fill in a browser-detected starting value on browsers where we\r\n    // know one. These don't have to be accurate -- the result of them\r\n    // being wrong would just be a slight flicker on the first wheel\r\n    // scroll (if it is large enough).\r\n    if (ie) wheelPixelsPerUnit = -.53;\r\n    else if (gecko) wheelPixelsPerUnit = 15;\r\n    else if (chrome) wheelPixelsPerUnit = -.7;\r\n    else if (safari) wheelPixelsPerUnit = -1/3;\r\n  \r\n    function onScrollWheel(cm, e) {\r\n      var dx = e.wheelDeltaX, dy = e.wheelDeltaY;\r\n      if (dx == null && e.detail && e.axis == e.HORIZONTAL_AXIS) dx = e.detail;\r\n      if (dy == null && e.detail && e.axis == e.VERTICAL_AXIS) dy = e.detail;\r\n      else if (dy == null) dy = e.wheelDelta;\r\n  \r\n      var display = cm.display, scroll = display.scroller;\r\n      // Quit if there's nothing to scroll here\r\n      if (!(dx && scroll.scrollWidth > scroll.clientWidth ||\r\n            dy && scroll.scrollHeight > scroll.clientHeight)) return;\r\n  \r\n      // Webkit browsers on OS X abort momentum scrolls when the target\r\n      // of the scroll event is removed from the scrollable element.\r\n      // This hack (see related code in patchDisplay) makes sure the\r\n      // element is kept around.\r\n      if (dy && mac && webkit) {\r\n        for (var cur = e.target; cur != scroll; cur = cur.parentNode) {\r\n          if (cur.lineObj) {\r\n            cm.display.currentWheelTarget = cur;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n  \r\n      // On some browsers, horizontal scrolling will cause redraws to\r\n      // happen before the gutter has been realigned, causing it to\r\n      // wriggle around in a most unseemly way. When we have an\r\n      // estimated pixels/delta value, we just handle horizontal\r\n      // scrolling entirely here. It'll be slightly off from native, but\r\n      // better than glitching out.\r\n      if (dx && !gecko && !opera && wheelPixelsPerUnit != null) {\r\n        if (dy)\r\n          setScrollTop(cm, Math.max(0, Math.min(scroll.scrollTop + dy * wheelPixelsPerUnit, scroll.scrollHeight - scroll.clientHeight)));\r\n        setScrollLeft(cm, Math.max(0, Math.min(scroll.scrollLeft + dx * wheelPixelsPerUnit, scroll.scrollWidth - scroll.clientWidth)));\r\n        e_preventDefault(e);\r\n        display.wheelStartX = null; // Abort measurement, if in progress\r\n        return;\r\n      }\r\n  \r\n      if (dy && wheelPixelsPerUnit != null) {\r\n        var pixels = dy * wheelPixelsPerUnit;\r\n        var top = cm.doc.scrollTop, bot = top + display.wrapper.clientHeight;\r\n        if (pixels < 0) top = Math.max(0, top + pixels - 50);\r\n        else bot = Math.min(cm.doc.height, bot + pixels + 50);\r\n        updateDisplay(cm, [], {top: top, bottom: bot});\r\n      }\r\n  \r\n      if (wheelSamples < 20) {\r\n        if (display.wheelStartX == null) {\r\n          display.wheelStartX = scroll.scrollLeft; display.wheelStartY = scroll.scrollTop;\r\n          display.wheelDX = dx; display.wheelDY = dy;\r\n          setTimeout(function() {\r\n            if (display.wheelStartX == null) return;\r\n            var movedX = scroll.scrollLeft - display.wheelStartX;\r\n            var movedY = scroll.scrollTop - display.wheelStartY;\r\n            var sample = (movedY && display.wheelDY && movedY / display.wheelDY) ||\r\n              (movedX && display.wheelDX && movedX / display.wheelDX);\r\n            display.wheelStartX = display.wheelStartY = null;\r\n            if (!sample) return;\r\n            wheelPixelsPerUnit = (wheelPixelsPerUnit * wheelSamples + sample) / (wheelSamples + 1);\r\n            ++wheelSamples;\r\n          }, 200);\r\n        } else {\r\n          display.wheelDX += dx; display.wheelDY += dy;\r\n        }\r\n      }\r\n    }\r\n  \r\n    function doHandleBinding(cm, bound, dropShift) {\r\n      if (typeof bound == \"string\") {\r\n        bound = commands[bound];\r\n        if (!bound) return false;\r\n      }\r\n      // Ensure previous input has been read, so that the handler sees a\r\n      // consistent view of the document\r\n      if (cm.display.pollingFast && readInput(cm)) cm.display.pollingFast = false;\r\n      var doc = cm.doc, prevShift = doc.sel.shift, done = false;\r\n      try {\r\n        if (isReadOnly(cm)) cm.state.suppressEdits = true;\r\n        if (dropShift) doc.sel.shift = false;\r\n        done = bound(cm) != Pass;\r\n      } finally {\r\n        doc.sel.shift = prevShift;\r\n        cm.state.suppressEdits = false;\r\n      }\r\n      return done;\r\n    }\r\n  \r\n    function allKeyMaps(cm) {\r\n      var maps = cm.state.keyMaps.slice(0);\r\n      if (cm.options.extraKeys) maps.push(cm.options.extraKeys);\r\n      maps.push(cm.options.keyMap);\r\n      return maps;\r\n    }\r\n  \r\n    var maybeTransition;\r\n    function handleKeyBinding(cm, e) {\r\n      // Handle auto keymap transitions\r\n      var startMap = getKeyMap(cm.options.keyMap), next = startMap.auto;\r\n      clearTimeout(maybeTransition);\r\n      if (next && !isModifierKey(e)) maybeTransition = setTimeout(function() {\r\n        if (getKeyMap(cm.options.keyMap) == startMap) {\r\n          cm.options.keyMap = (next.call ? next.call(null, cm) : next);\r\n          keyMapChanged(cm);\r\n        }\r\n      }, 50);\r\n  \r\n      var name = keyName(e, true), handled = false;\r\n      if (!name) return false;\r\n      var keymaps = allKeyMaps(cm);\r\n  \r\n      if (e.shiftKey) {\r\n        // First try to resolve full name (including 'Shift-'). Failing\r\n        // that, see if there is a cursor-motion command (starting with\r\n        // 'go') bound to the keyname without 'Shift-'.\r\n        handled = lookupKey(\"Shift-\" + name, keymaps, function(b) {return doHandleBinding(cm, b, true);})\r\n               || lookupKey(name, keymaps, function(b) {\r\n                    if (typeof b == \"string\" ? /^go[A-Z]/.test(b) : b.motion)\r\n                      return doHandleBinding(cm, b);\r\n                  });\r\n      } else {\r\n        handled = lookupKey(name, keymaps, function(b) { return doHandleBinding(cm, b); });\r\n      }\r\n  \r\n      if (handled) {\r\n        e_preventDefault(e);\r\n        restartBlink(cm);\r\n        if (ie_lt9) { e.oldKeyCode = e.keyCode; e.keyCode = 0; }\r\n        signalLater(cm, \"keyHandled\", cm, name, e);\r\n      }\r\n      return handled;\r\n    }\r\n  \r\n    function handleCharBinding(cm, e, ch) {\r\n      var handled = lookupKey(\"'\" + ch + \"'\", allKeyMaps(cm),\r\n                              function(b) { return doHandleBinding(cm, b, true); });\r\n      if (handled) {\r\n        e_preventDefault(e);\r\n        restartBlink(cm);\r\n        signalLater(cm, \"keyHandled\", cm, \"'\" + ch + \"'\", e);\r\n      }\r\n      return handled;\r\n    }\r\n  \r\n    var lastStoppedKey = null;\r\n    function onKeyDown(e) {\r\n      var cm = this;\r\n      if (!cm.state.focused) onFocus(cm);\r\n      if (signalDOMEvent(cm, e) || cm.options.onKeyEvent && cm.options.onKeyEvent(cm, addStop(e))) return;\r\n      if (ie && e.keyCode == 27) e.returnValue = false;\r\n      var code = e.keyCode;\r\n      // IE does strange things with escape.\r\n      cm.doc.sel.shift = code == 16 || e.shiftKey;\r\n      // First give onKeyEvent option a chance to handle this.\r\n      var handled = handleKeyBinding(cm, e);\r\n      if (opera) {\r\n        lastStoppedKey = handled ? code : null;\r\n        // Opera has no cut event... we try to at least catch the key combo\r\n        if (!handled && code == 88 && !hasCopyEvent && (mac ? e.metaKey : e.ctrlKey))\r\n          cm.replaceSelection(\"\");\r\n      }\r\n    }\r\n  \r\n    function onKeyPress(e) {\r\n      var cm = this;\r\n      if (signalDOMEvent(cm, e) || cm.options.onKeyEvent && cm.options.onKeyEvent(cm, addStop(e))) return;\r\n      var keyCode = e.keyCode, charCode = e.charCode;\r\n      if (opera && keyCode == lastStoppedKey) {lastStoppedKey = null; e_preventDefault(e); return;}\r\n      if (((opera && (!e.which || e.which < 10)) || khtml) && handleKeyBinding(cm, e)) return;\r\n      var ch = String.fromCharCode(charCode == null ? keyCode : charCode);\r\n      if (this.options.electricChars && this.doc.mode.electricChars &&\r\n          this.options.smartIndent && !isReadOnly(this) &&\r\n          this.doc.mode.electricChars.indexOf(ch) > -1)\r\n        setTimeout(operation(cm, function() {indentLine(cm, cm.doc.sel.to.line, \"smart\");}), 75);\r\n      if (handleCharBinding(cm, e, ch)) return;\r\n      if (ie && !ie_lt9) cm.display.inputHasSelection = null;\r\n      fastPoll(cm);\r\n    }\r\n  \r\n    function onFocus(cm) {\r\n      if (cm.options.readOnly == \"nocursor\") return;\r\n      if (!cm.state.focused) {\r\n        signal(cm, \"focus\", cm);\r\n        cm.state.focused = true;\r\n        if (cm.display.wrapper.className.search(/\\bCodeMirror-focused\\b/) == -1)\r\n          cm.display.wrapper.className += \" CodeMirror-focused\";\r\n        if (!cm.curOp) {\r\n          resetInput(cm, true);\r\n          if (webkit) setTimeout(bind(resetInput, cm, true), 0); // Issue #1730\r\n        }\r\n      }\r\n      slowPoll(cm);\r\n      restartBlink(cm);\r\n    }\r\n    function onBlur(cm) {\r\n      if (cm.state.focused) {\r\n        signal(cm, \"blur\", cm);\r\n        cm.state.focused = false;\r\n        cm.display.wrapper.className = cm.display.wrapper.className.replace(\" CodeMirror-focused\", \"\");\r\n      }\r\n      clearInterval(cm.display.blinker);\r\n      setTimeout(function() {if (!cm.state.focused) cm.doc.sel.shift = false;}, 150);\r\n    }\r\n  \r\n    var detectingSelectAll;\r\n    function onContextMenu(cm, e) {\r\n      if (signalDOMEvent(cm, e, \"contextmenu\")) return;\r\n      var display = cm.display, sel = cm.doc.sel;\r\n      if (eventInWidget(display, e) || contextMenuInGutter(cm, e)) return;\r\n  \r\n      var pos = posFromMouse(cm, e), scrollPos = display.scroller.scrollTop;\r\n      if (!pos || opera) return; // Opera is difficult.\r\n  \r\n      // Reset the current text selection only if the click is done outside of the selection\r\n      // and 'resetSelectionOnContextMenu' option is true.\r\n      var reset = cm.options.resetSelectionOnContextMenu;\r\n      if (reset && (posEq(sel.from, sel.to) || posLess(pos, sel.from) || !posLess(pos, sel.to)))\r\n        operation(cm, setSelection)(cm.doc, pos, pos);\r\n  \r\n      var oldCSS = display.input.style.cssText;\r\n      display.inputDiv.style.position = \"absolute\";\r\n      display.input.style.cssText = \"position: fixed; width: 30px; height: 30px; top: \" + (e.clientY - 5) +\r\n        \"px; left: \" + (e.clientX - 5) + \"px; z-index: 1000; background: white; outline: none;\" +\r\n        \"border-width: 0; outline: none; overflow: hidden; opacity: .05; -ms-opacity: .05; filter: alpha(opacity=5);\";\r\n      focusInput(cm);\r\n      resetInput(cm, true);\r\n      // Adds \"Select all\" to context menu in FF\r\n      if (posEq(sel.from, sel.to)) display.input.value = display.prevInput = \" \";\r\n  \r\n      function prepareSelectAllHack() {\r\n        if (display.input.selectionStart != null) {\r\n          var extval = display.input.value = \"\\u200b\" + (posEq(sel.from, sel.to) ? \"\" : display.input.value);\r\n          display.prevInput = \"\\u200b\";\r\n          display.input.selectionStart = 1; display.input.selectionEnd = extval.length;\r\n        }\r\n      }\r\n      function rehide() {\r\n        display.inputDiv.style.position = \"relative\";\r\n        display.input.style.cssText = oldCSS;\r\n        if (ie_lt9) display.scrollbarV.scrollTop = display.scroller.scrollTop = scrollPos;\r\n        slowPoll(cm);\r\n  \r\n        // Try to detect the user choosing select-all\r\n        if (display.input.selectionStart != null) {\r\n          if (!ie || ie_lt9) prepareSelectAllHack();\r\n          clearTimeout(detectingSelectAll);\r\n          var i = 0, poll = function(){\r\n            if (display.prevInput == \" \" && display.input.selectionStart == 0)\r\n              operation(cm, commands.selectAll)(cm);\r\n            else if (i++ < 10) detectingSelectAll = setTimeout(poll, 500);\r\n            else resetInput(cm);\r\n          };\r\n          detectingSelectAll = setTimeout(poll, 200);\r\n        }\r\n      }\r\n  \r\n      if (ie && !ie_lt9) prepareSelectAllHack();\r\n      if (captureMiddleClick) {\r\n        e_stop(e);\r\n        var mouseup = function() {\r\n          off(window, \"mouseup\", mouseup);\r\n          setTimeout(rehide, 20);\r\n        };\r\n        on(window, \"mouseup\", mouseup);\r\n      } else {\r\n        setTimeout(rehide, 50);\r\n      }\r\n    }\r\n  \r\n    // UPDATING\r\n  \r\n    var changeEnd = CodeMirror.changeEnd = function(change) {\r\n      if (!change.text) return change.to;\r\n      return Pos(change.from.line + change.text.length - 1,\r\n                 lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0));\r\n    };\r\n  \r\n    // Make sure a position will be valid after the given change.\r\n    function clipPostChange(doc, change, pos) {\r\n      if (!posLess(change.from, pos)) return clipPos(doc, pos);\r\n      var diff = (change.text.length - 1) - (change.to.line - change.from.line);\r\n      if (pos.line > change.to.line + diff) {\r\n        var preLine = pos.line - diff, lastLine = doc.first + doc.size - 1;\r\n        if (preLine > lastLine) return Pos(lastLine, getLine(doc, lastLine).text.length);\r\n        return clipToLen(pos, getLine(doc, preLine).text.length);\r\n      }\r\n      if (pos.line == change.to.line + diff)\r\n        return clipToLen(pos, lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0) +\r\n                         getLine(doc, change.to.line).text.length - change.to.ch);\r\n      var inside = pos.line - change.from.line;\r\n      return clipToLen(pos, change.text[inside].length + (inside ? 0 : change.from.ch));\r\n    }\r\n  \r\n    // Hint can be null|\"end\"|\"start\"|\"around\"|{anchor,head}\r\n    function computeSelAfterChange(doc, change, hint) {\r\n      if (hint && typeof hint == \"object\") // Assumed to be {anchor, head} object\r\n        return {anchor: clipPostChange(doc, change, hint.anchor),\r\n                head: clipPostChange(doc, change, hint.head)};\r\n  \r\n      if (hint == \"start\") return {anchor: change.from, head: change.from};\r\n  \r\n      var end = changeEnd(change);\r\n      if (hint == \"around\") return {anchor: change.from, head: end};\r\n      if (hint == \"end\") return {anchor: end, head: end};\r\n  \r\n      // hint is null, leave the selection alone as much as possible\r\n      var adjustPos = function(pos) {\r\n        if (posLess(pos, change.from)) return pos;\r\n        if (!posLess(change.to, pos)) return end;\r\n  \r\n        var line = pos.line + change.text.length - (change.to.line - change.from.line) - 1, ch = pos.ch;\r\n        if (pos.line == change.to.line) ch += end.ch - change.to.ch;\r\n        return Pos(line, ch);\r\n      };\r\n      return {anchor: adjustPos(doc.sel.anchor), head: adjustPos(doc.sel.head)};\r\n    }\r\n  \r\n    function filterChange(doc, change, update) {\r\n      var obj = {\r\n        canceled: false,\r\n        from: change.from,\r\n        to: change.to,\r\n        text: change.text,\r\n        origin: change.origin,\r\n        cancel: function() { this.canceled = true; }\r\n      };\r\n      if (update) obj.update = function(from, to, text, origin) {\r\n        if (from) this.from = clipPos(doc, from);\r\n        if (to) this.to = clipPos(doc, to);\r\n        if (text) this.text = text;\r\n        if (origin !== undefined) this.origin = origin;\r\n      };\r\n      signal(doc, \"beforeChange\", doc, obj);\r\n      if (doc.cm) signal(doc.cm, \"beforeChange\", doc.cm, obj);\r\n  \r\n      if (obj.canceled) return null;\r\n      return {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin};\r\n    }\r\n  \r\n    // Replace the range from from to to by the strings in replacement.\r\n    // change is a {from, to, text [, origin]} object\r\n    function makeChange(doc, change, selUpdate, ignoreReadOnly) {\r\n      if (doc.cm) {\r\n        if (!doc.cm.curOp) return operation(doc.cm, makeChange)(doc, change, selUpdate, ignoreReadOnly);\r\n        if (doc.cm.state.suppressEdits) return;\r\n      }\r\n  \r\n      if (hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\")) {\r\n        change = filterChange(doc, change, true);\r\n        if (!change) return;\r\n      }\r\n  \r\n      // Possibly split or suppress the update based on the presence\r\n      // of read-only spans in its range.\r\n      var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);\r\n      if (split) {\r\n        for (var i = split.length - 1; i >= 1; --i)\r\n          makeChangeNoReadonly(doc, {from: split[i].from, to: split[i].to, text: [\"\"]});\r\n        if (split.length)\r\n          makeChangeNoReadonly(doc, {from: split[0].from, to: split[0].to, text: change.text}, selUpdate);\r\n      } else {\r\n        makeChangeNoReadonly(doc, change, selUpdate);\r\n      }\r\n    }\r\n  \r\n    function makeChangeNoReadonly(doc, change, selUpdate) {\r\n      if (change.text.length == 1 && change.text[0] == \"\" && posEq(change.from, change.to)) return;\r\n      var selAfter = computeSelAfterChange(doc, change, selUpdate);\r\n      addToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);\r\n  \r\n      makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));\r\n      var rebased = [];\r\n  \r\n      linkedDocs(doc, function(doc, sharedHist) {\r\n        if (!sharedHist && indexOf(rebased, doc.history) == -1) {\r\n          rebaseHist(doc.history, change);\r\n          rebased.push(doc.history);\r\n        }\r\n        makeChangeSingleDoc(doc, change, null, stretchSpansOverChange(doc, change));\r\n      });\r\n    }\r\n  \r\n    function makeChangeFromHistory(doc, type) {\r\n      if (doc.cm && doc.cm.state.suppressEdits) return;\r\n  \r\n      var hist = doc.history;\r\n      var event = (type == \"undo\" ? hist.done : hist.undone).pop();\r\n      if (!event) return;\r\n  \r\n      var anti = {changes: [], anchorBefore: event.anchorAfter, headBefore: event.headAfter,\r\n                  anchorAfter: event.anchorBefore, headAfter: event.headBefore,\r\n                  generation: hist.generation};\r\n      (type == \"undo\" ? hist.undone : hist.done).push(anti);\r\n      hist.generation = event.generation || ++hist.maxGeneration;\r\n  \r\n      var filter = hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\");\r\n  \r\n      for (var i = event.changes.length - 1; i >= 0; --i) {\r\n        var change = event.changes[i];\r\n        change.origin = type;\r\n        if (filter && !filterChange(doc, change, false)) {\r\n          (type == \"undo\" ? hist.done : hist.undone).length = 0;\r\n          return;\r\n        }\r\n  \r\n        anti.changes.push(historyChangeFromChange(doc, change));\r\n  \r\n        var after = i ? computeSelAfterChange(doc, change, null)\r\n                      : {anchor: event.anchorBefore, head: event.headBefore};\r\n        makeChangeSingleDoc(doc, change, after, mergeOldSpans(doc, change));\r\n        var rebased = [];\r\n  \r\n        linkedDocs(doc, function(doc, sharedHist) {\r\n          if (!sharedHist && indexOf(rebased, doc.history) == -1) {\r\n            rebaseHist(doc.history, change);\r\n            rebased.push(doc.history);\r\n          }\r\n          makeChangeSingleDoc(doc, change, null, mergeOldSpans(doc, change));\r\n        });\r\n      }\r\n    }\r\n  \r\n    function shiftDoc(doc, distance) {\r\n      function shiftPos(pos) {return Pos(pos.line + distance, pos.ch);}\r\n      doc.first += distance;\r\n      if (doc.cm) regChange(doc.cm, doc.first, doc.first, distance);\r\n      doc.sel.head = shiftPos(doc.sel.head); doc.sel.anchor = shiftPos(doc.sel.anchor);\r\n      doc.sel.from = shiftPos(doc.sel.from); doc.sel.to = shiftPos(doc.sel.to);\r\n    }\r\n  \r\n    function makeChangeSingleDoc(doc, change, selAfter, spans) {\r\n      if (doc.cm && !doc.cm.curOp)\r\n        return operation(doc.cm, makeChangeSingleDoc)(doc, change, selAfter, spans);\r\n  \r\n      if (change.to.line < doc.first) {\r\n        shiftDoc(doc, change.text.length - 1 - (change.to.line - change.from.line));\r\n        return;\r\n      }\r\n      if (change.from.line > doc.lastLine()) return;\r\n  \r\n      // Clip the change to the size of this doc\r\n      if (change.from.line < doc.first) {\r\n        var shift = change.text.length - 1 - (doc.first - change.from.line);\r\n        shiftDoc(doc, shift);\r\n        change = {from: Pos(doc.first, 0), to: Pos(change.to.line + shift, change.to.ch),\r\n                  text: [lst(change.text)], origin: change.origin};\r\n      }\r\n      var last = doc.lastLine();\r\n      if (change.to.line > last) {\r\n        change = {from: change.from, to: Pos(last, getLine(doc, last).text.length),\r\n                  text: [change.text[0]], origin: change.origin};\r\n      }\r\n  \r\n      change.removed = getBetween(doc, change.from, change.to);\r\n  \r\n      if (!selAfter) selAfter = computeSelAfterChange(doc, change, null);\r\n      if (doc.cm) makeChangeSingleDocInEditor(doc.cm, change, spans, selAfter);\r\n      else updateDoc(doc, change, spans, selAfter);\r\n    }\r\n  \r\n    function makeChangeSingleDocInEditor(cm, change, spans, selAfter) {\r\n      var doc = cm.doc, display = cm.display, from = change.from, to = change.to;\r\n  \r\n      var recomputeMaxLength = false, checkWidthStart = from.line;\r\n      if (!cm.options.lineWrapping) {\r\n        checkWidthStart = lineNo(visualLine(doc, getLine(doc, from.line)));\r\n        doc.iter(checkWidthStart, to.line + 1, function(line) {\r\n          if (line == display.maxLine) {\r\n            recomputeMaxLength = true;\r\n            return true;\r\n          }\r\n        });\r\n      }\r\n  \r\n      if (!posLess(doc.sel.head, change.from) && !posLess(change.to, doc.sel.head))\r\n        cm.curOp.cursorActivity = true;\r\n  \r\n      updateDoc(doc, change, spans, selAfter, estimateHeight(cm));\r\n  \r\n      if (!cm.options.lineWrapping) {\r\n        doc.iter(checkWidthStart, from.line + change.text.length, function(line) {\r\n          var len = lineLength(doc, line);\r\n          if (len > display.maxLineLength) {\r\n            display.maxLine = line;\r\n            display.maxLineLength = len;\r\n            display.maxLineChanged = true;\r\n            recomputeMaxLength = false;\r\n          }\r\n        });\r\n        if (recomputeMaxLength) cm.curOp.updateMaxLine = true;\r\n      }\r\n  \r\n      // Adjust frontier, schedule worker\r\n      doc.frontier = Math.min(doc.frontier, from.line);\r\n      startWorker(cm, 400);\r\n  \r\n      var lendiff = change.text.length - (to.line - from.line) - 1;\r\n      // Remember that these lines changed, for updating the display\r\n      regChange(cm, from.line, to.line + 1, lendiff);\r\n  \r\n      if (hasHandler(cm, \"change\")) {\r\n        var changeObj = {from: from, to: to,\r\n                         text: change.text,\r\n                         removed: change.removed,\r\n                         origin: change.origin};\r\n        if (cm.curOp.textChanged) {\r\n          for (var cur = cm.curOp.textChanged; cur.next; cur = cur.next) {}\r\n          cur.next = changeObj;\r\n        } else cm.curOp.textChanged = changeObj;\r\n      }\r\n    }\r\n  \r\n    function replaceRange(doc, code, from, to, origin) {\r\n      if (!to) to = from;\r\n      if (posLess(to, from)) { var tmp = to; to = from; from = tmp; }\r\n      if (typeof code == \"string\") code = splitLines(code);\r\n      makeChange(doc, {from: from, to: to, text: code, origin: origin}, null);\r\n    }\r\n  \r\n    // POSITION OBJECT\r\n  \r\n    function Pos(line, ch) {\r\n      if (!(this instanceof Pos)) return new Pos(line, ch);\r\n      this.line = line; this.ch = ch;\r\n    }\r\n    CodeMirror.Pos = Pos;\r\n  \r\n    function posEq(a, b) {return a.line == b.line && a.ch == b.ch;}\r\n    function posLess(a, b) {return a.line < b.line || (a.line == b.line && a.ch < b.ch);}\r\n    function copyPos(x) {return Pos(x.line, x.ch);}\r\n  \r\n    // SELECTION\r\n  \r\n    function clipLine(doc, n) {return Math.max(doc.first, Math.min(n, doc.first + doc.size - 1));}\r\n    function clipPos(doc, pos) {\r\n      if (pos.line < doc.first) return Pos(doc.first, 0);\r\n      var last = doc.first + doc.size - 1;\r\n      if (pos.line > last) return Pos(last, getLine(doc, last).text.length);\r\n      return clipToLen(pos, getLine(doc, pos.line).text.length);\r\n    }\r\n    function clipToLen(pos, linelen) {\r\n      var ch = pos.ch;\r\n      if (ch == null || ch > linelen) return Pos(pos.line, linelen);\r\n      else if (ch < 0) return Pos(pos.line, 0);\r\n      else return pos;\r\n    }\r\n    function isLine(doc, l) {return l >= doc.first && l < doc.first + doc.size;}\r\n  \r\n    // If shift is held, this will move the selection anchor. Otherwise,\r\n    // it'll set the whole selection.\r\n    function extendSelection(doc, pos, other, bias) {\r\n      if (doc.sel.shift || doc.sel.extend) {\r\n        var anchor = doc.sel.anchor;\r\n        if (other) {\r\n          var posBefore = posLess(pos, anchor);\r\n          if (posBefore != posLess(other, anchor)) {\r\n            anchor = pos;\r\n            pos = other;\r\n          } else if (posBefore != posLess(pos, other)) {\r\n            pos = other;\r\n          }\r\n        }\r\n        setSelection(doc, anchor, pos, bias);\r\n      } else {\r\n        setSelection(doc, pos, other || pos, bias);\r\n      }\r\n      if (doc.cm) doc.cm.curOp.userSelChange = true;\r\n    }\r\n  \r\n    function filterSelectionChange(doc, anchor, head) {\r\n      var obj = {anchor: anchor, head: head};\r\n      signal(doc, \"beforeSelectionChange\", doc, obj);\r\n      if (doc.cm) signal(doc.cm, \"beforeSelectionChange\", doc.cm, obj);\r\n      obj.anchor = clipPos(doc, obj.anchor); obj.head = clipPos(doc, obj.head);\r\n      return obj;\r\n    }\r\n  \r\n    // Update the selection. Last two args are only used by\r\n    // updateDoc, since they have to be expressed in the line\r\n    // numbers before the update.\r\n    function setSelection(doc, anchor, head, bias, checkAtomic) {\r\n      if (!checkAtomic && hasHandler(doc, \"beforeSelectionChange\") || doc.cm && hasHandler(doc.cm, \"beforeSelectionChange\")) {\r\n        var filtered = filterSelectionChange(doc, anchor, head);\r\n        head = filtered.head;\r\n        anchor = filtered.anchor;\r\n      }\r\n  \r\n      var sel = doc.sel;\r\n      sel.goalColumn = null;\r\n      if (bias == null) bias = posLess(head, sel.head) ? -1 : 1;\r\n      // Skip over atomic spans.\r\n      if (checkAtomic || !posEq(anchor, sel.anchor))\r\n        anchor = skipAtomic(doc, anchor, bias, checkAtomic != \"push\");\r\n      if (checkAtomic || !posEq(head, sel.head))\r\n        head = skipAtomic(doc, head, bias, checkAtomic != \"push\");\r\n  \r\n      if (posEq(sel.anchor, anchor) && posEq(sel.head, head)) return;\r\n  \r\n      sel.anchor = anchor; sel.head = head;\r\n      var inv = posLess(head, anchor);\r\n      sel.from = inv ? head : anchor;\r\n      sel.to = inv ? anchor : head;\r\n  \r\n      if (doc.cm)\r\n        doc.cm.curOp.updateInput = doc.cm.curOp.selectionChanged =\r\n          doc.cm.curOp.cursorActivity = true;\r\n  \r\n      signalLater(doc, \"cursorActivity\", doc);\r\n    }\r\n  \r\n    function reCheckSelection(cm) {\r\n      setSelection(cm.doc, cm.doc.sel.from, cm.doc.sel.to, null, \"push\");\r\n    }\r\n  \r\n    function skipAtomic(doc, pos, bias, mayClear) {\r\n      var flipped = false, curPos = pos;\r\n      var dir = bias || 1;\r\n      doc.cantEdit = false;\r\n      search: for (;;) {\r\n        var line = getLine(doc, curPos.line);\r\n        if (line.markedSpans) {\r\n          for (var i = 0; i < line.markedSpans.length; ++i) {\r\n            var sp = line.markedSpans[i], m = sp.marker;\r\n            if ((sp.from == null || (m.inclusiveLeft ? sp.from <= curPos.ch : sp.from < curPos.ch)) &&\r\n                (sp.to == null || (m.inclusiveRight ? sp.to >= curPos.ch : sp.to > curPos.ch))) {\r\n              if (mayClear) {\r\n                signal(m, \"beforeCursorEnter\");\r\n                if (m.explicitlyCleared) {\r\n                  if (!line.markedSpans) break;\r\n                  else {--i; continue;}\r\n                }\r\n              }\r\n              if (!m.atomic) continue;\r\n              var newPos = m.find()[dir < 0 ? \"from\" : \"to\"];\r\n              if (posEq(newPos, curPos)) {\r\n                newPos.ch += dir;\r\n                if (newPos.ch < 0) {\r\n                  if (newPos.line > doc.first) newPos = clipPos(doc, Pos(newPos.line - 1));\r\n                  else newPos = null;\r\n                } else if (newPos.ch > line.text.length) {\r\n                  if (newPos.line < doc.first + doc.size - 1) newPos = Pos(newPos.line + 1, 0);\r\n                  else newPos = null;\r\n                }\r\n                if (!newPos) {\r\n                  if (flipped) {\r\n                    // Driven in a corner -- no valid cursor position found at all\r\n                    // -- try again *with* clearing, if we didn't already\r\n                    if (!mayClear) return skipAtomic(doc, pos, bias, true);\r\n                    // Otherwise, turn off editing until further notice, and return the start of the doc\r\n                    doc.cantEdit = true;\r\n                    return Pos(doc.first, 0);\r\n                  }\r\n                  flipped = true; newPos = pos; dir = -dir;\r\n                }\r\n              }\r\n              curPos = newPos;\r\n              continue search;\r\n            }\r\n          }\r\n        }\r\n        return curPos;\r\n      }\r\n    }\r\n  \r\n    // SCROLLING\r\n  \r\n    function scrollCursorIntoView(cm) {\r\n      var coords = scrollPosIntoView(cm, cm.doc.sel.head, null, cm.options.cursorScrollMargin);\r\n      if (!cm.state.focused) return;\r\n      var display = cm.display, box = getRect(display.sizer), doScroll = null;\r\n      if (coords.top + box.top < 0) doScroll = true;\r\n      else if (coords.bottom + box.top > (window.innerHeight || document.documentElement.clientHeight)) doScroll = false;\r\n      if (doScroll != null && !phantom) {\r\n        var hidden = display.cursor.style.display == \"none\";\r\n        if (hidden) {\r\n          display.cursor.style.display = \"\";\r\n          display.cursor.style.left = coords.left + \"px\";\r\n          display.cursor.style.top = (coords.top - display.viewOffset) + \"px\";\r\n        }\r\n        display.cursor.scrollIntoView(doScroll);\r\n        if (hidden) display.cursor.style.display = \"none\";\r\n      }\r\n    }\r\n  \r\n    function scrollPosIntoView(cm, pos, end, margin) {\r\n      if (margin == null) margin = 0;\r\n      for (;;) {\r\n        var changed = false, coords = cursorCoords(cm, pos);\r\n        var endCoords = !end || end == pos ? coords : cursorCoords(cm, end);\r\n        var scrollPos = calculateScrollPos(cm, Math.min(coords.left, endCoords.left),\r\n                                           Math.min(coords.top, endCoords.top) - margin,\r\n                                           Math.max(coords.left, endCoords.left),\r\n                                           Math.max(coords.bottom, endCoords.bottom) + margin);\r\n        var startTop = cm.doc.scrollTop, startLeft = cm.doc.scrollLeft;\r\n        if (scrollPos.scrollTop != null) {\r\n          setScrollTop(cm, scrollPos.scrollTop);\r\n          if (Math.abs(cm.doc.scrollTop - startTop) > 1) changed = true;\r\n        }\r\n        if (scrollPos.scrollLeft != null) {\r\n          setScrollLeft(cm, scrollPos.scrollLeft);\r\n          if (Math.abs(cm.doc.scrollLeft - startLeft) > 1) changed = true;\r\n        }\r\n        if (!changed) return coords;\r\n      }\r\n    }\r\n  \r\n    function scrollIntoView(cm, x1, y1, x2, y2) {\r\n      var scrollPos = calculateScrollPos(cm, x1, y1, x2, y2);\r\n      if (scrollPos.scrollTop != null) setScrollTop(cm, scrollPos.scrollTop);\r\n      if (scrollPos.scrollLeft != null) setScrollLeft(cm, scrollPos.scrollLeft);\r\n    }\r\n  \r\n    function calculateScrollPos(cm, x1, y1, x2, y2) {\r\n      var display = cm.display, snapMargin = textHeight(cm.display);\r\n      if (y1 < 0) y1 = 0;\r\n      var screen = display.scroller.clientHeight - scrollerCutOff, screentop = display.scroller.scrollTop, result = {};\r\n      var docBottom = cm.doc.height + paddingVert(display);\r\n      var atTop = y1 < snapMargin, atBottom = y2 > docBottom - snapMargin;\r\n      if (y1 < screentop) {\r\n        result.scrollTop = atTop ? 0 : y1;\r\n      } else if (y2 > screentop + screen) {\r\n        var newTop = Math.min(y1, (atBottom ? docBottom : y2) - screen);\r\n        if (newTop != screentop) result.scrollTop = newTop;\r\n      }\r\n  \r\n      var screenw = display.scroller.clientWidth - scrollerCutOff, screenleft = display.scroller.scrollLeft;\r\n      x1 += display.gutters.offsetWidth; x2 += display.gutters.offsetWidth;\r\n      var gutterw = display.gutters.offsetWidth;\r\n      var atLeft = x1 < gutterw + 10;\r\n      if (x1 < screenleft + gutterw || atLeft) {\r\n        if (atLeft) x1 = 0;\r\n        result.scrollLeft = Math.max(0, x1 - 10 - gutterw);\r\n      } else if (x2 > screenw + screenleft - 3) {\r\n        result.scrollLeft = x2 + 10 - screenw;\r\n      }\r\n      return result;\r\n    }\r\n  \r\n    function updateScrollPos(cm, left, top) {\r\n      cm.curOp.updateScrollPos = {scrollLeft: left == null ? cm.doc.scrollLeft : left,\r\n                                  scrollTop: top == null ? cm.doc.scrollTop : top};\r\n    }\r\n  \r\n    function addToScrollPos(cm, left, top) {\r\n      var pos = cm.curOp.updateScrollPos || (cm.curOp.updateScrollPos = {scrollLeft: cm.doc.scrollLeft, scrollTop: cm.doc.scrollTop});\r\n      var scroll = cm.display.scroller;\r\n      pos.scrollTop = Math.max(0, Math.min(scroll.scrollHeight - scroll.clientHeight, pos.scrollTop + top));\r\n      pos.scrollLeft = Math.max(0, Math.min(scroll.scrollWidth - scroll.clientWidth, pos.scrollLeft + left));\r\n    }\r\n  \r\n    // API UTILITIES\r\n  \r\n    function indentLine(cm, n, how, aggressive) {\r\n      var doc = cm.doc;\r\n      if (how == null) how = \"add\";\r\n      if (how == \"smart\") {\r\n        if (!cm.doc.mode.indent) how = \"prev\";\r\n        else var state = getStateBefore(cm, n);\r\n      }\r\n  \r\n      var tabSize = cm.options.tabSize;\r\n      var line = getLine(doc, n), curSpace = countColumn(line.text, null, tabSize);\r\n      var curSpaceString = line.text.match(/^\\s*/)[0], indentation;\r\n      if (how == \"smart\") {\r\n        indentation = cm.doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);\r\n        if (indentation == Pass) {\r\n          if (!aggressive) return;\r\n          how = \"prev\";\r\n        }\r\n      }\r\n      if (how == \"prev\") {\r\n        if (n > doc.first) indentation = countColumn(getLine(doc, n-1).text, null, tabSize);\r\n        else indentation = 0;\r\n      } else if (how == \"add\") {\r\n        indentation = curSpace + cm.options.indentUnit;\r\n      } else if (how == \"subtract\") {\r\n        indentation = curSpace - cm.options.indentUnit;\r\n      } else if (typeof how == \"number\") {\r\n        indentation = curSpace + how;\r\n      }\r\n      indentation = Math.max(0, indentation);\r\n  \r\n      var indentString = \"\", pos = 0;\r\n      if (cm.options.indentWithTabs)\r\n        for (var i = Math.floor(indentation / tabSize); i; --i) {pos += tabSize; indentString += \"\\t\";}\r\n      if (pos < indentation) indentString += spaceStr(indentation - pos);\r\n  \r\n      if (indentString != curSpaceString)\r\n        replaceRange(cm.doc, indentString, Pos(n, 0), Pos(n, curSpaceString.length), \"+input\");\r\n      else if (doc.sel.head.line == n && doc.sel.head.ch < curSpaceString.length)\r\n        setSelection(doc, Pos(n, curSpaceString.length), Pos(n, curSpaceString.length), 1);\r\n      line.stateAfter = null;\r\n    }\r\n  \r\n    function changeLine(cm, handle, op) {\r\n      var no = handle, line = handle, doc = cm.doc;\r\n      if (typeof handle == \"number\") line = getLine(doc, clipLine(doc, handle));\r\n      else no = lineNo(handle);\r\n      if (no == null) return null;\r\n      if (op(line, no)) regChange(cm, no, no + 1);\r\n      else return null;\r\n      return line;\r\n    }\r\n  \r\n    function findPosH(doc, pos, dir, unit, visually) {\r\n      var line = pos.line, ch = pos.ch, origDir = dir;\r\n      var lineObj = getLine(doc, line);\r\n      var possible = true;\r\n      function findNextLine() {\r\n        var l = line + dir;\r\n        if (l < doc.first || l >= doc.first + doc.size) return (possible = false);\r\n        line = l;\r\n        return lineObj = getLine(doc, l);\r\n      }\r\n      function moveOnce(boundToLine) {\r\n        var next = (visually ? moveVisually : moveLogically)(lineObj, ch, dir, true);\r\n        if (next == null) {\r\n          if (!boundToLine && findNextLine()) {\r\n            if (visually) ch = (dir < 0 ? lineRight : lineLeft)(lineObj);\r\n            else ch = dir < 0 ? lineObj.text.length : 0;\r\n          } else return (possible = false);\r\n        } else ch = next;\r\n        return true;\r\n      }\r\n  \r\n      if (unit == \"char\") moveOnce();\r\n      else if (unit == \"column\") moveOnce(true);\r\n      else if (unit == \"word\" || unit == \"group\") {\r\n        var sawType = null, group = unit == \"group\";\r\n        for (var first = true;; first = false) {\r\n          if (dir < 0 && !moveOnce(!first)) break;\r\n          var cur = lineObj.text.charAt(ch) || \"\\n\";\r\n          var type = isWordChar(cur) ? \"w\"\r\n            : !group ? null\r\n            : /\\s/.test(cur) ? null\r\n            : \"p\";\r\n          if (sawType && sawType != type) {\r\n            if (dir < 0) {dir = 1; moveOnce();}\r\n            break;\r\n          }\r\n          if (type) sawType = type;\r\n          if (dir > 0 && !moveOnce(!first)) break;\r\n        }\r\n      }\r\n      var result = skipAtomic(doc, Pos(line, ch), origDir, true);\r\n      if (!possible) result.hitSide = true;\r\n      return result;\r\n    }\r\n  \r\n    function findPosV(cm, pos, dir, unit) {\r\n      var doc = cm.doc, x = pos.left, y;\r\n      if (unit == \"page\") {\r\n        var pageSize = Math.min(cm.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);\r\n        y = pos.top + dir * (pageSize - (dir < 0 ? 1.5 : .5) * textHeight(cm.display));\r\n      } else if (unit == \"line\") {\r\n        y = dir > 0 ? pos.bottom + 3 : pos.top - 3;\r\n      }\r\n      for (;;) {\r\n        var target = coordsChar(cm, x, y);\r\n        if (!target.outside) break;\r\n        if (dir < 0 ? y <= 0 : y >= doc.height) { target.hitSide = true; break; }\r\n        y += dir * 5;\r\n      }\r\n      return target;\r\n    }\r\n  \r\n    function findWordAt(line, pos) {\r\n      var start = pos.ch, end = pos.ch;\r\n      if (line) {\r\n        if ((pos.xRel < 0 || end == line.length) && start) --start; else ++end;\r\n        var startChar = line.charAt(start);\r\n        var check = isWordChar(startChar) ? isWordChar\r\n          : /\\s/.test(startChar) ? function(ch) {return /\\s/.test(ch);}\r\n          : function(ch) {return !/\\s/.test(ch) && !isWordChar(ch);};\r\n        while (start > 0 && check(line.charAt(start - 1))) --start;\r\n        while (end < line.length && check(line.charAt(end))) ++end;\r\n      }\r\n      return {from: Pos(pos.line, start), to: Pos(pos.line, end)};\r\n    }\r\n  \r\n    function selectLine(cm, line) {\r\n      extendSelection(cm.doc, Pos(line, 0), clipPos(cm.doc, Pos(line + 1, 0)));\r\n    }\r\n  \r\n    // PROTOTYPE\r\n  \r\n    // The publicly visible API. Note that operation(null, f) means\r\n    // 'wrap f in an operation, performed on its `this` parameter'\r\n  \r\n    CodeMirror.prototype = {\r\n      constructor: CodeMirror,\r\n      focus: function(){window.focus(); focusInput(this); fastPoll(this);},\r\n  \r\n      setOption: function(option, value) {\r\n        var options = this.options, old = options[option];\r\n        if (options[option] == value && option != \"mode\") return;\r\n        options[option] = value;\r\n        if (optionHandlers.hasOwnProperty(option))\r\n          operation(this, optionHandlers[option])(this, value, old);\r\n      },\r\n  \r\n      getOption: function(option) {return this.options[option];},\r\n      getDoc: function() {return this.doc;},\r\n  \r\n      addKeyMap: function(map, bottom) {\r\n        this.state.keyMaps[bottom ? \"push\" : \"unshift\"](map);\r\n      },\r\n      removeKeyMap: function(map) {\r\n        var maps = this.state.keyMaps;\r\n        for (var i = 0; i < maps.length; ++i)\r\n          if (maps[i] == map || (typeof maps[i] != \"string\" && maps[i].name == map)) {\r\n            maps.splice(i, 1);\r\n            return true;\r\n          }\r\n      },\r\n  \r\n      addOverlay: operation(null, function(spec, options) {\r\n        var mode = spec.token ? spec : CodeMirror.getMode(this.options, spec);\r\n        if (mode.startState) throw new Error(\"Overlays may not be stateful.\");\r\n        this.state.overlays.push({mode: mode, modeSpec: spec, opaque: options && options.opaque});\r\n        this.state.modeGen++;\r\n        regChange(this);\r\n      }),\r\n      removeOverlay: operation(null, function(spec) {\r\n        var overlays = this.state.overlays;\r\n        for (var i = 0; i < overlays.length; ++i) {\r\n          var cur = overlays[i].modeSpec;\r\n          if (cur == spec || typeof spec == \"string\" && cur.name == spec) {\r\n            overlays.splice(i, 1);\r\n            this.state.modeGen++;\r\n            regChange(this);\r\n            return;\r\n          }\r\n        }\r\n      }),\r\n  \r\n      indentLine: operation(null, function(n, dir, aggressive) {\r\n        if (typeof dir != \"string\" && typeof dir != \"number\") {\r\n          if (dir == null) dir = this.options.smartIndent ? \"smart\" : \"prev\";\r\n          else dir = dir ? \"add\" : \"subtract\";\r\n        }\r\n        if (isLine(this.doc, n)) indentLine(this, n, dir, aggressive);\r\n      }),\r\n      indentSelection: operation(null, function(how) {\r\n        var sel = this.doc.sel;\r\n        if (posEq(sel.from, sel.to)) return indentLine(this, sel.from.line, how);\r\n        var e = sel.to.line - (sel.to.ch ? 0 : 1);\r\n        for (var i = sel.from.line; i <= e; ++i) indentLine(this, i, how);\r\n      }),\r\n  \r\n      // Fetch the parser token for a given character. Useful for hacks\r\n      // that want to inspect the mode state (say, for completion).\r\n      getTokenAt: function(pos, precise) {\r\n        var doc = this.doc;\r\n        pos = clipPos(doc, pos);\r\n        var state = getStateBefore(this, pos.line, precise), mode = this.doc.mode;\r\n        var line = getLine(doc, pos.line);\r\n        var stream = new StringStream(line.text, this.options.tabSize);\r\n        while (stream.pos < pos.ch && !stream.eol()) {\r\n          stream.start = stream.pos;\r\n          var style = mode.token(stream, state);\r\n        }\r\n        return {start: stream.start,\r\n                end: stream.pos,\r\n                string: stream.current(),\r\n                className: style || null, // Deprecated, use 'type' instead\r\n                type: style || null,\r\n                state: state};\r\n      },\r\n  \r\n      getTokenTypeAt: function(pos) {\r\n        pos = clipPos(this.doc, pos);\r\n        var styles = getLineStyles(this, getLine(this.doc, pos.line));\r\n        var before = 0, after = (styles.length - 1) / 2, ch = pos.ch;\r\n        if (ch == 0) return styles[2];\r\n        for (;;) {\r\n          var mid = (before + after) >> 1;\r\n          if ((mid ? styles[mid * 2 - 1] : 0) >= ch) after = mid;\r\n          else if (styles[mid * 2 + 1] < ch) before = mid + 1;\r\n          else return styles[mid * 2 + 2];\r\n        }\r\n      },\r\n  \r\n      getModeAt: function(pos) {\r\n        var mode = this.doc.mode;\r\n        if (!mode.innerMode) return mode;\r\n        return CodeMirror.innerMode(mode, this.getTokenAt(pos).state).mode;\r\n      },\r\n  \r\n      getHelper: function(pos, type) {\r\n        if (!helpers.hasOwnProperty(type)) return;\r\n        var help = helpers[type], mode = this.getModeAt(pos);\r\n        return mode[type] && help[mode[type]] ||\r\n          mode.helperType && help[mode.helperType] ||\r\n          help[mode.name];\r\n      },\r\n  \r\n      getStateAfter: function(line, precise) {\r\n        var doc = this.doc;\r\n        line = clipLine(doc, line == null ? doc.first + doc.size - 1: line);\r\n        return getStateBefore(this, line + 1, precise);\r\n      },\r\n  \r\n      cursorCoords: function(start, mode) {\r\n        var pos, sel = this.doc.sel;\r\n        if (start == null) pos = sel.head;\r\n        else if (typeof start == \"object\") pos = clipPos(this.doc, start);\r\n        else pos = start ? sel.from : sel.to;\r\n        return cursorCoords(this, pos, mode || \"page\");\r\n      },\r\n  \r\n      charCoords: function(pos, mode) {\r\n        return charCoords(this, clipPos(this.doc, pos), mode || \"page\");\r\n      },\r\n  \r\n      coordsChar: function(coords, mode) {\r\n        coords = fromCoordSystem(this, coords, mode || \"page\");\r\n        return coordsChar(this, coords.left, coords.top);\r\n      },\r\n  \r\n      lineAtHeight: function(height, mode) {\r\n        height = fromCoordSystem(this, {top: height, left: 0}, mode || \"page\").top;\r\n        return lineAtHeight(this.doc, height + this.display.viewOffset);\r\n      },\r\n      heightAtLine: function(line, mode) {\r\n        var end = false, last = this.doc.first + this.doc.size - 1;\r\n        if (line < this.doc.first) line = this.doc.first;\r\n        else if (line > last) { line = last; end = true; }\r\n        var lineObj = getLine(this.doc, line);\r\n        return intoCoordSystem(this, getLine(this.doc, line), {top: 0, left: 0}, mode || \"page\").top +\r\n          (end ? lineObj.height : 0);\r\n      },\r\n  \r\n      defaultTextHeight: function() { return textHeight(this.display); },\r\n      defaultCharWidth: function() { return charWidth(this.display); },\r\n  \r\n      setGutterMarker: operation(null, function(line, gutterID, value) {\r\n        return changeLine(this, line, function(line) {\r\n          var markers = line.gutterMarkers || (line.gutterMarkers = {});\r\n          markers[gutterID] = value;\r\n          if (!value && isEmpty(markers)) line.gutterMarkers = null;\r\n          return true;\r\n        });\r\n      }),\r\n  \r\n      clearGutter: operation(null, function(gutterID) {\r\n        var cm = this, doc = cm.doc, i = doc.first;\r\n        doc.iter(function(line) {\r\n          if (line.gutterMarkers && line.gutterMarkers[gutterID]) {\r\n            line.gutterMarkers[gutterID] = null;\r\n            regChange(cm, i, i + 1);\r\n            if (isEmpty(line.gutterMarkers)) line.gutterMarkers = null;\r\n          }\r\n          ++i;\r\n        });\r\n      }),\r\n  \r\n      addLineClass: operation(null, function(handle, where, cls) {\r\n        return changeLine(this, handle, function(line) {\r\n          var prop = where == \"text\" ? \"textClass\" : where == \"background\" ? \"bgClass\" : \"wrapClass\";\r\n          if (!line[prop]) line[prop] = cls;\r\n          else if (new RegExp(\"(?:^|\\\\s)\" + cls + \"(?:$|\\\\s)\").test(line[prop])) return false;\r\n          else line[prop] += \" \" + cls;\r\n          return true;\r\n        });\r\n      }),\r\n  \r\n      removeLineClass: operation(null, function(handle, where, cls) {\r\n        return changeLine(this, handle, function(line) {\r\n          var prop = where == \"text\" ? \"textClass\" : where == \"background\" ? \"bgClass\" : \"wrapClass\";\r\n          var cur = line[prop];\r\n          if (!cur) return false;\r\n          else if (cls == null) line[prop] = null;\r\n          else {\r\n            var found = cur.match(new RegExp(\"(?:^|\\\\s+)\" + cls + \"(?:$|\\\\s+)\"));\r\n            if (!found) return false;\r\n            var end = found.index + found[0].length;\r\n            line[prop] = cur.slice(0, found.index) + (!found.index || end == cur.length ? \"\" : \" \") + cur.slice(end) || null;\r\n          }\r\n          return true;\r\n        });\r\n      }),\r\n  \r\n      addLineWidget: operation(null, function(handle, node, options) {\r\n        return addLineWidget(this, handle, node, options);\r\n      }),\r\n  \r\n      removeLineWidget: function(widget) { widget.clear(); },\r\n  \r\n      lineInfo: function(line) {\r\n        if (typeof line == \"number\") {\r\n          if (!isLine(this.doc, line)) return null;\r\n          var n = line;\r\n          line = getLine(this.doc, line);\r\n          if (!line) return null;\r\n        } else {\r\n          var n = lineNo(line);\r\n          if (n == null) return null;\r\n        }\r\n        return {line: n, handle: line, text: line.text, gutterMarkers: line.gutterMarkers,\r\n                textClass: line.textClass, bgClass: line.bgClass, wrapClass: line.wrapClass,\r\n                widgets: line.widgets};\r\n      },\r\n  \r\n      getViewport: function() { return {from: this.display.showingFrom, to: this.display.showingTo};},\r\n  \r\n      addWidget: function(pos, node, scroll, vert, horiz) {\r\n        var display = this.display;\r\n        pos = cursorCoords(this, clipPos(this.doc, pos));\r\n        var top = pos.bottom, left = pos.left;\r\n        node.style.position = \"absolute\";\r\n        display.sizer.appendChild(node);\r\n        if (vert == \"over\") {\r\n          top = pos.top;\r\n        } else if (vert == \"above\" || vert == \"near\") {\r\n          var vspace = Math.max(display.wrapper.clientHeight, this.doc.height),\r\n          hspace = Math.max(display.sizer.clientWidth, display.lineSpace.clientWidth);\r\n          // Default to positioning above (if specified and possible); otherwise default to positioning below\r\n          if ((vert == 'above' || pos.bottom + node.offsetHeight > vspace) && pos.top > node.offsetHeight)\r\n            top = pos.top - node.offsetHeight;\r\n          else if (pos.bottom + node.offsetHeight <= vspace)\r\n            top = pos.bottom;\r\n          if (left + node.offsetWidth > hspace)\r\n            left = hspace - node.offsetWidth;\r\n        }\r\n        node.style.top = top + \"px\";\r\n        node.style.left = node.style.right = \"\";\r\n        if (horiz == \"right\") {\r\n          left = display.sizer.clientWidth - node.offsetWidth;\r\n          node.style.right = \"0px\";\r\n        } else {\r\n          if (horiz == \"left\") left = 0;\r\n          else if (horiz == \"middle\") left = (display.sizer.clientWidth - node.offsetWidth) / 2;\r\n          node.style.left = left + \"px\";\r\n        }\r\n        if (scroll)\r\n          scrollIntoView(this, left, top, left + node.offsetWidth, top + node.offsetHeight);\r\n      },\r\n  \r\n      triggerOnKeyDown: operation(null, onKeyDown),\r\n  \r\n      execCommand: function(cmd) {return commands[cmd](this);},\r\n  \r\n      findPosH: function(from, amount, unit, visually) {\r\n        var dir = 1;\r\n        if (amount < 0) { dir = -1; amount = -amount; }\r\n        for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {\r\n          cur = findPosH(this.doc, cur, dir, unit, visually);\r\n          if (cur.hitSide) break;\r\n        }\r\n        return cur;\r\n      },\r\n  \r\n      moveH: operation(null, function(dir, unit) {\r\n        var sel = this.doc.sel, pos;\r\n        if (sel.shift || sel.extend || posEq(sel.from, sel.to))\r\n          pos = findPosH(this.doc, sel.head, dir, unit, this.options.rtlMoveVisually);\r\n        else\r\n          pos = dir < 0 ? sel.from : sel.to;\r\n        extendSelection(this.doc, pos, pos, dir);\r\n      }),\r\n  \r\n      deleteH: operation(null, function(dir, unit) {\r\n        var sel = this.doc.sel;\r\n        if (!posEq(sel.from, sel.to)) replaceRange(this.doc, \"\", sel.from, sel.to, \"+delete\");\r\n        else replaceRange(this.doc, \"\", sel.from, findPosH(this.doc, sel.head, dir, unit, false), \"+delete\");\r\n        this.curOp.userSelChange = true;\r\n      }),\r\n  \r\n      findPosV: function(from, amount, unit, goalColumn) {\r\n        var dir = 1, x = goalColumn;\r\n        if (amount < 0) { dir = -1; amount = -amount; }\r\n        for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {\r\n          var coords = cursorCoords(this, cur, \"div\");\r\n          if (x == null) x = coords.left;\r\n          else coords.left = x;\r\n          cur = findPosV(this, coords, dir, unit);\r\n          if (cur.hitSide) break;\r\n        }\r\n        return cur;\r\n      },\r\n  \r\n      moveV: operation(null, function(dir, unit) {\r\n        var sel = this.doc.sel;\r\n        var pos = cursorCoords(this, sel.head, \"div\");\r\n        if (sel.goalColumn != null) pos.left = sel.goalColumn;\r\n        var target = findPosV(this, pos, dir, unit);\r\n  \r\n        if (unit == \"page\") addToScrollPos(this, 0, charCoords(this, target, \"div\").top - pos.top);\r\n        extendSelection(this.doc, target, target, dir);\r\n        sel.goalColumn = pos.left;\r\n      }),\r\n  \r\n      toggleOverwrite: function(value) {\r\n        if (value != null && value == this.state.overwrite) return;\r\n        if (this.state.overwrite = !this.state.overwrite)\r\n          this.display.cursor.className += \" CodeMirror-overwrite\";\r\n        else\r\n          this.display.cursor.className = this.display.cursor.className.replace(\" CodeMirror-overwrite\", \"\");\r\n      },\r\n      hasFocus: function() { return this.state.focused; },\r\n  \r\n      scrollTo: operation(null, function(x, y) {\r\n        updateScrollPos(this, x, y);\r\n      }),\r\n      getScrollInfo: function() {\r\n        var scroller = this.display.scroller, co = scrollerCutOff;\r\n        return {left: scroller.scrollLeft, top: scroller.scrollTop,\r\n                height: scroller.scrollHeight - co, width: scroller.scrollWidth - co,\r\n                clientHeight: scroller.clientHeight - co, clientWidth: scroller.clientWidth - co};\r\n      },\r\n  \r\n      scrollIntoView: operation(null, function(range, margin) {\r\n        if (range == null) range = {from: this.doc.sel.head, to: null};\r\n        else if (typeof range == \"number\") range = {from: Pos(range, 0), to: null};\r\n        else if (range.from == null) range = {from: range, to: null};\r\n        if (!range.to) range.to = range.from;\r\n        if (!margin) margin = 0;\r\n  \r\n        var coords = range;\r\n        if (range.from.line != null) {\r\n          this.curOp.scrollToPos = {from: range.from, to: range.to, margin: margin};\r\n          coords = {from: cursorCoords(this, range.from),\r\n                    to: cursorCoords(this, range.to)};\r\n        }\r\n        var sPos = calculateScrollPos(this, Math.min(coords.from.left, coords.to.left),\r\n                                      Math.min(coords.from.top, coords.to.top) - margin,\r\n                                      Math.max(coords.from.right, coords.to.right),\r\n                                      Math.max(coords.from.bottom, coords.to.bottom) + margin);\r\n        updateScrollPos(this, sPos.scrollLeft, sPos.scrollTop);\r\n      }),\r\n  \r\n      setSize: operation(null, function(width, height) {\r\n        function interpret(val) {\r\n          return typeof val == \"number\" || /^\\d+$/.test(String(val)) ? val + \"px\" : val;\r\n        }\r\n        if (width != null) this.display.wrapper.style.width = interpret(width);\r\n        if (height != null) this.display.wrapper.style.height = interpret(height);\r\n        if (this.options.lineWrapping)\r\n          this.display.measureLineCache.length = this.display.measureLineCachePos = 0;\r\n        this.curOp.forceUpdate = true;\r\n      }),\r\n  \r\n      operation: function(f){return runInOp(this, f);},\r\n  \r\n      refresh: operation(null, function() {\r\n        var badHeight = this.display.cachedTextHeight == null;\r\n        clearCaches(this);\r\n        updateScrollPos(this, this.doc.scrollLeft, this.doc.scrollTop);\r\n        regChange(this);\r\n        if (badHeight) estimateLineHeights(this);\r\n      }),\r\n  \r\n      swapDoc: operation(null, function(doc) {\r\n        var old = this.doc;\r\n        old.cm = null;\r\n        attachDoc(this, doc);\r\n        clearCaches(this);\r\n        resetInput(this, true);\r\n        updateScrollPos(this, doc.scrollLeft, doc.scrollTop);\r\n        signalLater(this, \"swapDoc\", this, old);\r\n        return old;\r\n      }),\r\n  \r\n      getInputField: function(){return this.display.input;},\r\n      getWrapperElement: function(){return this.display.wrapper;},\r\n      getScrollerElement: function(){return this.display.scroller;},\r\n      getGutterElement: function(){return this.display.gutters;}\r\n    };\r\n    eventMixin(CodeMirror);\r\n  \r\n    // OPTION DEFAULTS\r\n  \r\n    var optionHandlers = CodeMirror.optionHandlers = {};\r\n  \r\n    // The default configuration options.\r\n    var defaults = CodeMirror.defaults = {};\r\n  \r\n    function option(name, deflt, handle, notOnInit) {\r\n      CodeMirror.defaults[name] = deflt;\r\n      if (handle) optionHandlers[name] =\r\n        notOnInit ? function(cm, val, old) {if (old != Init) handle(cm, val, old);} : handle;\r\n    }\r\n  \r\n    var Init = CodeMirror.Init = {toString: function(){return \"CodeMirror.Init\";}};\r\n  \r\n    // These two are, on init, called from the constructor because they\r\n    // have to be initialized before the editor can start at all.\r\n    option(\"value\", \"\", function(cm, val) {\r\n      cm.setValue(val);\r\n    }, true);\r\n    option(\"mode\", null, function(cm, val) {\r\n      cm.doc.modeOption = val;\r\n      loadMode(cm);\r\n    }, true);\r\n  \r\n    option(\"indentUnit\", 2, loadMode, true);\r\n    option(\"indentWithTabs\", false);\r\n    option(\"smartIndent\", true);\r\n    option(\"tabSize\", 4, function(cm) {\r\n      loadMode(cm);\r\n      clearCaches(cm);\r\n      regChange(cm);\r\n    }, true);\r\n    option(\"specialChars\", /[\\t\\u0000-\\u0019\\u00ad\\u200b\\u2028\\u2029\\ufeff]/g, function(cm, val) {\r\n      cm.options.specialChars = new RegExp(val.source + (val.test(\"\\t\") ? \"\" : \"|\\t\"), \"g\");\r\n      cm.refresh();\r\n    }, true);\r\n    option(\"specialCharPlaceholder\", defaultSpecialCharPlaceholder, function(cm) {cm.refresh();}, true);\r\n    option(\"electricChars\", true);\r\n    option(\"rtlMoveVisually\", !windows);\r\n    option(\"wholeLineUpdateBefore\", true);\r\n  \r\n    option(\"theme\", \"default\", function(cm) {\r\n      themeChanged(cm);\r\n      guttersChanged(cm);\r\n    }, true);\r\n    option(\"keyMap\", \"default\", keyMapChanged);\r\n    option(\"extraKeys\", null);\r\n  \r\n    option(\"onKeyEvent\", null);\r\n    option(\"onDragEvent\", null);\r\n  \r\n    option(\"lineWrapping\", false, wrappingChanged, true);\r\n    option(\"gutters\", [], function(cm) {\r\n      setGuttersForLineNumbers(cm.options);\r\n      guttersChanged(cm);\r\n    }, true);\r\n    option(\"fixedGutter\", true, function(cm, val) {\r\n      cm.display.gutters.style.left = val ? compensateForHScroll(cm.display) + \"px\" : \"0\";\r\n      cm.refresh();\r\n    }, true);\r\n    option(\"coverGutterNextToScrollbar\", false, updateScrollbars, true);\r\n    option(\"lineNumbers\", false, function(cm) {\r\n      setGuttersForLineNumbers(cm.options);\r\n      guttersChanged(cm);\r\n    }, true);\r\n    option(\"firstLineNumber\", 1, guttersChanged, true);\r\n    option(\"lineNumberFormatter\", function(integer) {return integer;}, guttersChanged, true);\r\n    option(\"showCursorWhenSelecting\", false, updateSelection, true);\r\n  \r\n    option(\"resetSelectionOnContextMenu\", true);\r\n  \r\n    option(\"readOnly\", false, function(cm, val) {\r\n      if (val == \"nocursor\") {\r\n        onBlur(cm);\r\n        cm.display.input.blur();\r\n        cm.display.disabled = true;\r\n      } else {\r\n        cm.display.disabled = false;\r\n        if (!val) resetInput(cm, true);\r\n      }\r\n    });\r\n    option(\"dragDrop\", true);\r\n  \r\n    option(\"cursorBlinkRate\", 530);\r\n    option(\"cursorScrollMargin\", 0);\r\n    option(\"cursorHeight\", 1);\r\n    option(\"workTime\", 100);\r\n    option(\"workDelay\", 100);\r\n    option(\"flattenSpans\", true);\r\n    option(\"pollInterval\", 100);\r\n    option(\"undoDepth\", 40, function(cm, val){cm.doc.history.undoDepth = val;});\r\n    option(\"historyEventDelay\", 500);\r\n    option(\"viewportMargin\", 10, function(cm){cm.refresh();}, true);\r\n    option(\"maxHighlightLength\", 10000, function(cm){loadMode(cm); cm.refresh();}, true);\r\n    option(\"crudeMeasuringFrom\", 10000);\r\n    option(\"moveInputWithCursor\", true, function(cm, val) {\r\n      if (!val) cm.display.inputDiv.style.top = cm.display.inputDiv.style.left = 0;\r\n    });\r\n  \r\n    option(\"tabindex\", null, function(cm, val) {\r\n      cm.display.input.tabIndex = val || \"\";\r\n    });\r\n    option(\"autofocus\", null);\r\n  \r\n    // MODE DEFINITION AND QUERYING\r\n  \r\n    // Known modes, by name and by MIME\r\n    var modes = CodeMirror.modes = {}, mimeModes = CodeMirror.mimeModes = {};\r\n  \r\n    CodeMirror.defineMode = function(name, mode) {\r\n      if (!CodeMirror.defaults.mode && name != \"null\") CodeMirror.defaults.mode = name;\r\n      if (arguments.length > 2) {\r\n        mode.dependencies = [];\r\n        for (var i = 2; i < arguments.length; ++i) mode.dependencies.push(arguments[i]);\r\n      }\r\n      modes[name] = mode;\r\n    };\r\n  \r\n    CodeMirror.defineMIME = function(mime, spec) {\r\n      mimeModes[mime] = spec;\r\n    };\r\n  \r\n    CodeMirror.resolveMode = function(spec) {\r\n      if (typeof spec == \"string\" && mimeModes.hasOwnProperty(spec)) {\r\n        spec = mimeModes[spec];\r\n      } else if (spec && typeof spec.name == \"string\" && mimeModes.hasOwnProperty(spec.name)) {\r\n        var found = mimeModes[spec.name];\r\n        spec = createObj(found, spec);\r\n        spec.name = found.name;\r\n      } else if (typeof spec == \"string\" && /^[\\w\\-]+\\/[\\w\\-]+\\+xml$/.test(spec)) {\r\n        return CodeMirror.resolveMode(\"application/xml\");\r\n      }\r\n      if (typeof spec == \"string\") return {name: spec};\r\n      else return spec || {name: \"null\"};\r\n    };\r\n  \r\n    CodeMirror.getMode = function(options, spec) {\r\n      var spec = CodeMirror.resolveMode(spec);\r\n      var mfactory = modes[spec.name];\r\n      if (!mfactory) return CodeMirror.getMode(options, \"text/plain\");\r\n      var modeObj = mfactory(options, spec);\r\n      if (modeExtensions.hasOwnProperty(spec.name)) {\r\n        var exts = modeExtensions[spec.name];\r\n        for (var prop in exts) {\r\n          if (!exts.hasOwnProperty(prop)) continue;\r\n          if (modeObj.hasOwnProperty(prop)) modeObj[\"_\" + prop] = modeObj[prop];\r\n          modeObj[prop] = exts[prop];\r\n        }\r\n      }\r\n      modeObj.name = spec.name;\r\n  \r\n      return modeObj;\r\n    };\r\n  \r\n    CodeMirror.defineMode(\"null\", function() {\r\n      return {token: function(stream) {stream.skipToEnd();}};\r\n    });\r\n    CodeMirror.defineMIME(\"text/plain\", \"null\");\r\n  \r\n    var modeExtensions = CodeMirror.modeExtensions = {};\r\n    CodeMirror.extendMode = function(mode, properties) {\r\n      var exts = modeExtensions.hasOwnProperty(mode) ? modeExtensions[mode] : (modeExtensions[mode] = {});\r\n      copyObj(properties, exts);\r\n    };\r\n  \r\n    // EXTENSIONS\r\n  \r\n    CodeMirror.defineExtension = function(name, func) {\r\n      CodeMirror.prototype[name] = func;\r\n    };\r\n    CodeMirror.defineDocExtension = function(name, func) {\r\n      Doc.prototype[name] = func;\r\n    };\r\n    CodeMirror.defineOption = option;\r\n  \r\n    var initHooks = [];\r\n    CodeMirror.defineInitHook = function(f) {initHooks.push(f);};\r\n  \r\n    var helpers = CodeMirror.helpers = {};\r\n    CodeMirror.registerHelper = function(type, name, value) {\r\n      if (!helpers.hasOwnProperty(type)) helpers[type] = CodeMirror[type] = {};\r\n      helpers[type][name] = value;\r\n    };\r\n  \r\n    // UTILITIES\r\n  \r\n    CodeMirror.isWordChar = isWordChar;\r\n  \r\n    // MODE STATE HANDLING\r\n  \r\n    // Utility functions for working with state. Exported because modes\r\n    // sometimes need to do this.\r\n    function copyState(mode, state) {\r\n      if (state === true) return state;\r\n      if (mode.copyState) return mode.copyState(state);\r\n      var nstate = {};\r\n      for (var n in state) {\r\n        var val = state[n];\r\n        if (val instanceof Array) val = val.concat([]);\r\n        nstate[n] = val;\r\n      }\r\n      return nstate;\r\n    }\r\n    CodeMirror.copyState = copyState;\r\n  \r\n    function startState(mode, a1, a2) {\r\n      return mode.startState ? mode.startState(a1, a2) : true;\r\n    }\r\n    CodeMirror.startState = startState;\r\n  \r\n    CodeMirror.innerMode = function(mode, state) {\r\n      while (mode.innerMode) {\r\n        var info = mode.innerMode(state);\r\n        if (!info || info.mode == mode) break;\r\n        state = info.state;\r\n        mode = info.mode;\r\n      }\r\n      return info || {mode: mode, state: state};\r\n    };\r\n  \r\n    // STANDARD COMMANDS\r\n  \r\n    var commands = CodeMirror.commands = {\r\n      selectAll: function(cm) {cm.setSelection(Pos(cm.firstLine(), 0), Pos(cm.lastLine()));},\r\n      killLine: function(cm) {\r\n        var from = cm.getCursor(true), to = cm.getCursor(false), sel = !posEq(from, to);\r\n        if (!sel && cm.getLine(from.line).length == from.ch)\r\n          cm.replaceRange(\"\", from, Pos(from.line + 1, 0), \"+delete\");\r\n        else cm.replaceRange(\"\", from, sel ? to : Pos(from.line), \"+delete\");\r\n      },\r\n      deleteLine: function(cm) {\r\n        var l = cm.getCursor().line;\r\n        cm.replaceRange(\"\", Pos(l, 0), Pos(l), \"+delete\");\r\n      },\r\n      delLineLeft: function(cm) {\r\n        var cur = cm.getCursor();\r\n        cm.replaceRange(\"\", Pos(cur.line, 0), cur, \"+delete\");\r\n      },\r\n      undo: function(cm) {cm.undo();},\r\n      redo: function(cm) {cm.redo();},\r\n      goDocStart: function(cm) {cm.extendSelection(Pos(cm.firstLine(), 0));},\r\n      goDocEnd: function(cm) {cm.extendSelection(Pos(cm.lastLine()));},\r\n      goLineStart: function(cm) {\r\n        cm.extendSelection(lineStart(cm, cm.getCursor().line));\r\n      },\r\n      goLineStartSmart: function(cm) {\r\n        var cur = cm.getCursor(), start = lineStart(cm, cur.line);\r\n        var line = cm.getLineHandle(start.line);\r\n        var order = getOrder(line);\r\n        if (!order || order[0].level == 0) {\r\n          var firstNonWS = Math.max(0, line.text.search(/\\S/));\r\n          var inWS = cur.line == start.line && cur.ch <= firstNonWS && cur.ch;\r\n          cm.extendSelection(Pos(start.line, inWS ? 0 : firstNonWS));\r\n        } else cm.extendSelection(start);\r\n      },\r\n      goLineEnd: function(cm) {\r\n        cm.extendSelection(lineEnd(cm, cm.getCursor().line));\r\n      },\r\n      goLineRight: function(cm) {\r\n        var top = cm.charCoords(cm.getCursor(), \"div\").top + 5;\r\n        cm.extendSelection(cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\"));\r\n      },\r\n      goLineLeft: function(cm) {\r\n        var top = cm.charCoords(cm.getCursor(), \"div\").top + 5;\r\n        cm.extendSelection(cm.coordsChar({left: 0, top: top}, \"div\"));\r\n      },\r\n      goLineUp: function(cm) {cm.moveV(-1, \"line\");},\r\n      goLineDown: function(cm) {cm.moveV(1, \"line\");},\r\n      goPageUp: function(cm) {cm.moveV(-1, \"page\");},\r\n      goPageDown: function(cm) {cm.moveV(1, \"page\");},\r\n      goCharLeft: function(cm) {cm.moveH(-1, \"char\");},\r\n      goCharRight: function(cm) {cm.moveH(1, \"char\");},\r\n      goColumnLeft: function(cm) {cm.moveH(-1, \"column\");},\r\n      goColumnRight: function(cm) {cm.moveH(1, \"column\");},\r\n      goWordLeft: function(cm) {cm.moveH(-1, \"word\");},\r\n      goGroupRight: function(cm) {cm.moveH(1, \"group\");},\r\n      goGroupLeft: function(cm) {cm.moveH(-1, \"group\");},\r\n      goWordRight: function(cm) {cm.moveH(1, \"word\");},\r\n      delCharBefore: function(cm) {cm.deleteH(-1, \"char\");},\r\n      delCharAfter: function(cm) {cm.deleteH(1, \"char\");},\r\n      delWordBefore: function(cm) {cm.deleteH(-1, \"word\");},\r\n      delWordAfter: function(cm) {cm.deleteH(1, \"word\");},\r\n      delGroupBefore: function(cm) {cm.deleteH(-1, \"group\");},\r\n      delGroupAfter: function(cm) {cm.deleteH(1, \"group\");},\r\n      indentAuto: function(cm) {cm.indentSelection(\"smart\");},\r\n      indentMore: function(cm) {cm.indentSelection(\"add\");},\r\n      indentLess: function(cm) {cm.indentSelection(\"subtract\");},\r\n      insertTab: function(cm) {cm.replaceSelection(\"\\t\", \"end\", \"+input\");},\r\n      defaultTab: function(cm) {\r\n        if (cm.somethingSelected()) cm.indentSelection(\"add\");\r\n        else cm.replaceSelection(\"\\t\", \"end\", \"+input\");\r\n      },\r\n      transposeChars: function(cm) {\r\n        var cur = cm.getCursor(), line = cm.getLine(cur.line);\r\n        if (cur.ch > 0 && cur.ch < line.length - 1)\r\n          cm.replaceRange(line.charAt(cur.ch) + line.charAt(cur.ch - 1),\r\n                          Pos(cur.line, cur.ch - 1), Pos(cur.line, cur.ch + 1));\r\n      },\r\n      newlineAndIndent: function(cm) {\r\n        operation(cm, function() {\r\n          cm.replaceSelection(\"\\n\", \"end\", \"+input\");\r\n          cm.indentLine(cm.getCursor().line, null, true);\r\n        })();\r\n      },\r\n      toggleOverwrite: function(cm) {cm.toggleOverwrite();}\r\n    };\r\n  \r\n    // STANDARD KEYMAPS\r\n  \r\n    var keyMap = CodeMirror.keyMap = {};\r\n    keyMap.basic = {\r\n      \"Left\": \"goCharLeft\", \"Right\": \"goCharRight\", \"Up\": \"goLineUp\", \"Down\": \"goLineDown\",\r\n      \"End\": \"goLineEnd\", \"Home\": \"goLineStartSmart\", \"PageUp\": \"goPageUp\", \"PageDown\": \"goPageDown\",\r\n      \"Delete\": \"delCharAfter\", \"Backspace\": \"delCharBefore\", \"Shift-Backspace\": \"delCharBefore\",\r\n      \"Tab\": \"defaultTab\", \"Shift-Tab\": \"indentAuto\",\r\n      \"Enter\": \"newlineAndIndent\", \"Insert\": \"toggleOverwrite\"\r\n    };\r\n    // Note that the save and find-related commands aren't defined by\r\n    // default. Unknown commands are simply ignored.\r\n    keyMap.pcDefault = {\r\n      \"Ctrl-A\": \"selectAll\", \"Ctrl-D\": \"deleteLine\", \"Ctrl-Z\": \"undo\", \"Shift-Ctrl-Z\": \"redo\", \"Ctrl-Y\": \"redo\",\r\n      \"Ctrl-Home\": \"goDocStart\", \"Alt-Up\": \"goDocStart\", \"Ctrl-End\": \"goDocEnd\", \"Ctrl-Down\": \"goDocEnd\",\r\n      \"Ctrl-Left\": \"goGroupLeft\", \"Ctrl-Right\": \"goGroupRight\", \"Alt-Left\": \"goLineStart\", \"Alt-Right\": \"goLineEnd\",\r\n      \"Ctrl-Backspace\": \"delGroupBefore\", \"Ctrl-Delete\": \"delGroupAfter\", \"Ctrl-S\": \"save\", \"Ctrl-F\": \"find\",\r\n      \"Ctrl-G\": \"findNext\", \"Shift-Ctrl-G\": \"findPrev\", \"Shift-Ctrl-F\": \"replace\", \"Shift-Ctrl-R\": \"replaceAll\",\r\n      \"Ctrl-[\": \"indentLess\", \"Ctrl-]\": \"indentMore\",\r\n      fallthrough: \"basic\"\r\n    };\r\n    keyMap.macDefault = {\r\n      \"Cmd-A\": \"selectAll\", \"Cmd-D\": \"deleteLine\", \"Cmd-Z\": \"undo\", \"Shift-Cmd-Z\": \"redo\", \"Cmd-Y\": \"redo\",\r\n      \"Cmd-Up\": \"goDocStart\", \"Cmd-End\": \"goDocEnd\", \"Cmd-Down\": \"goDocEnd\", \"Alt-Left\": \"goGroupLeft\",\r\n      \"Alt-Right\": \"goGroupRight\", \"Cmd-Left\": \"goLineStart\", \"Cmd-Right\": \"goLineEnd\", \"Alt-Backspace\": \"delGroupBefore\",\r\n      \"Ctrl-Alt-Backspace\": \"delGroupAfter\", \"Alt-Delete\": \"delGroupAfter\", \"Cmd-S\": \"save\", \"Cmd-F\": \"find\",\r\n      \"Cmd-G\": \"findNext\", \"Shift-Cmd-G\": \"findPrev\", \"Cmd-Alt-F\": \"replace\", \"Shift-Cmd-Alt-F\": \"replaceAll\",\r\n      \"Cmd-[\": \"indentLess\", \"Cmd-]\": \"indentMore\", \"Cmd-Backspace\": \"delLineLeft\",\r\n      fallthrough: [\"basic\", \"emacsy\"]\r\n    };\r\n    keyMap[\"default\"] = mac ? keyMap.macDefault : keyMap.pcDefault;\r\n    keyMap.emacsy = {\r\n      \"Ctrl-F\": \"goCharRight\", \"Ctrl-B\": \"goCharLeft\", \"Ctrl-P\": \"goLineUp\", \"Ctrl-N\": \"goLineDown\",\r\n      \"Alt-F\": \"goWordRight\", \"Alt-B\": \"goWordLeft\", \"Ctrl-A\": \"goLineStart\", \"Ctrl-E\": \"goLineEnd\",\r\n      \"Ctrl-V\": \"goPageDown\", \"Shift-Ctrl-V\": \"goPageUp\", \"Ctrl-D\": \"delCharAfter\", \"Ctrl-H\": \"delCharBefore\",\r\n      \"Alt-D\": \"delWordAfter\", \"Alt-Backspace\": \"delWordBefore\", \"Ctrl-K\": \"killLine\", \"Ctrl-T\": \"transposeChars\"\r\n    };\r\n  \r\n    // KEYMAP DISPATCH\r\n  \r\n    function getKeyMap(val) {\r\n      if (typeof val == \"string\") return keyMap[val];\r\n      else return val;\r\n    }\r\n  \r\n    function lookupKey(name, maps, handle) {\r\n      function lookup(map) {\r\n        map = getKeyMap(map);\r\n        var found = map[name];\r\n        if (found === false) return \"stop\";\r\n        if (found != null && handle(found)) return true;\r\n        if (map.nofallthrough) return \"stop\";\r\n  \r\n        var fallthrough = map.fallthrough;\r\n        if (fallthrough == null) return false;\r\n        if (Object.prototype.toString.call(fallthrough) != \"[object Array]\")\r\n          return lookup(fallthrough);\r\n        for (var i = 0, e = fallthrough.length; i < e; ++i) {\r\n          var done = lookup(fallthrough[i]);\r\n          if (done) return done;\r\n        }\r\n        return false;\r\n      }\r\n  \r\n      for (var i = 0; i < maps.length; ++i) {\r\n        var done = lookup(maps[i]);\r\n        if (done) return done != \"stop\";\r\n      }\r\n    }\r\n    function isModifierKey(event) {\r\n      var name = keyNames[event.keyCode];\r\n      return name == \"Ctrl\" || name == \"Alt\" || name == \"Shift\" || name == \"Mod\";\r\n    }\r\n    function keyName(event, noShift) {\r\n      if (opera && event.keyCode == 34 && event[\"char\"]) return false;\r\n      var name = keyNames[event.keyCode];\r\n      if (name == null || event.altGraphKey) return false;\r\n      if (event.altKey) name = \"Alt-\" + name;\r\n      if (flipCtrlCmd ? event.metaKey : event.ctrlKey) name = \"Ctrl-\" + name;\r\n      if (flipCtrlCmd ? event.ctrlKey : event.metaKey) name = \"Cmd-\" + name;\r\n      if (!noShift && event.shiftKey) name = \"Shift-\" + name;\r\n      return name;\r\n    }\r\n    CodeMirror.lookupKey = lookupKey;\r\n    CodeMirror.isModifierKey = isModifierKey;\r\n    CodeMirror.keyName = keyName;\r\n  \r\n    // FROMTEXTAREA\r\n  \r\n    CodeMirror.fromTextArea = function(textarea, options) {\r\n      if (!options) options = {};\r\n      options.value = textarea.value;\r\n      if (!options.tabindex && textarea.tabindex)\r\n        options.tabindex = textarea.tabindex;\r\n      if (!options.placeholder && textarea.placeholder)\r\n        options.placeholder = textarea.placeholder;\r\n      // Set autofocus to true if this textarea is focused, or if it has\r\n      // autofocus and no other element is focused.\r\n      if (options.autofocus == null) {\r\n        var hasFocus = document.body;\r\n        // doc.activeElement occasionally throws on IE\r\n        try { hasFocus = document.activeElement; } catch(e) {}\r\n        options.autofocus = hasFocus == textarea ||\r\n          textarea.getAttribute(\"autofocus\") != null && hasFocus == document.body;\r\n      }\r\n  \r\n      function save() {textarea.value = cm.getValue();}\r\n      if (textarea.form) {\r\n        on(textarea.form, \"submit\", save);\r\n        // Deplorable hack to make the submit method do the right thing.\r\n        if (!options.leaveSubmitMethodAlone) {\r\n          var form = textarea.form, realSubmit = form.submit;\r\n          try {\r\n            var wrappedSubmit = form.submit = function() {\r\n              save();\r\n              form.submit = realSubmit;\r\n              form.submit();\r\n              form.submit = wrappedSubmit;\r\n            };\r\n          } catch(e) {}\r\n        }\r\n      }\r\n  \r\n      textarea.style.display = \"none\";\r\n      var cm = CodeMirror(function(node) {\r\n        textarea.parentNode.insertBefore(node, textarea.nextSibling);\r\n      }, options);\r\n      cm.save = save;\r\n      cm.getTextArea = function() { return textarea; };\r\n      cm.toTextArea = function() {\r\n        save();\r\n        textarea.parentNode.removeChild(cm.getWrapperElement());\r\n        textarea.style.display = \"\";\r\n        if (textarea.form) {\r\n          off(textarea.form, \"submit\", save);\r\n          if (typeof textarea.form.submit == \"function\")\r\n            textarea.form.submit = realSubmit;\r\n        }\r\n      };\r\n      return cm;\r\n    };\r\n  \r\n    // STRING STREAM\r\n  \r\n    // Fed to the mode parsers, provides helper functions to make\r\n    // parsers more succinct.\r\n  \r\n    // The character stream used by a mode's parser.\r\n    function StringStream(string, tabSize) {\r\n      this.pos = this.start = 0;\r\n      this.string = string;\r\n      this.tabSize = tabSize || 8;\r\n      this.lastColumnPos = this.lastColumnValue = 0;\r\n    }\r\n  \r\n    StringStream.prototype = {\r\n      eol: function() {return this.pos >= this.string.length;},\r\n      sol: function() {return this.pos == 0;},\r\n      peek: function() {return this.string.charAt(this.pos) || undefined;},\r\n      next: function() {\r\n        if (this.pos < this.string.length)\r\n          return this.string.charAt(this.pos++);\r\n      },\r\n      eat: function(match) {\r\n        var ch = this.string.charAt(this.pos);\r\n        if (typeof match == \"string\") var ok = ch == match;\r\n        else var ok = ch && (match.test ? match.test(ch) : match(ch));\r\n        if (ok) {++this.pos; return ch;}\r\n      },\r\n      eatWhile: function(match) {\r\n        var start = this.pos;\r\n        while (this.eat(match)){}\r\n        return this.pos > start;\r\n      },\r\n      eatSpace: function() {\r\n        var start = this.pos;\r\n        while (/[\\s\\u00a0]/.test(this.string.charAt(this.pos))) ++this.pos;\r\n        return this.pos > start;\r\n      },\r\n      skipToEnd: function() {this.pos = this.string.length;},\r\n      skipTo: function(ch) {\r\n        var found = this.string.indexOf(ch, this.pos);\r\n        if (found > -1) {this.pos = found; return true;}\r\n      },\r\n      backUp: function(n) {this.pos -= n;},\r\n      column: function() {\r\n        if (this.lastColumnPos < this.start) {\r\n          this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);\r\n          this.lastColumnPos = this.start;\r\n        }\r\n        return this.lastColumnValue;\r\n      },\r\n      indentation: function() {return countColumn(this.string, null, this.tabSize);},\r\n      match: function(pattern, consume, caseInsensitive) {\r\n        if (typeof pattern == \"string\") {\r\n          var cased = function(str) {return caseInsensitive ? str.toLowerCase() : str;};\r\n          var substr = this.string.substr(this.pos, pattern.length);\r\n          if (cased(substr) == cased(pattern)) {\r\n            if (consume !== false) this.pos += pattern.length;\r\n            return true;\r\n          }\r\n        } else {\r\n          var match = this.string.slice(this.pos).match(pattern);\r\n          if (match && match.index > 0) return null;\r\n          if (match && consume !== false) this.pos += match[0].length;\r\n          return match;\r\n        }\r\n      },\r\n      current: function(){return this.string.slice(this.start, this.pos);}\r\n    };\r\n    CodeMirror.StringStream = StringStream;\r\n  \r\n    // TEXTMARKERS\r\n  \r\n    function TextMarker(doc, type) {\r\n      this.lines = [];\r\n      this.type = type;\r\n      this.doc = doc;\r\n    }\r\n    CodeMirror.TextMarker = TextMarker;\r\n    eventMixin(TextMarker);\r\n  \r\n    TextMarker.prototype.clear = function() {\r\n      if (this.explicitlyCleared) return;\r\n      var cm = this.doc.cm, withOp = cm && !cm.curOp;\r\n      if (withOp) startOperation(cm);\r\n      if (hasHandler(this, \"clear\")) {\r\n        var found = this.find();\r\n        if (found) signalLater(this, \"clear\", found.from, found.to);\r\n      }\r\n      var min = null, max = null;\r\n      for (var i = 0; i < this.lines.length; ++i) {\r\n        var line = this.lines[i];\r\n        var span = getMarkedSpanFor(line.markedSpans, this);\r\n        if (span.to != null) max = lineNo(line);\r\n        line.markedSpans = removeMarkedSpan(line.markedSpans, span);\r\n        if (span.from != null)\r\n          min = lineNo(line);\r\n        else if (this.collapsed && !lineIsHidden(this.doc, line) && cm)\r\n          updateLineHeight(line, textHeight(cm.display));\r\n      }\r\n      if (cm && this.collapsed && !cm.options.lineWrapping) for (var i = 0; i < this.lines.length; ++i) {\r\n        var visual = visualLine(cm.doc, this.lines[i]), len = lineLength(cm.doc, visual);\r\n        if (len > cm.display.maxLineLength) {\r\n          cm.display.maxLine = visual;\r\n          cm.display.maxLineLength = len;\r\n          cm.display.maxLineChanged = true;\r\n        }\r\n      }\r\n  \r\n      if (min != null && cm) regChange(cm, min, max + 1);\r\n      this.lines.length = 0;\r\n      this.explicitlyCleared = true;\r\n      if (this.atomic && this.doc.cantEdit) {\r\n        this.doc.cantEdit = false;\r\n        if (cm) reCheckSelection(cm);\r\n      }\r\n      if (withOp) endOperation(cm);\r\n    };\r\n  \r\n    TextMarker.prototype.find = function() {\r\n      var from, to;\r\n      for (var i = 0; i < this.lines.length; ++i) {\r\n        var line = this.lines[i];\r\n        var span = getMarkedSpanFor(line.markedSpans, this);\r\n        if (span.from != null || span.to != null) {\r\n          var found = lineNo(line);\r\n          if (span.from != null) from = Pos(found, span.from);\r\n          if (span.to != null) to = Pos(found, span.to);\r\n        }\r\n      }\r\n      if (this.type == \"bookmark\") return from;\r\n      return from && {from: from, to: to};\r\n    };\r\n  \r\n    TextMarker.prototype.changed = function() {\r\n      var pos = this.find(), cm = this.doc.cm;\r\n      if (!pos || !cm) return;\r\n      if (this.type != \"bookmark\") pos = pos.from;\r\n      var line = getLine(this.doc, pos.line);\r\n      clearCachedMeasurement(cm, line);\r\n      if (pos.line >= cm.display.showingFrom && pos.line < cm.display.showingTo) {\r\n        for (var node = cm.display.lineDiv.firstChild; node; node = node.nextSibling) if (node.lineObj == line) {\r\n          if (node.offsetHeight != line.height) updateLineHeight(line, node.offsetHeight);\r\n          break;\r\n        }\r\n        runInOp(cm, function() {\r\n          cm.curOp.selectionChanged = cm.curOp.forceUpdate = cm.curOp.updateMaxLine = true;\r\n        });\r\n      }\r\n    };\r\n  \r\n    TextMarker.prototype.attachLine = function(line) {\r\n      if (!this.lines.length && this.doc.cm) {\r\n        var op = this.doc.cm.curOp;\r\n        if (!op.maybeHiddenMarkers || indexOf(op.maybeHiddenMarkers, this) == -1)\r\n          (op.maybeUnhiddenMarkers || (op.maybeUnhiddenMarkers = [])).push(this);\r\n      }\r\n      this.lines.push(line);\r\n    };\r\n    TextMarker.prototype.detachLine = function(line) {\r\n      this.lines.splice(indexOf(this.lines, line), 1);\r\n      if (!this.lines.length && this.doc.cm) {\r\n        var op = this.doc.cm.curOp;\r\n        (op.maybeHiddenMarkers || (op.maybeHiddenMarkers = [])).push(this);\r\n      }\r\n    };\r\n  \r\n    function markText(doc, from, to, options, type) {\r\n      if (options && options.shared) return markTextShared(doc, from, to, options, type);\r\n      if (doc.cm && !doc.cm.curOp) return operation(doc.cm, markText)(doc, from, to, options, type);\r\n  \r\n      var marker = new TextMarker(doc, type);\r\n      if (posLess(to, from) || posEq(from, to) && type == \"range\" &&\r\n          !(options.inclusiveLeft && options.inclusiveRight))\r\n        return marker;\r\n      if (options) copyObj(options, marker);\r\n      if (marker.replacedWith) {\r\n        marker.collapsed = true;\r\n        marker.replacedWith = elt(\"span\", [marker.replacedWith], \"CodeMirror-widget\");\r\n        if (!options.handleMouseEvents) marker.replacedWith.ignoreEvents = true;\r\n      }\r\n      if (marker.collapsed) sawCollapsedSpans = true;\r\n  \r\n      if (marker.addToHistory)\r\n        addToHistory(doc, {from: from, to: to, origin: \"markText\"},\r\n                     {head: doc.sel.head, anchor: doc.sel.anchor}, NaN);\r\n  \r\n      var curLine = from.line, size = 0, collapsedAtStart, collapsedAtEnd, cm = doc.cm, updateMaxLine;\r\n      doc.iter(curLine, to.line + 1, function(line) {\r\n        if (cm && marker.collapsed && !cm.options.lineWrapping && visualLine(doc, line) == cm.display.maxLine)\r\n          updateMaxLine = true;\r\n        var span = {from: null, to: null, marker: marker};\r\n        size += line.text.length;\r\n        if (curLine == from.line) {span.from = from.ch; size -= from.ch;}\r\n        if (curLine == to.line) {span.to = to.ch; size -= line.text.length - to.ch;}\r\n        if (marker.collapsed) {\r\n          if (curLine == to.line) collapsedAtEnd = collapsedSpanAt(line, to.ch);\r\n          if (curLine == from.line) collapsedAtStart = collapsedSpanAt(line, from.ch);\r\n          else updateLineHeight(line, 0);\r\n        }\r\n        addMarkedSpan(line, span);\r\n        ++curLine;\r\n      });\r\n      if (marker.collapsed) doc.iter(from.line, to.line + 1, function(line) {\r\n        if (lineIsHidden(doc, line)) updateLineHeight(line, 0);\r\n      });\r\n  \r\n      if (marker.clearOnEnter) on(marker, \"beforeCursorEnter\", function() { marker.clear(); });\r\n  \r\n      if (marker.readOnly) {\r\n        sawReadOnlySpans = true;\r\n        if (doc.history.done.length || doc.history.undone.length)\r\n          doc.clearHistory();\r\n      }\r\n      if (marker.collapsed) {\r\n        if (collapsedAtStart != collapsedAtEnd)\r\n          throw new Error(\"Inserting collapsed marker overlapping an existing one\");\r\n        marker.size = size;\r\n        marker.atomic = true;\r\n      }\r\n      if (cm) {\r\n        if (updateMaxLine) cm.curOp.updateMaxLine = true;\r\n        if (marker.className || marker.title || marker.startStyle || marker.endStyle || marker.collapsed)\r\n          regChange(cm, from.line, to.line + 1);\r\n        if (marker.atomic) reCheckSelection(cm);\r\n      }\r\n      return marker;\r\n    }\r\n  \r\n    // SHARED TEXTMARKERS\r\n  \r\n    function SharedTextMarker(markers, primary) {\r\n      this.markers = markers;\r\n      this.primary = primary;\r\n      for (var i = 0, me = this; i < markers.length; ++i) {\r\n        markers[i].parent = this;\r\n        on(markers[i], \"clear\", function(){me.clear();});\r\n      }\r\n    }\r\n    CodeMirror.SharedTextMarker = SharedTextMarker;\r\n    eventMixin(SharedTextMarker);\r\n  \r\n    SharedTextMarker.prototype.clear = function() {\r\n      if (this.explicitlyCleared) return;\r\n      this.explicitlyCleared = true;\r\n      for (var i = 0; i < this.markers.length; ++i)\r\n        this.markers[i].clear();\r\n      signalLater(this, \"clear\");\r\n    };\r\n    SharedTextMarker.prototype.find = function() {\r\n      return this.primary.find();\r\n    };\r\n  \r\n    function markTextShared(doc, from, to, options, type) {\r\n      options = copyObj(options);\r\n      options.shared = false;\r\n      var markers = [markText(doc, from, to, options, type)], primary = markers[0];\r\n      var widget = options.replacedWith;\r\n      linkedDocs(doc, function(doc) {\r\n        if (widget) options.replacedWith = widget.cloneNode(true);\r\n        markers.push(markText(doc, clipPos(doc, from), clipPos(doc, to), options, type));\r\n        for (var i = 0; i < doc.linked.length; ++i)\r\n          if (doc.linked[i].isParent) return;\r\n        primary = lst(markers);\r\n      });\r\n      return new SharedTextMarker(markers, primary);\r\n    }\r\n  \r\n    // TEXTMARKER SPANS\r\n  \r\n    function getMarkedSpanFor(spans, marker) {\r\n      if (spans) for (var i = 0; i < spans.length; ++i) {\r\n        var span = spans[i];\r\n        if (span.marker == marker) return span;\r\n      }\r\n    }\r\n    function removeMarkedSpan(spans, span) {\r\n      for (var r, i = 0; i < spans.length; ++i)\r\n        if (spans[i] != span) (r || (r = [])).push(spans[i]);\r\n      return r;\r\n    }\r\n    function addMarkedSpan(line, span) {\r\n      line.markedSpans = line.markedSpans ? line.markedSpans.concat([span]) : [span];\r\n      span.marker.attachLine(line);\r\n    }\r\n  \r\n    function markedSpansBefore(old, startCh, isInsert) {\r\n      if (old) for (var i = 0, nw; i < old.length; ++i) {\r\n        var span = old[i], marker = span.marker;\r\n        var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= startCh : span.from < startCh);\r\n        if (startsBefore ||\r\n            (marker.inclusiveLeft && marker.inclusiveRight || marker.type == \"bookmark\") &&\r\n            span.from == startCh && (!isInsert || !span.marker.insertLeft)) {\r\n          var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= startCh : span.to > startCh);\r\n          (nw || (nw = [])).push({from: span.from,\r\n                                  to: endsAfter ? null : span.to,\r\n                                  marker: marker});\r\n        }\r\n      }\r\n      return nw;\r\n    }\r\n  \r\n    function markedSpansAfter(old, endCh, isInsert) {\r\n      if (old) for (var i = 0, nw; i < old.length; ++i) {\r\n        var span = old[i], marker = span.marker;\r\n        var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= endCh : span.to > endCh);\r\n        if (endsAfter || marker.type == \"bookmark\" && span.from == endCh && (!isInsert || span.marker.insertLeft)) {\r\n          var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= endCh : span.from < endCh);\r\n          (nw || (nw = [])).push({from: startsBefore ? null : span.from - endCh,\r\n                                  to: span.to == null ? null : span.to - endCh,\r\n                                  marker: marker});\r\n        }\r\n      }\r\n      return nw;\r\n    }\r\n  \r\n    function stretchSpansOverChange(doc, change) {\r\n      var oldFirst = isLine(doc, change.from.line) && getLine(doc, change.from.line).markedSpans;\r\n      var oldLast = isLine(doc, change.to.line) && getLine(doc, change.to.line).markedSpans;\r\n      if (!oldFirst && !oldLast) return null;\r\n  \r\n      var startCh = change.from.ch, endCh = change.to.ch, isInsert = posEq(change.from, change.to);\r\n      // Get the spans that 'stick out' on both sides\r\n      var first = markedSpansBefore(oldFirst, startCh, isInsert);\r\n      var last = markedSpansAfter(oldLast, endCh, isInsert);\r\n  \r\n      // Next, merge those two ends\r\n      var sameLine = change.text.length == 1, offset = lst(change.text).length + (sameLine ? startCh : 0);\r\n      if (first) {\r\n        // Fix up .to properties of first\r\n        for (var i = 0; i < first.length; ++i) {\r\n          var span = first[i];\r\n          if (span.to == null) {\r\n            var found = getMarkedSpanFor(last, span.marker);\r\n            if (!found) span.to = startCh;\r\n            else if (sameLine) span.to = found.to == null ? null : found.to + offset;\r\n          }\r\n        }\r\n      }\r\n      if (last) {\r\n        // Fix up .from in last (or move them into first in case of sameLine)\r\n        for (var i = 0; i < last.length; ++i) {\r\n          var span = last[i];\r\n          if (span.to != null) span.to += offset;\r\n          if (span.from == null) {\r\n            var found = getMarkedSpanFor(first, span.marker);\r\n            if (!found) {\r\n              span.from = offset;\r\n              if (sameLine) (first || (first = [])).push(span);\r\n            }\r\n          } else {\r\n            span.from += offset;\r\n            if (sameLine) (first || (first = [])).push(span);\r\n          }\r\n        }\r\n      }\r\n      if (sameLine && first) {\r\n        // Make sure we didn't create any zero-length spans\r\n        for (var i = 0; i < first.length; ++i)\r\n          if (first[i].from != null && first[i].from == first[i].to && first[i].marker.type != \"bookmark\")\r\n            first.splice(i--, 1);\r\n        if (!first.length) first = null;\r\n      }\r\n  \r\n      var newMarkers = [first];\r\n      if (!sameLine) {\r\n        // Fill gap with whole-line-spans\r\n        var gap = change.text.length - 2, gapMarkers;\r\n        if (gap > 0 && first)\r\n          for (var i = 0; i < first.length; ++i)\r\n            if (first[i].to == null)\r\n              (gapMarkers || (gapMarkers = [])).push({from: null, to: null, marker: first[i].marker});\r\n        for (var i = 0; i < gap; ++i)\r\n          newMarkers.push(gapMarkers);\r\n        newMarkers.push(last);\r\n      }\r\n      return newMarkers;\r\n    }\r\n  \r\n    function mergeOldSpans(doc, change) {\r\n      var old = getOldSpans(doc, change);\r\n      var stretched = stretchSpansOverChange(doc, change);\r\n      if (!old) return stretched;\r\n      if (!stretched) return old;\r\n  \r\n      for (var i = 0; i < old.length; ++i) {\r\n        var oldCur = old[i], stretchCur = stretched[i];\r\n        if (oldCur && stretchCur) {\r\n          spans: for (var j = 0; j < stretchCur.length; ++j) {\r\n            var span = stretchCur[j];\r\n            for (var k = 0; k < oldCur.length; ++k)\r\n              if (oldCur[k].marker == span.marker) continue spans;\r\n            oldCur.push(span);\r\n          }\r\n        } else if (stretchCur) {\r\n          old[i] = stretchCur;\r\n        }\r\n      }\r\n      return old;\r\n    }\r\n  \r\n    function removeReadOnlyRanges(doc, from, to) {\r\n      var markers = null;\r\n      doc.iter(from.line, to.line + 1, function(line) {\r\n        if (line.markedSpans) for (var i = 0; i < line.markedSpans.length; ++i) {\r\n          var mark = line.markedSpans[i].marker;\r\n          if (mark.readOnly && (!markers || indexOf(markers, mark) == -1))\r\n            (markers || (markers = [])).push(mark);\r\n        }\r\n      });\r\n      if (!markers) return null;\r\n      var parts = [{from: from, to: to}];\r\n      for (var i = 0; i < markers.length; ++i) {\r\n        var mk = markers[i], m = mk.find();\r\n        for (var j = 0; j < parts.length; ++j) {\r\n          var p = parts[j];\r\n          if (posLess(p.to, m.from) || posLess(m.to, p.from)) continue;\r\n          var newParts = [j, 1];\r\n          if (posLess(p.from, m.from) || !mk.inclusiveLeft && posEq(p.from, m.from))\r\n            newParts.push({from: p.from, to: m.from});\r\n          if (posLess(m.to, p.to) || !mk.inclusiveRight && posEq(p.to, m.to))\r\n            newParts.push({from: m.to, to: p.to});\r\n          parts.splice.apply(parts, newParts);\r\n          j += newParts.length - 1;\r\n        }\r\n      }\r\n      return parts;\r\n    }\r\n  \r\n    function collapsedSpanAt(line, ch) {\r\n      var sps = sawCollapsedSpans && line.markedSpans, found;\r\n      if (sps) for (var sp, i = 0; i < sps.length; ++i) {\r\n        sp = sps[i];\r\n        if (!sp.marker.collapsed) continue;\r\n        if ((sp.from == null || sp.from < ch) &&\r\n            (sp.to == null || sp.to > ch) &&\r\n            (!found || found.width < sp.marker.width))\r\n          found = sp.marker;\r\n      }\r\n      return found;\r\n    }\r\n    function collapsedSpanAtStart(line) { return collapsedSpanAt(line, -1); }\r\n    function collapsedSpanAtEnd(line) { return collapsedSpanAt(line, line.text.length + 1); }\r\n  \r\n    function visualLine(doc, line) {\r\n      var merged;\r\n      while (merged = collapsedSpanAtStart(line))\r\n        line = getLine(doc, merged.find().from.line);\r\n      return line;\r\n    }\r\n  \r\n    function lineIsHidden(doc, line) {\r\n      var sps = sawCollapsedSpans && line.markedSpans;\r\n      if (sps) for (var sp, i = 0; i < sps.length; ++i) {\r\n        sp = sps[i];\r\n        if (!sp.marker.collapsed) continue;\r\n        if (sp.from == null) return true;\r\n        if (sp.marker.replacedWith) continue;\r\n        if (sp.from == 0 && sp.marker.inclusiveLeft && lineIsHiddenInner(doc, line, sp))\r\n          return true;\r\n      }\r\n    }\r\n    function lineIsHiddenInner(doc, line, span) {\r\n      if (span.to == null) {\r\n        var end = span.marker.find().to, endLine = getLine(doc, end.line);\r\n        return lineIsHiddenInner(doc, endLine, getMarkedSpanFor(endLine.markedSpans, span.marker));\r\n      }\r\n      if (span.marker.inclusiveRight && span.to == line.text.length)\r\n        return true;\r\n      for (var sp, i = 0; i < line.markedSpans.length; ++i) {\r\n        sp = line.markedSpans[i];\r\n        if (sp.marker.collapsed && !sp.marker.replacedWith && sp.from == span.to &&\r\n            (sp.marker.inclusiveLeft || span.marker.inclusiveRight) &&\r\n            lineIsHiddenInner(doc, line, sp)) return true;\r\n      }\r\n    }\r\n  \r\n    function detachMarkedSpans(line) {\r\n      var spans = line.markedSpans;\r\n      if (!spans) return;\r\n      for (var i = 0; i < spans.length; ++i)\r\n        spans[i].marker.detachLine(line);\r\n      line.markedSpans = null;\r\n    }\r\n  \r\n    function attachMarkedSpans(line, spans) {\r\n      if (!spans) return;\r\n      for (var i = 0; i < spans.length; ++i)\r\n        spans[i].marker.attachLine(line);\r\n      line.markedSpans = spans;\r\n    }\r\n  \r\n    // LINE WIDGETS\r\n  \r\n    var LineWidget = CodeMirror.LineWidget = function(cm, node, options) {\r\n      if (options) for (var opt in options) if (options.hasOwnProperty(opt))\r\n        this[opt] = options[opt];\r\n      this.cm = cm;\r\n      this.node = node;\r\n    };\r\n    eventMixin(LineWidget);\r\n    function widgetOperation(f) {\r\n      return function() {\r\n        var withOp = !this.cm.curOp;\r\n        if (withOp) startOperation(this.cm);\r\n        try {var result = f.apply(this, arguments);}\r\n        finally {if (withOp) endOperation(this.cm);}\r\n        return result;\r\n      };\r\n    }\r\n    LineWidget.prototype.clear = widgetOperation(function() {\r\n      var ws = this.line.widgets, no = lineNo(this.line);\r\n      if (no == null || !ws) return;\r\n      for (var i = 0; i < ws.length; ++i) if (ws[i] == this) ws.splice(i--, 1);\r\n      if (!ws.length) this.line.widgets = null;\r\n      var aboveVisible = heightAtLine(this.cm, this.line) < this.cm.doc.scrollTop;\r\n      updateLineHeight(this.line, Math.max(0, this.line.height - widgetHeight(this)));\r\n      if (aboveVisible) addToScrollPos(this.cm, 0, -this.height);\r\n      regChange(this.cm, no, no + 1);\r\n    });\r\n    LineWidget.prototype.changed = widgetOperation(function() {\r\n      var oldH = this.height;\r\n      this.height = null;\r\n      var diff = widgetHeight(this) - oldH;\r\n      if (!diff) return;\r\n      updateLineHeight(this.line, this.line.height + diff);\r\n      var no = lineNo(this.line);\r\n      regChange(this.cm, no, no + 1);\r\n    });\r\n  \r\n    function widgetHeight(widget) {\r\n      if (widget.height != null) return widget.height;\r\n      if (!widget.node.parentNode || widget.node.parentNode.nodeType != 1)\r\n        removeChildrenAndAdd(widget.cm.display.measure, elt(\"div\", [widget.node], null, \"position: relative\"));\r\n      return widget.height = widget.node.offsetHeight;\r\n    }\r\n  \r\n    function addLineWidget(cm, handle, node, options) {\r\n      var widget = new LineWidget(cm, node, options);\r\n      if (widget.noHScroll) cm.display.alignWidgets = true;\r\n      changeLine(cm, handle, function(line) {\r\n        var widgets = line.widgets || (line.widgets = []);\r\n        if (widget.insertAt == null) widgets.push(widget);\r\n        else widgets.splice(Math.min(widgets.length - 1, Math.max(0, widget.insertAt)), 0, widget);\r\n        widget.line = line;\r\n        if (!lineIsHidden(cm.doc, line) || widget.showIfHidden) {\r\n          var aboveVisible = heightAtLine(cm, line) < cm.doc.scrollTop;\r\n          updateLineHeight(line, line.height + widgetHeight(widget));\r\n          if (aboveVisible) addToScrollPos(cm, 0, widget.height);\r\n        }\r\n        return true;\r\n      });\r\n      return widget;\r\n    }\r\n  \r\n    // LINE DATA STRUCTURE\r\n  \r\n    // Line objects. These hold state related to a line, including\r\n    // highlighting info (the styles array).\r\n    var Line = CodeMirror.Line = function(text, markedSpans, estimateHeight) {\r\n      this.text = text;\r\n      attachMarkedSpans(this, markedSpans);\r\n      this.height = estimateHeight ? estimateHeight(this) : 1;\r\n    };\r\n    eventMixin(Line);\r\n    Line.prototype.lineNo = function() { return lineNo(this); };\r\n  \r\n    function updateLine(line, text, markedSpans, estimateHeight) {\r\n      line.text = text;\r\n      if (line.stateAfter) line.stateAfter = null;\r\n      if (line.styles) line.styles = null;\r\n      if (line.order != null) line.order = null;\r\n      detachMarkedSpans(line);\r\n      attachMarkedSpans(line, markedSpans);\r\n      var estHeight = estimateHeight ? estimateHeight(line) : 1;\r\n      if (estHeight != line.height) updateLineHeight(line, estHeight);\r\n    }\r\n  \r\n    function cleanUpLine(line) {\r\n      line.parent = null;\r\n      detachMarkedSpans(line);\r\n    }\r\n  \r\n    // Run the given mode's parser over a line, update the styles\r\n    // array, which contains alternating fragments of text and CSS\r\n    // classes.\r\n    function runMode(cm, text, mode, state, f, forceToEnd) {\r\n      var flattenSpans = mode.flattenSpans;\r\n      if (flattenSpans == null) flattenSpans = cm.options.flattenSpans;\r\n      var curStart = 0, curStyle = null;\r\n      var stream = new StringStream(text, cm.options.tabSize), style;\r\n      if (text == \"\" && mode.blankLine) mode.blankLine(state);\r\n      while (!stream.eol()) {\r\n        if (stream.pos > cm.options.maxHighlightLength) {\r\n          flattenSpans = false;\r\n          if (forceToEnd) processLine(cm, text, state, stream.pos);\r\n          stream.pos = text.length;\r\n          style = null;\r\n        } else {\r\n          style = mode.token(stream, state);\r\n        }\r\n        if (!flattenSpans || curStyle != style) {\r\n          if (curStart < stream.start) f(stream.start, curStyle);\r\n          curStart = stream.start; curStyle = style;\r\n        }\r\n        stream.start = stream.pos;\r\n      }\r\n      while (curStart < stream.pos) {\r\n        // Webkit seems to refuse to render text nodes longer than 57444 characters\r\n        var pos = Math.min(stream.pos, curStart + 50000);\r\n        f(pos, curStyle);\r\n        curStart = pos;\r\n      }\r\n    }\r\n  \r\n    function highlightLine(cm, line, state, forceToEnd) {\r\n      // A styles array always starts with a number identifying the\r\n      // mode/overlays that it is based on (for easy invalidation).\r\n      var st = [cm.state.modeGen];\r\n      // Compute the base array of styles\r\n      runMode(cm, line.text, cm.doc.mode, state, function(end, style) {\r\n        st.push(end, style);\r\n      }, forceToEnd);\r\n  \r\n      // Run overlays, adjust style array.\r\n      for (var o = 0; o < cm.state.overlays.length; ++o) {\r\n        var overlay = cm.state.overlays[o], i = 1, at = 0;\r\n        runMode(cm, line.text, overlay.mode, true, function(end, style) {\r\n          var start = i;\r\n          // Ensure there's a token end at the current position, and that i points at it\r\n          while (at < end) {\r\n            var i_end = st[i];\r\n            if (i_end > end)\r\n              st.splice(i, 1, end, st[i+1], i_end);\r\n            i += 2;\r\n            at = Math.min(end, i_end);\r\n          }\r\n          if (!style) return;\r\n          if (overlay.opaque) {\r\n            st.splice(start, i - start, end, style);\r\n            i = start + 2;\r\n          } else {\r\n            for (; start < i; start += 2) {\r\n              var cur = st[start+1];\r\n              st[start+1] = cur ? cur + \" \" + style : style;\r\n            }\r\n          }\r\n        });\r\n      }\r\n  \r\n      return st;\r\n    }\r\n  \r\n    function getLineStyles(cm, line) {\r\n      if (!line.styles || line.styles[0] != cm.state.modeGen)\r\n        line.styles = highlightLine(cm, line, line.stateAfter = getStateBefore(cm, lineNo(line)));\r\n      return line.styles;\r\n    }\r\n  \r\n    // Lightweight form of highlight -- proceed over this line and\r\n    // update state, but don't save a style array.\r\n    function processLine(cm, text, state, startAt) {\r\n      var mode = cm.doc.mode;\r\n      var stream = new StringStream(text, cm.options.tabSize);\r\n      stream.start = stream.pos = startAt || 0;\r\n      if (text == \"\" && mode.blankLine) mode.blankLine(state);\r\n      while (!stream.eol() && stream.pos <= cm.options.maxHighlightLength) {\r\n        mode.token(stream, state);\r\n        stream.start = stream.pos;\r\n      }\r\n    }\r\n  \r\n    var styleToClassCache = {};\r\n    function interpretTokenStyle(style, builder) {\r\n      if (!style) return null;\r\n      for (;;) {\r\n        var lineClass = style.match(/(?:^|\\s)line-(background-)?(\\S+)/);\r\n        if (!lineClass) break;\r\n        style = style.slice(0, lineClass.index) + style.slice(lineClass.index + lineClass[0].length);\r\n        var prop = lineClass[1] ? \"bgClass\" : \"textClass\";\r\n        if (builder[prop] == null)\r\n          builder[prop] = lineClass[2];\r\n        else if (!(new RegExp(\"(?:^|\\s)\" + lineClass[2] + \"(?:$|\\s)\")).test(builder[prop]))\r\n          builder[prop] += \" \" + lineClass[2];\r\n      }\r\n      return styleToClassCache[style] ||\r\n        (styleToClassCache[style] = \"cm-\" + style.replace(/ +/g, \" cm-\"));\r\n    }\r\n  \r\n    function buildLineContent(cm, realLine, measure, copyWidgets) {\r\n      var merged, line = realLine, empty = true;\r\n      while (merged = collapsedSpanAtStart(line))\r\n        line = getLine(cm.doc, merged.find().from.line);\r\n  \r\n      var builder = {pre: elt(\"pre\"), col: 0, pos: 0,\r\n                     measure: null, measuredSomething: false, cm: cm,\r\n                     copyWidgets: copyWidgets};\r\n  \r\n      do {\r\n        if (line.text) empty = false;\r\n        builder.measure = line == realLine && measure;\r\n        builder.pos = 0;\r\n        builder.addToken = builder.measure ? buildTokenMeasure : buildToken;\r\n        if ((ie || webkit) && cm.getOption(\"lineWrapping\"))\r\n          builder.addToken = buildTokenSplitSpaces(builder.addToken);\r\n        var next = insertLineContent(line, builder, getLineStyles(cm, line));\r\n        if (measure && line == realLine && !builder.measuredSomething) {\r\n          measure[0] = builder.pre.appendChild(zeroWidthElement(cm.display.measure));\r\n          builder.measuredSomething = true;\r\n        }\r\n        if (next) line = getLine(cm.doc, next.to.line);\r\n      } while (next);\r\n  \r\n      if (measure && !builder.measuredSomething && !measure[0])\r\n        measure[0] = builder.pre.appendChild(empty ? elt(\"span\", \"\\u00a0\") : zeroWidthElement(cm.display.measure));\r\n      if (!builder.pre.firstChild && !lineIsHidden(cm.doc, realLine))\r\n        builder.pre.appendChild(document.createTextNode(\"\\u00a0\"));\r\n  \r\n      var order;\r\n      // Work around problem with the reported dimensions of single-char\r\n      // direction spans on IE (issue #1129). See also the comment in\r\n      // cursorCoords.\r\n      if (measure && (ie || ie_gt10) && (order = getOrder(line))) {\r\n        var l = order.length - 1;\r\n        if (order[l].from == order[l].to) --l;\r\n        var last = order[l], prev = order[l - 1];\r\n        if (last.from + 1 == last.to && prev && last.level < prev.level) {\r\n          var span = measure[builder.pos - 1];\r\n          if (span) span.parentNode.insertBefore(span.measureRight = zeroWidthElement(cm.display.measure),\r\n                                                 span.nextSibling);\r\n        }\r\n      }\r\n  \r\n      var textClass = builder.textClass ? builder.textClass + \" \" + (realLine.textClass || \"\") : realLine.textClass;\r\n      if (textClass) builder.pre.className = textClass;\r\n  \r\n      signal(cm, \"renderLine\", cm, realLine, builder.pre);\r\n      return builder;\r\n    }\r\n  \r\n    function defaultSpecialCharPlaceholder(ch) {\r\n      var token = elt(\"span\", \"\\u2022\", \"cm-invalidchar\");\r\n      token.title = \"\\\\u\" + ch.charCodeAt(0).toString(16);\r\n      return token;\r\n    }\r\n  \r\n    function buildToken(builder, text, style, startStyle, endStyle, title) {\r\n      if (!text) return;\r\n      var special = builder.cm.options.specialChars;\r\n      if (!special.test(text)) {\r\n        builder.col += text.length;\r\n        var content = document.createTextNode(text);\r\n      } else {\r\n        var content = document.createDocumentFragment(), pos = 0;\r\n        while (true) {\r\n          special.lastIndex = pos;\r\n          var m = special.exec(text);\r\n          var skipped = m ? m.index - pos : text.length - pos;\r\n          if (skipped) {\r\n            content.appendChild(document.createTextNode(text.slice(pos, pos + skipped)));\r\n            builder.col += skipped;\r\n          }\r\n          if (!m) break;\r\n          pos += skipped + 1;\r\n          if (m[0] == \"\\t\") {\r\n            var tabSize = builder.cm.options.tabSize, tabWidth = tabSize - builder.col % tabSize;\r\n            content.appendChild(elt(\"span\", spaceStr(tabWidth), \"cm-tab\"));\r\n            builder.col += tabWidth;\r\n          } else {\r\n            var token = builder.cm.options.specialCharPlaceholder(m[0]);\r\n            content.appendChild(token);\r\n            builder.col += 1;\r\n          }\r\n        }\r\n      }\r\n      if (style || startStyle || endStyle || builder.measure) {\r\n        var fullStyle = style || \"\";\r\n        if (startStyle) fullStyle += startStyle;\r\n        if (endStyle) fullStyle += endStyle;\r\n        var token = elt(\"span\", [content], fullStyle);\r\n        if (title) token.title = title;\r\n        return builder.pre.appendChild(token);\r\n      }\r\n      builder.pre.appendChild(content);\r\n    }\r\n  \r\n    function buildTokenMeasure(builder, text, style, startStyle, endStyle) {\r\n      var wrapping = builder.cm.options.lineWrapping;\r\n      for (var i = 0; i < text.length; ++i) {\r\n        var ch = text.charAt(i), start = i == 0;\r\n        if (ch >= \"\\ud800\" && ch < \"\\udbff\" && i < text.length - 1) {\r\n          ch = text.slice(i, i + 2);\r\n          ++i;\r\n        } else if (i && wrapping && spanAffectsWrapping(text, i)) {\r\n          builder.pre.appendChild(elt(\"wbr\"));\r\n        }\r\n        var old = builder.measure[builder.pos];\r\n        var span = builder.measure[builder.pos] =\r\n          buildToken(builder, ch, style,\r\n                     start && startStyle, i == text.length - 1 && endStyle);\r\n        if (old) span.leftSide = old.leftSide || old;\r\n        // In IE single-space nodes wrap differently than spaces\r\n        // embedded in larger text nodes, except when set to\r\n        // white-space: normal (issue #1268).\r\n        if (ie && wrapping && ch == \" \" && i && !/\\s/.test(text.charAt(i - 1)) &&\r\n            i < text.length - 1 && !/\\s/.test(text.charAt(i + 1)))\r\n          span.style.whiteSpace = \"normal\";\r\n        builder.pos += ch.length;\r\n      }\r\n      if (text.length) builder.measuredSomething = true;\r\n    }\r\n  \r\n    function buildTokenSplitSpaces(inner) {\r\n      function split(old) {\r\n        var out = \" \";\r\n        for (var i = 0; i < old.length - 2; ++i) out += i % 2 ? \" \" : \"\\u00a0\";\r\n        out += \" \";\r\n        return out;\r\n      }\r\n      return function(builder, text, style, startStyle, endStyle, title) {\r\n        return inner(builder, text.replace(/ {3,}/g, split), style, startStyle, endStyle, title);\r\n      };\r\n    }\r\n  \r\n    function buildCollapsedSpan(builder, size, marker, ignoreWidget) {\r\n      var widget = !ignoreWidget && marker.replacedWith;\r\n      if (widget) {\r\n        if (builder.copyWidgets) widget = widget.cloneNode(true);\r\n        builder.pre.appendChild(widget);\r\n        if (builder.measure) {\r\n          if (size) {\r\n            builder.measure[builder.pos] = widget;\r\n          } else {\r\n            var elt = zeroWidthElement(builder.cm.display.measure);\r\n            if (marker.type == \"bookmark\" && !marker.insertLeft)\r\n              builder.measure[builder.pos] = builder.pre.appendChild(elt);\r\n            else if (builder.measure[builder.pos])\r\n              return;\r\n            else\r\n              builder.measure[builder.pos] = builder.pre.insertBefore(elt, widget);\r\n          }\r\n          builder.measuredSomething = true;\r\n        }\r\n      }\r\n      builder.pos += size;\r\n    }\r\n  \r\n    // Outputs a number of spans to make up a line, taking highlighting\r\n    // and marked text into account.\r\n    function insertLineContent(line, builder, styles) {\r\n      var spans = line.markedSpans, allText = line.text, at = 0;\r\n      if (!spans) {\r\n        for (var i = 1; i < styles.length; i+=2)\r\n          builder.addToken(builder, allText.slice(at, at = styles[i]), interpretTokenStyle(styles[i+1], builder));\r\n        return;\r\n      }\r\n  \r\n      var len = allText.length, pos = 0, i = 1, text = \"\", style;\r\n      var nextChange = 0, spanStyle, spanEndStyle, spanStartStyle, title, collapsed;\r\n      for (;;) {\r\n        if (nextChange == pos) { // Update current marker set\r\n          spanStyle = spanEndStyle = spanStartStyle = title = \"\";\r\n          collapsed = null; nextChange = Infinity;\r\n          var foundBookmarks = [];\r\n          for (var j = 0; j < spans.length; ++j) {\r\n            var sp = spans[j], m = sp.marker;\r\n            if (sp.from <= pos && (sp.to == null || sp.to > pos)) {\r\n              if (sp.to != null && nextChange > sp.to) { nextChange = sp.to; spanEndStyle = \"\"; }\r\n              if (m.className) spanStyle += \" \" + m.className;\r\n              if (m.startStyle && sp.from == pos) spanStartStyle += \" \" + m.startStyle;\r\n              if (m.endStyle && sp.to == nextChange) spanEndStyle += \" \" + m.endStyle;\r\n              if (m.title && !title) title = m.title;\r\n              if (m.collapsed && (!collapsed || collapsed.marker.size < m.size))\r\n                collapsed = sp;\r\n            } else if (sp.from > pos && nextChange > sp.from) {\r\n              nextChange = sp.from;\r\n            }\r\n            if (m.type == \"bookmark\" && sp.from == pos && m.replacedWith) foundBookmarks.push(m);\r\n          }\r\n          if (collapsed && (collapsed.from || 0) == pos) {\r\n            buildCollapsedSpan(builder, (collapsed.to == null ? len : collapsed.to) - pos,\r\n                               collapsed.marker, collapsed.from == null);\r\n            if (collapsed.to == null) return collapsed.marker.find();\r\n          }\r\n          if (!collapsed && foundBookmarks.length) for (var j = 0; j < foundBookmarks.length; ++j)\r\n            buildCollapsedSpan(builder, 0, foundBookmarks[j]);\r\n        }\r\n        if (pos >= len) break;\r\n  \r\n        var upto = Math.min(len, nextChange);\r\n        while (true) {\r\n          if (text) {\r\n            var end = pos + text.length;\r\n            if (!collapsed) {\r\n              var tokenText = end > upto ? text.slice(0, upto - pos) : text;\r\n              builder.addToken(builder, tokenText, style ? style + spanStyle : spanStyle,\r\n                               spanStartStyle, pos + tokenText.length == nextChange ? spanEndStyle : \"\", title);\r\n            }\r\n            if (end >= upto) {text = text.slice(upto - pos); pos = upto; break;}\r\n            pos = end;\r\n            spanStartStyle = \"\";\r\n          }\r\n          text = allText.slice(at, at = styles[i++]);\r\n          style = interpretTokenStyle(styles[i++], builder);\r\n        }\r\n      }\r\n    }\r\n  \r\n    // DOCUMENT DATA STRUCTURE\r\n  \r\n    function updateDoc(doc, change, markedSpans, selAfter, estimateHeight) {\r\n      function spansFor(n) {return markedSpans ? markedSpans[n] : null;}\r\n      function update(line, text, spans) {\r\n        updateLine(line, text, spans, estimateHeight);\r\n        signalLater(line, \"change\", line, change);\r\n      }\r\n  \r\n      var from = change.from, to = change.to, text = change.text;\r\n      var firstLine = getLine(doc, from.line), lastLine = getLine(doc, to.line);\r\n      var lastText = lst(text), lastSpans = spansFor(text.length - 1), nlines = to.line - from.line;\r\n  \r\n      // First adjust the line structure\r\n      if (from.ch == 0 && to.ch == 0 && lastText == \"\" &&\r\n          (!doc.cm || doc.cm.options.wholeLineUpdateBefore)) {\r\n        // This is a whole-line replace. Treated specially to make\r\n        // sure line objects move the way they are supposed to.\r\n        for (var i = 0, e = text.length - 1, added = []; i < e; ++i)\r\n          added.push(new Line(text[i], spansFor(i), estimateHeight));\r\n        update(lastLine, lastLine.text, lastSpans);\r\n        if (nlines) doc.remove(from.line, nlines);\r\n        if (added.length) doc.insert(from.line, added);\r\n      } else if (firstLine == lastLine) {\r\n        if (text.length == 1) {\r\n          update(firstLine, firstLine.text.slice(0, from.ch) + lastText + firstLine.text.slice(to.ch), lastSpans);\r\n        } else {\r\n          for (var added = [], i = 1, e = text.length - 1; i < e; ++i)\r\n            added.push(new Line(text[i], spansFor(i), estimateHeight));\r\n          added.push(new Line(lastText + firstLine.text.slice(to.ch), lastSpans, estimateHeight));\r\n          update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\r\n          doc.insert(from.line + 1, added);\r\n        }\r\n      } else if (text.length == 1) {\r\n        update(firstLine, firstLine.text.slice(0, from.ch) + text[0] + lastLine.text.slice(to.ch), spansFor(0));\r\n        doc.remove(from.line + 1, nlines);\r\n      } else {\r\n        update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\r\n        update(lastLine, lastText + lastLine.text.slice(to.ch), lastSpans);\r\n        for (var i = 1, e = text.length - 1, added = []; i < e; ++i)\r\n          added.push(new Line(text[i], spansFor(i), estimateHeight));\r\n        if (nlines > 1) doc.remove(from.line + 1, nlines - 1);\r\n        doc.insert(from.line + 1, added);\r\n      }\r\n  \r\n      signalLater(doc, \"change\", doc, change);\r\n      setSelection(doc, selAfter.anchor, selAfter.head, null, true);\r\n    }\r\n  \r\n    function LeafChunk(lines) {\r\n      this.lines = lines;\r\n      this.parent = null;\r\n      for (var i = 0, e = lines.length, height = 0; i < e; ++i) {\r\n        lines[i].parent = this;\r\n        height += lines[i].height;\r\n      }\r\n      this.height = height;\r\n    }\r\n  \r\n    LeafChunk.prototype = {\r\n      chunkSize: function() { return this.lines.length; },\r\n      removeInner: function(at, n) {\r\n        for (var i = at, e = at + n; i < e; ++i) {\r\n          var line = this.lines[i];\r\n          this.height -= line.height;\r\n          cleanUpLine(line);\r\n          signalLater(line, \"delete\");\r\n        }\r\n        this.lines.splice(at, n);\r\n      },\r\n      collapse: function(lines) {\r\n        lines.splice.apply(lines, [lines.length, 0].concat(this.lines));\r\n      },\r\n      insertInner: function(at, lines, height) {\r\n        this.height += height;\r\n        this.lines = this.lines.slice(0, at).concat(lines).concat(this.lines.slice(at));\r\n        for (var i = 0, e = lines.length; i < e; ++i) lines[i].parent = this;\r\n      },\r\n      iterN: function(at, n, op) {\r\n        for (var e = at + n; at < e; ++at)\r\n          if (op(this.lines[at])) return true;\r\n      }\r\n    };\r\n  \r\n    function BranchChunk(children) {\r\n      this.children = children;\r\n      var size = 0, height = 0;\r\n      for (var i = 0, e = children.length; i < e; ++i) {\r\n        var ch = children[i];\r\n        size += ch.chunkSize(); height += ch.height;\r\n        ch.parent = this;\r\n      }\r\n      this.size = size;\r\n      this.height = height;\r\n      this.parent = null;\r\n    }\r\n  \r\n    BranchChunk.prototype = {\r\n      chunkSize: function() { return this.size; },\r\n      removeInner: function(at, n) {\r\n        this.size -= n;\r\n        for (var i = 0; i < this.children.length; ++i) {\r\n          var child = this.children[i], sz = child.chunkSize();\r\n          if (at < sz) {\r\n            var rm = Math.min(n, sz - at), oldHeight = child.height;\r\n            child.removeInner(at, rm);\r\n            this.height -= oldHeight - child.height;\r\n            if (sz == rm) { this.children.splice(i--, 1); child.parent = null; }\r\n            if ((n -= rm) == 0) break;\r\n            at = 0;\r\n          } else at -= sz;\r\n        }\r\n        if (this.size - n < 25) {\r\n          var lines = [];\r\n          this.collapse(lines);\r\n          this.children = [new LeafChunk(lines)];\r\n          this.children[0].parent = this;\r\n        }\r\n      },\r\n      collapse: function(lines) {\r\n        for (var i = 0, e = this.children.length; i < e; ++i) this.children[i].collapse(lines);\r\n      },\r\n      insertInner: function(at, lines, height) {\r\n        this.size += lines.length;\r\n        this.height += height;\r\n        for (var i = 0, e = this.children.length; i < e; ++i) {\r\n          var child = this.children[i], sz = child.chunkSize();\r\n          if (at <= sz) {\r\n            child.insertInner(at, lines, height);\r\n            if (child.lines && child.lines.length > 50) {\r\n              while (child.lines.length > 50) {\r\n                var spilled = child.lines.splice(child.lines.length - 25, 25);\r\n                var newleaf = new LeafChunk(spilled);\r\n                child.height -= newleaf.height;\r\n                this.children.splice(i + 1, 0, newleaf);\r\n                newleaf.parent = this;\r\n              }\r\n              this.maybeSpill();\r\n            }\r\n            break;\r\n          }\r\n          at -= sz;\r\n        }\r\n      },\r\n      maybeSpill: function() {\r\n        if (this.children.length <= 10) return;\r\n        var me = this;\r\n        do {\r\n          var spilled = me.children.splice(me.children.length - 5, 5);\r\n          var sibling = new BranchChunk(spilled);\r\n          if (!me.parent) { // Become the parent node\r\n            var copy = new BranchChunk(me.children);\r\n            copy.parent = me;\r\n            me.children = [copy, sibling];\r\n            me = copy;\r\n          } else {\r\n            me.size -= sibling.size;\r\n            me.height -= sibling.height;\r\n            var myIndex = indexOf(me.parent.children, me);\r\n            me.parent.children.splice(myIndex + 1, 0, sibling);\r\n          }\r\n          sibling.parent = me.parent;\r\n        } while (me.children.length > 10);\r\n        me.parent.maybeSpill();\r\n      },\r\n      iterN: function(at, n, op) {\r\n        for (var i = 0, e = this.children.length; i < e; ++i) {\r\n          var child = this.children[i], sz = child.chunkSize();\r\n          if (at < sz) {\r\n            var used = Math.min(n, sz - at);\r\n            if (child.iterN(at, used, op)) return true;\r\n            if ((n -= used) == 0) break;\r\n            at = 0;\r\n          } else at -= sz;\r\n        }\r\n      }\r\n    };\r\n  \r\n    var nextDocId = 0;\r\n    var Doc = CodeMirror.Doc = function(text, mode, firstLine) {\r\n      if (!(this instanceof Doc)) return new Doc(text, mode, firstLine);\r\n      if (firstLine == null) firstLine = 0;\r\n  \r\n      BranchChunk.call(this, [new LeafChunk([new Line(\"\", null)])]);\r\n      this.first = firstLine;\r\n      this.scrollTop = this.scrollLeft = 0;\r\n      this.cantEdit = false;\r\n      this.history = makeHistory();\r\n      this.cleanGeneration = 1;\r\n      this.frontier = firstLine;\r\n      var start = Pos(firstLine, 0);\r\n      this.sel = {from: start, to: start, head: start, anchor: start, shift: false, extend: false, goalColumn: null};\r\n      this.id = ++nextDocId;\r\n      this.modeOption = mode;\r\n  \r\n      if (typeof text == \"string\") text = splitLines(text);\r\n      updateDoc(this, {from: start, to: start, text: text}, null, {head: start, anchor: start});\r\n    };\r\n  \r\n    Doc.prototype = createObj(BranchChunk.prototype, {\r\n      constructor: Doc,\r\n      iter: function(from, to, op) {\r\n        if (op) this.iterN(from - this.first, to - from, op);\r\n        else this.iterN(this.first, this.first + this.size, from);\r\n      },\r\n  \r\n      insert: function(at, lines) {\r\n        var height = 0;\r\n        for (var i = 0, e = lines.length; i < e; ++i) height += lines[i].height;\r\n        this.insertInner(at - this.first, lines, height);\r\n      },\r\n      remove: function(at, n) { this.removeInner(at - this.first, n); },\r\n  \r\n      getValue: function(lineSep) {\r\n        var lines = getLines(this, this.first, this.first + this.size);\r\n        if (lineSep === false) return lines;\r\n        return lines.join(lineSep || \"\\n\");\r\n      },\r\n      setValue: function(code) {\r\n        var top = Pos(this.first, 0), last = this.first + this.size - 1;\r\n        makeChange(this, {from: top, to: Pos(last, getLine(this, last).text.length),\r\n                          text: splitLines(code), origin: \"setValue\"},\r\n                   {head: top, anchor: top}, true);\r\n      },\r\n      replaceRange: function(code, from, to, origin) {\r\n        from = clipPos(this, from);\r\n        to = to ? clipPos(this, to) : from;\r\n        replaceRange(this, code, from, to, origin);\r\n      },\r\n      getRange: function(from, to, lineSep) {\r\n        var lines = getBetween(this, clipPos(this, from), clipPos(this, to));\r\n        if (lineSep === false) return lines;\r\n        return lines.join(lineSep || \"\\n\");\r\n      },\r\n  \r\n      getLine: function(line) {var l = this.getLineHandle(line); return l && l.text;},\r\n      setLine: function(line, text) {\r\n        if (isLine(this, line))\r\n          replaceRange(this, text, Pos(line, 0), clipPos(this, Pos(line)));\r\n      },\r\n      removeLine: function(line) {\r\n        if (line) replaceRange(this, \"\", clipPos(this, Pos(line - 1)), clipPos(this, Pos(line)));\r\n        else replaceRange(this, \"\", Pos(0, 0), clipPos(this, Pos(1, 0)));\r\n      },\r\n  \r\n      getLineHandle: function(line) {if (isLine(this, line)) return getLine(this, line);},\r\n      getLineNumber: function(line) {return lineNo(line);},\r\n  \r\n      getLineHandleVisualStart: function(line) {\r\n        if (typeof line == \"number\") line = getLine(this, line);\r\n        return visualLine(this, line);\r\n      },\r\n  \r\n      lineCount: function() {return this.size;},\r\n      firstLine: function() {return this.first;},\r\n      lastLine: function() {return this.first + this.size - 1;},\r\n  \r\n      clipPos: function(pos) {return clipPos(this, pos);},\r\n  \r\n      getCursor: function(start) {\r\n        var sel = this.sel, pos;\r\n        if (start == null || start == \"head\") pos = sel.head;\r\n        else if (start == \"anchor\") pos = sel.anchor;\r\n        else if (start == \"end\" || start === false) pos = sel.to;\r\n        else pos = sel.from;\r\n        return copyPos(pos);\r\n      },\r\n      somethingSelected: function() {return !posEq(this.sel.head, this.sel.anchor);},\r\n  \r\n      setCursor: docOperation(function(line, ch, extend) {\r\n        var pos = clipPos(this, typeof line == \"number\" ? Pos(line, ch || 0) : line);\r\n        if (extend) extendSelection(this, pos);\r\n        else setSelection(this, pos, pos);\r\n      }),\r\n      setSelection: docOperation(function(anchor, head, bias) {\r\n        setSelection(this, clipPos(this, anchor), clipPos(this, head || anchor), bias);\r\n      }),\r\n      extendSelection: docOperation(function(from, to, bias) {\r\n        extendSelection(this, clipPos(this, from), to && clipPos(this, to), bias);\r\n      }),\r\n  \r\n      getSelection: function(lineSep) {return this.getRange(this.sel.from, this.sel.to, lineSep);},\r\n      replaceSelection: function(code, collapse, origin) {\r\n        makeChange(this, {from: this.sel.from, to: this.sel.to, text: splitLines(code), origin: origin}, collapse || \"around\");\r\n      },\r\n      undo: docOperation(function() {makeChangeFromHistory(this, \"undo\");}),\r\n      redo: docOperation(function() {makeChangeFromHistory(this, \"redo\");}),\r\n  \r\n      setExtending: function(val) {this.sel.extend = val;},\r\n  \r\n      historySize: function() {\r\n        var hist = this.history;\r\n        return {undo: hist.done.length, redo: hist.undone.length};\r\n      },\r\n      clearHistory: function() {this.history = makeHistory(this.history.maxGeneration);},\r\n  \r\n      markClean: function() {\r\n        this.cleanGeneration = this.changeGeneration();\r\n      },\r\n      changeGeneration: function() {\r\n        this.history.lastOp = this.history.lastOrigin = null;\r\n        return this.history.generation;\r\n      },\r\n      isClean: function (gen) {\r\n        return this.history.generation == (gen || this.cleanGeneration);\r\n      },\r\n  \r\n      getHistory: function() {\r\n        return {done: copyHistoryArray(this.history.done),\r\n                undone: copyHistoryArray(this.history.undone)};\r\n      },\r\n      setHistory: function(histData) {\r\n        var hist = this.history = makeHistory(this.history.maxGeneration);\r\n        hist.done = histData.done.slice(0);\r\n        hist.undone = histData.undone.slice(0);\r\n      },\r\n  \r\n      markText: function(from, to, options) {\r\n        return markText(this, clipPos(this, from), clipPos(this, to), options, \"range\");\r\n      },\r\n      setBookmark: function(pos, options) {\r\n        var realOpts = {replacedWith: options && (options.nodeType == null ? options.widget : options),\r\n                        insertLeft: options && options.insertLeft};\r\n        pos = clipPos(this, pos);\r\n        return markText(this, pos, pos, realOpts, \"bookmark\");\r\n      },\r\n      findMarksAt: function(pos) {\r\n        pos = clipPos(this, pos);\r\n        var markers = [], spans = getLine(this, pos.line).markedSpans;\r\n        if (spans) for (var i = 0; i < spans.length; ++i) {\r\n          var span = spans[i];\r\n          if ((span.from == null || span.from <= pos.ch) &&\r\n              (span.to == null || span.to >= pos.ch))\r\n            markers.push(span.marker.parent || span.marker);\r\n        }\r\n        return markers;\r\n      },\r\n      getAllMarks: function() {\r\n        var markers = [];\r\n        this.iter(function(line) {\r\n          var sps = line.markedSpans;\r\n          if (sps) for (var i = 0; i < sps.length; ++i)\r\n            if (sps[i].from != null) markers.push(sps[i].marker);\r\n        });\r\n        return markers;\r\n      },\r\n  \r\n      posFromIndex: function(off) {\r\n        var ch, lineNo = this.first;\r\n        this.iter(function(line) {\r\n          var sz = line.text.length + 1;\r\n          if (sz > off) { ch = off; return true; }\r\n          off -= sz;\r\n          ++lineNo;\r\n        });\r\n        return clipPos(this, Pos(lineNo, ch));\r\n      },\r\n      indexFromPos: function (coords) {\r\n        coords = clipPos(this, coords);\r\n        var index = coords.ch;\r\n        if (coords.line < this.first || coords.ch < 0) return 0;\r\n        this.iter(this.first, coords.line, function (line) {\r\n          index += line.text.length + 1;\r\n        });\r\n        return index;\r\n      },\r\n  \r\n      copy: function(copyHistory) {\r\n        var doc = new Doc(getLines(this, this.first, this.first + this.size), this.modeOption, this.first);\r\n        doc.scrollTop = this.scrollTop; doc.scrollLeft = this.scrollLeft;\r\n        doc.sel = {from: this.sel.from, to: this.sel.to, head: this.sel.head, anchor: this.sel.anchor,\r\n                   shift: this.sel.shift, extend: false, goalColumn: this.sel.goalColumn};\r\n        if (copyHistory) {\r\n          doc.history.undoDepth = this.history.undoDepth;\r\n          doc.setHistory(this.getHistory());\r\n        }\r\n        return doc;\r\n      },\r\n  \r\n      linkedDoc: function(options) {\r\n        if (!options) options = {};\r\n        var from = this.first, to = this.first + this.size;\r\n        if (options.from != null && options.from > from) from = options.from;\r\n        if (options.to != null && options.to < to) to = options.to;\r\n        var copy = new Doc(getLines(this, from, to), options.mode || this.modeOption, from);\r\n        if (options.sharedHist) copy.history = this.history;\r\n        (this.linked || (this.linked = [])).push({doc: copy, sharedHist: options.sharedHist});\r\n        copy.linked = [{doc: this, isParent: true, sharedHist: options.sharedHist}];\r\n        return copy;\r\n      },\r\n      unlinkDoc: function(other) {\r\n        if (other instanceof CodeMirror) other = other.doc;\r\n        if (this.linked) for (var i = 0; i < this.linked.length; ++i) {\r\n          var link = this.linked[i];\r\n          if (link.doc != other) continue;\r\n          this.linked.splice(i, 1);\r\n          other.unlinkDoc(this);\r\n          break;\r\n        }\r\n        // If the histories were shared, split them again\r\n        if (other.history == this.history) {\r\n          var splitIds = [other.id];\r\n          linkedDocs(other, function(doc) {splitIds.push(doc.id);}, true);\r\n          other.history = makeHistory();\r\n          other.history.done = copyHistoryArray(this.history.done, splitIds);\r\n          other.history.undone = copyHistoryArray(this.history.undone, splitIds);\r\n        }\r\n      },\r\n      iterLinkedDocs: function(f) {linkedDocs(this, f);},\r\n  \r\n      getMode: function() {return this.mode;},\r\n      getEditor: function() {return this.cm;}\r\n    });\r\n  \r\n    Doc.prototype.eachLine = Doc.prototype.iter;\r\n  \r\n    // The Doc methods that should be available on CodeMirror instances\r\n    var dontDelegate = \"iter insert remove copy getEditor\".split(\" \");\r\n    for (var prop in Doc.prototype) if (Doc.prototype.hasOwnProperty(prop) && indexOf(dontDelegate, prop) < 0)\r\n      CodeMirror.prototype[prop] = (function(method) {\r\n        return function() {return method.apply(this.doc, arguments);};\r\n      })(Doc.prototype[prop]);\r\n  \r\n    eventMixin(Doc);\r\n  \r\n    function linkedDocs(doc, f, sharedHistOnly) {\r\n      function propagate(doc, skip, sharedHist) {\r\n        if (doc.linked) for (var i = 0; i < doc.linked.length; ++i) {\r\n          var rel = doc.linked[i];\r\n          if (rel.doc == skip) continue;\r\n          var shared = sharedHist && rel.sharedHist;\r\n          if (sharedHistOnly && !shared) continue;\r\n          f(rel.doc, shared);\r\n          propagate(rel.doc, doc, shared);\r\n        }\r\n      }\r\n      propagate(doc, null, true);\r\n    }\r\n  \r\n    function attachDoc(cm, doc) {\r\n      if (doc.cm) throw new Error(\"This document is already in use.\");\r\n      cm.doc = doc;\r\n      doc.cm = cm;\r\n      estimateLineHeights(cm);\r\n      loadMode(cm);\r\n      if (!cm.options.lineWrapping) computeMaxLength(cm);\r\n      cm.options.mode = doc.modeOption;\r\n      regChange(cm);\r\n    }\r\n  \r\n    // LINE UTILITIES\r\n  \r\n    function getLine(chunk, n) {\r\n      n -= chunk.first;\r\n      while (!chunk.lines) {\r\n        for (var i = 0;; ++i) {\r\n          var child = chunk.children[i], sz = child.chunkSize();\r\n          if (n < sz) { chunk = child; break; }\r\n          n -= sz;\r\n        }\r\n      }\r\n      return chunk.lines[n];\r\n    }\r\n  \r\n    function getBetween(doc, start, end) {\r\n      var out = [], n = start.line;\r\n      doc.iter(start.line, end.line + 1, function(line) {\r\n        var text = line.text;\r\n        if (n == end.line) text = text.slice(0, end.ch);\r\n        if (n == start.line) text = text.slice(start.ch);\r\n        out.push(text);\r\n        ++n;\r\n      });\r\n      return out;\r\n    }\r\n    function getLines(doc, from, to) {\r\n      var out = [];\r\n      doc.iter(from, to, function(line) { out.push(line.text); });\r\n      return out;\r\n    }\r\n  \r\n    function updateLineHeight(line, height) {\r\n      var diff = height - line.height;\r\n      for (var n = line; n; n = n.parent) n.height += diff;\r\n    }\r\n  \r\n    function lineNo(line) {\r\n      if (line.parent == null) return null;\r\n      var cur = line.parent, no = indexOf(cur.lines, line);\r\n      for (var chunk = cur.parent; chunk; cur = chunk, chunk = chunk.parent) {\r\n        for (var i = 0;; ++i) {\r\n          if (chunk.children[i] == cur) break;\r\n          no += chunk.children[i].chunkSize();\r\n        }\r\n      }\r\n      return no + cur.first;\r\n    }\r\n  \r\n    function lineAtHeight(chunk, h) {\r\n      var n = chunk.first;\r\n      outer: do {\r\n        for (var i = 0, e = chunk.children.length; i < e; ++i) {\r\n          var child = chunk.children[i], ch = child.height;\r\n          if (h < ch) { chunk = child; continue outer; }\r\n          h -= ch;\r\n          n += child.chunkSize();\r\n        }\r\n        return n;\r\n      } while (!chunk.lines);\r\n      for (var i = 0, e = chunk.lines.length; i < e; ++i) {\r\n        var line = chunk.lines[i], lh = line.height;\r\n        if (h < lh) break;\r\n        h -= lh;\r\n      }\r\n      return n + i;\r\n    }\r\n  \r\n    function heightAtLine(cm, lineObj) {\r\n      lineObj = visualLine(cm.doc, lineObj);\r\n  \r\n      var h = 0, chunk = lineObj.parent;\r\n      for (var i = 0; i < chunk.lines.length; ++i) {\r\n        var line = chunk.lines[i];\r\n        if (line == lineObj) break;\r\n        else h += line.height;\r\n      }\r\n      for (var p = chunk.parent; p; chunk = p, p = chunk.parent) {\r\n        for (var i = 0; i < p.children.length; ++i) {\r\n          var cur = p.children[i];\r\n          if (cur == chunk) break;\r\n          else h += cur.height;\r\n        }\r\n      }\r\n      return h;\r\n    }\r\n  \r\n    function getOrder(line) {\r\n      var order = line.order;\r\n      if (order == null) order = line.order = bidiOrdering(line.text);\r\n      return order;\r\n    }\r\n  \r\n    // HISTORY\r\n  \r\n    function makeHistory(startGen) {\r\n      return {\r\n        // Arrays of history events. Doing something adds an event to\r\n        // done and clears undo. Undoing moves events from done to\r\n        // undone, redoing moves them in the other direction.\r\n        done: [], undone: [], undoDepth: Infinity,\r\n        // Used to track when changes can be merged into a single undo\r\n        // event\r\n        lastTime: 0, lastOp: null, lastOrigin: null,\r\n        // Used by the isClean() method\r\n        generation: startGen || 1, maxGeneration: startGen || 1\r\n      };\r\n    }\r\n  \r\n    function attachLocalSpans(doc, change, from, to) {\r\n      var existing = change[\"spans_\" + doc.id], n = 0;\r\n      doc.iter(Math.max(doc.first, from), Math.min(doc.first + doc.size, to), function(line) {\r\n        if (line.markedSpans)\r\n          (existing || (existing = change[\"spans_\" + doc.id] = {}))[n] = line.markedSpans;\r\n        ++n;\r\n      });\r\n    }\r\n  \r\n    function historyChangeFromChange(doc, change) {\r\n      var from = { line: change.from.line, ch: change.from.ch };\r\n      var histChange = {from: from, to: changeEnd(change), text: getBetween(doc, change.from, change.to)};\r\n      attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);\r\n      linkedDocs(doc, function(doc) {attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);}, true);\r\n      return histChange;\r\n    }\r\n  \r\n    function addToHistory(doc, change, selAfter, opId) {\r\n      var hist = doc.history;\r\n      hist.undone.length = 0;\r\n      var time = +new Date, cur = lst(hist.done);\r\n  \r\n      if (cur &&\r\n          (hist.lastOp == opId ||\r\n           hist.lastOrigin == change.origin && change.origin &&\r\n           ((change.origin.charAt(0) == \"+\" && doc.cm && hist.lastTime > time - doc.cm.options.historyEventDelay) ||\r\n            change.origin.charAt(0) == \"*\"))) {\r\n        // Merge this change into the last event\r\n        var last = lst(cur.changes);\r\n        if (posEq(change.from, change.to) && posEq(change.from, last.to)) {\r\n          // Optimized case for simple insertion -- don't want to add\r\n          // new changesets for every character typed\r\n          last.to = changeEnd(change);\r\n        } else {\r\n          // Add new sub-event\r\n          cur.changes.push(historyChangeFromChange(doc, change));\r\n        }\r\n        cur.anchorAfter = selAfter.anchor; cur.headAfter = selAfter.head;\r\n      } else {\r\n        // Can not be merged, start a new event.\r\n        cur = {changes: [historyChangeFromChange(doc, change)],\r\n               generation: hist.generation,\r\n               anchorBefore: doc.sel.anchor, headBefore: doc.sel.head,\r\n               anchorAfter: selAfter.anchor, headAfter: selAfter.head};\r\n        hist.done.push(cur);\r\n        hist.generation = ++hist.maxGeneration;\r\n        while (hist.done.length > hist.undoDepth)\r\n          hist.done.shift();\r\n      }\r\n      hist.lastTime = time;\r\n      hist.lastOp = opId;\r\n      hist.lastOrigin = change.origin;\r\n    }\r\n  \r\n    function removeClearedSpans(spans) {\r\n      if (!spans) return null;\r\n      for (var i = 0, out; i < spans.length; ++i) {\r\n        if (spans[i].marker.explicitlyCleared) { if (!out) out = spans.slice(0, i); }\r\n        else if (out) out.push(spans[i]);\r\n      }\r\n      return !out ? spans : out.length ? out : null;\r\n    }\r\n  \r\n    function getOldSpans(doc, change) {\r\n      var found = change[\"spans_\" + doc.id];\r\n      if (!found) return null;\r\n      for (var i = 0, nw = []; i < change.text.length; ++i)\r\n        nw.push(removeClearedSpans(found[i]));\r\n      return nw;\r\n    }\r\n  \r\n    // Used both to provide a JSON-safe object in .getHistory, and, when\r\n    // detaching a document, to split the history in two\r\n    function copyHistoryArray(events, newGroup) {\r\n      for (var i = 0, copy = []; i < events.length; ++i) {\r\n        var event = events[i], changes = event.changes, newChanges = [];\r\n        copy.push({changes: newChanges, anchorBefore: event.anchorBefore, headBefore: event.headBefore,\r\n                   anchorAfter: event.anchorAfter, headAfter: event.headAfter});\r\n        for (var j = 0; j < changes.length; ++j) {\r\n          var change = changes[j], m;\r\n          newChanges.push({from: change.from, to: change.to, text: change.text});\r\n          if (newGroup) for (var prop in change) if (m = prop.match(/^spans_(\\d+)$/)) {\r\n            if (indexOf(newGroup, Number(m[1])) > -1) {\r\n              lst(newChanges)[prop] = change[prop];\r\n              delete change[prop];\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return copy;\r\n    }\r\n  \r\n    // Rebasing/resetting history to deal with externally-sourced changes\r\n  \r\n    function rebaseHistSel(pos, from, to, diff) {\r\n      if (to < pos.line) {\r\n        pos.line += diff;\r\n      } else if (from < pos.line) {\r\n        pos.line = from;\r\n        pos.ch = 0;\r\n      }\r\n    }\r\n  \r\n    // Tries to rebase an array of history events given a change in the\r\n    // document. If the change touches the same lines as the event, the\r\n    // event, and everything 'behind' it, is discarded. If the change is\r\n    // before the event, the event's positions are updated. Uses a\r\n    // copy-on-write scheme for the positions, to avoid having to\r\n    // reallocate them all on every rebase, but also avoid problems with\r\n    // shared position objects being unsafely updated.\r\n    function rebaseHistArray(array, from, to, diff) {\r\n      for (var i = 0; i < array.length; ++i) {\r\n        var sub = array[i], ok = true;\r\n        for (var j = 0; j < sub.changes.length; ++j) {\r\n          var cur = sub.changes[j];\r\n          if (!sub.copied) { cur.from = copyPos(cur.from); cur.to = copyPos(cur.to); }\r\n          if (to < cur.from.line) {\r\n            cur.from.line += diff;\r\n            cur.to.line += diff;\r\n          } else if (from <= cur.to.line) {\r\n            ok = false;\r\n            break;\r\n          }\r\n        }\r\n        if (!sub.copied) {\r\n          sub.anchorBefore = copyPos(sub.anchorBefore); sub.headBefore = copyPos(sub.headBefore);\r\n          sub.anchorAfter = copyPos(sub.anchorAfter); sub.readAfter = copyPos(sub.headAfter);\r\n          sub.copied = true;\r\n        }\r\n        if (!ok) {\r\n          array.splice(0, i + 1);\r\n          i = 0;\r\n        } else {\r\n          rebaseHistSel(sub.anchorBefore); rebaseHistSel(sub.headBefore);\r\n          rebaseHistSel(sub.anchorAfter); rebaseHistSel(sub.headAfter);\r\n        }\r\n      }\r\n    }\r\n  \r\n    function rebaseHist(hist, change) {\r\n      var from = change.from.line, to = change.to.line, diff = change.text.length - (to - from) - 1;\r\n      rebaseHistArray(hist.done, from, to, diff);\r\n      rebaseHistArray(hist.undone, from, to, diff);\r\n    }\r\n  \r\n    // EVENT OPERATORS\r\n  \r\n    function stopMethod() {e_stop(this);}\r\n    // Ensure an event has a stop method.\r\n    function addStop(event) {\r\n      if (!event.stop) event.stop = stopMethod;\r\n      return event;\r\n    }\r\n  \r\n    function e_preventDefault(e) {\r\n      if (e.preventDefault) e.preventDefault();\r\n      else e.returnValue = false;\r\n    }\r\n    function e_stopPropagation(e) {\r\n      if (e.stopPropagation) e.stopPropagation();\r\n      else e.cancelBubble = true;\r\n    }\r\n    function e_defaultPrevented(e) {\r\n      return e.defaultPrevented != null ? e.defaultPrevented : e.returnValue == false;\r\n    }\r\n    function e_stop(e) {e_preventDefault(e); e_stopPropagation(e);}\r\n    CodeMirror.e_stop = e_stop;\r\n    CodeMirror.e_preventDefault = e_preventDefault;\r\n    CodeMirror.e_stopPropagation = e_stopPropagation;\r\n  \r\n    function e_target(e) {return e.target || e.srcElement;}\r\n    function e_button(e) {\r\n      var b = e.which;\r\n      if (b == null) {\r\n        if (e.button & 1) b = 1;\r\n        else if (e.button & 2) b = 3;\r\n        else if (e.button & 4) b = 2;\r\n      }\r\n      if (mac && e.ctrlKey && b == 1) b = 3;\r\n      return b;\r\n    }\r\n  \r\n    // EVENT HANDLING\r\n  \r\n    function on(emitter, type, f) {\r\n      if (emitter.addEventListener)\r\n        emitter.addEventListener(type, f, false);\r\n      else if (emitter.attachEvent)\r\n        emitter.attachEvent(\"on\" + type, f);\r\n      else {\r\n        var map = emitter._handlers || (emitter._handlers = {});\r\n        var arr = map[type] || (map[type] = []);\r\n        arr.push(f);\r\n      }\r\n    }\r\n  \r\n    function off(emitter, type, f) {\r\n      if (emitter.removeEventListener)\r\n        emitter.removeEventListener(type, f, false);\r\n      else if (emitter.detachEvent)\r\n        emitter.detachEvent(\"on\" + type, f);\r\n      else {\r\n        var arr = emitter._handlers && emitter._handlers[type];\r\n        if (!arr) return;\r\n        for (var i = 0; i < arr.length; ++i)\r\n          if (arr[i] == f) { arr.splice(i, 1); break; }\r\n      }\r\n    }\r\n  \r\n    function signal(emitter, type /*, values...*/) {\r\n      var arr = emitter._handlers && emitter._handlers[type];\r\n      if (!arr) return;\r\n      var args = Array.prototype.slice.call(arguments, 2);\r\n      for (var i = 0; i < arr.length; ++i) arr[i].apply(null, args);\r\n    }\r\n  \r\n    var delayedCallbacks, delayedCallbackDepth = 0;\r\n    function signalLater(emitter, type /*, values...*/) {\r\n      var arr = emitter._handlers && emitter._handlers[type];\r\n      if (!arr) return;\r\n      var args = Array.prototype.slice.call(arguments, 2);\r\n      if (!delayedCallbacks) {\r\n        ++delayedCallbackDepth;\r\n        delayedCallbacks = [];\r\n        setTimeout(fireDelayed, 0);\r\n      }\r\n      function bnd(f) {return function(){f.apply(null, args);};};\r\n      for (var i = 0; i < arr.length; ++i)\r\n        delayedCallbacks.push(bnd(arr[i]));\r\n    }\r\n  \r\n    function signalDOMEvent(cm, e, override) {\r\n      signal(cm, override || e.type, cm, e);\r\n      return e_defaultPrevented(e) || e.codemirrorIgnore;\r\n    }\r\n  \r\n    function fireDelayed() {\r\n      --delayedCallbackDepth;\r\n      var delayed = delayedCallbacks;\r\n      delayedCallbacks = null;\r\n      for (var i = 0; i < delayed.length; ++i) delayed[i]();\r\n    }\r\n  \r\n    function hasHandler(emitter, type) {\r\n      var arr = emitter._handlers && emitter._handlers[type];\r\n      return arr && arr.length > 0;\r\n    }\r\n  \r\n    CodeMirror.on = on; CodeMirror.off = off; CodeMirror.signal = signal;\r\n  \r\n    function eventMixin(ctor) {\r\n      ctor.prototype.on = function(type, f) {on(this, type, f);};\r\n      ctor.prototype.off = function(type, f) {off(this, type, f);};\r\n    }\r\n  \r\n    // MISC UTILITIES\r\n  \r\n    // Number of pixels added to scroller and sizer to hide scrollbar\r\n    var scrollerCutOff = 30;\r\n  \r\n    // Returned or thrown by various protocols to signal 'I'm not\r\n    // handling this'.\r\n    var Pass = CodeMirror.Pass = {toString: function(){return \"CodeMirror.Pass\";}};\r\n  \r\n    function Delayed() {this.id = null;}\r\n    Delayed.prototype = {set: function(ms, f) {clearTimeout(this.id); this.id = setTimeout(f, ms);}};\r\n  \r\n    // Counts the column offset in a string, taking tabs into account.\r\n    // Used mostly to find indentation.\r\n    function countColumn(string, end, tabSize, startIndex, startValue) {\r\n      if (end == null) {\r\n        end = string.search(/[^\\s\\u00a0]/);\r\n        if (end == -1) end = string.length;\r\n      }\r\n      for (var i = startIndex || 0, n = startValue || 0; i < end; ++i) {\r\n        if (string.charAt(i) == \"\\t\") n += tabSize - (n % tabSize);\r\n        else ++n;\r\n      }\r\n      return n;\r\n    }\r\n    CodeMirror.countColumn = countColumn;\r\n  \r\n    var spaceStrs = [\"\"];\r\n    function spaceStr(n) {\r\n      while (spaceStrs.length <= n)\r\n        spaceStrs.push(lst(spaceStrs) + \" \");\r\n      return spaceStrs[n];\r\n    }\r\n  \r\n    function lst(arr) { return arr[arr.length-1]; }\r\n  \r\n    function selectInput(node) {\r\n      if (ios) { // Mobile Safari apparently has a bug where select() is broken.\r\n        node.selectionStart = 0;\r\n        node.selectionEnd = node.value.length;\r\n      } else {\r\n        // Suppress mysterious IE10 errors\r\n        try { node.select(); }\r\n        catch(_e) {}\r\n      }\r\n    }\r\n  \r\n    function indexOf(collection, elt) {\r\n      if (collection.indexOf) return collection.indexOf(elt);\r\n      for (var i = 0, e = collection.length; i < e; ++i)\r\n        if (collection[i] == elt) return i;\r\n      return -1;\r\n    }\r\n  \r\n    function createObj(base, props) {\r\n      function Obj() {}\r\n      Obj.prototype = base;\r\n      var inst = new Obj();\r\n      if (props) copyObj(props, inst);\r\n      return inst;\r\n    }\r\n  \r\n    function copyObj(obj, target) {\r\n      if (!target) target = {};\r\n      for (var prop in obj) if (obj.hasOwnProperty(prop)) target[prop] = obj[prop];\r\n      return target;\r\n    }\r\n  \r\n    function emptyArray(size) {\r\n      for (var a = [], i = 0; i < size; ++i) a.push(undefined);\r\n      return a;\r\n    }\r\n  \r\n    function bind(f) {\r\n      var args = Array.prototype.slice.call(arguments, 1);\r\n      return function(){return f.apply(null, args);};\r\n    }\r\n  \r\n    var nonASCIISingleCaseWordChar = /[\\u3040-\\u309f\\u30a0-\\u30ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\uac00-\\ud7af]/;\r\n    function isWordChar(ch) {\r\n      return /\\w/.test(ch) || ch > \"\\x80\" &&\r\n        (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch));\r\n    }\r\n  \r\n    function isEmpty(obj) {\r\n      for (var n in obj) if (obj.hasOwnProperty(n) && obj[n]) return false;\r\n      return true;\r\n    }\r\n  \r\n    var isExtendingChar = /[\\u0300-\\u036F\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05BD\\u05BF\\u05C1-\\u05C2\\u05C4-\\u05C5\\u05C7\\u0610-\\u061A\\u064B-\\u065F\\u0670\\u06D6-\\u06DC\\u06DF-\\u06E4\\u06E7-\\u06E8\\u06EA-\\u06ED\\uA66F\\u1DC0\\u1DFF\\u20D0\\u20FF\\uA670-\\uA672\\uA674-\\uA67D\\uA69F\\udc00-\\udfff\\uFE20\\uFE2F]/;\r\n  \r\n    // DOM UTILITIES\r\n  \r\n    function elt(tag, content, className, style) {\r\n      var e = document.createElement(tag);\r\n      if (className) e.className = className;\r\n      if (style) e.style.cssText = style;\r\n      if (typeof content == \"string\") setTextContent(e, content);\r\n      else if (content) for (var i = 0; i < content.length; ++i) e.appendChild(content[i]);\r\n      return e;\r\n    }\r\n  \r\n    function removeChildren(e) {\r\n      for (var count = e.childNodes.length; count > 0; --count)\r\n        e.removeChild(e.firstChild);\r\n      return e;\r\n    }\r\n  \r\n    function removeChildrenAndAdd(parent, e) {\r\n      return removeChildren(parent).appendChild(e);\r\n    }\r\n  \r\n    function setTextContent(e, str) {\r\n      if (ie_lt9) {\r\n        e.innerHTML = \"\";\r\n        e.appendChild(document.createTextNode(str));\r\n      } else e.textContent = str;\r\n    }\r\n  \r\n    function getRect(node) {\r\n      return node.getBoundingClientRect();\r\n    }\r\n    CodeMirror.replaceGetRect = function(f) { getRect = f; };\r\n  \r\n    // FEATURE DETECTION\r\n  \r\n    // Detect drag-and-drop\r\n    var dragAndDrop = function() {\r\n      // There is *some* kind of drag-and-drop support in IE6-8, but I\r\n      // couldn't get it to work yet.\r\n      if (ie_lt9) return false;\r\n      var div = elt('div');\r\n      return \"draggable\" in div || \"dragDrop\" in div;\r\n    }();\r\n  \r\n    // For a reason I have yet to figure out, some browsers disallow\r\n    // word wrapping between certain characters *only* if a new inline\r\n    // element is started between them. This makes it hard to reliably\r\n    // measure the position of things, since that requires inserting an\r\n    // extra span. This terribly fragile set of tests matches the\r\n    // character combinations that suffer from this phenomenon on the\r\n    // various browsers.\r\n    function spanAffectsWrapping() { return false; }\r\n    if (gecko) // Only for \"$'\"\r\n      spanAffectsWrapping = function(str, i) {\r\n        return str.charCodeAt(i - 1) == 36 && str.charCodeAt(i) == 39;\r\n      };\r\n    else if (safari && !/Version\\/([6-9]|\\d\\d)\\b/.test(navigator.userAgent))\r\n      spanAffectsWrapping = function(str, i) {\r\n        return /\\-[^ \\-?]|\\?[^ !\\'\\\"\\),.\\-\\/:;\\?\\]\\}]/.test(str.slice(i - 1, i + 1));\r\n      };\r\n    else if (webkit && /Chrome\\/(?:29|[3-9]\\d|\\d\\d\\d)\\./.test(navigator.userAgent))\r\n      spanAffectsWrapping = function(str, i) {\r\n        var code = str.charCodeAt(i - 1);\r\n        return code >= 8208 && code <= 8212;\r\n      };\r\n    else if (webkit)\r\n      spanAffectsWrapping = function(str, i) {\r\n        if (i > 1 && str.charCodeAt(i - 1) == 45) {\r\n          if (/\\w/.test(str.charAt(i - 2)) && /[^\\-?\\.]/.test(str.charAt(i))) return true;\r\n          if (i > 2 && /[\\d\\.,]/.test(str.charAt(i - 2)) && /[\\d\\.,]/.test(str.charAt(i))) return false;\r\n        }\r\n        return /[~!#%&*)=+}\\]\\\\|\\\"\\.>,:;][({[<]|-[^\\-?\\.\\u2010-\\u201f\\u2026]|\\?[\\w~`@#$%\\^&*(_=+{[|><]|[\\w~`@#$%\\^&*(_=+{[><]/.test(str.slice(i - 1, i + 1));\r\n      };\r\n  \r\n    var knownScrollbarWidth;\r\n    function scrollbarWidth(measure) {\r\n      if (knownScrollbarWidth != null) return knownScrollbarWidth;\r\n      var test = elt(\"div\", null, null, \"width: 50px; height: 50px; overflow-x: scroll\");\r\n      removeChildrenAndAdd(measure, test);\r\n      if (test.offsetWidth)\r\n        knownScrollbarWidth = test.offsetHeight - test.clientHeight;\r\n      return knownScrollbarWidth || 0;\r\n    }\r\n  \r\n    var zwspSupported;\r\n    function zeroWidthElement(measure) {\r\n      if (zwspSupported == null) {\r\n        var test = elt(\"span\", \"\\u200b\");\r\n        removeChildrenAndAdd(measure, elt(\"span\", [test, document.createTextNode(\"x\")]));\r\n        if (measure.firstChild.offsetHeight != 0)\r\n          zwspSupported = test.offsetWidth <= 1 && test.offsetHeight > 2 && !ie_lt8;\r\n      }\r\n      if (zwspSupported) return elt(\"span\", \"\\u200b\");\r\n      else return elt(\"span\", \"\\u00a0\", null, \"display: inline-block; width: 1px; margin-right: -1px\");\r\n    }\r\n  \r\n    // See if \"\".split is the broken IE version, if so, provide an\r\n    // alternative way to split lines.\r\n    var splitLines = \"\\n\\nb\".split(/\\n/).length != 3 ? function(string) {\r\n      var pos = 0, result = [], l = string.length;\r\n      while (pos <= l) {\r\n        var nl = string.indexOf(\"\\n\", pos);\r\n        if (nl == -1) nl = string.length;\r\n        var line = string.slice(pos, string.charAt(nl - 1) == \"\\r\" ? nl - 1 : nl);\r\n        var rt = line.indexOf(\"\\r\");\r\n        if (rt != -1) {\r\n          result.push(line.slice(0, rt));\r\n          pos += rt + 1;\r\n        } else {\r\n          result.push(line);\r\n          pos = nl + 1;\r\n        }\r\n      }\r\n      return result;\r\n    } : function(string){return string.split(/\\r\\n?|\\n/);};\r\n    CodeMirror.splitLines = splitLines;\r\n  \r\n    var hasSelection = window.getSelection ? function(te) {\r\n      try { return te.selectionStart != te.selectionEnd; }\r\n      catch(e) { return false; }\r\n    } : function(te) {\r\n      try {var range = te.ownerDocument.selection.createRange();}\r\n      catch(e) {}\r\n      if (!range || range.parentElement() != te) return false;\r\n      return range.compareEndPoints(\"StartToEnd\", range) != 0;\r\n    };\r\n  \r\n    var hasCopyEvent = (function() {\r\n      var e = elt(\"div\");\r\n      if (\"oncopy\" in e) return true;\r\n      e.setAttribute(\"oncopy\", \"return;\");\r\n      return typeof e.oncopy == 'function';\r\n    })();\r\n  \r\n    // KEY NAMING\r\n  \r\n    var keyNames = {3: \"Enter\", 8: \"Backspace\", 9: \"Tab\", 13: \"Enter\", 16: \"Shift\", 17: \"Ctrl\", 18: \"Alt\",\r\n                    19: \"Pause\", 20: \"CapsLock\", 27: \"Esc\", 32: \"Space\", 33: \"PageUp\", 34: \"PageDown\", 35: \"End\",\r\n                    36: \"Home\", 37: \"Left\", 38: \"Up\", 39: \"Right\", 40: \"Down\", 44: \"PrintScrn\", 45: \"Insert\",\r\n                    46: \"Delete\", 59: \";\", 91: \"Mod\", 92: \"Mod\", 93: \"Mod\", 109: \"-\", 107: \"=\", 127: \"Delete\",\r\n                    186: \";\", 187: \"=\", 188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\",\r\n                    221: \"]\", 222: \"'\", 63276: \"PageUp\", 63277: \"PageDown\", 63275: \"End\", 63273: \"Home\",\r\n                    63234: \"Left\", 63232: \"Up\", 63235: \"Right\", 63233: \"Down\", 63302: \"Insert\", 63272: \"Delete\"};\r\n    CodeMirror.keyNames = keyNames;\r\n    (function() {\r\n      // Number keys\r\n      for (var i = 0; i < 10; i++) keyNames[i + 48] = String(i);\r\n      // Alphabetic keys\r\n      for (var i = 65; i <= 90; i++) keyNames[i] = String.fromCharCode(i);\r\n      // Function keys\r\n      for (var i = 1; i <= 12; i++) keyNames[i + 111] = keyNames[i + 63235] = \"F\" + i;\r\n    })();\r\n  \r\n    // BIDI HELPERS\r\n  \r\n    function iterateBidiSections(order, from, to, f) {\r\n      if (!order) return f(from, to, \"ltr\");\r\n      var found = false;\r\n      for (var i = 0; i < order.length; ++i) {\r\n        var part = order[i];\r\n        if (part.from < to && part.to > from || from == to && part.to == from) {\r\n          f(Math.max(part.from, from), Math.min(part.to, to), part.level == 1 ? \"rtl\" : \"ltr\");\r\n          found = true;\r\n        }\r\n      }\r\n      if (!found) f(from, to, \"ltr\");\r\n    }\r\n  \r\n    function bidiLeft(part) { return part.level % 2 ? part.to : part.from; }\r\n    function bidiRight(part) { return part.level % 2 ? part.from : part.to; }\r\n  \r\n    function lineLeft(line) { var order = getOrder(line); return order ? bidiLeft(order[0]) : 0; }\r\n    function lineRight(line) {\r\n      var order = getOrder(line);\r\n      if (!order) return line.text.length;\r\n      return bidiRight(lst(order));\r\n    }\r\n  \r\n    function lineStart(cm, lineN) {\r\n      var line = getLine(cm.doc, lineN);\r\n      var visual = visualLine(cm.doc, line);\r\n      if (visual != line) lineN = lineNo(visual);\r\n      var order = getOrder(visual);\r\n      var ch = !order ? 0 : order[0].level % 2 ? lineRight(visual) : lineLeft(visual);\r\n      return Pos(lineN, ch);\r\n    }\r\n    function lineEnd(cm, lineN) {\r\n      var merged, line;\r\n      while (merged = collapsedSpanAtEnd(line = getLine(cm.doc, lineN)))\r\n        lineN = merged.find().to.line;\r\n      var order = getOrder(line);\r\n      var ch = !order ? line.text.length : order[0].level % 2 ? lineLeft(line) : lineRight(line);\r\n      return Pos(lineN, ch);\r\n    }\r\n  \r\n    function compareBidiLevel(order, a, b) {\r\n      var linedir = order[0].level;\r\n      if (a == linedir) return true;\r\n      if (b == linedir) return false;\r\n      return a < b;\r\n    }\r\n    var bidiOther;\r\n    function getBidiPartAt(order, pos) {\r\n      for (var i = 0, found; i < order.length; ++i) {\r\n        var cur = order[i];\r\n        if (cur.from < pos && cur.to > pos) { bidiOther = null; return i; }\r\n        if (cur.from == pos || cur.to == pos) {\r\n          if (found == null) {\r\n            found = i;\r\n          } else if (compareBidiLevel(order, cur.level, order[found].level)) {\r\n            bidiOther = found;\r\n            return i;\r\n          } else {\r\n            bidiOther = i;\r\n            return found;\r\n          }\r\n        }\r\n      }\r\n      bidiOther = null;\r\n      return found;\r\n    }\r\n  \r\n    function moveInLine(line, pos, dir, byUnit) {\r\n      if (!byUnit) return pos + dir;\r\n      do pos += dir;\r\n      while (pos > 0 && isExtendingChar.test(line.text.charAt(pos)));\r\n      return pos;\r\n    }\r\n  \r\n    // This is somewhat involved. It is needed in order to move\r\n    // 'visually' through bi-directional text -- i.e., pressing left\r\n    // should make the cursor go left, even when in RTL text. The\r\n    // tricky part is the 'jumps', where RTL and LTR text touch each\r\n    // other. This often requires the cursor offset to move more than\r\n    // one unit, in order to visually move one unit.\r\n    function moveVisually(line, start, dir, byUnit) {\r\n      var bidi = getOrder(line);\r\n      if (!bidi) return moveLogically(line, start, dir, byUnit);\r\n      var pos = getBidiPartAt(bidi, start), part = bidi[pos];\r\n      var target = moveInLine(line, start, part.level % 2 ? -dir : dir, byUnit);\r\n  \r\n      for (;;) {\r\n        if (target > part.from && target < part.to) return target;\r\n        if (target == part.from || target == part.to) {\r\n          if (getBidiPartAt(bidi, target) == pos) return target;\r\n          part = bidi[pos += dir];\r\n          return (dir > 0) == part.level % 2 ? part.to : part.from;\r\n        } else {\r\n          part = bidi[pos += dir];\r\n          if (!part) return null;\r\n          if ((dir > 0) == part.level % 2)\r\n            target = moveInLine(line, part.to, -1, byUnit);\r\n          else\r\n            target = moveInLine(line, part.from, 1, byUnit);\r\n        }\r\n      }\r\n    }\r\n  \r\n    function moveLogically(line, start, dir, byUnit) {\r\n      var target = start + dir;\r\n      if (byUnit) while (target > 0 && isExtendingChar.test(line.text.charAt(target))) target += dir;\r\n      return target < 0 || target > line.text.length ? null : target;\r\n    }\r\n  \r\n    // Bidirectional ordering algorithm\r\n    // See http://unicode.org/reports/tr9/tr9-13.html for the algorithm\r\n    // that this (partially) implements.\r\n  \r\n    // One-char codes used for character types:\r\n    // L (L):   Left-to-Right\r\n    // R (R):   Right-to-Left\r\n    // r (AL):  Right-to-Left Arabic\r\n    // 1 (EN):  European Number\r\n    // + (ES):  European Number Separator\r\n    // % (ET):  European Number Terminator\r\n    // n (AN):  Arabic Number\r\n    // , (CS):  Common Number Separator\r\n    // m (NSM): Non-Spacing Mark\r\n    // b (BN):  Boundary Neutral\r\n    // s (B):   Paragraph Separator\r\n    // t (S):   Segment Separator\r\n    // w (WS):  Whitespace\r\n    // N (ON):  Other Neutrals\r\n  \r\n    // Returns null if characters are ordered as they appear\r\n    // (left-to-right), or an array of sections ({from, to, level}\r\n    // objects) in the order in which they occur visually.\r\n    var bidiOrdering = (function() {\r\n      // Character types for codepoints 0 to 0xff\r\n      var lowTypes = \"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL\";\r\n      // Character types for codepoints 0x600 to 0x6ff\r\n      var arabicTypes = \"rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr\";\r\n      function charType(code) {\r\n        if (code <= 0xff) return lowTypes.charAt(code);\r\n        else if (0x590 <= code && code <= 0x5f4) return \"R\";\r\n        else if (0x600 <= code && code <= 0x6ff) return arabicTypes.charAt(code - 0x600);\r\n        else if (0x700 <= code && code <= 0x8ac) return \"r\";\r\n        else return \"L\";\r\n      }\r\n  \r\n      var bidiRE = /[\\u0590-\\u05f4\\u0600-\\u06ff\\u0700-\\u08ac]/;\r\n      var isNeutral = /[stwN]/, isStrong = /[LRr]/, countsAsLeft = /[Lb1n]/, countsAsNum = /[1n]/;\r\n      // Browsers seem to always treat the boundaries of block elements as being L.\r\n      var outerType = \"L\";\r\n  \r\n      return function(str) {\r\n        if (!bidiRE.test(str)) return false;\r\n        var len = str.length, types = [];\r\n        for (var i = 0, type; i < len; ++i)\r\n          types.push(type = charType(str.charCodeAt(i)));\r\n  \r\n        // W1. Examine each non-spacing mark (NSM) in the level run, and\r\n        // change the type of the NSM to the type of the previous\r\n        // character. If the NSM is at the start of the level run, it will\r\n        // get the type of sor.\r\n        for (var i = 0, prev = outerType; i < len; ++i) {\r\n          var type = types[i];\r\n          if (type == \"m\") types[i] = prev;\r\n          else prev = type;\r\n        }\r\n  \r\n        // W2. Search backwards from each instance of a European number\r\n        // until the first strong type (R, L, AL, or sor) is found. If an\r\n        // AL is found, change the type of the European number to Arabic\r\n        // number.\r\n        // W3. Change all ALs to R.\r\n        for (var i = 0, cur = outerType; i < len; ++i) {\r\n          var type = types[i];\r\n          if (type == \"1\" && cur == \"r\") types[i] = \"n\";\r\n          else if (isStrong.test(type)) { cur = type; if (type == \"r\") types[i] = \"R\"; }\r\n        }\r\n  \r\n        // W4. A single European separator between two European numbers\r\n        // changes to a European number. A single common separator between\r\n        // two numbers of the same type changes to that type.\r\n        for (var i = 1, prev = types[0]; i < len - 1; ++i) {\r\n          var type = types[i];\r\n          if (type == \"+\" && prev == \"1\" && types[i+1] == \"1\") types[i] = \"1\";\r\n          else if (type == \",\" && prev == types[i+1] &&\r\n                   (prev == \"1\" || prev == \"n\")) types[i] = prev;\r\n          prev = type;\r\n        }\r\n  \r\n        // W5. A sequence of European terminators adjacent to European\r\n        // numbers changes to all European numbers.\r\n        // W6. Otherwise, separators and terminators change to Other\r\n        // Neutral.\r\n        for (var i = 0; i < len; ++i) {\r\n          var type = types[i];\r\n          if (type == \",\") types[i] = \"N\";\r\n          else if (type == \"%\") {\r\n            for (var end = i + 1; end < len && types[end] == \"%\"; ++end) {}\r\n            var replace = (i && types[i-1] == \"!\") || (end < len - 1 && types[end] == \"1\") ? \"1\" : \"N\";\r\n            for (var j = i; j < end; ++j) types[j] = replace;\r\n            i = end - 1;\r\n          }\r\n        }\r\n  \r\n        // W7. Search backwards from each instance of a European number\r\n        // until the first strong type (R, L, or sor) is found. If an L is\r\n        // found, then change the type of the European number to L.\r\n        for (var i = 0, cur = outerType; i < len; ++i) {\r\n          var type = types[i];\r\n          if (cur == \"L\" && type == \"1\") types[i] = \"L\";\r\n          else if (isStrong.test(type)) cur = type;\r\n        }\r\n  \r\n        // N1. A sequence of neutrals takes the direction of the\r\n        // surrounding strong text if the text on both sides has the same\r\n        // direction. European and Arabic numbers act as if they were R in\r\n        // terms of their influence on neutrals. Start-of-level-run (sor)\r\n        // and end-of-level-run (eor) are used at level run boundaries.\r\n        // N2. Any remaining neutrals take the embedding direction.\r\n        for (var i = 0; i < len; ++i) {\r\n          if (isNeutral.test(types[i])) {\r\n            for (var end = i + 1; end < len && isNeutral.test(types[end]); ++end) {}\r\n            var before = (i ? types[i-1] : outerType) == \"L\";\r\n            var after = (end < len - 1 ? types[end] : outerType) == \"L\";\r\n            var replace = before || after ? \"L\" : \"R\";\r\n            for (var j = i; j < end; ++j) types[j] = replace;\r\n            i = end - 1;\r\n          }\r\n        }\r\n  \r\n        // Here we depart from the documented algorithm, in order to avoid\r\n        // building up an actual levels array. Since there are only three\r\n        // levels (0, 1, 2) in an implementation that doesn't take\r\n        // explicit embedding into account, we can build up the order on\r\n        // the fly, without following the level-based algorithm.\r\n        var order = [], m;\r\n        for (var i = 0; i < len;) {\r\n          if (countsAsLeft.test(types[i])) {\r\n            var start = i;\r\n            for (++i; i < len && countsAsLeft.test(types[i]); ++i) {}\r\n            order.push({from: start, to: i, level: 0});\r\n          } else {\r\n            var pos = i, at = order.length;\r\n            for (++i; i < len && types[i] != \"L\"; ++i) {}\r\n            for (var j = pos; j < i;) {\r\n              if (countsAsNum.test(types[j])) {\r\n                if (pos < j) order.splice(at, 0, {from: pos, to: j, level: 1});\r\n                var nstart = j;\r\n                for (++j; j < i && countsAsNum.test(types[j]); ++j) {}\r\n                order.splice(at, 0, {from: nstart, to: j, level: 2});\r\n                pos = j;\r\n              } else ++j;\r\n            }\r\n            if (pos < i) order.splice(at, 0, {from: pos, to: i, level: 1});\r\n          }\r\n        }\r\n        if (order[0].level == 1 && (m = str.match(/^\\s+/))) {\r\n          order[0].from = m[0].length;\r\n          order.unshift({from: 0, to: m[0].length, level: 0});\r\n        }\r\n        if (lst(order).level == 1 && (m = str.match(/\\s+$/))) {\r\n          lst(order).to -= m[0].length;\r\n          order.push({from: len - m[0].length, to: len, level: 0});\r\n        }\r\n        if (order[0].level != lst(order).level)\r\n          order.push({from: len, to: len, level: order[0].level});\r\n  \r\n        return order;\r\n      };\r\n    })();\r\n  \r\n    // THE END\r\n  \r\n    CodeMirror.version = \"3.20.0\";\r\n  \r\n    return CodeMirror;\r\n  })();\r\n  "],"names":["window","CodeMirror","gecko","test","navigator","userAgent","ie","ie_lt8","document","documentMode","ie_lt9","ie_gt10","webkit","qtwebkit","chrome","opera","safari","vendor","khtml","mac_geLion","mac_geMountainLion","phantom","ios","mobile","mac","platform","windows","opera_version","match","Number","measureText","flipCtrlCmd","captureMiddleClick","sawReadOnlySpans","sawCollapsedSpans","place","options","this","opt","defaults","hasOwnProperty","setGuttersForLineNumbers","docStart","value","first","display","d","input","elt","style","width","setAttribute","border","inputDiv","scrollbarH","scrollbarV","scrollbarFiller","gutterFiller","lineDiv","selectionDiv","cursor","otherCursor","measure","lineSpace","mover","sizer","heightForcer","scrollerCutOff","gutters","lineGutter","scroller","wrapper","zIndex","paddingRight","appendChild","draggable","height","position","minWidth","viewOffset","lastSizeC","showingFrom","showingTo","lineNumWidth","lineNumInnerWidth","lineNumChars","prevInput","alignWidgets","pollingFast","poll","Delayed","cachedCharWidth","cachedTextHeight","measureLineCache","measureLineCachePos","inaccurateSelection","maxLine","maxLineLength","maxLineChanged","wheelDX","wheelDY","wheelStartX","wheelStartY","makeDisplay","updateGutters","autofocus","focusInput","state","keyMaps","overlays","modeGen","overwrite","focused","suppressEdits","pasteIncoming","draggingText","highlight","themeChanged","lineWrapping","className","hasFocus","doc","Doc","mode","operation","attachDoc","setTimeout","bind","resetInput","cm","resizeTimer","on","onMouseDown","e","signalDOMEvent","pos","posFromMouse","clickInGutter","eventInWidget","e_preventDefault","word","findWordAt","getLine","line","text","extendSelection","from","to","onContextMenu","reFocus","onResize","knownScrollbarWidth","clearCaches","runInOp","regChange","unregister","p","parentNode","body","off","drag_","onDragEvent","addStop","e_stop","clientHeight","setScrollTop","scrollTop","setScrollLeft","scrollLeft","signal","onScrollWheel","onKeyEvent","keyCode","sel","shift","inputHasSelection","fastPoll","onKeyDown","onKeyPress","onFocus","onBlur","dragDrop","Date","lastDrop","txt","getSelection","dataTransfer","setData","setDragImage","img","src","_top","offsetTop","removeChild","onDragStart","onDrop","prepareCopy","selectInput","fakedLastChar","lastMiddleDown","start","selectionStart","end","selectionEnd","activeElement","blur","registerEventHandlers","optionHandlers","propertyIsEnumerable","Init","i","initHooks","length","loadMode","getMode","modeOption","iter","stateAfter","styles","frontier","startWorker","curOp","estimateHeight","th","textHeight","wrapping","perLine","Math","max","clientWidth","charWidth","lineIsHidden","ceil","estimateLineHeights","est","estHeight","updateLineHeight","keyMapChanged","map","keyMap","replace","disableInput","theme","guttersChanged","alignHorizontally","specs","removeChildren","gutterClass","gElt","lineLength","merged","len","cur","collapsedSpanAtStart","found","find","ch","collapsedSpanAtEnd","computeMaxLength","indexOf","lineNumbers","concat","slice","splice","updateScrollbars","totalHeight","paddingVert","minHeight","top","scrollHeight","needsH","scrollWidth","needsV","bottom","scrollbarWidth","firstChild","right","coverGutterNextToScrollbar","fixedGutter","offsetWidth","pointerEvents","visibleLines","viewPort","floor","paddingTop","lineAtHeight","comp","compensateForHScroll","gutterW","l","n","nextSibling","alignable","a","left","lineNumberFor","String","lineNumberFormatter","firstLineNumber","getRect","updateDisplay","changes","forced","updated","oldFrom","oldTo","visible","oldWidth","updateDisplayInner","updateSelection","min","signalLater","last","size","innerW","padding","maybeUpdateLineNumberWidth","marginLeft","positionsChangedFrom","Infinity","diff","viewportMargin","lineNo","visualLine","intact","change","intact2","j","l2","range","push","computeIntact","newTo","intactLines","sort","b","updateNumbersFrom","dims","offsetLeft","fixedPos","gutterTotalWidth","gutterLeft","gutterWidth","wrapperWidth","getDimensions","currentWheelTarget","container","rm","node","next","lineObj","nextIntact","lineN","widgets","previousSibling","w","showIfHidden","prev","nodeName","wrap","replaceChild","wnode","handleMouseEvents","ignoreEvents","positionLineWidget","lineNumber","setTextContent","reuse","search","lineNode","built","buildLineContent","lineElement","pre","markers","gutterMarkers","bgClass","wrapClass","isOk","widgetsSeen","insertBefore","widget","above","gutterWrap","k","id","ws","buildLineElement","patchDisplay","offsetHeight","focus","prevBottom","bot","box","updateHeightsInViewport","updateViewOffset","heightAtLine","noHScroll","coverGutter","paddingLeft","collapsed","posEq","showCursorWhenSelecting","cursorCoords","head","cursorHeight","other","updateSelectionCursor","fragment","createDocumentFragment","pl","removeChildrenAndAdd","add","drawForLine","fromArg","toArg","lineLen","coords","bias","charCoords","Pos","order","f","part","level","iterateBidiSections","getOrder","dir","rightPos","leftPos","tmp","fromLine","toLine","singleVLine","leftEnd","rightStart","updateSelectionRange","moveInputWithCursor","headPos","wrapOff","lineOff","restartBlink","clearInterval","blinker","visibility","cursorBlinkRate","setInterval","time","startState","set","highlightWorker","prevChange","workTime","copyState","getStateBefore","changed","oldStyles","highlightLine","ischange","processLine","workDelay","precise","minindent","minline","lim","innerMode","indented","countColumn","tabSize","findStartLine","save","measureChar","data","measureLine","crude","r","leftSide","rightSide","findCachedMeasurement","cache","memo","markedSpans","classes","textClass","cached","measureLineInner","crudeMeasuringFrom","copy","Line","crudelyMeasureLine","emptyArray","childNodes","chunks","outer","vranges","maxBot","measureRect","rect","rtop","rbot","finishRect","getClientRects","nodeType","rects","measureRight","pageScrollX","pageXOffset","documentElement","pageScrollY","pageYOffset","intoCoordSystem","context","widgetHeight","yOff","lOff","xOff","fromCoordSystem","localBox","lineSpaceBox","measurement","get","m","getBidi","partPos","bidiLeft","bidiRight","val","getBidiPartAt","bidiOther","PosWithInfo","outside","xRel","coordsChar","x","y","coordsCharInner","mergedPos","innerOff","wrongLine","adjust","getX","sp","bidi","dist","lineLeft","lineRight","fromX","fromOutside","toX","toOutside","moveVisually","xDiff","isExtendingChar","charAt","step","middle","middleX","createTextNode","anchor","lastClick","lastDoubleClick","nextOpId","startOperation","forceUpdate","updateInput","userSelChange","textChanged","selectionChanged","cursorActivity","updateMaxLine","updateScrollPos","delayedCallbackDepth","delayedCallbacks","endOperation","newScrollPos","op","hasBadSpan","zeroWidthElement","measureLineWidth","maxScrollLeft","calculateScrollPos","scrollToPos","scrollPosIntoView","clipPos","margin","cursorScrollMargin","doScroll","innerHeight","hidden","scrollIntoView","scrollCursorIntoView","delayed","maybeHiddenMarkers","unhidden","maybeUnhiddenMarkers","lines","cm1","withOp","result","apply","arguments","docOperation","lendiff","slowPoll","pollInterval","readInput","missed","hasSelection","isReadOnly","substring","same","charCodeAt","changeEvent","splitLines","origin","makeChange","user","minimal","selected","content","hasCopyEvent","readOnly","cantEdit","e_target","liberal","target","space","clientX","clientY","shiftKey","e_button","call","now","type","selectLine","dragAndDrop","posLess","dragEnd","e2","abs","startstart","startend","lastPos","editorSize","counter","move","extend","done","up","curCount","doSelect","gutterEvent","prevent","signalfn","mX","mY","lineBox","hasHandler","e_defaultPrevented","g","files","FileReader","File","Array","read","loadFile","file","reader","onload","join","readAsText","getData","curFrom","curTo","setSelection","replaceRange","replaceSelection","isScroller","maybeTransition","wheelSamples","wheelPixelsPerUnit","dx","wheelDeltaX","dy","wheelDeltaY","detail","axis","HORIZONTAL_AXIS","VERTICAL_AXIS","wheelDelta","scroll","pixels","movedX","movedY","sample","doHandleBinding","bound","dropShift","commands","prevShift","Pass","allKeyMaps","maps","extraKeys","handleKeyBinding","startMap","getKeyMap","auto","clearTimeout","isModifierKey","name","keyName","handled","keymaps","lookupKey","motion","oldKeyCode","detectingSelectAll","lastStoppedKey","returnValue","code","metaKey","ctrlKey","charCode","which","fromCharCode","electricChars","smartIndent","indentLine","handleCharBinding","contextMenuInGutter","scrollPos","resetSelectionOnContextMenu","oldCSS","cssText","prepareSelectAllHack","mouseup","rehide","extval","selectAll","changeEnd","lst","clipPostChange","preLine","lastLine","clipToLen","inside","computeSelAfterChange","hint","adjustPos","filterChange","update","obj","canceled","cancel","undefined","selUpdate","ignoreReadOnly","split","mark","marker","parts","mk","newParts","inclusiveLeft","inclusiveRight","removeReadOnlyRanges","makeChangeNoReadonly","selAfter","addToHistory","NaN","makeChangeSingleDoc","stretchSpansOverChange","rebased","linkedDocs","sharedHist","history","rebaseHist","makeChangeFromHistory","hist","event","undone","pop","anti","anchorBefore","anchorAfter","headBefore","headAfter","generation","maxGeneration","filter","historyChangeFromChange","after","mergeOldSpans","shiftDoc","distance","shiftPos","spans","removed","getBetween","recomputeMaxLength","checkWidthStart","updateDoc","changeObj","makeChangeSingleDocInEditor","copyPos","clipLine","linelen","isLine","posBefore","checkAtomic","filtered","filterSelectionChange","goalColumn","skipAtomic","inv","reCheckSelection","mayClear","flipped","curPos","explicitlyCleared","atomic","newPos","endCoords","startTop","startLeft","x1","y1","x2","y2","snapMargin","screen","screentop","docBottom","atTop","atBottom","newTop","screenw","screenleft","gutterw","atLeft","addToScrollPos","how","aggressive","indent","indentation","curSpace","curSpaceString","indentUnit","indentString","indentWithTabs","spaceStr","changeLine","handle","no","findPosH","unit","visually","origDir","possible","moveOnce","boundToLine","moveLogically","sawType","group","isWordChar","hitSide","findPosV","pageSize","startChar","check","prototype","constructor","setOption","option","old","getOption","getDoc","addKeyMap","removeKeyMap","addOverlay","spec","token","Error","modeSpec","opaque","removeOverlay","indentSelection","getTokenAt","stream","StringStream","eol","string","current","getTokenTypeAt","getLineStyles","before","mid","getModeAt","getHelper","helpers","help","helperType","getStateAfter","defaultTextHeight","defaultCharWidth","setGutterMarker","gutterID","isEmpty","clearGutter","addLineClass","where","cls","prop","RegExp","removeLineClass","index","addLineWidget","LineWidget","insertAt","aboveVisible","removeLineWidget","clear","lineInfo","getViewport","addWidget","vert","horiz","vspace","hspace","triggerOnKeyDown","execCommand","cmd","amount","moveH","rtlMoveVisually","deleteH","moveV","toggleOverwrite","scrollTo","getScrollInfo","co","sPos","setSize","interpret","refresh","badHeight","swapDoc","getInputField","getWrapperElement","getScrollerElement","getGutterElement","eventMixin","deflt","notOnInit","toString","setValue","specialChars","source","title","integer","disabled","undoDepth","tabIndex","modes","mimeModes","defineMode","dependencies","defineMIME","mime","resolveMode","createObj","mfactory","modeObj","modeExtensions","exts","skipToEnd","extendMode","properties","copyObj","defineExtension","func","defineDocExtension","defineOption","defineInitHook","nstate","a1","a2","registerHelper","info","firstLine","killLine","getCursor","deleteLine","delLineLeft","undo","redo","goDocStart","goDocEnd","goLineStart","lineStart","goLineStartSmart","getLineHandle","firstNonWS","inWS","goLineEnd","lineEnd","goLineRight","goLineLeft","goLineUp","goLineDown","goPageUp","goPageDown","goCharLeft","goCharRight","goColumnLeft","goColumnRight","goWordLeft","goGroupRight","goGroupLeft","goWordRight","delCharBefore","delCharAfter","delWordBefore","delWordAfter","delGroupBefore","delGroupAfter","indentAuto","indentMore","indentLess","insertTab","defaultTab","somethingSelected","transposeChars","newlineAndIndent","lookup","nofallthrough","fallthrough","Object","keyNames","noShift","altGraphKey","altKey","lastColumnPos","lastColumnValue","TextMarker","markText","shared","primary","replacedWith","cloneNode","linked","isParent","SharedTextMarker","markTextShared","collapsedAtStart","collapsedAtEnd","curLine","span","collapsedSpanAt","attachLine","addMarkedSpan","clearOnEnter","clearHistory","startStyle","endStyle","me","parent","getMarkedSpanFor","removeMarkedSpan","oldFirst","oldLast","startCh","endCh","isInsert","nw","insertLeft","endsAfter","markedSpansBefore","startsBefore","markedSpansAfter","sameLine","offset","newMarkers","gapMarkers","gap","removeClearedSpans","getOldSpans","stretched","oldCur","stretchCur","sps","lineIsHiddenInner","endLine","detachMarkedSpans","detachLine","attachMarkedSpans","basic","Left","Right","Up","Down","End","Home","PageUp","PageDown","Delete","Backspace","Shift-Backspace","Tab","Shift-Tab","Enter","Insert","pcDefault","Ctrl-A","Ctrl-D","Ctrl-Z","Shift-Ctrl-Z","Ctrl-Y","Ctrl-Home","Alt-Up","Ctrl-End","Ctrl-Down","Ctrl-Left","Ctrl-Right","Alt-Left","Alt-Right","Ctrl-Backspace","Ctrl-Delete","Ctrl-S","Ctrl-F","Ctrl-G","Shift-Ctrl-G","Shift-Ctrl-F","Shift-Ctrl-R","Ctrl-[","Ctrl-]","macDefault","Cmd-A","Cmd-D","Cmd-Z","Shift-Cmd-Z","Cmd-Y","Cmd-Up","Cmd-End","Cmd-Down","Cmd-Left","Cmd-Right","Alt-Backspace","Ctrl-Alt-Backspace","Alt-Delete","Cmd-S","Cmd-F","Cmd-G","Shift-Cmd-G","Cmd-Alt-F","Shift-Cmd-Alt-F","Cmd-[","Cmd-]","Cmd-Backspace","emacsy","Ctrl-B","Ctrl-P","Ctrl-N","Alt-F","Alt-B","Ctrl-E","Ctrl-V","Shift-Ctrl-V","Ctrl-H","Alt-D","Ctrl-K","Ctrl-T","fromTextArea","textarea","tabindex","placeholder","getAttribute","getValue","form","leaveSubmitMethodAlone","realSubmit","submit","wrappedSubmit","getTextArea","toTextArea","sol","peek","eat","ok","eatWhile","eatSpace","skipTo","backUp","column","pattern","consume","caseInsensitive","cased","str","toLowerCase","substr","visual","exists","clearCachedMeasurement","widgetOperation","oldH","cleanUpLine","runMode","forceToEnd","flattenSpans","curStart","curStyle","blankLine","maxHighlightLength","st","o","overlay","at","i_end","startAt","styleToClassCache","interpretTokenStyle","builder","lineClass","realLine","copyWidgets","empty","col","measuredSomething","addToken","buildTokenMeasure","buildToken","buildTokenSplitSpaces","insertLineContent","special","lastIndex","exec","skipped","tabWidth","specialCharPlaceholder","fullStyle","spanAffectsWrapping","whiteSpace","inner","out","buildCollapsedSpan","ignoreWidget","allText","spanStyle","spanEndStyle","spanStartStyle","nextChange","foundBookmarks","upto","tokenText","spansFor","updateLine","lastText","lastSpans","nlines","wholeLineUpdateBefore","added","insert","remove","LeafChunk","BranchChunk","children","chunkSize","removeInner","collapse","insertInner","iterN","child","sz","oldHeight","newleaf","maybeSpill","sibling","myIndex","used","nextDocId","makeHistory","cleanGeneration","lineSep","getLines","getRange","setLine","removeLine","getLineNumber","getLineHandleVisualStart","lineCount","setCursor","setExtending","historySize","markClean","changeGeneration","lastOp","lastOrigin","isClean","gen","getHistory","copyHistoryArray","setHistory","histData","setBookmark","realOpts","findMarksAt","getAllMarks","posFromIndex","indexFromPos","copyHistory","linkedDoc","unlinkDoc","splitIds","iterLinkedDocs","getEditor","eachLine","dontDelegate","method","sharedHistOnly","propagate","skip","rel","chunk","h","lh","bidiOrdering","startGen","lastTime","attachLocalSpans","existing","histChange","opId","historyEventDelay","events","newGroup","newChanges","rebaseHistSel","rebaseHistArray","array","sub","copied","readAfter","stopMethod","stop","preventDefault","e_stopPropagation","stopPropagation","cancelBubble","defaultPrevented","srcElement","button","emitter","addEventListener","attachEvent","_handlers","removeEventListener","detachEvent","arr","args","fireDelayed","bnd","override","codemirrorIgnore","ctor","startIndex","startValue","ms","spaceStrs","select","_e","collection","base","props","Obj","inst","nonASCIISingleCaseWordChar","toUpperCase","tag","createElement","count","innerHTML","textContent","getBoundingClientRect","replaceGetRect","zwspSupported","div","nl","rt","te","ownerDocument","selection","createRange","parentElement","compareEndPoints","oncopy","3","8","9","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","44","45","46","59","91","92","93","109","107","127","186","187","188","189","190","191","192","219","220","221","222","63276","63277","63275","63273","63234","63232","63235","63233","63302","63272","compareBidiLevel","linedir","moveInLine","byUnit","bidiRE","isNeutral","isStrong","countsAsLeft","countsAsNum","outerType","types","nstart","unshift","version"],"mappings":"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"}