import{G as e,S as t,i as s,s as i,e as a,j as o,c as l,b as r,u as n,f as d,g as u,T as p,m as c,h,l as f,x as m,q as g,r as b,o as x,D as y,t as v,a as w,d as _,y as k,k as E,n as A,p as C,A as T,E as S,X as M,v as z}from"./main-464952be.js";import{I as L}from"./ItemHelper-9b9be701.js";import{s as $,p as D}from"./index-c97c95b1.js";const F=window.baseUrl+"reactUpload.php/";let X;class P extends e{constructor(e,t){super(),this.timer={},this.eid=e,this.essay_ready(e,t)}essay_ready(e,t){let s=document.querySelector(e);X=t,setTimeout((()=>{this.bind("#drop a","click",(e=>{this.find(e.target.parentNode,"input").click()})),this.selectAll("[data-role=magic-overlay]").forEach((function(e){e.dataset.target})),t.onChange=(t,s)=>{this.updateXML(e,200,t)},t.onKeyDown=(t,s)=>{86!=t.keyCode&&67!=t.keyCode||this.updateXML(e,200,t.target.innerHTM)};let i=window.navigator.userAgent,a=i.indexOf("MSIE "),o=i.indexOf("Trident/");this.listen(s,"click","a.essay_dwl_file",(e=>{if(a>-1||o>-1){var t=e.getAttribute("href");e.removeAttribute("href"),window.open(t),setTimeout((()=>{this.select("a.essay_dwl_file").setAttribute("href",t)}),500)}setTimeout((()=>{this.select("#center").remove()}),500)}))}),500)}getPath(){let e="";"undefined"!=typeof test_session_uid?e="//s3.amazonaws.com/test_session/"+this.getForlderName(test_session_uid)+"/":"undefined"!=typeof user_guid&&(e="//s3.amazonaws.com/test_session/"+user_guid+"/");return e}getUploads(...e){let t=this.getPath();console.log("Upload media selected",e);let s=","+this.select(this.eid).getAttribute("data-filetypeexts");Array.prototype.forEach.call(e[0],(e=>{let i=new FormData;i.append("Filedata",e);let a=e.name.split("."),o=this.parseHtml('<li class="working"><span class="download" disabled="disabled"><a target="_blank" onclick="setTimeout(function(){activate(0)},500);" href="'+t+e.name+'" title="Download File"  class="essay_dwl_file icomoon-file-download"></a></span><span class="filename"></span><span class="fileSize"></span><span class="abort">abort</span><div id="progressbar"><div class="bar" style={{width: "0"}}></div></div></li>');this.find(o,".filename",{action:"text",actionData:e.name}),this.insert(this.find(o,".fileSize"),`<i>${this.formatFileSize(e.size)}</i>`,"beforeend"),this.find(this.eid,".essay_upload_status li","all").length>=this.select(this.eid).getAttribute("data-limit")?this.showmsg("The number of files uploaded exceeds the queue size limit ("+this.select(this.eid).getAttribute("data-limit")+")"):this.findInArray(a[1].toLowerCase(),s.split(",*."))?(this.find(this.eid,".essay_upload_status",{action:"addClass",actionData:"working_file"}),this.select(".essay_upload_status").append(o),this.essay_sendFile_ToServer(this.eid,i,status)):this.showmsg("The file format/file extension is not valid.")}))}formatFileSize(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"}essay_sendFile_ToServer(e,t,s){this.activate(1);let i="undefined"==typeof test_session_uid?"":test_session_uid,a=F+"?func=essay&exts="+this.select(e).dataset.filetypeexts+"&test_session_uid="+i;console.log(a),this.ajax({url:a,dataType:"text",formData:!0,contentType:!1,processData:!1,cache:!1,data:t}).then((()=>{this.activate(0),this.select(".essay_upload_status","css",{display:"block"}),this.select("#progressbar .bar","remove"),this.selectAll(".download","removeAttr","disabled"),this.updateXML(this.eid),this.showmsg("File uploaded sucessfully.")})).catch(((...e)=>{this.activate(0),console.log("File is recorded but not uploaded due to server error.",e),this.select("#progressbar .bar","remove"),this.selectAll(".download","removeAttr","disabled")}))}ext_array(e){let t=[];return this.selectAll(e.split(",")).forEach(((e,s)=>{let i=e.split(".");t.push(i[1])})),t}updateXML(e,t,s){this.timer.updateXML&&clearTimeout(this.timer.updateXML),this.timer.updateXML=setTimeout((()=>{let t=s||X.getContents(),i="";this.find(e,".essay_upload_status li","all").forEach((e=>{i=""==i?e.querySelector(".filename").innerHTML:i+","+e.querySelector(".filename").innerHTML})),window.inNative&&window.getHeight();let a=`<smans type='5'><userans><![CDATA[${t}]]></userans><upload><![CDATA[${i}]]></upload><path><![CDATA[${this.getPath()}]]></path></smans>`;window.ISSPECIALMODULEUSERXMLCHANGE=1,this.select("#special_module_user_xml","value",a),globalThis.saveUserAnswerInSapper?.({uXml:a,ans:"manual"}),window.inNative&&window.postMessage(JSON.stringify({userAnsXML:a,essayPreview:!0}),"*")}),t)}remove_file(e,t){let s=this.parent(e).querySelector(".filename").innerHTML;this.find(t,".essay_upload_status li","all").length<=1&&this.find(t,".essay_upload_status").classList.remove("working_file"),this.activate(1),this.ajax({url:F,data:{action:"remove_file",file_name:s}}).then((s=>{this.parent(e).remove(),this.updateXML(t),this.activate(0)}))}getForlderName(e){let t=e;if(e>856399||e<7e5){let s=this.str_pad(e%1e4,4,"0");t=this.str_pad(Math.floor(e/1e4),1,"0")+"/"+s}return t}str_pad(e,t,s){for(;e.length<t;)e=padString+e;return e}modeOn(e){this.selectAll(".test, .review","addClass","h"),e?this.selectAll("#upload, .abort","hide"):(this.select("#essay_edit").setAttribute("contenteditable","true"),this.selectAll(".abort","show"))}}function I(e,t,s){const i=e.slice();return i[20]=t[s],i[22]=s,i}function H(e){let t,s,i,g,b,y,E,A,C,T,S,M,$,D,F,X,P,I,H,R,U,B,j,q,G,K,J,W,Y,Q=e[3].limit+"",V=e[3].filetypeexts+"";t=new L({}),t.$on("setReview",e[5]),t.$on("unsetReview",(function(){z(e[6].bind(this,e[3].type))&&e[6].bind(this,e[3].type).apply(this,arguments)}));let Z=""!=e[3].upload&&N(e);return{c(){l(t.$$.fragment),s=r(),i=a("div"),g=a("div"),b=r(),y=a("textarea"),E=r(),A=a("div"),C=a("div"),T=n("Drag & Drop Files Here\n                        "),S=a("div"),M=n("You can upload upto "),$=n(Q),D=r(),F=n(V),X=n(" files."),P=r(),I=a("a"),I.textContent="Browse",H=r(),R=a("input"),B=r(),j=a("ul"),Z&&Z.c(),d(g,"id","essayPreviewToolbar"),d(g,"class","sun-editor"),d(y,"id","essay_edit"),d(y,"class","text-left editor sun-editor-editable"),d(S,"class","text-center"),u(S,"font-size","12px"),u(S,"font-weight","normal"),u(S,"position","relative"),u(S,"top","45px"),u(S,"word-wrap","break-word"),d(I,"href","#upl"),d(I,"class","essay-btn btn btn-light darkgrey_border svelte-hdiuou"),d(R,"type","file"),d(R,"name","upl"),d(R,"id","upl"),R.multiple="multiple",u(R,"opacity","0.5"),d(R,"class","svelte-hdiuou"),d(C,"id","drop"),d(C,"class","svelte-hdiuou"),d(A,"id","upload"),d(A,"class",U=p(1==window.isReview||1==e[0]||"0"==e[3].type?"h":"")+" svelte-hdiuou"),d(j,"class",q=p("0"==e[3].type?"essay_upload_status text-left h":"essay_upload_status text-left working_file")+" svelte-hdiuou"),u(j,"list-style-type","none"),d(i,"id",O),d(i,"data-filetypeexts",G=e[3].filetypeexts),d(i,"data-limit",K=e[3].limit),d(i,"class","essay-container m-auto hero-unit svelte-hdiuou")},m(a,l){c(t,a,l),h(a,s,l),h(a,i,l),o(i,g),o(i,b),o(i,y),o(i,E),o(i,A),o(A,C),o(C,T),o(C,S),o(S,M),o(S,$),o(S,D),o(S,F),o(S,X),o(C,P),o(C,I),o(C,H),o(C,R),o(i,B),o(i,j),Z&&Z.m(j,null),J=!0,W||(Y=[f(R,"change",e[10]),f(R,"change",e[11])],W=!0)},p(t,s){e=t,(!J||8&s)&&Q!==(Q=e[3].limit+"")&&m($,Q),(!J||8&s)&&V!==(V=e[3].filetypeexts+"")&&m(F,V),(!J||9&s&&U!==(U=p(1==window.isReview||1==e[0]||"0"==e[3].type?"h":"")+" svelte-hdiuou"))&&d(A,"class",U),""!=e[3].upload?Z?Z.p(e,s):(Z=N(e),Z.c(),Z.m(j,null)):Z&&(Z.d(1),Z=null),(!J||8&s&&q!==(q=p("0"==e[3].type?"essay_upload_status text-left h":"essay_upload_status text-left working_file")+" svelte-hdiuou"))&&d(j,"class",q),(!J||8&s&&G!==(G=e[3].filetypeexts))&&d(i,"data-filetypeexts",G),(!J||8&s&&K!==(K=e[3].limit))&&d(i,"data-limit",K)},i(e){J||(v(t.$$.fragment,e),J=!0)},o(e){w(t.$$.fragment,e),J=!1},d(e){_(t,e),e&&x(s),e&&x(i),Z&&Z.d(),W=!1,k(Y)}}}function N(e){let t,s=e[3].upload.split(","),i=[];for(let t=0;t<s.length;t+=1)i[t]=U(I(e,s,t));return{c(){for(let e=0;e<i.length;e+=1)i[e].c();t=g()},m(e,s){for(let t=0;t<i.length;t+=1)i[t].m(e,s);h(e,t,s)},p(e,a){if(25&a){let o;for(s=e[3].upload.split(","),o=0;o<s.length;o+=1){const l=I(e,s,o);i[o]?i[o].p(l,a):(i[o]=U(l),i[o].c(),i[o].m(t.parentNode,t))}for(;o<i.length;o+=1)i[o].d(1);i.length=s.length}},d(e){y(i,e),e&&x(t)}}}function R(e){let t,s,i;return{c(){t=a("span"),t.textContent="abort",d(t,"class","abort svelte-hdiuou")},m(a,o){h(a,t,o),s||(i=f(t,"click",e[4]),s=!0)},p:b,d(e){e&&x(t),s=!1,i()}}}function U(e){let t,s,i,l,u,p,c,f,g,b,y=e[20]+"",v=!e[0]&&R(e);return{c(){t=a("li"),s=a("span"),i=a("a"),l=a("i"),p=r(),c=a("span"),f=n(y),g=r(),v&&v.c(),b=r(),d(l,"class","icomoon-file-download"),d(i,"target","_blanks"),d(i,"href",u=e[3].path+e[20]),d(i,"title","Download File"),d(i,"class","essay_dwl_file svelte-hdiuou"),d(s,"class","download"),d(c,"class","filename"),d(t,"class","working")},m(e,a){h(e,t,a),o(t,s),o(s,i),o(i,l),o(t,p),o(t,c),o(c,f),o(t,g),v&&v.m(t,null),o(t,b)},p(e,s){8&s&&u!==(u=e[3].path+e[20])&&d(i,"href",u),8&s&&y!==(y=e[20]+"")&&m(f,y),e[0]?v&&(v.d(1),v=null):v?v.p(e,s):(v=R(e),v.c(),v.m(t,b))},d(e){e&&x(t),v&&v.d()}}}function B(e){let t,s,i,l,n,u=e[3]&&H(e);return{c(){t=a("main"),s=a("p"),i=r(),l=a("div"),u&&u.c(),d(s,"id","demo")},m(e,a){h(e,t,a),o(t,s),o(t,i),o(t,l),u&&u.m(l,null),n=!0},p(e,[t]){e[3]?u?(u.p(e,t),8&t&&v(u,1)):(u=H(e),u.c(),v(u,1),u.m(l,null)):u&&(E(),w(u,1,1,(()=>{u=null})),A())},i(e){n||(v(u),n=!0)},o(e){w(u),n=!1},d(e){e&&x(t),u&&u.d()}}}let O="essayPreviewContainer";function j(e,t,s){let i,a,o,{xml:l}=t,{uxml:r}=t,{isReview:n}=t,{editorState:d}=t,u={userans:"",appPath:"",essayStr:"",userAns:"",site_url:""},p={},c="";function h(){console.log("set Content"),o.setContents(c)}function f(e,t){let i=t?M(t):"";e=M(e);try{let t=e.smxml.default?e.smxml.default:e.smxml;c=i&&10!=i.smans.userans.charCodeAt(0)?i.smans.userans:void 0!==t.__cdata?t.__cdata:"",s(3,p={userans:c,filetypeexts:t._filetypeexts,limit:t._limit,type:"5"==t._type?"0":t._type,upload:i?i.smans.upload:"",path:i?i.smans.path:""})}catch(e){console.log({error:e,func:"loadXml",file:"EssayPreview.svelte"})}}C((()=>{d&&T.set(d.content_type+"_refresh",h.bind(this)),f(l,r),o=$.create("essay_edit",{height:"300px",value:c,width:"auto",toolbarContainer:"#essayPreviewToolbar",placeholder:"Write text here.",resizingBar:!1,showPathLabel:!1,plugins:D,fontSize:10,defaultStyle:"padding-left: 10px",buttonList:[["formatBlock"],["bold","italic","underline"],["link"],["list","outdent","indent","align"],["removeFormat"]]}),s(1,i=new P("#"+O,o))})),S((()=>{l!=u.xml&&(u.xml=l,console.log("Updating from Preview"),f(l,r))}));return e.$$set=e=>{"xml"in e&&s(7,l=e.xml),"uxml"in e&&s(8,r=e.uxml),"isReview"in e&&s(0,n=e.isReview),"editorState"in e&&s(9,d=e.editorState)},e.$$.update=()=>{e.$$.dirty},[n,i,a,p,function(e){i.remove_file(e.currentTarget,"#"+O)},function(){s(0,n=!0),o.disabled(),i.modeOn("on")},function(e){s(0,n=!1),o.enabled(),0!=e&&(T.select("#upload","show"),T.select("#upload","removeClass","h")),i.modeOn("")},l,r,d,function(){a=this.files,s(2,a)},e=>i.getUploads(a,e)]}export default class extends t{constructor(e){var t;super(),document.getElementById("svelte-hdiuou-style")||((t=a("style")).id="svelte-hdiuou-style",t.textContent=".hero-unit.svelte-hdiuou.svelte-hdiuou{border:1px solid #ccc;width:84%;padding:18px!important;font-size:15px!important;margin-bottom:30px;font-weight:200;line-height:30px;color:inherit;background-color:#eeeeee;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px}.essay_upload_status.svelte-hdiuou.svelte-hdiuou{margin-top:10px}.abort.svelte-hdiuou.svelte-hdiuou{padding-left:15px;cursor:pointer}.essay-btn.svelte-hdiuou.svelte-hdiuou,#essayfile-button.svelte-hdiuou.svelte-hdiuou,#editfiles.svelte-hdiuou.svelte-hdiuou{display:inline-block;padding:4px 8px;font-size:12px;line-height:20px;text-align:center;vertical-align:middle;cursor:pointer;color:#333333;text-shadow:0 1px 1px rgba(255, 255, 255, 0.75);background-color:#f5f5f5;background-image:-moz-linear-gradient(top, #ffffff, #e6e6e6);background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#ffffff), to(#e6e6e6));background-image:-webkit-linear-gradient(top, #ffffff, #e6e6e6);background-image:-o-linear-gradient(top, #ffffff, #e6e6e6);background-image:linear-gradient(to bottom, #ffffff, #e6e6e6);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffffff', endColorstr='#ffe6e6e6', GradientType=0);border-color:#e6e6e6 #e6e6e6 #bfbfbf;border-color:rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);filter:progid:DXImageTransform.Microsoft.gradient(enabled = false);border:1px solid #cccccc;border-bottom-color:#b3b3b3;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,.2), 0 1px 2px rgba(0,0,0,.05);-moz-box-shadow:inset 0 1px 0 rgba(255,255,255,.2), 0 1px 2px rgba(0,0,0,.05);box-shadow:inset 0 1px 0 rgba(255,255,255,.2), 0 1px 2px rgba(0,0,0,.05)}#upload.svelte-hdiuou.svelte-hdiuou{font-family:'PT Sans Narrow', sans-serif;background-color:#E0E0E0;background-image:-webkit-linear-gradient(top, #E0E0E0, #E0E0E0);background-image:-moz-linear-gradient(top, #E0E0E0, #E0E0E0);background-image:linear-gradient(top, #E0E0E0, #E0E0E0);width:100%;padding:30px 30px 0;border-radius:3px;border-collapse:separate;border:1px solid rgb(204, 204, 204);margin-top:2px}#drop.svelte-hdiuou.svelte-hdiuou{background-color:#EEEEEE;padding:25px 30px;margin-bottom:30px;border:20px solid rgba(0, 0, 0, 0);border-radius:3px;text-align:center;font-size:16px;font-weight:bold;color:#7f858a;border:1px solid #CCCCCC}#drop.svelte-hdiuou a.svelte-hdiuou{padding:12px 5%;color:#2B2E31;font-size:14px;border-radius:2px;cursor:pointer;display:inline-block;margin-top:12px;margin-bottom:12px;line-height:1;text-decoration:none;position:relative;top:30px}#drop.svelte-hdiuou input.svelte-hdiuou{display:none}.essay-btn.svelte-hdiuou.svelte-hdiuou{margin-bottom:15px}.essay-container.svelte-hdiuou.svelte-hdiuou{width:89%}",o(document.head,t)),s(this,e,j,B,i,{xml:7,uxml:8,isReview:0,editorState:9})}}
//# sourceMappingURL=EssayPreview-2989489c.js.map
