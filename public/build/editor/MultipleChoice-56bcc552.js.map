{"version":3,"file":"MultipleChoice-56bcc552.js","sources":["../../../clsSMMultipleChoice/MultipleChoice.svelte"],"sourcesContent":["<script>\n\t/**\n\t * File: MultipleChoice.svelte\n\t * Author: Pradeep Yadav\n\t * Description: Authoring file for multiple choice\n\t */\n\timport { onMount } from \"svelte\";\n\timport { writable } from \"svelte/store\";\n\timport { AH } from \"../helper/HelperAI.svelte\";\n\timport OptionContainer from \"./OptionContainer.svelte\";\n\texport let ucEditor;\n\texport let getChildXml;\n\texport let editorState;\n\texport let xml;\n\n\tlet state = {};\n\tlet hdd = writable({\n\t\t\tcorrectAnswers:\"\",\n\t\t\toptionData:\"\",\n\t\t\toptionDataCopy:\"\",\n\t\t\treviewMode:false,\n\t\t\txml:\"\",\n\t\t\toptionCounter: 1,\n\t\t});\n\tconst unsubscribe = hdd.subscribe((items)=> {\n\t\tstate = items;\n\t});\n\tlet letters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\".split('');\n\n\tonMount(async()=> {\n\t\tdidMount();\n\t})\n\n\t// Interate and load Options\n\tfunction didMount() {\n\t\tvar init = setTimeout(function() {\n\t\t\tloadOldType();\n\t\t\tvar loadTimer = setTimeout(function() {\n\t\t\t\ttry {\n\t\t\t\t\tdocument.querySelectorAll(\"[id^='option']\").forEach((_this, i)=> {\n\t\t\t\t\t\tif (_this.querySelectorAll(\".pln\").length > 0) {\n\t\t\t\t\t\t\t_this.querySelectorAll(\".pln\").forEach((_this2)=> {\n\t\t\t\t\t\t\t\tif (_this2.nextElementSibling.length > 0 && _this.previousElementSibling.length > 0) {\n\t\t\t\t\t\t\t\t\tif (_this2.nextElementSibling.nodeName == \"BR\" && _this2.previousElementSibling.nodeName == \"BR\") {\n\t\t\t\t\t\t\t\t\t\t_this.nextElementSibling.remove();\n\t\t\t\t\t\t\t\t\t\t_this2.remove();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\txml ? editOption(i) : \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} catch(error) {\n\t\t\t\t\tconsole.log({err:\"Removing PrettyPrint  BR from Authoring Error\", func:'componentDidMount'});\n\t\t\t\t}\n\t\t\t\tucEditor.initEditor(false, \"#authoringSection .ebook_item_text\");\n\t\t\t\tclearTimeout(loadTimer);\n\t\t\t}, 3000);\n\t\t\tclearTimeout(init);\n\t\t}, 200);\n\t\tAH.listen(document, 'keydown', '.answer_container .delete_element', function(_this, event) {\n\t\t\tif ((event.keyCode == 13 || event.which == 13)) {\n\t\t\t\t// click the element which currently get the focus and enter key is down\n\t\t\t\tAH.trigger(_this, 'click');\n\t\t\t}\n        });\n        \n        // this condition used for that guid which is generated by the help of List Item module\n        if (editorState.ajaxData.parent_guid) {\n            // used for only show the preview\n            preview_edit = 1;\n            AI && AI.set('get_parent_guid', editorState.ajaxData.parent_guid);\n        }\n\t}\n\n\t// TO update modified options\n\tfunction updateProps(newData) {\n\t\teditorState.ajaxData.correct_answers = newData.correct_answers;\n\t\teditorState.ajaxData.answers = newData.answers;\n\t\tgetChildXml(editorState, \"mcqType\");\n\t}\n\n\t// Check options and set state\n\tfunction loadOldType() {\n\t\tstate.correctAnswers = editorState.ajaxData.correct_answers;\n\t\tstate.optionData = editorState.ajaxData.answers;\n\t\tstate.optionDataCopy = editorState.ajaxData.answers;\n\t\tstate.optionCounter = editorState.ajaxData.answers.length;\n\t}\n\n\t// Handle Edit of options\n\tfunction editOption(index){\n\t\tlet quesData = ucEditor.getContent(\"option\"+index);\n\t\tstate.optionDataCopy[index]['answer'] = AI.ignoreEnity(quesData);\n\t\tupdateProps({\n\t\t\tcorrect_answers: state.correctAnswers,\n\t\t\tanswers: state.optionDataCopy,\n\t\t});\n\t}\n\n\t//Handle Delete options\n\tfunction deleteOption(index) {\n\t\tlet temp = [];\n\t\tstate.optionDataCopy.map((data, i)=> {\n\t\t\tif (i != index) {\n\t\t\t\ttemp.push(data);\n\t\t\t}\n\t\t});\n\t\tconsole.log(temp);\n\t\tstate.optionDataCopy = temp;\n\t\tupdateProps({\n\t\t\tcorrect_answers: state.correctAnswers,\n\t\t\tanswers: temp,\n\t\t});\n\t\tupdateOptionData(temp);\n\t}\n\n\t// Handle addition of new options\n\tfunction addOption(index) {\n\t\tlet temp1 = state.optionDataCopy;\n\t\tstate.optionCounter = state.optionCounter + 1;\n\t\ttemp1.push({\n\t\t\tanswer: \"Option\",\n\t\t\tid: \"id\" + (state.optionCounter),\n\t\t\tis_correct:\"0\",\n\t\t\tseq_str:\"\",\n\t\t\tseq_tag:\"\"\n\t\t});\n\t\tstate.optionDataCopy = temp1;\n\t\tupdateProps({\n\t\t\tcorrect_answers: state.correctAnswers,\n\t\t\tanswers: temp1,\n\t\t});\n\t\tupdateOptionData(temp1);\n\t\t\n\t\ttinymce.EditorManager.editors = [];//@saquib:added this line\n\t\tucEditor.initEditor();\n\t\tsetTimeout(()=> {\n\t\t\tucEditor.initEditor(false, \"#authoringSection .ebook_item_text\");\n\t\t},1000);\n\t}\n\n\t// Update option's data\n\tfunction updateOptionData(data) {\n\t\tdata = JSON.stringify(data);\n\t\tdata  = JSON.parse(data);\n\t\tstate.optionData = data;\n\t}\n\n\t// Handle checked\n\tfunction toggleChecked(index,e) {\n\t\tlet correctAnswers = 0;\n\t\tstate.optionDataCopy[index]['is_correct'] = ((e.target.checked) ? \"1\" : \"0\");\n\t\tfor (let i in state.optionDataCopy) {\n\t\t\tif (state.optionDataCopy[i][\"is_correct\"] == \"1\") {\n\t\t\t\tcorrectAnswers++;\n\t\t\t}\n\t\t}\n\t\tstate.correctAnswers = correctAnswers;\n\t\tlet temp = state.optionDataCopy;\n\t\tupdateOptionData(temp);\n\t\tupdateProps({\n\t\t\tcorrect_answers: correctAnswers,\n\t\t\tanswers: state.optionDataCopy,\n\t\t});\n\t}\n</script>\n\n<div>\n\t{#if (state.optionData)}\n\t\t<OptionContainer \n\t\t\ttoggleChecked={toggleChecked} \n\t\t\tdeleteOption={deleteOption} \n\t\t\teditOption={editOption} \n\t\t\tletters={letters} \n\t\t\tcorrectAnswers={state.correctAnswers} \n\t\t\treviewMode={state.reviewMode} \n\t\t\tdata={state.optionData} \n\t\t/>\n\t{/if}\n\t<div class=\"mt-lg position-relative col-12 bottom20 pl-0\" style=\"padding-top: 8px;\">\n\t\t<button \n\t\t\tvariant=\"fab\" \n\t\t\tcolor=\"primary\"\n\t\t\taria-label=\"Add\"\n\t\t\ton:click={addOption}\n\t\t\tclass=\"rounded d-flex align-items-center btn btn-sm btn-outline-primary pr-md\"\n\t\t\tstyle=\"text-transform: none;\"\n\t\t>\n\t\t\t<span class=\"icomoon-plus pr-1\"></span>Add option\n\t\t</button> \n\t</div>\n</div>"],"names":["ctx","correctAnswers","reviewMode","optionData","ucEditor","getChildXml","editorState","xml","state","writable","optionDataCopy","optionCounter","subscribe","items","letters","split","updateProps","newData","ajaxData","correct_answers","answers","editOption","index","quesData","getContent","AI","ignoreEnity","updateOptionData","data","JSON","stringify","parse","onMount","init","setTimeout","length","loadTimer","document","querySelectorAll","forEach","_this","i","_this2","nextElementSibling","previousElementSibling","nodeName","remove","error","console","log","err","func","initEditor","clearTimeout","AH","listen","event","keyCode","which","trigger","parent_guid","preview_edit","set","didMount","temp","map","push","temp1","answer","id","is_correct","seq_str","seq_tag","tinymce","EditorManager","editors","e","target","checked"],"mappings":"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"}