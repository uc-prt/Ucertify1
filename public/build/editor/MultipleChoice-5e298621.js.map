{"version":3,"file":"MultipleChoice-5e298621.js","sources":["../../../clsSMMultipleChoice/MultipleChoice.svelte"],"sourcesContent":["<script>\r\n\t/**\r\n\t * File: MultipleChoice.svelte\r\n\t * Author: Pradeep Yadav\r\n\t * Description: Authoring file for multiple choice\r\n\t */\r\n\timport { onMount } from \"svelte\";\r\n\timport { writable } from \"svelte/store\";\r\n\timport { AH } from \"../helper/HelperAI.svelte\";\r\n\timport OptionContainer from \"./OptionContainer.svelte\";\r\n\texport let ucEditor;\r\n\texport let getChildXml;\r\n\texport let editorState;\r\n\texport let xml;\r\n\r\n\tlet state = {};\r\n\tlet hdd = writable({\r\n\t\t\tcorrectAnswers:\"\",\r\n\t\t\toptionData:\"\",\r\n\t\t\toptionDataCopy:\"\",\r\n\t\t\treviewMode:false,\r\n\t\t\txml:\"\",\r\n\t\t\toptionCounter: 1,\r\n\t\t});\r\n\tconst unsubscribe = hdd.subscribe((items)=> {\r\n\t\tstate = items;\r\n\t});\r\n\tlet letters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\".split('');\r\n\r\n\tonMount(async()=> {\r\n\t\tdidMount();\r\n\t})\r\n\r\n\t// Interate and load Options\r\n\tfunction didMount() {\r\n\t\tvar init = setTimeout(function() {\r\n\t\t\tloadOldType();\r\n\t\t\tvar loadTimer = setTimeout(function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tdocument.querySelectorAll(\"[id^='option']\").forEach((_this, i)=> {\r\n\t\t\t\t\t\tif (_this.querySelectorAll(\".pln\").length > 0) {\r\n\t\t\t\t\t\t\t_this.querySelectorAll(\".pln\").forEach((_this2)=> {\r\n\t\t\t\t\t\t\t\tif (_this2.nextElementSibling.length > 0 && _this.previousElementSibling.length > 0) {\r\n\t\t\t\t\t\t\t\t\tif (_this2.nextElementSibling.nodeName == \"BR\" && _this2.previousElementSibling.nodeName == \"BR\") {\r\n\t\t\t\t\t\t\t\t\t\t_this.nextElementSibling.remove();\r\n\t\t\t\t\t\t\t\t\t\t_this2.remove();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\txml ? editOption(i) : \"\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch(error) {\r\n\t\t\t\t\tconsole.log({err:\"Removing PrettyPrint  BR from Authoring Error\", func:'componentDidMount'});\r\n\t\t\t\t}\r\n\t\t\t\tucEditor.initEditor(false, \"#authoringSection .ebook_item_text\");\r\n\t\t\t\tclearTimeout(loadTimer);\r\n\t\t\t}, 3000);\r\n\t\t\tclearTimeout(init);\r\n\t\t}, 200);\r\n\t\tAH.listen(document, 'keydown', '.answer_container .delete_element', function(_this, event) {\r\n\t\t\tif ((event.keyCode == 13 || event.which == 13)) {\r\n\t\t\t\t// click the element which currently get the focus and enter key is down\r\n\t\t\t\tAH.trigger(_this, 'click');\r\n\t\t\t}\r\n        });\r\n        \r\n        // this condition used for that guid which is generated by the help of List Item module\r\n        if (editorState.ajaxData.parent_guid) {\r\n            // used for only show the preview\r\n            preview_edit = 1;\r\n            AI && AI.set('get_parent_guid', editorState.ajaxData.parent_guid);\r\n        }\r\n\t}\r\n\r\n\t// TO update modified options\r\n\tfunction updateProps(newData) {\r\n\t\teditorState.ajaxData.correct_answers = newData.correct_answers;\r\n\t\teditorState.ajaxData.answers = newData.answers;\r\n\t\tgetChildXml(editorState, \"mcqType\");\r\n\t}\r\n\r\n\t// Check options and set state\r\n\tfunction loadOldType() {\r\n\t\tstate.correctAnswers = editorState.ajaxData.correct_answers;\r\n\t\tstate.optionData = editorState.ajaxData.answers;\r\n\t\tstate.optionDataCopy = editorState.ajaxData.answers;\r\n\t\tstate.optionCounter = editorState.ajaxData.answers.length;\r\n\t}\r\n\r\n\t// Handle Edit of options\r\n\tfunction editOption(index){\r\n\t\tlet quesData = ucEditor.getContent(\"option\"+index);\r\n\t\tstate.optionDataCopy[index]['answer'] = AI.ignoreEnity(quesData);\r\n\t\tupdateProps({\r\n\t\t\tcorrect_answers: state.correctAnswers,\r\n\t\t\tanswers: state.optionDataCopy,\r\n\t\t});\r\n\t}\r\n\r\n\t//Handle Delete options\r\n\tfunction deleteOption(index) {\r\n\t\tlet temp = [];\r\n\t\tstate.optionDataCopy.map((data, i)=> {\r\n\t\t\tif (i != index) {\r\n\t\t\t\ttemp.push(data);\r\n\t\t\t}\r\n\t\t});\r\n\t\tconsole.log(temp);\r\n\t\tstate.optionDataCopy = temp;\r\n\t\tupdateProps({\r\n\t\t\tcorrect_answers: state.correctAnswers,\r\n\t\t\tanswers: temp,\r\n\t\t});\r\n\t\tupdateOptionData(temp);\r\n\t}\r\n\r\n\t// Handle addition of new options\r\n\tfunction addOption(index) {\r\n\t\tlet temp1 = state.optionDataCopy;\r\n\t\tstate.optionCounter = state.optionCounter + 1;\r\n\t\ttemp1.push({\r\n\t\t\tanswer: \"Option\",\r\n\t\t\tid: \"id\" + (state.optionCounter),\r\n\t\t\tis_correct:\"0\",\r\n\t\t\tseq_str:\"\",\r\n\t\t\tseq_tag:\"\"\r\n\t\t});\r\n\t\tstate.optionDataCopy = temp1;\r\n\t\tupdateProps({\r\n\t\t\tcorrect_answers: state.correctAnswers,\r\n\t\t\tanswers: temp1,\r\n\t\t});\r\n\t\tupdateOptionData(temp1);\r\n\t\t\r\n\t\ttinymce.EditorManager.editors = [];//@saquib:added this line\r\n\t\tucEditor.initEditor();\r\n\t\tsetTimeout(()=> {\r\n\t\t\tucEditor.initEditor(false, \"#authoringSection .ebook_item_text\");\r\n\t\t},1000);\r\n\t}\r\n\r\n\t// Update option's data\r\n\tfunction updateOptionData(data) {\r\n\t\tdata = JSON.stringify(data);\r\n\t\tdata  = JSON.parse(data);\r\n\t\tstate.optionData = data;\r\n\t}\r\n\r\n\t// Handle checked\r\n\tfunction toggleChecked(index,e) {\r\n\t\tlet correctAnswers = 0;\r\n\t\tstate.optionDataCopy[index]['is_correct'] = ((e.target.checked) ? \"1\" : \"0\");\r\n\t\tfor (let i in state.optionDataCopy) {\r\n\t\t\tif (state.optionDataCopy[i][\"is_correct\"] == \"1\") {\r\n\t\t\t\tcorrectAnswers++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tstate.correctAnswers = correctAnswers;\r\n\t\tlet temp = state.optionDataCopy;\r\n\t\tupdateOptionData(temp);\r\n\t\tupdateProps({\r\n\t\t\tcorrect_answers: correctAnswers,\r\n\t\t\tanswers: state.optionDataCopy,\r\n\t\t});\r\n\t}\r\n</script>\r\n\r\n<div>\r\n\t{#if (state.optionData)}\r\n\t\t<OptionContainer \r\n\t\t\ttoggleChecked={toggleChecked} \r\n\t\t\tdeleteOption={deleteOption} \r\n\t\t\teditOption={editOption} \r\n\t\t\tletters={letters} \r\n\t\t\tcorrectAnswers={state.correctAnswers} \r\n\t\t\treviewMode={state.reviewMode} \r\n\t\t\tdata={state.optionData} \r\n\t\t/>\r\n\t{/if}\r\n\t<div class=\"mt-lg position-relative col-12 bottom20 pl-0\" style=\"padding-top: 8px;\">\r\n\t\t<button \r\n\t\t\tvariant=\"fab\" \r\n\t\t\tcolor=\"primary\"\r\n\t\t\taria-label=\"Add\"\r\n\t\t\ton:click={addOption}\r\n\t\t\tclass=\"rounded d-flex align-items-center btn btn-sm btn-outline-primary pr-md\"\r\n\t\t\tstyle=\"text-transform: none;\"\r\n\t\t>\r\n\t\t\t<span class=\"icomoon-plus pr-1\"></span>Add option\r\n\t\t</button> \r\n\t</div>\r\n</div>"],"names":["ctx","correctAnswers","reviewMode","optionData","insert","append","ucEditor","getChildXml","editorState","xml","state","writable","optionDataCopy","optionCounter","subscribe","items","letters","split","updateProps","newData","ajaxData","correct_answers","answers","editOption","index","quesData","getContent","AI","ignoreEnity","updateOptionData","data","JSON","stringify","parse","onMount","init","setTimeout","length","loadTimer","document","querySelectorAll","forEach","_this","i","_this2","nextElementSibling","previousElementSibling","nodeName","remove","error","console","log","err","func","initEditor","clearTimeout","AH","listen","event","keyCode","which","trigger","parent_guid","preview_edit","set","didMount","temp","map","push","temp1","answer","id","is_correct","seq_str","seq_tag","tinymce","EditorManager","editors","e","target","checked"],"mappings":"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"}