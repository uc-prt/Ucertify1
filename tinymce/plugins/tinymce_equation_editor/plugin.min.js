tinymce.create("tinymce.plugins.EquationEditorPlugin", {
    init: function(t, e) {
        var n;
        return n = null, t.addCommand("mceMathquill", function(i) {
            var r;
            return i || (i = ""), r = t.windowManager.open({
                url: themeUrl + "pe-items/tinymce/plugins/tinymce_equation_editor/equation_editor.html",
                width: 820,
                height: 400,
                inline: 1,
                popup_css: !1,
                title: "Equation Editor",
                buttons: [{
                    text: "insert",
                    subtype: "primary",
                    onclick: function() {
                        var e, n;
                        return n = t.windowManager.getWindows()[0], e = t.windowManager.getParams().latexInput.mathquill("latex"), t.execCommand("mceMathquillInsert", e), n.close()
                    }
                }, {
                    text: "cancel",
                    onclick: function() {
                        return n = null, t.windowManager.getWindows()[0].close()
                    }
                }]
            }, {
                plugin_url: e,
                existing_latex: i
            })
        }), t.addCommand("mceMathquillInsert", function(e) {
            var i;
            if (window.currentId) return document.querySelector(window.currentInp).value = e
            if (e) return i = '<span type="e" id="latexSpan'+(++window.spanCounter)+'" class="alert alert-info editFill editMath" latex="'+e+'" originalKey="%{'+e+'|e}%" style="padding: 5px;outline: none;line-height:40px;cursor:move;color:#000" contentEditable="false"><i style="padding-right:4px" class="icomoon-insert-template"></i>Math</span>',/*window.currentId = "latexSpan"+window.spanCounter,*/ n && t.selection.select(n), n = null, t.selection.setContent(i)
        }), t.on("init", function() {
            return $(t.getDoc()).on("click", ".latexEditButton", function(e) {
                var i;
                var id = $(this).children(0)[0].id;
                id = "#input" + (id.replace(/[^\d]/g,""));
                window.currentInp = id;
                
                if($("#"+window.currentId).attr("latex").indexOf('user Response') > -1) {
                    var new_latex = $("#"+window.currentId).attr("latex").replace(/user Response/g , '')
                    $("#"+window.currentId).attr("latex",new_latex);
                }
                return e.stopPropagation(), n = document.querySelector("#"+window.currentId), i = $(id).val().replace(/user Response/g, "").replace(/\}\}/g, "}"), t.execCommand("mceMathquill", i);
            })
        }), t.addButton("equationeditor", {
            title: "Equation editor",
            cmd: "mceMathquill",
            text: "f(x)"
        }), t.on("preProcess", function(t) {
            var e;
            return e = t.target.dom.select(".rendered-latex:not(.mathquill-rendered-math)"), $(e).mathquill()
        }), t.on("loadContent", function(t) {
            var e;
            return e = t.target.dom.select("span.rendered-latex:not(.mathquill-rendered-math)"), $(e).mathquill()
        }), t.on("setContent", function(t) {
            var e;
            return e = t.target.dom.select("span.rendered-latex:not(.mathquill-rendered-math)"), $(e).mathquill()
        })
    },
    getInfo: function() {
        return {
            longname: "Equation Editor",
            author: "Foraker, derived from https://github.com/laughinghan/tinymce_mathquill_plugin",
            authorurl: "http://www.foraker.com",
            infourl: "https://github.com/foraker/tinymce_equation_editor",
            version: "1.0"
        }
    }
}), tinymce.PluginManager.add("equationeditor", tinymce.plugins.EquationEditorPlugin);